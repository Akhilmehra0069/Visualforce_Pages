(function(b){var a=new (function(){var n=!!{}.hasOwnProperty,i=Object.prototype.toString,c=function(){var m=null;return function(){if(m===null){m=b.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"}return m}}(),j=function(m){return m<10?"0"+m:m},l=function(m){return m},r=function(z){if(!p(z)||z===null){return"null"
}else{if(o(z)){return h(z)}else{if(q(z)){return u(z)}else{if(d(z)){return t(z)}else{if(typeof z=="number"){return isFinite(z)?String(z):"null"}else{if(f(z)){return String(z)}else{var w=["{"],m,y,x;for(y in z){if(!z.getElementsByTagName){if(!n||z.hasOwnProperty(y)){x=z[y];switch(typeof x){case"undefined":case"function":case"unknown":break;
default:if(m){w.push(",")}w.push(r(y),":",x===null?"null":r(x));m=true}}}}w.push("}");return w.join("")}}}}}}},k={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t=function(m){if(/["\\\x00-\x1f]/.test(m)){return'"'+m.replace(/([\x00-\x1f\\"])/g,function(w,v){var x=k[v];if(x){return x
}x=v.charCodeAt();return"\\u00"+Math.floor(x/16).toString(16)+(x%16).toString(16)})+'"'}return'"'+m+'"'},h=function(A){var x=["["],m,z,w=A.length,y;for(z=0;z<w;z+=1){y=A[z];switch(typeof y){case"undefined":case"function":case"unknown":break;default:if(m){x.push(",")}x.push(y===null?"null":a.encode(y));
m=true}}x.push("]");return x.join("")},u=function(m){return'"'+m.getFullYear()+"-"+j(m.getMonth()+1)+"-"+j(m.getDate())+"T"+j(m.getHours())+":"+j(m.getMinutes())+":"+j(m.getSeconds())+'"'},o=("isArray" in Array)?Array.isArray:function(m){return i.call(m)==="[object Array]"},q=function(m){return i.call(m)==="[object Date]"
},g=(typeof document!=="undefined"&&typeof document.getElementsByTagName("body")==="function")?function(m){return i.call(m)==="[object Function]"}:function(m){return typeof m==="function"},d=function(m){return typeof m==="string"},f=function(m){return typeof m==="boolean"},p=function(m){return typeof m!=="undefined"
};this.encode=function(){var m;return function(v){if(!m){m=c()?JSON.stringify:r}return m(v)}}();this.decode=function(){var m;return function(v){if(!m){m=c()?JSON.parse:l}return m(v)}}()})()})(window);(function(m,i){var g=0,o=1,a=2,b=3,c={},l={},f=0;var k=function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){return new Number(RegExp.$1)
}else{return 100}};if(m.sessionStorage){f=o}else{if(m.globalStorage){f=a}else{if(k()<8){f=b}else{f=g}}}var n={init:function(){},clear:function(){},getItem:function(d){return null},length:function(){return 0},removeItem:function(d){},setItem:function(d,p){},getMode:function(){return f},onError:function(){throw {name:"StorageError",message:ex.message}
},isReady:false};if(f==o){l=m.sessionStorage;n.clear=function(){l.clear()};n.getItem=function(p){try{return l.getItem(p)}catch(d){return null}};n.length=function(){return l.length};n.removeItem=function(p){try{l.removeItem(p)}catch(d){}};n.setItem=function(p,q){try{l.setItem(p,q)}catch(d){}};n.isReady=true
}else{if(f==a){l=m.globalStorage[m.location.hostname];n.clear=function(){for(var d in l){if(l.hasOwnProperty(d)){l.remove(d);delete l[d]}}};n.getItem=function(p){try{return l[p].value}catch(d){return null}};n.length=function(){return l.length};n.removeItem=function(d){l.removeItem(d)};n.setItem=function(d,p){l.setItem(d,p)
};n.isReady=true}else{if(f==b){var h="sfdc_user_data";var j="user_data";l=i.createElement("span");l.id=h;l.addBehavior("#default#userData");n.init=function(){try{i.body.appendChild(l);l.load(h);c=JSON.parse(l.getAttribute(j));if(!c){c={}}}catch(d){c={}}n.isReady=true};n.clear=function(){c={};n._save()
};n.getItem=function(d){return c.hasOwnProperty(d)?c[d]:null};n.length=function(){var p=0,d;for(d in c){if(c.hasOwnProperty(d)){p+=1}}return p};n.removeItem=function(d){delete c[d];n._save()};n.setItem=function(d,p){c[d]=p;n._save()};n._save=function(){if(!n.isReady){n.init()}var p=JSON.stringify(c);
try{l.setAttribute(j,p);l.save(h)}catch(d){n.onError(d)}}}else{}}}window.StorageManager=n})(window,document);var presence={};presence.Model={};presence.Controller={};presence.View={};presence.View.build={};presence.config={};presence.logPanel="buddies_log";presence.USE_NATIVE_JSON=false;presence.isIE=(navigator.appName.indexOf("Microsoft")!=-1)?true:false;
presence.isFF=(navigator.userAgent.indexOf("Firefox")!=-1)?true:false;presence.isSFDC_LogOut_TimeOut=false;var umps_popoutChatWindow=null;presence.log=function(b,a){if(typeof(console)=="undefined"||console==null||!presence.config.logLevel){return}try{if(a=="error"){console.error("presence: "+b)}else{if(a=="warn"&&presence.config.logLevel>=2){console.warn("presence: "+b)
}else{if(a=="info"&&presence.config.logLevel>=3){console.info("presence: "+b)}else{if(presence.config.logLevel>=4){console.log("presence: "+b)}}}}}catch(c){}};presence.getPresenceElement=function(a){return canvas_doc.getElementById(a)};presence.addHandler=function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)
}else{if(c.attachEvent){c.attachEvent("on"+a,b)}}};presence.removeElementFrom=function(b,d){var a=presence.getPresenceElement(d);var c=presence.getPresenceElement(b);a.removeChild(c);return true};presence.checkElementExist=function(a){var b=presence.getPresenceElement(a);if(b!=null&&typeof b!="undefined"){return true
}else{return false}};presence.putInCache=function(){if(presence.isSFDC_LogOut_TimeOut){return}presence.log("info presence.putInCache","info");try{Jiffy.mark("PutInCache");if(presence.Controller.ownerObj&&presence.EventManager.bootstrapDone){presence.Controller.ownerObj.forceBreak=true;presence.Controller.ownerObj.widgetProp={isCollapsed:presence.BuddyListActive,setAutoidle:presence.setAutoidle,hideOfflineUsers:presence.hideOfflineUsers,BuddylistCollapsed:presence.BuddylistCollapsed,HistoryExpanded:presence.HistoryExpanded,showEmoticons:presence.showEmoticons,blinkBrowserTab:presence.blinkBrowserTab,expandChatWindow:presence.expandChatWindow,autoIdleTime:presence.config.autoIdleTime,audibleLevel:presence.config.audibleLevel,enableWebkitNotification:presence.config.enableWebkitNotification,showFavorites:presence.showFavorites,showFollowed:presence.showFollowed,timeStampHover:presence.timeStampHover,showCloseDialog:presence.showCloseDialog};
if(presence.config.screenShareEnabled){presence.Controller.ownerObj.widgetProp.ssConnectionTimeout=presence.config.ssConnectionTimeout;presence.Controller.ownerObj.widgetProp.ssRetries=presence.config.ssRetries;presence.Controller.ownerObj.widgetProp.autoDetectProxy=presence.config.autoDetectProxy;presence.Controller.ownerObj.widgetProp.byPassProxy=presence.byPassProxy;
presence.Controller.ownerObj.widgetProp.proxyAddress=presence.proxyAddress;presence.Controller.ownerObj.widgetProp.socksProxy=presence.socksProxy;presence.Controller.ownerObj.widgetProp.socksProxy=presence.socksProxy;presence.Controller.ownerObj.widgetProp.proxyUserName=presence.proxyUserName;presence.Controller.ownerObj.widgetProp.proxyPassword=presence.proxyPassword
}if(presence.histObj&&presence.histObj.chatSessionId){presence.Controller.ownerObj.widgetProp.histObj=presence.histObj}presence.Controller.ownerObj.cacheTime=new Date().getTime();presence.Controller.ownerObj.transport=presence.Controller.transportType;presence.Controller.ownerObj.isChatUiEnabled=canvas_window.umps_config.isChatUiEnabled;
presence.Controller.ownerObj.screenShareEnabled=presence.config.screenShareEnabled;var a=JSON.stringify(presence.Controller.ownerObj);StorageManager.setItem("presence_model",a)}else{presence.log("presence:putIncache ownerObj is undefined, Must be previous boot strap failed","error");StorageManager.removeItem("presence_model")
}Jiffy.measure("Done","PutInCache");presence.View.Actions.sendBrowserEvent({command:"onBlur"})}catch(b){presence.log("presence:putIncache "+b,"error")}};presence.onbeforeunload=function(){presence.log("info presence.onbeforeunload","info");if(presence.Controller.ownerObj){presence.Controller.ownerObj.pageLoadHappens=true
}if(presence.Controller.eventPollObj.httpObj){presence.Controller.eventPollObj.httpObj.abort()}};presence.readFromCache=function(){Jiffy.mark("ReadFromCache");var a=StorageManager.getItem("presence_model");StorageManager.removeItem("presence_model");var b=0;if(a&&a.length){b=a.length/1024;presence.log("Cache size: "+b+" KB","info")
}Jiffy.measure("Done-"+b,"ReadFromCache");return a};presence.readUserBankFromCache=function(){};presence.clearCache=function(){var a=StorageManager.removeItem("presence_model")};presence.setCookie=function(c,f){var a=arguments,i=arguments.length,b=(i>2)?a[2]:null,h=(i>3)?a[3]:"/",d=(i>4)?a[4]:null,g=true;
document.cookie=c+"="+escape(f)+((b===null)?"":("; expires="+b.toGMTString()))+((h===null)?"":("; path="+h))+((d===null)?"":("; domain="+d))+((g===true)?"; secure":"")};presence.getCookie=function(d){var b=d+"=",g=b.length,a=document.cookie.length,f=0,c=0;while(f<a){c=f+g;if(document.cookie.substring(f,c)==b){return presence._getCookieVal(c)
}f=document.cookie.indexOf(" ",f)+1;if(f===0){break}}return null};presence._getCookieVal=function(b){var a=document.cookie.indexOf(";",b);if(a==-1){a=document.cookie.length}return unescape(document.cookie.substring(b,a))};presence.getCatalog=function(b){var c=presence.config.catalog[b];var a=arguments;
if(presence.config.catalog&&c){for(var d=1;d<=a.length;d++){c=c.replace("{%"+d+"%}",a[d])}return c}else{return b}};presence.encode=JSON.stringify;presence.decode=JSON.parse;presence.getBrowserWidth=function(){var a=0;if(presence.isIE){a=(canvas_doc.documentElement.clientWidth!=0)?(canvas_doc.documentElement.clientWidth):presence.config.defaultWidth
}else{a=(canvas_window.innerWidth!=0)?canvas_window.innerWidth:presence.config.defaultWidth}return a};presence.getBrowserHeight=function(){var a=0;if(presence.isIE){a=(canvas_doc.documentElement.clientHeight!=0)?(canvas_doc.documentElement.clientHeight):presence.config.defaultHeight}else{a=(canvas_window.innerHeight!=0)?canvas_window.innerHeight:presence.config.defaultHeight
}return a};presence.getClientId=function(){if(!presence.clientId){var c=presence.getCookie("umps_clientId");var b=c&&c.indexOf("-")?c.split("-"):[];var a=presence.Model.Owner.getInstance();if(b.length>1&&b[1]==a.id){c=null}if(c!=null){presence.clientId=c}else{presence.setClientId(presence.Controller.ownerObj.umpsSessionId)
}}return presence.clientId};presence.setClientId=function(a){presence.clientId=a;presence.setCookie("umps_clientId",presence.clientId,new Date((new Date().getTime())+1000*60*60*24*30))};presence.getDeviceId=function(){return presence.getClientId()};presence.resetValues=function(){presence.synchScheduled=false
};presence.getOSName=function(){if(navigator.appVersion.indexOf("Win")!=-1){presence.osName="Win"}else{if(navigator.appVersion.indexOf("Mac")!=-1){presence.osName="Mac"}else{presence.osName="NotSupported"}}};presence.getMillisecToHours=function(){var a=new Date();return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+":"+a.getMilliseconds()
};presence.getCodeLocation=function(){if(!presence.codeLocation){var b=canvas_window.umps_config.sfdcVersion;presence.codeLocation="/umps/UMPSWidget/";var a=canvas_window.umps_config.umpsWidgetPath;if((b&&b!=null)&&(a&&a!=null)){presence.codeLocation="/umps/"+a+"/"}}return presence.codeLocation};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,d){for(var b=(d||0),a=this.length;
b<a;b++){if(this[b]===c){return b}}return -1}}(function(){var c=function(i){var m={};var n=0;var h=new Array();var k=false;var j=i;var o=this;var p;o.bind=function(r,t){if(typeof t!="function"){return}if(!m[r]){m[r]={}}var q=l(t);m[r][q]=t};o.unbind=function(r,t){var q=l(t);if(!m[r]||!m[r][q]){return
}delete m[r][q]};o.unbindAll=function(q){if(!m[q]){return}delete m[q]};o.trigger=function(q,t,r){if(b.bootstrapDone||r){h[h.length]={event:q,payload:t};if(!k){k=true;p=window.setTimeout(g,j)}}};o.count=function(r){if(!m[r]){return 0}var q=0;for(var t in m[r]){q++}return q};o.queueLength=function(){return h.length
};o.stopProcessing=function(){h=new Array()};var g=function(){if(h.length==0){k=false;return}k=true;var u=h[0];h.splice(0,1);var r=m[u.event];if(r){for(var v in r){if(r.hasOwnProperty(v)&&typeof r[v]=="function"){try{presence.log("firing event: "+u.event,"warn");r[v].call(document,u.event,u.payload)}catch(t){var q=t.stack||r[v].toString();
presence.log("listener failed: "+u.event+": "+t+" "+q,"error")}}}}p=window.setTimeout(g,j)};var l=function(r){var q="presenceuid",t=r[q];return t?t:r[q]=++n}};var d=new c(10);var a=new c(0);var f=function(g){var h=d;if(g&&g=="api"){h=a}return h};var b={};b.bootstrapDone=false;b.bind=function(h,i,g){return f(g).bind(h,i)
};b.trigger=function(h,j,i,g){return f(g).trigger(h,j,i)};b.unbind=function(h,i,g){return f(g).unbind(h,i)};b.unbindAll=function(h,g){return f(g).unbindAll(h)};b.count=function(h,g){return f(g).count(h)};b.stopProcessing=function(h,g){return f(g).stopProcessing(h)};b.queueLength=function(g){return f(g).queueLength()
};window.presence.EventManager=b})();(function(c){var b={};if(canvas_window.name.length<2){canvas_window.name="umpsTab_"+Math.floor(Math.random()*10000)}var i="__umpsXTab",g=new Array(),d,f=canvas_window.name,a;var h=function(){this.cancelEvent=false};b.sendCommand=function(l,j){var m=new Date().getTime()+""+Math.floor(Math.random()*100),k=j||false;
if(presence.isIE&&!window.performance){c.localStorage.setItem(i,JSON.stringify({data:l,timestamp:m,source:f,lockable:k,isIE:true}));if(a){window.clearTimeout(a)}a=window.setTimeout(function(){c.localStorage.setItem(i,JSON.stringify({timestamp:m,source:f,lockable:k,key:i}))},400)}else{c.localStorage.setItem(i,JSON.stringify({data:l,timestamp:m,source:f,lockable:k}))
}};b.listenCommands=function(j){if(!j||typeof j!="function"){return}if(!g.length){if(c.addEventListener){c.addEventListener("storage",b.commonListener,false)}else{c.document.attachEvent("onstorage",b.commonListener)}}g.push(j)};b.commonListener=function(m){var k=false,l;if(m.key){if(m.key!=i||!m.newValue){return
}l=m.newValue}else{l=c.localStorage.getItem(i);if(!l){return}}try{l=JSON.parse(l)}catch(m){return}presence.log("received command: "+JSON.stringify(l),"warn");if(!m.key&&!l.isIE&&!presence.isFF){presence.log("its not IE return!");return}if(!l.data||l.source==f||l.timestamp==d||l.timestamp<(new Date().getTime()-1000)){return
}presence.log("lastTimetamp:"+d+"uuid: "+f);d=l.timetamp;if(l.lockable){if(m.key){l=JSON.parse(c.localStorage.getItem(i))}if(l.locked){return}}for(var j=0;j<g.length;j++){k=g[j](l.data);if(k){return}}if(l.lockable){l.locked=true;c.localStorage.setItem(i,JSON.stringify(l))}};if(!c.localStorage){b.sendCommand=b.listenCommands=function(){}
}c.presence.XTab=b})(window);function DateUtil(){}DateUtil.MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];DateUtil.DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
DateUtil.LZ=function(a){return(a<0||a>9?"":"0")+a};DateUtil.isDate=function(c,b){var a=DateUtil.getDateFromFormat(c,b);if(a===0){return false}return true};DateUtil.compareDates=function(f,g,c,d){var b=DateUtil.getDateFromFormat(f,g);var a=DateUtil.getDateFromFormat(c,d);if(b===0||a===0){return -1}else{if(b>a){return 1
}}return 0};DateUtil.formatDate=function(J,F){F=F+"";var n="";var w=0;var I="";var g="";var l=J.getFullYear()+"";var i=J.getMonth()+1;var G=J.getDate();var p=J.getDay();var o=J.getHours();var z=J.getMinutes();var r=J.getSeconds();var u,v,b,t,L,f,D,C,A,q,O,N,j,a,B;var x={};x.y=""+l;x.yyyy=l;x.yy=l.substring(2,4);
x.M=i;x.MM=DateUtil.LZ(i);x.MMM=DateUtil.MONTH_NAMES[i-1];x.NNN=DateUtil.MONTH_NAMES[i+11];x.d=G;x.dd=DateUtil.LZ(G);x.E=DateUtil.DAY_NAMES[p+7];x.EE=DateUtil.DAY_NAMES[p];x.H=o;x.HH=DateUtil.LZ(o);if(o===0){x.h=12}else{if(o>12){x.h=o-12}else{x.h=o}}x.hh=DateUtil.LZ(x.h);if(o>11){x.K=o-12}else{x.K=o}x.k=o+1;
x.KK=DateUtil.LZ(x.K);x.kk=DateUtil.LZ(x.k);if(o>11){x.a=DateUtil.getPMSymbol()}else{x.a=DateUtil.getAMSymbol()}x.m=z;x.mm=DateUtil.LZ(z);x.s=r;x.ss=DateUtil.LZ(r);while(w<F.length){I=F.charAt(w);g="";while((F.charAt(w)==I)&&(w<F.length)){g+=F.charAt(w++)}if(x[g]){n=n+x[g]}else{n=n+g}}return n};DateUtil._isInteger=function(c){var b="1234567890";
for(var a=0;a<c.length;a++){if(b.indexOf(c.charAt(a))==-1){return false}}return true};DateUtil._getInt=function(g,d,f,c){for(var a=c;a>=f;a--){var b=g.substring(d,d+a);if(b.length<f){return null}if(DateUtil._isInteger(b)){return b}}return null};DateUtil.getDateFromFormat=function(E,u){E=E+"";u=u+"";var D=0;
var n=0;var z="";var h="";var C="";var k,j;var d=new Date();var l=d.getFullYear();var B=d.getMonth()+1;var A=1;var f=d.getHours();var v=d.getMinutes();var q=d.getSeconds();var m="";while(n<u.length){z=u.charAt(n);h="";while((u.charAt(n)==z)&&(n<u.length)){h+=u.charAt(n++)}if(h=="yyyy"||h=="yy"||h=="y"){if(h=="yyyy"){k=2;
j=4}if(h=="yy"){k=2;j=2}if(h=="y"){k=2;j=4}l=DateUtil._getInt(E,D,k,j);if(l===null){return 0}D+=l.length;if(l.length==2){if(l>70){l=1900+(l-0)}else{l=2000+(l-0)}}}else{if(h=="MMM"||h=="NNN"){B=0;for(var t=0;t<DateUtil.MONTH_NAMES.length;t++){var g=DateUtil.MONTH_NAMES[t];if(E.substring(D,D+g.length).toLowerCase()==g.toLowerCase()){if(h=="MMM"||(h=="NNN"&&t>11)){B=t+1;
if(B>12){B-=12}D+=g.length;break}}}if((B<1)||(B>12)){return 0}}else{if(h=="EE"||h=="E"){for(t=0;t<DateUtil.DAY_NAMES.length;t++){var p=DateUtil.DAY_NAMES[t];if(E.substring(D,D+p.length).toLowerCase()==p.toLowerCase()){D+=p.length;break}}}else{if(h=="MM"||h=="M"){B=DateUtil._getInt(E,D,1,2);if(B===null||(B<1)||(B>12)){return 0
}D+=B.length}else{if(h=="dd"||h=="d"){A=DateUtil._getInt(E,D,1,2);if(A===null||(A<1)||(A>31)){return 0}D+=A.length}else{if(h=="hh"||h=="h"){f=DateUtil._getInt(E,D,h.length,2);if(f===null||(f<1)||(f>12)){return 0}D+=f.length}else{if(h=="HH"||h=="H"){f=DateUtil._getInt(E,D,h.length,2);if(f===null||(f<0)||(f>23)){return 0
}D+=f.length}else{if(h=="KK"||h=="K"){f=DateUtil._getInt(E,D,h.length,2);if(f===null||(f<0)||(f>11)){return 0}D+=f.length}else{if(h=="kk"||h=="k"){f=DateUtil._getInt(E,D,h.length,2);if(f===null||(f<1)||(f>24)){return 0}D+=f.length;f--}else{if(h=="mm"||h=="m"){v=DateUtil._getInt(E,D,h.length,2);if(v===null||(v<0)||(v>59)){return 0
}D+=v.length}else{if(h=="ss"||h=="s"){q=DateUtil._getInt(E,D,h.length,2);if(q===null||(q<0)||(q>59)){return 0}D+=q.length}else{if(h=="a"){var o=DateUtil.getAMSymbol();var w=DateUtil.getPMSymbol();var a=E.substring(D,D+o.length);var r=E.substring(D,D+w.length);if(a==o||a.toUpperCase()==o){m=o}else{if(r==w||r.toUpperCase()==w){m=w
}else{return 0}}D+=m.length}else{if(E.substring(D,D+h.length)!=h){return 0}else{D+=h.length}}}}}}}}}}}}}}if(D!=E.length){return 0}if(LC.isThaiTHLocale()){l=l-LC.BUDDHIST_CAL_OFFSET}if(B==2){if(((l%4===0)&&(l%100!==0))||(l%400===0)){if(A>29){return 0}}else{if(A>28){return 0}}}if((B==4)||(B==6)||(B==9)||(B==11)){if(A>30){return 0
}}if(f<12&&m==DateUtil.getPMSymbol()){f=f-0+12}else{if(f>11&&m==DateUtil.getAMSymbol()){f-=12}}var b=new Date(l,B-1,A,f,v,q);return b.getTime()};DateUtil.parseDate=function(k){var g=(arguments.length==2)?arguments[1]:false;generalFormats=["y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d"];monthFirst=["M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d","M.d"];
dateFirst=["d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M","d.M"];var b=["generalFormats",g?"dateFirst":"monthFirst",g?"monthFirst":"dateFirst"];var h=null;for(var f=0;f<b.length;f++){var a=window[b[f]];for(var c=0;c<a.length;c++){h=DateUtil.getDateFromFormat(k,a[c]);if(h!==0){return new Date(h)}}}return null
};DateUtil.TIMEZONES;DateUtil.getTimezoneOffset=function(){var f=new Date();var c=f.getTimezoneOffset()*(60*1000);var b=DateUtil.getTimezoneIndex(f);if(DateUtil.TIMEZONES===undefined){DateUtil.TIMEZONES=DateUtil.getTimezones(f)}var a=DateUtil.TIMEZONES[b];var d=a+c;return d};DateUtil.isBrowserAndSystemTimezoneSame=function(){var a=DateUtil.getTimezoneOffset();
return a===0};DateUtil.getTimezoneIndex=function(a){return DateUtil.formatDate(a,"yyyyMMdd")};DateUtil.getTimezones=function(b){var d=null;var a=Sfdc.Url.generateUrl(UserContext.getUrl("/home/timezones.jsp"),{ts:b.getTime()});var c=Sfdc.Ajax.request(a,{async:false});if(c){return null}return d};DateUtil.rollDate=function(c,a){var b=new Date(c.getTime());
b.setDate(b.getDate()+a);return b};DateUtil.roundDate=function(b){var a=new Date(b.getTime());a.setHours(0);a.setMinutes(0);a.setSeconds(0);return a};DateUtil.getDateStringFromUserLocale=function(a){return DateUtil.formatDate(a,UserContext.dateFormat)};DateUtil.getDateFromUserLocale=function(a){return new Date(DateUtil.getDateFromFormat(a,UserContext.dateFormat))
};DateUtil.getDateTimeStringFromUserLocale=function(a){return DateUtil.formatDate(a,UserContext.dateTimeFormat)};DateUtil.getDateTimeFromUserLocale=function(a){return new Date(DateUtil.getDateFromFormat(a,UserContext.dateTimeFormat))};DateUtil.getTimeStringFromUserLocale=function(a){return DateUtil.formatDate(a,UserContext.timeFormat)
};DateUtil.getTimeFromUserLocale=function(a){return new Date(DateUtil.getDateFromFormat(a,UserContext.timeFormat))};DateUtil.getAMSymbol=function(){return presence.getCatalog("AM")};DateUtil.getPMSymbol=function(){return presence.getCatalog("PM")};DateUtil.is24Hour=function(a){return a.indexOf("k")>-1
};DateUtil.hasAMPM=function(a){return a.indexOf("a")>-1};DateUtil.equals=function(b,a){return b&&a&&DateUtil.compare(b,a)===0};DateUtil.lessThan=function(b,a){return DateUtil.compare(b,a)<0};DateUtil.greaterThan=function(b,a){return DateUtil.compare(b,a)>0};DateUtil.compare=function(b,a){if(b.getFullYear()!=a.getFullYear()){return b.getFullYear()-a.getFullYear()
}else{if(b.getMonth()!=a.getMonth()){return b.getMonth()-a.getMonth()}else{return b.getDate()-a.getDate()}}};DateUtil.separators=["/","-","."];DateUtil.checkYear=function(c,a){var d=c.value.toLowerCase();var b=DateUtil.getCheckYearValue(d);if(b){c.value=b;if(a&&c.onchange){c.onchange()}}};DateUtil.getCheckYearValue=function(g){if(!(g&&g.length>0)){return null
}var f=null;for(var b=0;b<DateUtil.separators.length;b++){if(g.indexOf(DateUtil.separators[b])!=-1){f=DateUtil.separators[b];break}}var a=DateUtil.getDateTimeFromUserLocale(UserContext.today);if(f){a.setDate(1);var d=g.split(f);if(d.length==2){if(!isNaN(parseInt(d[0],10))&&!isNaN(parseInt(d[1],10))){a.setMonth(parseInt(d[0],10)-1);
a.setDate(parseInt(d[1],10));return DateUtil.getDateStringFromUserLocale(a)}}else{if(d.length==3){if(!isNaN(parseInt(d[2],10))&&!isNaN(parseInt(d[0],10))&&!isNaN(parseInt(d[1],10))){var c=parseInt(d[2],10);if(c/1000<1){a.setMonth(parseInt(d[0],10)-1);a.setDate(parseInt(d[1],10));if(c>=60&&c<100){a.setFullYear(c+1900)
}else{a.setFullYear(c+2000)}return DateUtil.getDateStringFromUserLocale(a)}else{if(f!="/"){return d[0]+"/"+d[1]+"/"+d[2]}}}}}}else{return DateUtil.getEvaluateShortcutValue(g)}};DateUtil.DAY_SHORTCUTS=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];DateUtil.evaluateShortcut=function(c,a){var d=c.value.toLowerCase();
var b=DateUtil.getEvaluateShortcutValue(d);if(b){c.value=b;if(a&&c.onchange){c.onchange()}}};DateUtil.getEvaluateShortcutValue=function(d){if(!(d&&d.length>0)){return null}var a=DateUtil.getDateTimeFromUserLocale(UserContext.today);if(d.indexOf("tod")===0){return DateUtil.getDateStringFromUserLocale(a)
}else{if(d.indexOf("yes")===0){a.setDate(a.getDate()-1);return DateUtil.getDateStringFromUserLocale(a)}else{if(d.indexOf("tom")===0){a.setDate(a.getDate()+1);return DateUtil.getDateStringFromUserLocale(a)}else{if(d.length>=3){for(var c=0;c<DateUtil.DAY_SHORTCUTS.length;c++){if(d.indexOf(DateUtil.DAY_SHORTCUTS[c].toLowerCase())===0){var b=c-a.getDay();
if(b<0){b+=7}a.setDate(a.getDate()+b);return DateUtil.getDateStringFromUserLocale(a)}}}}}}return null};DateUtil.differenceInMinutes=function(c,b){var a=b.getTime()-c.getTime();return Math.round(a/(60*1000))};DateUtil.getDateFromValue=function(b,a){var c=a?DateUtil.getDateFromFormat(b,UserContext.dateTimeFormat):DateUtil.getDateFromFormat(b,UserContext.dateFormat);
if(c!==0){return new Date(c)}return null};(function(k){var j={};var r=function(){var x=/(opera)(?:.*version)?[ \/]([\w.]+)/;var w=navigator.userAgent;w=w.toLowerCase();var v=x.exec(w)||[];return v.length!=0};var n,p,g=1,i,m={},t=10,o=false,h=0,u=0,l="addEventListener",b,c,f,a,d=window.postMessage&&!r();
j.postMessage=function(v,x,w){v=typeof v==="string"?v:encodeURIComponent(v);w=w||parent;if(d){w.postMessage(v,x)}else{g++;m[g]={target:w,prefix:"#"+g+"&",message:v};umpsxdomain.setWindowName(g)}};j.setWindowName=function(w){if(m[w-1]){return}var v=m[w];if(v){if(window.name!=""){umpsxdomain.readWindowname()
}v.target.name=v.prefix+u+"|"+v.message}};var q=function(v){v=parseInt(v);if(m[v]){delete m[v];umpsxdomain.setWindowName(v+1)}};j.readWindowname=function(){var z=window.name,x=/^#?\d+&/;if(z!==p&&x.test(z)){window.name="";p=z;var v=z.indexOf("&"),w=z.indexOf("|"),y=z.substring(1,v);h=z.substring(v+1,w);
if(y=="0"){q(h)}else{a.name="#0&"+y+"|";u=y;q(h);f({data:z.substring(w+1,z.length)})}}clearTimeout(n);n=window.setTimeout(function(){umpsxdomain.readWindowname()},t)};j.receiveMessage=b=function(x,w,v){if(d){if(x){i&&b();i=function(z){if(typeof w==="string"&&z.origin!==w){var y=JSON.parse(z.data);if(y&&y.originCheck){return x({data:JSON.stringify({originCheck:y.originCheck})})
}return false}x(z)}}if(window[l]){window[x?l:"removeEventListener"]("message",i,false)}else{window[x?"attachEvent":"detachEvent"]("onmessage",i)}}else{if(x&&v){f=x;a=v;umpsxdomain.readWindowname()}}};k.umpsxdomain=j})(window);(function(b){var a=function(f){this.id="";this.name="";this.picture="";this.attributes={};
this.onlineCount=0;this.activeCount=0;this.totalCount=0;this.muted=true;this.eventIndex="";var d=this;this.fromJSON=function(g){if(!g){return}if(g.id){d.id=g.id}if(g.name){d.name=g.name}if(g.picture){d.picture=g.picture}if(g.attributes){d.attributes=g.attributes}if(g.presenceSubspaceId){d.presenceSubspaceId=g.presenceSubspaceId
}if(g.chatSubspaceId){d.chatSubspaceId=g.chatSubspaceId}if(g.onlineCount!=undefined){d.onlineCount=g.onlineCount}if(g.activeCount!=undefined){d.activeCount=g.activeCount}if(g.totalCount!=undefined){d.totalCount=g.totalCount}if(g.muted!=undefined){d.muted=g.muted}if(g.deleted!=undefined){d.deleted=g.deleted
}if(g.updatePending!=undefined){d.updatePending=g.updatePending}};this.toJSON=function(){var g={};if(d.id){g.id=d.id}if(d.name){g.name=d.name}if(d.picture){g.picture=d.picture}if(d.attributes){g.attributes=d.attributes}if(d.presenceSubspaceId){g.presenceSubspaceId=d.presenceSubspaceId}if(d.chatSubspaceId){g.chatSubspaceId=d.chatSubspaceId
}if(d.onlineCount!=undefined){g.onlineCount=d.onlineCount}if(d.activeCount!=undefined){g.activeCount=d.activeCount}if(d.totalCount!=undefined){g.totalCount=d.totalCount}if(d.muted!=undefined){g.muted=d.muted}if(d.deleted!=undefined){g.deleted=d.deleted}if(d.updatePending!=undefined){g.updatePending=d.updatePending
}g.eventIndex=d.eventIndex;return g};var c=function(g){d.fromJSON(g)};c(f);this.setAttribute=function(g,h){d.attributes[g]=h;b.EventManager.trigger("event.user.presence.attribute.changed",d.toJSON())};this.removeAttribute=function(g){delete d.attributes[g];b.EventManager.trigger("event.user.presence.attribute.removed",d.toJSON())
};this.setId=function(g){d.id=g};this.setName=function(g){d.name=g;b.EventManager.trigger("event.user.group.summary.updated",d.toJSON())};this.setPicture=function(g){d.picture=g;b.EventManager.trigger("event.user.group.summary.updated",d.toJSON())};this.setOnlineCount=function(g){d.onlineCount=g;b.EventManager.trigger("event.group.online.counter.updated",d.toJSON())
};this.setTotalCount=function(g){if(d.totalCount==g){return}d.totalCount=g;Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupCounterUpdated-"+d.eventIndex);b.EventManager.trigger("event.group.total.counter.updated",d.toJSON())};this.setActiveCount=function(g){d.activeCount=g;Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupCounterUpdated-"+d.eventIndex);
b.EventManager.trigger("event.group.active.counter.updated",d.toJSON())};this.setCount=function(h,g){d.onlineCount=h;d.totalCount=g;b.EventManager.trigger("event.group.counter.updated",d.toJSON())};this.setMuted=function(g){d.muted=g;if(g){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupChatMuted-"+d.eventIndex);
b.EventManager.trigger("event.user.groupchat.muted",d.toJSON())}else{Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupChatUnMuted-"+d.eventIndex);b.EventManager.trigger("event.user.groupchat.unmuted",d.toJSON())}};this.setDeleted=function(g){d.deleted=g;if(g){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupRemoved-"+d.eventIndex);
b.EventManager.trigger("event.user.group.roster.removed",d.toJSON())}else{b.EventManager.trigger("event.user.group.roster.added",d.toJSON())}};this.summaryUpdated=function(){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupSummaryUpdated-"+d.eventIndex);b.EventManager.trigger("event.system.group.summary.updated",d.toJSON())
}};window.presence.Model.Group=a})(presence);if(!presence.Model){presence.Model={}}presence.Model.fromJSON=function(c,b){var d=(b)?b:presence.Model.Owner.getInstance();d.fromJSON(c);if(c.users){for(user in c.users){d.addToUserList(new presence.Model.User(c.users[user]))}}if(c.groups){for(group in c.groups){d.addToGroupList(new presence.Model.Group(c.groups[group]))
}}if(c.workspaces){for(workspace in c.workspaces){var a=new presence.Model.Workspace(c.workspaces[workspace]);for(user in c.workspaces[workspace].users){a.addUser(d.users[user])}d.addWorkspace(a)}}};(function(b,c){var a={};a.bootstrapDone=function(){c.Controller.ownerObj.sortUsers();c.EventManager.bootstrapDone=true;
c.EventManager.trigger("event.bootstrap",self)};a.bootstrapFailed=function(d){c.EventManager.bootstrapDone=true;c.EventManager.trigger("event.bootstrap.failed",d)};a.bootStrapLoading=function(){c.EventManager.trigger("event.bootstrap.started")};a.rosterLoaded=function(){c.Controller.ownerObj.state.rosterLoaded=true;
c.EventManager.trigger("event.bootstrap.rosterLoaded",self)};a.networkReconnecting=function(){c.EventManager.trigger("event.bootstrap.showReconnect")};a.stopNetworkReconnecting=function(){c.EventManager.trigger("event.bootstrap.cleanReconnect",data)};a.fail=function(d){if(c.Controller.ownerObj&&c.EventManager.bootstrapDone){c.Controller.ownerObj=undefined;
c.EventManager.trigger("event.error",d)}};a.notificationMuted=function(){c.EventManager.trigger("event.custom.notification.muted",{})};a.onCustomEvent=function(d){c.EventManager.trigger("event.custom.other",d)};a.onPrefchange=function(d){Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.PreferenceChanged");
c.EventManager.trigger("event.user.preferences.status",d)};a.triggerEvent=function(d,f){c.EventManager.trigger(d,f)};a.collapseAll=function(d){c.EventManager.trigger("event.custom.collapse.all",d)};b.presence.Model.Notify=a})(window,presence);(function(b){var a=function(d){this.id="";this.name="";this.fName="";
this.lName="";this.sessionId="";this.presenceStatus="";this.presenceMessage="";this.channelState="active";this.users={};this.groups={};this.workspaces={};this.sortScheduled=false;this.channelId="";this.picture="";this.bufferIndex={buffer:0,event:0,eventSubIndex:-1};this.pendingMembers={};this.state={};
this.device={};this.eventIndex="";this.favorites={};this.pendingEvents=[];this.isSharingScreen=false;this.isViewingScreen=false;this.sharingSubspaceId=null;this.viewingSubspaceId=null;this.isAppletLoading=false;this.processShareEvent=false;this.deviceState={};var c=this;this.fromJSON=function(f){if(!f){return
}if(f.id){c.id=f.id}if(f.name){c.name=f.name}if(f.fName){c.fName=f.fName}if(f.lName){c.lName=f.lName}if(f.presenceStatus){c.presenceStatus=f.presenceStatus}if(f.presenceMessage){c.presenceMessage=f.presenceMessage}if(f.channelState){c.channelState=f.channelState}if(f.sessionId){c.sessionId=f.sessionId
}if(f.sortScheduled){c.sortScheduled=f.sortScheduled}if(f.channelId){c.channelId=f.channelId}if(f.picture){c.picture=b.Controller.parseImageUrl(f.picture)}if(f.bufferIndex){c.bufferIndex=f.bufferIndex}if(f.umpsSessionId){c.umpsSessionId=f.umpsSessionId}if(f.currentWindow){c.currentWindow=f.currentWindow
}if(f.uuidCounter){c.uuidCounter=f.uuidCounter}if(f.defaultSubSpaceId){c.defaultSubSpaceId=f.defaultSubSpaceId}if(f.pendingMembers){c.pendingMembers=f.pendingMembers}if(f.state){c.state=f.state}if(f.device){c.device=f.device}if(f.primaryChannelId){c.primaryChannelId=f.primaryChannelId}if(f.favorites){c.favorites=f.favorites
}if(f.rosterNextPageIndex){c.rosterNextPageIndex=f.rosterNextPageIndex}if(f.cacheSubDomain){c.cacheSubDomain=f.cacheSubDomain}if(f.pendingEvents){c.pendingEvents=f.pendingEvents}if(f.isSharingScreen){c.isSharingScreen=f.isSharingScreen}if(f.isViewingScreen){c.isViewingScreen=f.isViewingScreen}if(f.sharingSubspaceId){c.sharingSubspaceId=f.sharingSubspaceId
}if(f.viewingSubspaceId){c.viewingSubspaceId=f.viewingSubspaceId}if(f.isAppletLoading){c.isAppletLoading=f.isAppletLoading}if(f.processShareEvent){c.processShareEvent=f.processShareEvent}if(f.deviceState){c.deviceState=f.deviceState}};this.set=function(f,g){c.key=g};this.get=function(f){return c.key};
this.setId=function(f){c.id=f};this.setName=function(f){c.name=f.name;c.fName=f.fName;c.lName=f.lName};this.setPresenceStatus=function(g,f){c.presenceStatus=g;c.channelState=f;b.EventManager.trigger("event.owner.presence.status",c)};this.setPresenceMessage=function(f){c.presenceMessage=f};this.setPresence=function(f,g){c.presenceStatus=f;
c.presenceMessage=g;b.EventManager.trigger("event.owner.presence.status",c)};this.setPicture=function(f){c.picture=b.Controller.parseImageUrl(f)};this.addToUserList=function(f){if(f&&f.id&&f.id!=c.id){c.users[f.id]=f}else{b.log("addToUserList: user id is null","error")}};this.removeFromUserList=function(f){if(f&&f.id){delete c.users[f.id]
}else{b.log("removeFromUserList: user not removed","error")}};this.getUserList=function(){return c.users};this.getUserById=function(f){if(f){return c.users[f]}else{b.log("getUserById: user id is null","error")}};this.getName=function(){var f="";if(reverseName){if(c.lName){if(c.fName){f=c.lName+" "+c.fName
}else{f=c.lName}}else{f=c.fName}}else{if(c.fName){f=c.fName+" "+c.lName}else{f=c.lName}}if(f==""){f=c.name}return f};this.addToGroupList=function(g,f){if(g&&g.id){c.groups[g.id]=g;if(f){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.GroupAdded-"+c.eventIndex);c.groups[g.id].eventIndex=c.eventIndex;
b.EventManager.trigger("event.user.group.roster.added",c.groups[g.id].toJSON())}}else{b.log("addToGroupList: group id is null","error")}};this.removeFromGroupList=function(g,f){if(g&&g.id){if(f){b.EventManager.trigger("event.user.group.roster.removed",c.groups[g.id].toJSON())}delete c.groups[g.id]}else{b.log("removeFromGroupList: group not removed","error")
}};this.getGroupList=function(){return c.groups};this.getGroupById=function(f){if(f){return c.groups[f]}else{b.log("getGroupById: group id is null","error")}};this.addWorkspace=function(f){if(f&&f.id){c.workspaces[f.id]=f;b.EventManager.trigger("event.workspace.added",f)}else{b.log("addWorkspace: subsapace id not found","error")
}};this.removeWorkspace=function(f){if(f&&f.id){delete c.workspaces[f.id];b.EventManager.trigger("event.workspace.removed",f)}};this.getWorkspacesByUserId=function(g){var i=new Array();for(var h in c.workspaces){for(var f in c.workspaces[h].users){if(c.workspaces[h].users[f]&&c.workspaces[h].users[f].id==g){i.push(c.workspaces[h])
}}}return i};this.clearWorkspaces=function(){for(var g in c.workspaces){var f=c.workspaces[g];delete c.workspaces[g];b.EventManager.trigger("event.workspace.removed",f)}};this.scheduleSort=function(){if(!c.sortScheduled){c.sortScheduled=true;window.setTimeout(c.sortUsers,3000)}};this.wentOffline=function(){c.workspaces={};
c.users={};c.groups={};c.favorites={};b.EventManager.trigger("event.owner.went.offline",{})};this.sortUsers=function(){Jiffy.mark("SortUsers");var h={},i,g=[],f;var k=new Array();k[10]=1;k[200]=2;k[40]=3;k[50]=4;k[100]=5;k[101]=6;k[30]=7;k[20]=8;for(i in c.users){g.push(i)}var j=function(m,l){if(typeof m=="string"){m=m.toLowerCase()
}if(typeof l=="string"){l=l.toLowerCase()}if(m>l){return 1}if(m<l){return -1}if(m==l){return 0}};g.sort(function(m,l){f=j(k[c.users[m].presenceStatus],k[c.users[l].presenceStatus]);if(f==0){f=j(c.users[m].getName(),c.users[l].getName())}return f});for(i=0;i<g.length;i++){h[g[i]]=c.users[g[i]]}c.users=h;
c.sortScheduled=false;Jiffy.measure("Done","SortUsers");c.sortFavorites();if(!b.View.hasClass(b.View.getEl("user_searchlist"),"hide")){c.sortSearchUsers()}b.EventManager.trigger("event.user.list.update",c)};this.sortSearchUsers=function(){Jiffy.mark("SortSearchUsers");var i={},j,h=[],g;var l=new Array();
l[10]=1;l[200]=2;l[40]=3;l[50]=4;l[100]=5;l[101]=6;l[30]=7;l[20]=8;var f=b.View.OrgSearchCache.getInstance();var m=f.getCurrentSearchResult();if(!m){return}for(j in m){h.push(j)}var k=function(o,n){if(typeof o=="string"){o=o.toLowerCase()}if(typeof n=="string"){n=n.toLowerCase()}if(o>n){return 1}if(o<n){return -1
}if(o==n){return 0}};h.sort(function(o,n){g=k(l[m[o].presenceStatus],l[m[n].presenceStatus]);if(g==0){g=k(m[o].getName(),m[n].getName())}return g});for(j=0;j<h.length;j++){i[h[j]]=m[h[j]]}f.updateCurrentSearchResult(i);Jiffy.measure("Done","SortSearchUsers")};this.sortGroups=function(){};this.sortFavorites=function(){Jiffy.mark("SortFvts");
var g={},i,h=[],f;var k=new Array();k[10]=1;k[100]=2;k[101]=3;k[20]=4;for(i in c.favorites){h.push(i)}var j=function(m,l){if(typeof m=="string"){m=m.toLowerCase()}if(typeof l=="string"){l=l.toLowerCase()}if(m>l){return 1}if(m<l){return -1}if(m==l){return 0}};h.sort(function(m,l){var o=c.favorites[m].users,n=c.favorites[l].users;
if(!c.users[o[0]]||!c.users[n[0]]){return 0}if(o.length>1&&n.length==1){f=1}else{if(n.length>1&&o.length==1){f=-1}else{f=0}}if(f==0&&n.length==1){f=j(k[c.users[o[0]].presenceStatus],k[c.users[n[0]].presenceStatus])}if(f==0){f=j(c.users[o[0]].getName(),c.users[n[0]].getName())}return f});for(i=0;i<h.length;
i++){g[h[i]]=c.favorites[h[i]]}c.favorites=g;Jiffy.measure("Done","SortFvts")};this.summaryUpdated=function(){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.OnSummaryUpdated");b.EventManager.trigger("event.system.owner.summary.updated",c)};this.setDeviceAttributes=function(f){if(typeof f!="object"){return
}c.device=f;Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.DeviceAttrChanged");b.EventManager.trigger("event.device.attributes.changed",f.action)};this.addFavorite=function(g,j){var k;var h;var f;if(b.config.chatMsgDeepHistoryEnabled){k=g.chatSessionId;h=g.chatSessionMembers;if(h){var i=h.indexOf(c.id);
if(i!=-1){h.splice(i,1)}}}else{k=c.generateFvtId(g.memberIds);h=g.memberIds}if(!k){return null}f=c.generateFvtId(h);if(k){c.favorites[k]={id:k,entityIds:f,users:h,favoriteName:(g.favoriteName)?g.favoriteName:"",actualFavId:g.favoriteId,chatSessionId:g.chatSessionId}}c.sortFavorites();if(j){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.FavoriteChanged");
b.EventManager.trigger("event.user.favourites.changed",k)}return k};this.generateFvtId=function(f){objectIdsClone=f?f.slice(0):f;var g=false;if(typeof(objectIdsClone)==="object"){if(objectIdsClone.length==1){g=objectIdsClone[0]}else{g=objectIdsClone.sort().join("_")}}return g};this.removeFavorite=function(g,f){delete c.favorites[g];
if(f){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.FavoriteChanged");b.EventManager.trigger("event.user.favourites.changed",g)}};this.renameFavorite=function(f,g){var h;if(b.config.chatMsgDeepHistoryEnabled){h=f.chatSessionId}else{h=c.generateFvtId(f.memberIds)}if(h){c.favorites[h].favoriteName=f.favoriteName
}c.sortFavorites();if(g){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.FavoriteRenamed");b.EventManager.trigger("event.user.favourites.changed",h)}return h};this.modifyFavorite=function(f,i){var j;if(b.config.chatMsgDeepHistoryEnabled){j=f.chatSessionId}else{j=c.generateFvtId(f.memberIds)}var g=f.memberIds;
if(g){var h=g.indexOf(c.id);if(h!=-1){g.splice(h,1)}}if(j){c.favorites[j].users=g}c.sortFavorites();if(i){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.FavoriteRenamed");b.EventManager.trigger("event.user.favourites.changed",j)}return j}};a.getInstance=function(){if(window._chatOwner){return window._chatOwner
}else{window._chatOwner=new a();return window._chatOwner}};a.getOwnerString=function(){if(window._chatOwner){return JSON.stringify(window._chatOwner)}};window.presence.Model.Owner=a})(presence);(function(a,b){var c=function(g){this.id="";this.name="";this.fName="";this.lName="";this.presenceStatus=20;
this.presenceMessage="";this.picture="";this.title="";this.eventIndex="";this.userSource="";this.attributes={};var f=this;this.fromJSON=function(h){if(!h){return}if(h.id){f.id=h.id}if(h.name){f.name=h.name}if(h.fName!=undefined){f.fName=h.fName}if(h.lName!=undefined){f.lName=h.lName}if(h.presenceStatus){f.presenceStatus=h.presenceStatus
}if(h.presenceMessage){f.presenceMessage=h.presenceMessage}if(h.title){f.title=h.title}if(h.picture){f.picture=b.Controller.parseImageUrl(h.picture)+(h.picture.indexOf("refreshTimeout")==-1?"?refreshTimeout=false":"")}if(h.attributes){f.attributes=h.attributes}if(h.isAnonymous){f.isAnonymous=h.isAnonymous
}if(h.isAnonymousLnk){f.isAnonymousLnk=h.isAnonymousLnk}if(h.userSource){f.userSource=h.userSource}};this.toJSON=function(h){var i={};if(f.id){i.id=f.id}if(f.name){i.name=f.name}if(f.fName!=undefined){i.fName=f.fName}if(f.lName!=undefined){i.lName=f.lName}i.getName=f.getName;i.presenceStatus=f.presenceStatus;
i.presenceMessage=f.presenceMessage;i.picture=f.picture;i.attributes=f.attributes;i.isAnonymousLnk=f.isAnonymousLnk;i.eventIndex=f.eventIndex;i.isAnonymous=f.isAnonymous;i.title=f.title;if(f.userSource){i.userSource=f.userSource}if(h){i.workspaces=b.Model.Owner.getInstance().getWorkspacesByUserId(f.id)
}return i};var d=function(h){f.fromJSON(h)};d(g);this.setAttribute=function(h,i){f.attributes[h]=i;b.EventManager.trigger("event.user.presence.attribute.changed",f.toJSON(true))};this.removeAttribute=function(h){delete f.attributes[h];b.EventManager.trigger("event.user.presence.attribute.removed",f.toJSON(true))
};this.setId=function(h){f.id=h};this.setName=function(h){f.name=h;b.EventManager.trigger("event.user.name",f.toJSON())};this.getName=function(){var h="";if(reverseName){if(f.lName){if(f.fName){h=f.lName+" "+f.fName}else{h=f.lName}}else{h=f.fName}}else{if(f.fName){h=f.fName+" "+f.lName}else{h=f.lName
}}if(h==""){h=f.name}return h};this.setPresenceStatus=function(k){if(f.presenceStatus==k){return}var i=f.presenceStatus;f.presenceStatus=k;var j=f.toJSON(true);j.oldPresenceStatus=i;if(!b.View.hasClass(b.View.getEl("user_searchlist"),"hide")){var h=b.View.OrgSearchCache.getInstance();var l=h.getCurrentSearchResult();
if(l[f.id]){l[f.id].presenceStatus=k}h.updateCurrentSearchResult(l)}Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.FollowedPersonStatusChange-"+f.eventIndex);b.EventManager.trigger("event.user.presence.status",j);b.Model.Owner.getInstance().scheduleSort()};this.setPresenceMessage=function(h){f.presenceMessage=h
};this.setPicture=function(h){f.picture=b.Controller.parseImageUrl(h)+(h.indexOf("refreshTimeout")==-1?"?refreshTimeout=false":"")};this.summaryUpdated=function(){Jiffy.measure("CM-"+b.EventManager.queueLength(),"Event.OnSummaryUpdated");b.EventManager.trigger("event.system.user.summary.updated",f.toJSON(true));
b.Model.Owner.getInstance().scheduleSort()}};a.presence.Model.User=c})(window,presence);(function(b){var a=function(){this.length=0;this.maxLength=100;this.users={};var c=this;this.fromJSON=function(d){if(!d){return}if(d.length){c.length=d.length}if(d.maxLength){c.maxLength=d.maxLength}if(d.users){c.users=d.users
}};this.addUser=function(d){if(!d||!d.id){return}if(c.users[d.id]){delete c.users[d.id]}else{c.length++}c.users[d.id]=c.parseUser(d);if(c.length>c.maxLength){c.removeFirstUser()}};this.removeUser=function(d){if(!d||!c.users[d.id]){return}delete c.users[d.id];c.length--};this.removeFirstUser=function(){for(var d in c.users){return c.removeUser({id:d})
}};this.updateUser=function(d){if(!d||!d.id){return}c.addUser(d);b.EventManager.trigger("event.system.userstore.summary.updated",d)};this.parseUser=function(d){var f={};if(d.name){f.name=d.name}if(d.picture){f.picture=d.picture}if(d.fName){f.name=d.fName}else{if(d.lName){f.name=d.lName}}return f}};window.presence.Model.UserStore=new a()
})(presence);(function(b,c){var a=function(g){this.id="";this.name="";this.owner="";this.messageHistory=new Array();this.messageQueue=new Array();this.users={};this.oldUsers={};this.groupId="";this.message="";this.eventIndex="";this.attributes={};this.isActive=true;this.hasUnreadMessages=false;this.once1toM=false;
this.fetchingUsers=false;this.isUserPresent=false;this.isPopped=false;this.showHistoryIcon=false;this.meetupSessionId="";this.chatSessionId="";var f=this;new c.Model.SSWorkspace(f);this.fromJSON=function(h){if(!h){return}if(h.id){f.id=h.id}if(h.name){f.name=h.name}if(h.owner){f.owner=h.owner}if(h.attributes){f.attributes=h.attributes
}if(h.messageHistory){f.messageHistory=h.messageHistory}if(h.messageQueue){f.messageQueue=h.messageQueue}if(h.message){f.message=h.message}if(h.isActive!=undefined){f.isActive=h.isActive}if(h.hasUnreadMessages!=undefined){f.hasUnreadMessages=h.hasUnreadMessages}if(h.collapsed!=undefined){f.collapsed=h.collapsed
}if(h.newMsgCount!=undefined){f.newMsgCount=h.newMsgCount}if(h.type!=undefined){f.type=h.type}if(h.disabled!=undefined){f.disabled=h.disabled}if(h.once1toM!=undefined){f.once1toM=h.once1toM}if(h.uuid!=undefined){f.uuid=h.uuid}if(h.oldUsers!=undefined){f.oldUsers=h.oldUsers}if(h.groupId!=undefined){f.groupId=h.groupId
}if(h.fetchingUsers!=undefined){f.fetchingUsers=h.fetchingUsers}if(h.height!=undefined){f.height=h.height}if(h.isPopped!=undefined){f.isPopped=h.isPopped}if(h.showHistoryIcon!=undefined){f.showHistoryIcon=h.showHistoryIcon}if(h.confCode!=undefined){f.confCode=h.confCode}if(h.publisherId!=undefined){f.publisherId=h.publisherId
}if(h.publisherstatus!=undefined){f.publisherstatus=h.publisherstatus}if(h.publisherDeviceId!=undefined){f.publisherDeviceId=h.publisherDeviceId}if(h.propData!=undefined){f.propData=h.propData}if(h.viewed!=undefined){f.viewed=h.viewed}if(h.meetupSessionId!=undefined){f.meetupSessionId=h.meetupSessionId
}if(h.chatSessionType!=undefined){f.chatSessionType=h.chatSessionType}if(h.sourceId!=undefined){f.sourceId=h.sourceId}if(h.chatSessionId!=undefined){f.chatSessionId=h.chatSessionId}};this.toJSON=function(){var h={};if(f.id){h.id=f.id}if(f.chatSessionId){h.chatSessionId=f.chatSessionId}if(f.name){h.name=f.name
}if(f.message){h.message=f.message}if(f.attributes){h.attributes=f.attributes}if(f.messageHistory){h.messageHistory=f.messageHistory.concat()}if(f.messageQueue){h.messageQueue=f.messageQueue.concat()}if(f.isActive!=undefined){h.isActive=f.isActive}if(f.hasUnreadMessages!=undefined){h.hasUnreadMessages=f.hasUnreadMessages
}if(f.collapsed!=undefined){h.collapsed=f.collapsed}if(f.newMsgCount!=undefined){h.newMsgCount=f.newMsgCount}if(f.type!=undefined){h.type=f.type}if(f.disabled!=undefined){h.disabled=f.disabled}if(f.uuid!=undefined){h.uuid=f.uuid}if(f.once1toM!=undefined){h.once1toM=f.once1toM}if(f.eventIndex!=undefined){h.eventIndex=f.eventIndex
}if(f.height!=undefined){h.height=f.height}if(f.isPopped!=undefined){h.isPopped=f.isPopped}if(f.doOpenWindow!=undefined){h.doOpenWindow=f.doOpenWindow}if(f.showHistoryIcon!=undefined){h.showHistoryIcon=f.showHistoryIcon}if(f.confCode!=undefined){h.confCode=f.confCode}if(f.publisherId!=undefined){h.publisherId=f.publisherId
}if(f.publisherstatus!=undefined){h.publisherstatus=f.publisherstatus}if(f.publisherDeviceId!=undefined){h.publisherDeviceId=f.publisherDeviceId}if(f.viewed!=undefined){h.viewed=f.viewed}if(f.meetupSessionId!=undefined){h.meetupSessionId=f.meetupSessionId}if(f.chatSessionType!=undefined){h.chatSessionType=f.chatSessionType
}if(f.sourceId!=undefined){h.sourceId=f.sourceId}h.users=f.users;h.oldUsers=f.oldUsers;h.groupId=f.groupId;return h};var d=function(h){f.fromJSON(h)};d(g);this.set=function(h,i){f.key=i};this.setAttribute=function(h,i){f.attributes[h]=i;c.EventManager.trigger("event.user.workspace.attribute.changed",f.toJSON())
};this.removeAttribute=function(h){delete f.attributes[h];c.EventManager.trigger("event.user.workspace.attribute.removed",f.toJSON())};this.getAttribute=function(h){return f.attributes[h]};this.isAttributePresent=function(h){if(f.attributes[h]){return true}else{return false}};this.setId=function(h){f.id=h
};this.setName=function(h){f.name=h;c.EventManager.trigger("event.user.workspace.changed",f.toJSON())};this.setOwner=function(h){f.owner=h;c.EventManager.trigger("event.user.workspace.changed",f.toJSON())};this.addUser=function(h,l,i,j){if(h&&h.id&&h.id!=c.Model.Owner.getInstance().id){this.isUserPresent=true;
if(f.oldUsers[h.id]){delete f.oldUsers[h.id]}if(i==false){f.oldUsers[h.id]=h}else{f.users[h.id]=h}var k=f.toJSON();k.user=h;k.sourceId=j;if(l){Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.MemberAdded-"+f.eventIndex);c.EventManager.trigger("event.user.roster.workspace.added",k)}}else{c.log("addUser: user id not found (or) the user might be owner","error")
}};this.removeUser=function(h,j){if(h&&h.id&&h.id!=c.Model.Owner.getInstance().id){var i=f.toJSON();i.user=f.users[h.id];delete f.users[h.id];f.oldUsers[h.id]=h;if(j){Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.MemberRemoved-"+f.eventIndex);c.EventManager.trigger("event.user.roster.workspace.removed",i)
}}else{c.log("removeUser: user not removed","error")}};this.removeSubspace=function(h,j){var i=f.toJSON();i.user={id:c.Model.Owner.getInstance().id};c.EventManager.trigger("event.user.workspace.deleted",i)};this.ownerRemove=function(){var h=f.toJSON();h.user={id:c.Model.Owner.getInstance().id};c.EventManager.trigger("event.user.roster.workspace.removed",h)
};this.setMessage=function(i,h){f.message=i;var j=f.toJSON();j.user=h;c.log("setMessage "+f.isUserPresent+" "+f.messageQueue.length);if(f.groupId){c.EventManager.trigger("event.user.message.text",j);f.addToGroupMessageHistory(h.id,h.name,h.picture,"group",i)}else{if(f.isUserPresent&&!f.messageQueue.length){Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.OnMessage-true-"+f.eventIndex);
c.EventManager.trigger("event.user.message.text",j);f.addToMessageHistory(h.id,i)}else{f.addToMessageQueue(h.id,i)}}};this.processBulkEvents=function(i){var h=f.toJSON();h.bulkMsgs=i;c.log("setMessage "+f.isUserPresent+" "+f.messageQueue.length);Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.OnMessage-"+f.eventIndex);
if(f.groupId){c.EventManager.trigger("event.user.message.text",h)}else{if(f.isUserPresent&&!f.messageQueue.length){c.EventManager.trigger("event.user.message.text",h)}}};this.addToMessageHistory=function(h,i){if(c.config.chatMsgHistoryEnabled){return}f.messageHistory[f.messageHistory.length]={userId:h,message:i,t:new Date().getTime()};
if(f.messageHistory.length>20){f.messageHistory.splice(0,1)}};this.addToMessageQueue=function(h,i,j){f.messageQueue[f.messageQueue.length]={userId:h,message:i,t:!j?new Date().getTime():j};if(f.messageQueue.length>20){f.messageQueue.splice(0,1)}};this.addToGroupMessageHistory=function(h,l,k,i,j){if(c.config.chatMsgHistoryEnabled){return
}f.messageHistory[f.messageHistory.length]={userId:h,type:i,n:l,p:k,message:j,t:new Date().getTime()};if(f.messageHistory.length>20){f.messageHistory.splice(0,1)}};this.addFollowHistory=function(h,i){if(c.config.chatMsgHistoryEnabled){return}f.messageHistory[f.messageHistory.length]={userId:h,message:"followLink",type:"followLink",sourceId:i,t:new Date().getTime()};
if(f.messageHistory.length>20){f.messageHistory.splice(0,1)}};this.addFollowOnlyHistory=function(h){if(c.config.chatMsgHistoryEnabled){return}f.messageHistory.splice(0,0,{userId:h,message:"followOnlyLink",type:"followOnlyLink",t:new Date().getTime()});if(f.messageHistory.length>20){f.messageHistory.splice(0,1)
}};this.addToEventHistory=function(h,i,k,j){if(c.config.chatMsgHistoryEnabled){return}f.messageHistory[f.messageHistory.length]={userId:h,type:i,value:k,sourceId:j,t:new Date().getTime()};if(f.messageHistory.length>20){f.messageHistory.splice(0,1)}};this.addShareHistory=function(i,h,k,j){if(c.config.chatMsgHistoryEnabled){return
}f.messageHistory[f.messageHistory.length]={userId:i,status:h,type:"share",deviceId:k,ssType:j,t:new Date().getTime()};if(f.messageHistory.length>20){f.messageHistory.splice(0,1)}};this.refreshWorkspace=function(){Jiffy.measure("CM-"+c.EventManager.queueLength(),"Event.OnFirstMessageReceived-"+f.eventIndex);
c.EventManager.trigger("event.user.workspace.refresh",f.toJSON());var h=f.messageQueue.length;while(h--){f.messageHistory.push(f.messageQueue.shift())}};this.refreshWkTitle=function(i){var h=f.toJSON();h.myselfAdded=i;c.EventManager.trigger("event.user.workspace.refreshtitle",h)};this.getMembersCount=function(){var i=0;
for(var h in f.users){i++}return i};this.setCollapsed=function(h){f.collapsed=h;c.EventManager.trigger("event.user.workspace.toggled",f.toJSON())}};b.presence.Model.Workspace=a})(window,presence);(function(a,c){var b=0;var d=function(){var h=this;this.asynchToken="";this.callSuccess=null;this.callFailed=null;
this.apiName="";this.isAsynch=false;this.timeout=c.isIE?600000:20000;this.neededAllRes=false;this.reTryCount=0;this.makeAPICall=function(u,v,B,y,t,A,r,z){b++;h.apiCounter=b;Jiffy.mark("APICall-"+h.apiCounter);Jiffy.mark("TotalAPICall-"+h.apiCounter);if(c.Controller.apiList[u]["isChannel"]&&u!="createChannel"){v.channelId=c.Controller.ownerObj.channelId
}var o=l(c.Controller.apiList[u]["url"],B,c.Controller.apiList[u]["isBatch"]);h.isAsynch=c.Controller.apiList[u]["isAsynch"];h.callSuccess=y;h.callFailed=t;h.apiName=u;h.neededAllRes=z;h.data=v;h.urlData=B;h.givenTimeout=A;if(!A){A=h.timeout}if(!r){r={apiCallerSource:_api_Caller_Source}}r=c.Controller.getHeaderObj(r);
h.headers=r;if(u==="appsubscriptions"||u==="notifications"||u==="getAllMeetups"){r.appType=v.appType;delete v.appType}if(u==="registerToSessionGroup"||u==="postEventToSessionGroup"){r.appType=v.appType;delete v.appType}if(c.Controller.apiList[u]["isChannel"]&&c.Controller.socket){c.log("sending to socket: "+JSON.stringify({method:u.toLowerCase(),params:v}));
c.Controller.socket.send(JSON.stringify({method:u.toLowerCase(),params:v}))}else{var q=new c.Controller.HttpGateway(),n=(c.Controller.apiList[u]["method"]),p;if(n=="GET"||n=="DELETE"){p=v}else{if(n=="POST"||n=="PUT"){p={data:JSON.stringify(v)}}}if(r&&u!="startSession"){var x=["umpsSessionId","objectId","orgId","sessionId"];
for(var w=0;w<x.length;w++){var m=x[w];if(r[m]===undefined){return c.log("No API call should made without required headers : "+x,"info")}}}if(n=="POST"){r["Content-Type"]="application/json; charset=UTF-8"}q.sendRequest(o,n,p,k,i,A,r)}};var l=function(n,m,q){if(!m){return n}var p=n;for(var r in m){if(q===true){var o=m[r]+"";
o=o.replace(/\,/g,",");p=p.replace("{"+r+"}",o)}else{p=p.replace("{"+r+"}",m[r])}}return p};this.retryCall=function(){h.makeAPICall(h.apiName,h.data,h.urlData,h.callSuccess,h.callFailed,h.givenTimeout,h.headers)};var k=function(m){if(m.result){if(h.isAsynch){Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"APICall-"+h.apiCounter);
h.tokenRes=m;h.asynchToken=m.token;g()}else{Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"APICall-"+h.apiCounter);Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"TotalAPICall-"+h.apiCounter);h.asynchToken=undefined;h.callSuccess(m)}}else{i(m)}};var i=function(m){m=(m.errorData&&m.errorData.result===false)?m.errorData:m;
Jiffy.measure(c.Controller.apiList[h.apiName]["url"]+"Failed","APICall-"+h.apiCounter);h.asynchToken=undefined;if(m.errorCode=="invalidUmpsSessionId"&&h.apiName=="createChannel"){c.Controller.ownerObj.umpsSessionId="";c.setClientId("")}if((m.errorCode=="invalidSessionId"||m.errorCode=="invalidUmpsSessionId")&&c.EventManager.bootstrapDone){if(c.getCookie("umps_status")=="offline"){c.Model.Notify.triggerEvent("event.channel.closed")
}else{if(!c.Controller.isFirstAPICallFailed){}else{if(m.errorCode=="invalidUmpsSessionId"&&!c.isSFDC_LogOut_TimeOut){c.isSFDC_LogOut_TimeOut=true;c.Model.Notify.triggerEvent("event.channel.closed")}else{h.callFailed(m)}}}}else{if(m.errorCode=="spaceDoesNotExist"&&c.EventManager.bootstrapDone){if(c.getCookie("umps_status")=="offline"){c.Model.Notify.triggerEvent("event.channel.closed")
}else{c.Model.Notify.fail({status:-106,reason:"Space does not exist"})}}else{h.callFailed(m)}}};var g=function(){Jiffy.mark("ReadResponse-"+h.apiCounter);url=c.Controller.apiList.readResponse["url"];data={token:h.asynchToken};var m=new c.Controller.HttpGateway();if(h.headers&&h.headers.umpsSessionId===undefined){return c.log("No API call should made without umpsSessionId","info")
}m.sendRequest(url,"POST",{data:JSON.stringify(data)},f,j,h.timeout,h.headers)};var f=function(m){if(m.status=="pending"){Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"ReadResponse-"+h.apiCounter);g()}else{if(m.errorCode=="InvalidNode"&&h.reTryCount<4){h.reTryCount++;h.retryCall()}else{if(m.result){h.reTryCount=0;
Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"ReadResponse-"+h.apiCounter);Jiffy.measure(c.Controller.apiList[h.apiName]["url"],"TotalAPICall-"+h.apiCounter);if(h.neededAllRes){h.callSuccess(m,h.tokenRes)}else{h.callSuccess(m)}}else{h.reTryCount=0;Jiffy.measure(c.Controller.apiList[h.apiName]["url"]+"Failed","ReadResponse-"+h.apiCounter);
Jiffy.measure(c.Controller.apiList[h.apiName]["url"]+"Failed","TotalAPICall-"+h.apiCounter);if(m.errorCode=="invalidSessionId"&&c.EventManager.bootstrapDone){c.closeChannel(function(){c.Model.Notify.fail({status:-103,reason:"Logout inactivity"})})}else{if(m.errorCode=="spaceDoesNotExist"&&c.EventManager.bootstrapDone){c.Model.Notify.fail({status:-106,reason:"Space does not exist"})
}else{h.callFailed(m)}}}}}};var j=function(m){Jiffy.measure(c.Controller.apiList[h.apiName]["url"]+"Failed","ReadResponse-"+h.apiCounter);Jiffy.measure(c.Controller.apiList[h.apiName]["url"]+"Failed","TotalAPICall-"+h.apiCounter);if(h.neededAllRes){h.callFailed(m,h.tokenRes)}else{h.callFailed(m)}}};c.Controller.ApiGateway=d
})(window,presence);(function(k,m){var h="";var y=function(){if(m.Controller.websocketEnabled&&m.Controller.Websocket.check()){A("websocket")}else{A("longpoll")}};var A=function(p){if(p=="websocket"){m.Controller.transportType="websocket";m.Controller.eventPollObj=new m.Controller.EventPollerSocket()
}else{if(m.isIE&&!window.performance){m.Controller.pollInterval=1000}m.Controller.transportType="longpoll";m.Controller.eventPollObj=new m.Controller.EventPoller()}};var x=false;m.Controller.isFirstAPICallFailed=true;var r=function(F,B){if(x){return true}if(F&&F.sid&&F.objectId&&F.orgId){_api_Caller_Source=m.View.PopOutWidget.active?(popOut_ChatSubspaceId?"CHAT_POPOUT":"ROSTER_POPOUT"):"RHS_Widget";
x=true;m.EventManager.bootstrapDone=false;window._chatOwner=undefined;m.Controller.ownerObj=m.Model.Owner.getInstance();m.Controller.parentData=F;var G=undefined;if(m.readFromCache&&m.Controller.cacheTimeOut>0&&!B){G=m.readFromCache()}m.Controller.ownerObj.id=F.objectId;var H=true;if(G){try{m.log("ControllerInit: ownerObjCache="+G,"info");
Jiffy.mark("JsonParsingCache");var D=JSON.parse(G);Jiffy.measure("Done","JsonParsingCache");m.log("ControllerInit: parsing cache is done , window.name="+canvas_window.name+" ,channelId="+D.channelId,"info");var E=canvas_window.name.split("|")[1];if((canvas_window.name.length>0&&E!=""&&D.channelId==E)){m.log("ControllerInit: Window.name PASS (channel id check)","info");
var p=new Date().getTime();if((p-D.cacheTime<m.Controller.cacheTimeOut)){m.log("ControllerInit: Cache Time out PASS cacheTime="+D.cacheTime+" , currentTime="+p+" , Diff in Mins="+((p-D.cacheTime)/(1000*60)),"info");if((F.objectId==D.id)){m.log("ControllerInit: Object Id Check PASS","info");if(D.isChatUiEnabled===canvas_window.umps_config.isChatUiEnabled){m.log("ControllerInit: isChatUiEnabled PASS","info");
if((D.screenShareEnabled===m.config.screenShareEnabled)||D.screenShareEnabled===true){m.log("ControllerInit: screenShareEnabled PASS","info");m.Controller.isFirstAPICallFailed=false;H=false;b(D)}else{m.log("ControllerInit: screenShareEnabled FAIL","info")}}else{m.log("ControllerInit: isChatUiEnabled FAIL","info")
}}else{m.log("ControllerInit: Object Id Check FAIL","info")}}else{m.log("ControllerInit: Cache Time out FAIL cacheTime="+D.cacheTime+" , currentTime="+p+" , Diff in Mins="+((p-D.cacheTime)/(1000*60)),"info")}}else{m.log("ControllerInit: Window.name FAIL (channel id check)","info")}}catch(C){m.log("ControllerInit: Exception Cache reading ="+C,"error")
}}var w=m.getCookie("umps_status")=="offline"?true:false;if(w&&!B&&H&&!m.View.PopOutWidget.active){m.log("Offline cookie set, showing offline","info");m.Controller.ownerObj.presenceStatus=20;t(true);w=false;return true}if(H){m.log("ControllerInit: No cache available doing bootstrap (or) Force bootstrap","info");
v()}return true}else{m.log("ControllerInit:init no data provided by parent page (or) sid,objectId,orgId mising","error");return false}};var v=function(){try{Jiffy.mark("ShowConnecting");m.Model.Notify.bootStrapLoading()}catch(p){m.log("ControllerInit: exception in showWidgetLoader","error")}m.Controller.callCreateSpace()
};var b=function(F){var w=F.widgetProp;if(w){if(w.isCollapsed!==undefined){presence.BuddyListActive=w.isCollapsed}if(w.setAutoidle!==undefined){presence.setAutoidle=w.setAutoidle}if(w.hideOfflineUsers!==undefined){presence.hideOfflineUsers=w.hideOfflineUsers}if(w.BuddylistCollapsed!==undefined){presence.BuddylistCollapsed=w.BuddylistCollapsed
}if(w.HistoryExpanded!==undefined){presence.HistoryExpanded=w.HistoryExpanded}if(w.showEmoticons!==undefined){presence.showEmoticons=w.showEmoticons}if(w.blinkBrowserTab!==undefined){presence.blinkBrowserTab=w.blinkBrowserTab}if(w.expandChatWindow!==undefined){presence.expandChatWindow=w.expandChatWindow
}if(w.autoIdleTime!==undefined){presence.config.autoIdleTime=w.autoIdleTime}if(w.enableWebkitNotification!==undefined){presence.config.enableWebkitNotification=w.enableWebkitNotification}if(w.audibleEnabled!==undefined){presence.config.audibleEnabled=w.audibleEnabled}if(w.audibleLevel!==undefined){presence.config.audibleLevel=w.audibleLevel
}if(w.showFavorites!==undefined){presence.showFavorites=w.showFavorites}if(w.showFollowed!==undefined){presence.showFollowed=w.showFollowed}if(w.timeStampHover!==undefined){presence.timeStampHover=w.timeStampHover}if(w.showCloseDialog!==undefined){presence.showCloseDialog=w.showCloseDialog}if(w.ssConnectionTimeout!==undefined){presence.config.ssConnectionTimeout=w.ssConnectionTimeout
}if(w.ssRetries!==undefined){presence.config.ssRetries=w.ssRetries}if(w.autoDetectProxy!==undefined){presence.config.autoDetectProxy=w.autoDetectProxy}if(w.byPassProxy!==undefined){presence.byPassProxy=w.byPassProxy}if(w.socksProxy!==undefined){presence.socksProxy=w.socksProxy}if(w.proxyAddress!==undefined){presence.proxyAddress=w.proxyAddress
}if(w.proxyDomain!==undefined){presence.proxyDomain=w.proxyDomain}if(w.proxyUserName!==undefined){presence.proxyUserName=w.proxyUserName}if(w.proxyPassword!==undefined){presence.proxyPassword=w.proxyPassword}if(w.histObj!=undefined){presence.histObj=w.histObj}}A(F.transport);m.Model.fromJSON(F);var B=[],E=[];
for(var C in m.Controller.ownerObj.workspaces){if(m.Controller.ownerObj.workspaces[C].fetchingUsers==true){B[B.length]=C}if(m.Controller.ownerObj.workspaces[C].propData){E[E.length]=C}}var D=function(G){if(G<B.length){m.log("ControllerInit: found invalidSubspace doing getsubspacemembers "+B[G],"info");
m.Controller.getSubspaceMembers(B[G],function(I,O){if(I&&O.data.length>0){var N=O.data[0];var M=N.members;m.Controller.ownerObj.workspaces[B[G]].users={};m.Controller.ownerObj.workspaces[B[G]].oldUsers={};for(var L=0;L<M.length;L++){var K=M[L];if(K.objectId!=m.Controller.ownerObj.id){if(K.presence.aggregatedChannelsState=="idle"&&K.presence.status!=100){K.presence.status=m.presenceStatus.IDLE
}var J=new m.Model.User({id:K.objectId,name:K.screenName,fName:K.firstName,lName:K.lastName,presenceStatus:K.presence.status,presenceStatusMessage:K.presence.message,picture:K.thumbnailUrl});m.Controller.ownerObj.workspaces[B[G]].addUser(J,false,K.isMember);J.isAnonymous=!K.isFollowee;m.Controller.ownerObj.addToUserList(J)
}}m.Controller.ownerObj.workspaces[B[G]].fetchingUsers=false;m.Controller.ownerObj.workspaces[B[G]].refreshWorkspace();G=G+1;D(G)}else{f({fillSubapcesWithMembers_fail:O})}})}else{t(true);for(var H in B){if(m.Controller.ownerObj.workspaces[B[H]]){m.Controller.ownerObj.workspaces[B[H]].refreshWorkspace()
}}return}};D(0);var p=function(G){if(G<E.length){m.log("ControllerInit: found pending subspaceproperties so doing it "+E[G],"info");if(m.Controller.ownerObj.workspaces[E[G]].propData){m.Controller.call({method:"setsubspaceproperties",data:m.Controller.ownerObj.workspaces[E[G]].propData,urlData:{chatId:propData.chatId},successCallBack:function(H){delete m.Controller.ownerObj.workspaces[E[G]].propData;
G=G+1;p(G)},failCallBack:function(H){delete m.Controller.ownerObj.workspaces[E[G]].propData;G=G+1;p(G)}})}}};p(0)};var z=function(){};var c=function(){Jiffy.mark("BS-createspace");var p={};var w={apiCallerSource:_api_Caller_Source,chatMsgHistoryEnabled:m.config.chatMsgHistoryEnabled,chatMsgDeepHistoryEnabled:m.config.chatMsgDeepHistoryEnabled,chatMsgDeepHistoryDarkLaunchEnabled:m.config.chatMsgDeepHistoryDarkLaunchEnabled};
new m.Controller.ApiGateway().makeAPICall("startSession",p,null,d,f,false,w)};var d=function(C){if(C.result){try{var B=C.data;m.Controller.ownerObj.sessionId=B.spaceId;m.Controller.ownerObj.umpsSessionId=B.umpsSessionId;m.setClientId(m.Controller.ownerObj.umpsSessionId);m.Controller.ownerObj.defaultSubSpaceId=B.subspaceId;
m.Controller.ownerObj.totalRosterCount=B.totalRosterCount;m.Controller.ownerObj.setPicture(B.details.smallPhotoUrl);m.Controller.ownerObj.setName({name:B.details.screenName,fName:B.details.firstName,lName:B.details.lastName});m.Controller.ownerObj.presenceStatus=B.presence.status;m.Controller.ownerObj.presenceMessage=B.presence.message;
h=B.presence.aggregatedChannelsState;if(B.channelsGroupDetails){m.Controller.ownerObj.device=B.channelsGroupDetails}m.Controller.overRidePreferences(B.userPreferences);m.Controller.overRideUserAppPreferences(B.userAppPreferences);if(B.userPreferences){if(B.userPreferences.activeSubspaces!==undefined||B.userPreferences.unreadSubspaces!==undefined){if(B.userPreferences.activeSubspaces!==undefined){m.activeSubspaces=B.userPreferences.activeSubspaces
}if(B.userPreferences.unreadSubspaces!==undefined){m.unreadSubspaces=B.userPreferences.unreadSubspaces}m.cleanUserPreferences=true}}if(B.spacePreferences&&B.spacePreferences.allOpenWindows){m.Controller.viewState=B.spacePreferences}var p={deviceId:m.Controller.ownerObj.umpsSessionId};new m.Controller.ApiGateway().makeAPICall("createChannel",p,null,function(D){if(D.result){var E=D;
if(!m.View.PopOutWidget.active){if(canvas_window.name.indexOf("|")>=0){canvas_window.name="umps|"+E.channelId+"|"+canvas_window.name.split("|")[2]+"|"}else{canvas_window.name=E.channelId}}m.Controller.ownerObj.channelId=E.channelId;Jiffy.measure("Done","BS-createspace");popOut_ChatSubspaceId?t():l()}else{f(resOb)
}},f)}catch(w){m.log("ControllerInit:callCreateSpace callback exception="+w,"error");f({error:"callCreateSpace callback exception="+w})}}else{f(resOb)}};var f=function(p){x=false;if(m.EventManager.bootstrapDone&&m.Controller.ownerObj.presenceStatus==20){return}m.log("ControllerInit: bootstrap failed data="+JSON.stringify(p),"error");
m.Model.Notify.bootstrapFailed(p);m.Controller.ownerObj=undefined};var t=function(p){if(p&&m.Controller.ownerObj&&m.Controller.ownerObj.presenceStatus!=20){m.Controller.ownerObj.rosterNextPageIndex!=-1&&n({pageSize:m.Controller.pageSize,pageIndex:m.Controller.ownerObj.rosterNextPageIndex})}else{Jiffy.measure("Done","ShowConnecting")
}m.Model.Notify.bootstrapDone();x=false;if(m.Controller.ownerObj.presenceStatus!=20){y();m.Controller.EventParser({messages:[]});m.Controller.eventPollObj.startTimer()}a()};var a=function(){u()};var l=function(){Jiffy.mark("BS-getallsubspaces");var p={includeMembers:true};presence.Controller.call({method:"getAllWorkspaces",data:p,successCallBack:function(N){var M=N.data,J=M.length;
for(var G=0;G<J;G++){var C=M[G],L=C.members,w=new m.Model.Workspace({id:C.subspaceId,isActive:false});if(C.chatSessionType){w.chatSessionType=C.chatSessionType}if(C.sourceId){w.sourceId=C.sourceId}if(C.chatSessionId){w.chatSessionId=C.chatSessionId}if(m.config.screenShareEnabled){w.setSubspaceProperties(C,false)
}usersLen=L.length,considerWk=false;for(var F=0;F<usersLen;F++){var E=L[F];if(E.objectId!=m.Controller.ownerObj.id){if(E.presence.aggregatedChannelsState=="idle"&&E.presence.status!=100){E.presence.status=m.presenceStatus.IDLE}var K=new m.Model.User({id:E.objectId,name:E.screenName,fName:E.firstName,lName:E.lastName,presenceStatus:E.presence.status,presenceStatusMessage:E.presence.message,picture:E.thumbnailUrl});
if(usersLen==2){considerWk=true;(E.presence.status==20)&&(w.disabled=true);w.addUser(K,false,true)}else{w.once1toM=true;w.addUser(K,false,E.isMember);if(E.isMember){considerWk=true}}K.isAnonymous=!E.isFollowee;m.Controller.ownerObj.addToUserList(K)}}if(considerWk){m.Controller.ownerObj.addWorkspace(w)
}}var D=m.Controller.ownerObj.device.chatPopout;for(var F=0,B=D?D.length:0;F<B;F++){var w=m.Controller.ownerObj.workspaces[D[F]];if(w){w.isPopped=true}}var I=m.activeSubspaces,H=m.getCookie("umps_open_subspaceid");for(var F=0,B=I?I.length:0;F<B;F++){var w=m.Controller.ownerObj.workspaces[I[F]];if(w){w.isActive=true;
if(H!="DUMMY"&&I[F]==H&&!w.isPopped){w.doOpenWindow=true;w.collapsed=true}}}var O=m.unreadSubspaces;for(var F=0,B=O?O.length:0;F<B;F++){var w=m.Controller.ownerObj.workspaces[O[F]];if(w){w.hasUnreadMessages=true}}if(m.cleanUserPreferences===true){m.View.WindowManager.updatePreferencesCall();m.View.WindowManager.synchWindows();
m.cleanUserPreferences=false}Jiffy.measure("Done","BS-getallsubspaces");g()},failCallBack:f})};var j=function(p){Jiffy.mark("BS-getallsubspaces");var w={includeMembers:true};presence.Controller.call({method:"getAllWorkspaces",data:w,successCallBack:function(O){m.View.WindowManager.reInit();var N=O.data,K=N.length;
for(var H=0;H<K;H++){var D=N[H],M=D.members,B=new m.Model.Workspace({id:D.subspaceId,isActive:false});if(D.chatSessionType){B.chatSessionType=D.chatSessionType}if(D.sourceId){B.sourceId=D.sourceId}if(D.chatSessionId){B.chatSessionId=D.chatSessionId}if(m.config.screenShareEnabled){B.setSubspaceProperties(D,false)
}usersLen=M.length,considerWk=false;for(var G=0;G<usersLen;G++){var F=M[G];if(F.objectId!=m.Controller.ownerObj.id){if(F.presence.aggregatedChannelsState=="idle"&&F.presence.status!=100){F.presence.status=m.presenceStatus.IDLE}var L=new m.Model.User({id:F.objectId,name:F.screenName,fName:F.firstName,lName:F.lastName,presenceStatus:F.presence.status,presenceStatusMessage:F.presence.message,picture:F.thumbnailUrl});
if(usersLen==2){considerWk=true;(F.presence.status==20)&&(B.disabled=true);B.addUser(L,false,true)}else{B.once1toM=true;B.addUser(L,false,F.isMember);if(F.isMember){considerWk=true}}L.isAnonymous=!F.isFollowee;m.Controller.ownerObj.addToUserList(L)}}if(considerWk){m.Controller.ownerObj.addWorkspace(B)
}}var E=m.Controller.ownerObj.device.chatPopout;for(var G=0,C=E?E.length:0;G<C;G++){var B=m.Controller.ownerObj.workspaces[E[G]];if(B){B.isPopped=true}}var J=m.activeSubspaces,I=m.getCookie("umps_open_subspaceid");for(var G=0,C=J?J.length:0;G<C;G++){var B=m.Controller.ownerObj.workspaces[J[G]];if(B){B.isActive=true;
if(I!="DUMMY"&&J[G]==I&&!B.isPopped){B.doOpenWindow=true;B.collapsed=true}}}var P=m.unreadSubspaces;for(var G=0,C=P?P.length:0;G<C;G++){var B=m.Controller.ownerObj.workspaces[P[G]];if(B){B.hasUnreadMessages=true}}m.View.WindowManager.resurrectWindows();m.Controller.eventPollObj.scheduleReceiveMessagesCall(p)
},failCallBack:function(){m.log("Reloading active subspaces failed, so collapsing widget","error");m.Model.Notify.fail({reason:"Reloading active subspaces failed"})}})};var g=function(p){if(!p){p={pageSize:m.Controller.pageSize}}presence.Controller.call({method:"getFavorites",data:p,successCallBack:function(G){var E=G.data;
var B=m.Controller.ownerObj;for(var D=0,w=E.members.length;D<w;D++){if(!B.users[E.members[D].objectId]){if(E.members[D].presence.aggregatedChannelsState=="idle"&&E.members[D].presence.status!=100){E.members[D].presence.status=m.presenceStatus.IDLE}var C=new m.Model.User({id:E.members[D].objectId,name:E.members[D].screenName,fName:E.members[D].firstName,lName:E.members[D].lastName,presenceStatus:E.members[D].presence.status,picture:E.members[D].thumbnailUrl,isAnonymous:!E.members[D].isFollowee});
B.addToUserList(C)}}for(var F in E.favorites){B.addFavorite(E.favorites[F])}if(E.nextPageIndex==-1){m.Controller.updatePresence()}else{g({pageSize:m.Controller.pageSize,pageIndex:E.nextPageIndex})}if(m.config.App==="webmessenger"&&m.config.meetupsEnabled){q()}},failCallBack:f})};var q=function(){var p={appType:"meetup"};
new m.Controller.ApiGateway().makeAPICall("appsubscriptions",p,null,function(C){if(C&&C.result){var w=m.getCookie("groupId"),B=[m.Controller.ownerObj.umpsSessionId];if(w&&m.View.MeetupsLauncher){m.View.MeetupsLauncher.registerToSessionGroup(B,w)}o()}else{m.log("ApiCall - Subscribe To Meetups Channel result false","error")
}},function(){m.log("ApiCall - Subscribe To Meetups Channel failed","error")})};var o=function(){var p={appType:"meetup"};new m.Controller.ApiGateway().makeAPICall("getAllMeetups",p,null,function(G){if(G&&G.result){var E=G.data;if(E){for(var w in E){var D=E[w];if(D){var C=D.meetupSessionId;var B=D.parentChatId;
var F=m.Controller.ownerObj.workspaces[B];if(F){F.meetupSessionId=C}}}}}},function(){m.log("ApiCall - getAllMeetups failed","error")})};var i=function(){if(m.Controller.ownerObj.presenceStatus==20||h!="active"){var p={presenceStatus:{status:10,message:"Available"}};new m.Controller.ApiGateway().makeAPICall("setPresence",p,null,function(B){if(B&&B.result){var w=B.data;
m.Controller.ownerObj.presenceStatus=w.status;m.Controller.ownerObj.presenceMessage=w.message;m.Controller.ownerObj.aggregatedChannelsState=w.aggregatedChannelsState;t();n()}else{f}},f)}else{t();n()}};var n=function(p){if(!p){p={pageSize:m.Controller.pageSize}}presence.Controller.call({method:"getRoster",data:p,successCallBack:function(H){var E=H.data;
var F=E.members,w=m.Controller.ownerObj;for(var C=0,G=F.length;C<G;C++){try{var B=F[C];if(B.presence.aggregatedChannelsState=="idle"&&B.presence.status!=100){B.presence.status=m.presenceStatus.IDLE}if(B.objectId!=m.Controller.ownerObj.id){w.addToUserList(new m.Model.User({id:B.objectId,name:B.screenName,fName:B.firstName,lName:B.lastName,presenceStatus:B.presence.status,presenceStatusMessage:B.presence.message,picture:B.thumbnailUrl}))
}}catch(D){m.log("ControllerInit:getRoster exception="+D,"error")}}m.Controller.ownerObj.sortUsers();w.rosterNextPageIndex=E.nextPageIndex;if(E.nextPageIndex==-1){m.Model.Notify.rosterLoaded()}else{n({pageSize:m.Controller.pageSize,pageIndex:E.nextPageIndex})}},failCallBack:function(){if(!m.Controller.ownerObj.pageLoadHappens){m.closeChannel(function(){m.Model.Notify.fail({reason:"Get roster failed"})
})}}})};var u=function(){try{if(m.Controller.ownerObj.pendingMembers){for(var F in m.Controller.ownerObj.pendingMembers){var p=F.split("|||");if(p.length==2){var D=p[0];var B=m.Controller.ownerObj.workspaces[D];var E=p[1];var w=m.Controller.ownerObj.users[E];if(w){B.addUser(w,true)}else{m.Controller.getUserDetails(E,function(G){return function(H,J){if(!H){return
}var K=J.data;if(K[G].presence.aggregatedChannelsState=="idle"&&K[G].presence.status!=100){K[G].presence.status=m.presenceStatus.IDLE}var I=new m.Model.User({id:G,name:K[G].screenName,fName:K[G].firstName,lName:K[G].lastName,picture:K[G].thumbnailUrl,presenceStatus:K[G].presence.status,presenceMessage:K[G].presence.message});
B.addUser(I,true);I.isAnonymous=!K[G].isFollowee;m.Controller.ownerObj.addToUserList(I);m.Controller.ownerObj.sortUsers();delete m.Controller.ownerObj.pendingMembers[D+"|||"+G]}}(E))}}else{m.Controller.EventParser.updateUser(p[0])}}}}catch(C){m.log("ControllerInit:checkPendingMembers exception="+data,"error")
}};if(!window.presence.Controller.init){window.presence.Controller.init=r}if(!window.presence.Controller.callCreateSpace){window.presence.Controller.callCreateSpace=c}if(!window.presence.Controller.getAllActiveSubspaces){window.presence.Controller.getAllActiveSubspaces=l}if(!window.presence.Controller.getAllActiveSubspacesAgainAndResumeReceivemessages){window.presence.Controller.getAllActiveSubspacesAgainAndResumeReceivemessages=j
}if(!window.presence.Controller.fireBootStrap){window.presence.Controller.fireBootStrap=t}if(!window.presence.Controller.updatePresence){window.presence.Controller.updatePresence=i}if(!window.presence.Controller.getRoster){window.presence.Controller.getRoster=n}})(window,presence);(function(a,b){b.Controller.pollTimeout=65000;
b.Controller.pollInterval=200;b.Controller.shortPollInterval=60000;b.Controller.websocketEnabled=false;b.Controller.websocketConnected=false;b.Controller.socketHeartbeat=20000;b.Controller.socketHeartbeatAck=30000;b.Controller.socketEstablishMent=60000;b.Controller.cacheTimeOut=90*1000;b.pingInterval=10*60*1000;
b.Controller.pageSize=100;b.Controller.APIsVersion="v28.0";b.Controller.APIsOldVersion="v27.0";b.Controller.appType="messenger";b.Controller.nodeDownMaxRetryCount=3;b.Controller.nodeDownRetryInterval=5000;b.Controller.apiList={startSession:{url:"/api/presence/"+b.Controller.APIsVersion+"/common/sessions",isAsynch:false,method:"POST"},getWorkspaceMembers:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats/{chatId}",isAsynch:false,method:"GET"},notifyDevice:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/messages",isAsynch:false,method:"POST"},setsubspaceproperties:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats/{chatId}",isAsynch:false,method:"PUT"},removeMemberToWorkspace:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats/{chatId}/members/{memberId}",isAsynch:false,method:"DELETE"},createWorkspace:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats",isAsynch:false,method:"POST"},getAllWorkspaces:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats",isAsynch:false,method:"GET"},setPresence:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/users/me/presence",isAsynch:false,method:"PUT"},getmemberdetails:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/users/{userId}",isAsynch:false,method:"GET"},getmembersdetails:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/users/batch/{userIds_list}",isAsynch:false,method:"GET",isBatch:true},addMemberToWorkspace:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/chats/{chatId}/members",isAsynch:false,method:"PUT"},sendMessage:{url:"/api/channel/"+b.Controller.APIsVersion+"/messenger/chats/{chatId}/messages",isAsynch:false,isChannel:true,method:"POST"},getPresence:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/users/{userId}/presence",isAsynch:false,method:"GET"},getPresences:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/users/batch/{userIds_list}/presence",isAsynch:false,method:"GET",isBatch:true},getEvents:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/channels/this/messages",isAsynch:false,isChannel:true,method:"GET"},closechannel:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/channels/this",isAsynch:false,isChannel:true,method:"DELETE"},sendCustomEvent:{url:"/api/channel/"+b.Controller.APIsVersion+"/messenger/messages",isAsynch:false,isChannel:true,method:"POST"},setChannelGroupPreferences:{url:"/api/presence/"+b.Controller.APIsVersion+"/setchannelsgrouppreferences",isAsynch:false,method:"POST"},setuserpreferences:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/preferences",isAsynch:false,method:"PUT"},setuserAppPreferences:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/apppreferences",isAsynch:false,method:"PUT"},addFavorite:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites",isAsynch:false,method:"POST"},removeFavorite:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites/{favoriteId}",isAsynch:false,method:"DELETE"},removeFavoriteDH:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites",isAsynch:false,method:"DELETE"},ping:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/sessions/this",isAsynch:false,method:"PUT"},getFavorites:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites",isAsynch:false,method:"GET"},renameFavorite:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites/{favoriteId}",isAsynch:false,method:"PUT"},renameFavoriteDH:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/favorites",isAsynch:false,method:"PUT"},getRoster:{url:"/api/presence/"+b.Controller.APIsVersion+"/messenger/followees",isAsynch:false,method:"GET"},addroster:{url:"/api/presence/"+b.Controller.APIsVersion+"/internal/followees/{followeeId}",isAsynch:false,method:"PUT"},removeroster:{url:"/api/presence/"+b.Controller.APIsVersion+"/internal/followees/{followeeId}",isAsynch:false,method:"DELETE"},setdevicestate:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this",isAsynch:false,method:"PUT"},createChannel:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/channels",isAsynch:false,isChannel:true,method:"POST"},closeDevice:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this",isAsynch:false,isChannel:true,method:"DELETE"},getMessageHistory:{url:"/api/channel/"+b.Controller.APIsVersion+"/messenger/chats/{this}/history",isAsynch:false,isChannel:true,method:"GET"},createchatsession:{url:"/api/presence/v26.0/createchatsession",isAsynch:false,method:"POST"},websocket:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/channels/this/websocket"},appsubscriptions:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessions/this/channels/this/appsubscriptions",isAsynch:false,method:"PUT"},registerToSessionGroup:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessionGroups/{sessionGroupId}",isAsynch:false,method:"PUT"},postEventToSessionGroup:{url:"/api/channel/"+b.Controller.APIsVersion+"/common/sessionGroups/{sessionGroupId}/events",isAsynch:false,method:"POST"},getAllMeetups:{url:"/api/presence/"+b.Controller.APIsVersion+"/meetup/sessions",isAsynch:false,method:"GET"},orgWideSearch:{url:"/api/presence/"+b.Controller.APIsVersion+"/common/users/me/search",isAsynch:false,method:"GET"}};
b.Controller.getHeaderObj=function(c){if(!c){c={}}if(b.Controller.ownerObj){if(b.Controller.ownerObj.umpsSessionId){c.umpsSessionId=b.Controller.ownerObj.umpsSessionId}else{c.umpsSessionId=b.getClientId()}if(b.Controller.ownerObj.channelId){c.channelId=b.Controller.ownerObj.channelId}}if(b.Controller.parentData){c.objectId=b.Controller.parentData.objectId;
c.orgId=b.Controller.parentData.orgId;c.sessionId=b.Controller.parentData.sid;c.appType=b.Controller.appType}return c};b.Controller.parseImageUrl=function(d){var c=contentDomainUrl?contentDomainUrl:baseSfdcUrl;if(d&&c){if(d.indexOf("/profilephoto")===-1){d=c+"/profilephoto/"+d+"/T"}else{d=c+d.substring(d.indexOf("/profilephoto"),d.length)
}}return d}})(window,presence);(function(v,B){var d=0,b;B.Controller.getUserDetails=function(w,M){var p={userId:w};new B.Controller.ApiGateway().makeAPICall("getmemberdetails",{},p,function(N){M(true,N)},function(N){M(false,N)})};B.Controller.getSubspaceMembers=function(M,N){var w={includeMembers:true};
var p={chatId:M};new B.Controller.ApiGateway().makeAPICall("getWorkspaceMembers",w,p,function(O){N(true,O)},function(O){N(false,O);B.log("EventParser:getWorkspaceMembers failed="+O,"error")})};B.Controller.getGroupDetails=function(p,N){b=B.Model.Owner.getInstance();var M=b.groups[p];M.updatePending=true;
var w={groupIds:[p]};new B.Controller.ApiGateway().makeAPICall("getgroupdetails",w,null,N,function(O){B.log("EventParser:getGroupDetails failed="+O,"error");delete M.updatePending})};B.Controller.refreshGroups=function(){};B.Controller.overRidePreferences=function(p){if(p){if(p.hideOfflineUsers!==undefined){B.hideOfflineUsers=p.hideOfflineUsers
}if(p.showEmoticons!==undefined){B.showEmoticons=p.showEmoticons}if(p.setAutoidle!==undefined){B.setAutoidle=p.setAutoidle}if(p.autoIdleTime!==undefined){B.config.autoIdleTime=p.autoIdleTime}if(p.blinkBrowserTab!==undefined){B.blinkBrowserTab=p.blinkBrowserTab}if(p.audibleLevel!==undefined){B.config.audibleLevel=p.audibleLevel
}if(p.enableWebkitNotification!==undefined){B.config.enableWebkitNotification=p.enableWebkitNotification}if(p.showFavorites!==undefined){B.showFavorites=p.showFavorites}if(p.showFollowed!==undefined){B.showFollowed=p.showFollowed}if(p.timeStampHover!==undefined){B.timeStampHover=p.timeStampHover}if(p.showCloseDialog!==undefined){B.showCloseDialog=p.showCloseDialog
}if(p.ssConnectionTimeout!==undefined){B.config.ssConnectionTimeout=p.ssConnectionTimeout}if(p.ssRetries!==undefined){B.config.ssRetries=p.ssRetries}if(p.autoDetectProxy!==undefined){B.config.autoDetectProxy=p.autoDetectProxy}if(p.byPassProxy!==undefined){B.byPassProxy=p.byPassProxy}if(p.socksProxy!==undefined){B.socksProxy=p.socksProxy
}if(p.proxyAddress!==undefined){B.proxyAddress=p.proxyAddress}if(p.proxyDomain!==undefined){B.proxyDomain=p.proxyDomain}if(p.proxyUserName!==undefined){B.proxyUserName=p.proxyUserName}if(p.proxyPassword!==undefined){B.proxyPassword=p.proxyPassword}}};B.Controller.overRideUserAppPreferences=function(p){if(p){if(p.activeSubspaces!==undefined){B.activeSubspaces=p.activeSubspaces
}if(p.unreadSubspaces!==undefined){B.unreadSubspaces=p.unreadSubspaces}}};var I=function(O){var R=O.header;var p=O.data;var N=++d,Q=false;var P=R.subspaceId;var w=R.chatSessionId;if(popOut_ChatSubspaceId&&popOut_ChatSubspaceId!=P){return false}var M=function(Z,S){B.log("processing message event for ="+P,"info");
var W=b.workspaces[P];W.eventIndex=N;var T=[],X=S.length;for(var V=0;V<X;V++){var Y=S[V];if(Y.channelId!=b.channelId){var U=(Y.sourceId==b.id)?"me":Y.sourceId;if(Y.isComposing===true){if(Y.sourceId!=b.id){T[T.length]={from:Y.sourceId,isComposing:true}}}else{if(W.isUserPresent&&!W.messageQueue.length){W.addToMessageHistory(U,Y.text)
}else{W.addToMessageQueue(U,Y.text,Y.timestamp)}T[T.length]={from:U,message:Y.text,timestamp:Y.timestamp}}}B.Controller.ownerObj.bufferIndex.eventSubIndex=V}B.Controller.ownerObj.bufferIndex.eventSubIndex=-1;if(T.length>0){W.processBulkEvents(T)}return Q};if(R.isGroup){}else{if(b.workspaces[P]){Jiffy.mark("Event.OnMessage-"+N);
return M(R,p)}else{Jiffy.mark("Event.OnFirstMessageReceived-"+N);B.log("Received message first time from subspace id ="+P+", so doing getallsubspace members","info");b.addWorkspace(new B.Model.Workspace({id:P}));b.workspaces[P].fetchingUsers=true;if(w){b.workspaces[P].chatSessionId=w}Q=true;B.Controller.getSubspaceMembers(P,function(S,Y){if(S&&Y.data.length>0){var X=Y.data[0];
var W=X.members;for(var V=0;V<W.length;V++){var U=W[V];if(U.objectId!=B.Controller.ownerObj.id){if(U.presence.aggregatedChannelsState=="idle"&&U.presence.status!=100){U.presence.status=B.presenceStatus.IDLE}var T=new B.Model.User({id:U.objectId,name:U.screenName,fName:U.firstName,lName:U.lastName,presenceStatus:U.presence.status,presenceStatusMessage:U.presence.message,picture:U.thumbnailUrl});
b.workspaces[P].addUser(T,false,U.isMember);T.isAnonymous=!U.isFollowee;b.addToUserList(T)}}B.Controller.ownerObj.sortUsers();B.log("Got all subspace members of subspce id="+P+" ,count="+W.length+" , openOnLoad="+b.workspaces[P].openOnLoad+" , closeOnLoad="+b.workspaces[P].closeOnLoad,"info");b.workspaces[P].eventIndex=N;
b.workspaces[P].refreshWorkspace();b.workspaces[P].fetchingUsers=false;if(B.config.screenShareEnabled){b.workspaces[P].setSubspaceProperties(X,false,"")}}else{delete b.workspaces[P]}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;h()}});return M(R,p)}}};var g=function(O){var R=O.header;
var p=O.data;var N=++d,Q=false;var w=b.users[p.userId];if(w){Jiffy.mark("Event.FollowedPersonStatusChange-"+N);w.eventIndex=N;if(p.presence.aggregatedChannelsState=="idle"&&p.presence.status!=100){if(p.presence.status){w.setPresenceStatus(B.presenceStatus.IDLE)}}else{if(p.presence.status){w.setPresenceStatus(p.presence.status)
}}if(p.presence.message){w.setPresenceMessage(p.presence.message)}if(p.presence.status==20){var P=b.getWorkspacesByUserId(p.userId);for(var M=0;M<P.length;M++){if(!P[M].disabled){if(P[M].once1toM){P[M].removeUser(w)}if(P[M].getMembersCount()>1){P[M].refreshWkTitle()}}}}}else{if(b.id==p.userId){B.log("onPresence owner presence");
if(p.presence.status&&p.presence.status!=20){B.Controller.ownerObj.setPresenceStatus(p.presence.status,p.presence.aggregatedChannelsState)}else{if(p.presence.status&&p.presence.status===20){B.closeChannel(function(){B.log("Ideally we should not receive it but may be ping is not being happened by long poll hence device TTL expired","info");
B.Model.Notify.fail({status:-106,reason:"Space does not exist"})})}}}}return Q};var c=function(w,M){var S=w.header;var U=w.data;var p=++d,R=false;var X=U.subspaceId;var W=U.chatSessionId;if(popOut_ChatSubspaceId&&popOut_ChatSubspaceId!=X){return false}if(X==B.Controller.ownerObj.defaultSubSpaceId){B.log("EventParser:onSubspaceMemberAdded  for the default subspace id="+X+", so ignoring","info")
}else{var V=B.Controller.ownerObj.workspaces[X];if(V){B.Controller.ownerObj.workspaces[X].chatSessionId=W;for(var Q=0,T=U.memberIds.length;Q<T;Q++){var P=U.memberIds[Q];if(P==B.Controller.ownerObj.id&&!M){var O=V.toJSON();O.user={id:B.Model.Owner.getInstance().id};B.EventManager.trigger("event.user.roster.workspace.added",O)
}if(P!=B.Controller.ownerObj.id){Jiffy.mark("Event.MemberAdded-"+p);var N=b.users[P];if(N){V.eventIndex=p;V.addUser(N,true,null,U.sourceId)}else{b.pendingMembers[X+"|||"+P]={};R=true;presence.Controller.getUserDetails(P,function(Y){return function(Z,ab){if(Z){var ac=ab.data;if(ac[Y].presence.aggregatedChannelsState=="idle"&&ac[Y].presence.status!=100){ac[Y].presence.status=B.presenceStatus.IDLE
}var aa=new B.Model.User({id:Y,name:ac[Y].screenName,fName:ac[Y].firstName,lName:ac[Y].lastName,picture:ac[Y].thumbnailUrl,presenceStatus:ac[Y].presence.status,presenceMessage:ac[Y].presence.message});V.eventIndex=p;V.addUser(aa,true,null,U.sourceId);aa.isAnonymous=!ac[Y].isFollowee;b.addToUserList(aa);
B.Controller.ownerObj.sortUsers();delete b.pendingMembers[X+"|||"+Y]}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;h()}}}(P))}}else{if(M&&V.disabled===true){B.log("EventParser:onSubspaceMemberAdded  owner added to the  subspace id="+X,"info");delete b.workspaces[X].disabled;b.workspaces[X].fetchingUsers=true;
R=true;B.Controller.getSubspaceMembers(X,function(Y){return function(Z,af){if(Z&&af.data.length>0){var ae=af.data[0];var ad=ae.members;b.workspaces[Y].users={};for(var ac=0;ac<ad.length;ac++){var ab=ad[ac];if(ab.objectId!=B.Controller.ownerObj.id){if(ab.presence.aggregatedChannelsState=="idle"&&ab.presence.status!=100){ab.presence.status=B.presenceStatus.IDLE
}var aa=new B.Model.User({id:ab.objectId,name:ab.screenName,fName:ab.firstName,lName:ab.lastName,presenceStatus:ab.presence.status,presenceStatusMessage:ab.presence.message,picture:ab.thumbnailUrl});b.workspaces[Y].addUser(aa,false,ab.isMember);aa.isAnonymous=!ab.isFollowee;b.addToUserList(aa)}}if(ae.properties&&ae.properties.publisherstatus&&ae.properties.publisherstatus=="started"){B.Controller.ownerObj.workspaces[Y].setSubspaceProperties(ae,true,"changed")
}else{if(ae.properties&&ae.properties.publisherstatus&&ae.properties.publisherstatus=="stopped"){B.Controller.ownerObj.workspaces[Y].setSubspaceProperties(ae,true,"deleted")}else{B.Controller.ownerObj.workspaces[Y].setSubspaceProperties(ae,false,"")}}B.Controller.ownerObj.sortUsers();b.workspaces[Y].refreshWkTitle(true);
b.workspaces[Y].fetchingUsers=false}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;h()}}}(X))}}}}else{return C(w);B.log("EventParser:onSubspaceMemberAdded no subspace object for the id="+X+", so ignoring","info")}}return R};var l=function(p){B.EventManager.trigger("event.sessiongroups.session.added",p)
};var o=function(p){B.EventManager.trigger("event.user.sds.meetups.ack",p)};var J=function(w,M){var S=w.header;var T=w.data;var p=++d,R=false;var V=T.subspaceId;if(popOut_ChatSubspaceId&&popOut_ChatSubspaceId!=V){return false}if(V==B.Controller.ownerObj.defaultSubSpaceId){B.log("EventParser:onSubspaceMemberRemoved  for the default subspace id="+V+", so ignoring","info")
}else{var U=B.Controller.ownerObj.workspaces[V];if(U){for(var Q=0;Q<T.memberIds.length;Q++){Jiffy.mark("Event.MemberRemoved-"+p);var P=T.memberIds[Q];var N=b.users[P];if(N){U.eventIndex=p;if(U.once1toM){U.removeUser(N,true)}else{var O=U.toJSON();O.user=U.users[N.id];B.EventManager.trigger("event.user.roster.workspace.removed",O)
}}else{if(P==B.Controller.ownerObj.id){if(M){B.log("EventParser:onSubspaceMemberRemoved  owner removed from subspace id="+V,"info");U.ownerRemove()}}else{B.log("EventParser:onSubspaceMemberRemoved  should never happen, seems added event lost for this user="+P,"error")}}}}else{B.log("EventParser:onSubspaceMemberRemoved no subspace object for the id="+V+", so ignoring","info")
}}return R};var f=function(N){var Q=N.header;var p=N.data;var M=++d,O=false;B.log("EventParser:onDefSubspaceMemberAdded seems parent page follow happened","info");for(var w=0;w<p.memberIds.length;w++){var P=p.memberIds[w];if(P!=B.Controller.ownerObj.id){O=true;presence.Controller.getUserDetails(P,function(R){return function(S,U){if(S){var V=U.data;
if(V[R].presence.aggregatedChannelsState=="idle"&&V[R].presence.status!=100){V[R].presence.status=B.presenceStatus.IDLE}var T=new B.Model.User({id:R,name:V[R].screenName,fName:V[R].firstName,lName:V[R].lastName,picture:V[R].thumbnailUrl,presenceStatus:V[R].presence.status,presenceMessage:V[R].presence.message});
T.isAnonymous=!V[R].isFollowee;if(V[R].isFollowee){b.addToUserList(T);B.Controller.ownerObj.sortUsers()}}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;h()}}}(P))}else{B.log("EventParser:onDefSubspaceMemberAdded  for the owner on default subspace id so ignoring","info")}}return O};var j=function(O){var R=O.header;
var p=O.data;var N=++d,P=false;B.log("EventParser:onDefSubspaceMemberRemoved seems parent page unfollow happened","info");for(var M=0;M<p.memberIds.length;M++){var Q=p.memberIds[M];var w=b.users[Q];if(w&&Q!=B.Controller.ownerObj.id){w.isAnonymous=true;b.addToUserList(w);B.Controller.ownerObj.sortUsers()
}}return P};var H=function(M){var O=M.header;var p=M.data;var w=++d,N=false;x.updateUser(p.userId);return N};var k=function(p){};var L=function(p){};var u=function(p){};var z=function(p){};var t=function(p){};var F=function(p){};var K=function(){};var r=function(p){};var A=function(M){var Q=M.header,p=M.data,w=++d,P=false;
if(B.Controller.ownerObj.channelId==p.channelId){return false}B.log(p.text);var O=JSON.parse(p.text);if(O.event=="muteNotify"){B.Model.Notify.notificationMuted()}else{if(O.event=="collapseAll"){B.Model.Notify.collapseAll(O)}else{if(O.event=="windowOpened"&&!b.workspaces[O.subspaceId]){P=true;var N=O.subspaceId;
b.addWorkspace(new B.Model.Workspace({id:N}));b.workspaces[N].fetchingUsers=true;B.Controller.getSubspaceMembers(N,function(R,X){if(R&&X.data.length>0){var W=X.data[0];var V=W.members;for(var U=0;U<V.length;U++){var T=V[U];if(T.objectId!=B.Controller.ownerObj.id){if(T.presence.aggregatedChannelsState=="idle"&&T.presence.status!=100){T.presence.status=B.presenceStatus.IDLE
}var S=new B.Model.User({id:T.objectId,name:T.screenName,fName:T.firstName,lName:T.lastName,presenceStatus:T.presence.status,presenceStatusMessage:T.presence.message,picture:T.thumbnailUrl});b.workspaces[N].addUser(S,false,T.isMember);S.isAnonymous=!T.isFollowee;b.addToUserList(S)}}B.Controller.ownerObj.sortUsers();
b.workspaces[N].fetchingUsers=false;B.EventManager.trigger("event.custom.other",{event:"windowOpened",subspaceId:N,showHistoryIcon:O.showHistoryIcon})}else{delete b.workspaces[N]}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;h()}})}else{B.Model.Notify.onCustomEvent(O)}}}return P};var m=function(M){var O=M.header,p=M.data,w=++d,N=false;
if(B.Controller.ownerObj.channelId==p.channelId){return false}Jiffy.mark("Event.DeviceAttrChanged");b.setDeviceAttributes(p.channelsGroupDetails?p.channelsGroupDetails:{});return N};var E=function(O){var R=O.header,p=O.data,N=++d,P,Q=false,M=p.userPreferences;if(B.Controller.ownerObj.channelId==p.userPreferences.channelId){return false
}var w=(B.config.autoIdleTime!=M.autoIdleTime);Jiffy.mark("Event.PreferenceChanged");B.Controller.overRidePreferences(p.userPreferences);B.Model.Notify.onPrefchange({isIdleTimeChanged:w});return Q};var D=function(N){var Q=N.header,p=N.data,M=++d,O,P=false,w=p.userAppPreferences;if(B.Controller.ownerObj.channelId==p.userAppPreferences.channelId){return false
}Jiffy.mark("Event.AppPreferenceChanged");B.Controller.overRideUserAppPreferences(p.userAppPreferences);return P};var i=function(M){var O=M.header,p=M.data,w=++d,N=false;b.primaryChannelId=p.primaryChannelId;return N};var a=function(O){var Q=O.header,p=O.data,N=++d,P=false;Jiffy.mark("Event.FavoriteChanged");
if(B.Controller.ownerObj.channelId==p.channelId){return false}var M;var w;if(B.config.chatMsgDeepHistoryEnabled){M=p.chatSessionId;w={chatSessionMembers:p.chatSessionMembers,favoriteName:p.favoriteName?p.favoriteName:"",favoriteId:p.favoriteId,chatSessionId:p.chatSessionId}}else{M=b.generateFvtId(p.memberIds);
w={memberIds:p.memberIds,favoriteName:p.favoriteName?p.favoriteName:"",favoriteId:p.favoriteId,chatSessionId:p.chatSessionId}}if(!b.favorites[M]){b.addFavorite(w,true)}return P};var G=function(N){var P=N.header,p=N.data,M=++d,O=false;Jiffy.mark("Event.FavoriteChanged");if(B.Controller.ownerObj.channelId==p.channelId){return false
}var w;if(B.config.chatMsgDeepHistoryEnabled){w=p.chatSessionId}else{w=b.generateFvtId(p.memberIds)}b.removeFavorite(w,true);return O};var q=function(N){var P=N.header,p=N.data,M=++d,O=false;Jiffy.mark("Event.FavoriteRenamed");if(B.Controller.ownerObj.channelId==p.channelId){return false}var w;if(B.config.chatMsgDeepHistoryEnabled){w=p.chatSessionId
}else{w=b.generateFvtId(p.memberIds)}if(b.favorites[w]){b.renameFavorite({memberIds:p.memberIds,favoriteName:p.favoriteName?p.favoriteName:"",actualFavId:p.favoriteId,chatSessionId:p.chatSessionId},true)}return O};var y=function(O){var Q=O.header,p=O.data,N=++d,P=false;Jiffy.mark("Event.FavoriteModified");
if(B.Controller.ownerObj.channelId==p.channelId){return false}var M;var w;if(B.config.chatMsgDeepHistoryEnabled){M=p.chatSessionId;w=p.chatSessionMembers}else{M=b.generateFvtId(p.memberIds);w=p.memberIds}if(b.favorites[M]){b.modifyFavorite({memberIds:w,favoriteName:p.favoriteName?p.favoriteName:"",actualFavId:p.favoriteId,chatSessionId:p.chatSessionId},true)
}return P};var C=function(O,w){if(!presence.config.screenShareEnabled){return false}var R=O.header,p=O.data,N=++d,Q=false;if(B.Controller.ownerObj.channelId==p.channelId){return false}var P=p.subspaceId?p.subspaceId:p.chatId;if(B.Controller.ownerObj.workspaces[P]){var M=B.Controller.ownerObj.workspaces[P];
M.setSubspaceProperties(p,true,w);return Q}else{B.log("Received subspace properties chagned event id ="+P+", so doing getSubspaceMembers members","info");Q=true;B.Controller.getSubspaceMembers(P,function(S,Z){if(S&&Z.data.length>0){var Y=Z.data[0];if(Y.properties&&Y.properties.publisherstatus){b.addWorkspace(new B.Model.Workspace({id:P}));
b.workspaces[P].fetchingUsers=true;var X=Y.members;for(var W=0;W<X.length;W++){var U=X[W];if(U.objectId!=B.Controller.ownerObj.id){if(U.presence.aggregatedChannelsState=="idle"&&U.presence.status!=100){U.presence.status=B.presenceStatus.IDLE}var T=new B.Model.User({id:U.objectId,name:U.screenName,fName:U.firstName,lName:U.lastName,presenceStatus:U.presence.status,presenceStatusMessage:U.presence.message,picture:U.thumbnailUrl});
b.workspaces[P].addUser(T,false,U.isMember);T.isAnonymous=!U.isFollowee;b.addToUserList(T)}}B.Controller.ownerObj.sortUsers();b.workspaces[P].eventIndex=N;B.log("Got all subspace members of subspce id="+P+" ,count="+X.length+" , openOnLoad="+b.workspaces[P].openOnLoad+" , closeOnLoad="+b.workspaces[P].closeOnLoad,"info");
var V=B.Controller.ownerObj.workspaces[P];if(Y.properties&&Y.properties.publisherstatus=="started"){w=!w?(Y.properties.publisherstatus=="started"?w="changed":w="deleted"):w;V.setSubspaceProperties(Y,true,w);b.workspaces[P].refreshWorkspace();b.workspaces[P].fetchingUsers=false}}}if(B.Controller.isProcessSche){B.Controller.isProcessSche=false;
h()}});B.log("EventParser:onSubspacePropertiesChanged no subspace object for the id="+P+", so ignoring","info");return Q}};var n=function(N){var Q=N.header,M=++d,p=(N.data.text)?JSON.parse(N.data.text):{},P=false;var O=p.chatId;var w=B.Controller.ownerObj.workspaces[O];if(w){if(!p.data){p.data={}}w.processNotifyDeviceEvent(p.data)
}else{B.log("EventParser:onNotifyDevice no subspace object for the id="+O+", so ignoring","info")}return P};var h=function(){try{if(B.Controller.ownerObj.forceBreak||B.Controller.ownerObj.presenceStatus==20||B.Controller.isProcessSche){return}var O,Q,N,M,w;O=b.pendingEvents.shift();if(!O){return}Q=O.header;
N=O.data;M=Q.topic;switch(M){case"event.user.subspace.member.added":w=c(O);break;case"event.system.subspace.joined":w=c(O,true);break;case"event.user.subspace.member.removed":w=J(O);break;case"event.system.subspace.left":w=J(O,true);break;case"event.user.presence.status":w=g(O);break;case"event.user.message.text":w=I(O);
break;case"event.user.roster.member.added":w=f(O);break;case"event.user.roster.member.removed":w=j(O);break;case"event.user.summary.updated":w=H(O);break;case"event.user.message.custom":w=A(O);break;case"event.user.channelsgroup.details.updated":w=m(O);break;case"event.user.preferences.status":w=E(O);
break;case"event.user.app.preferences.status":w=D(O);break;case"event.user.device.primarychannel":w=i(O);break;case"event.user.favorites.added":w=a(O);break;case"event.user.favorites.removed":w=G(O);break;case"event.user.favorites.renamed":w=q(O);break;case"event.user.favorites.modified":w=y(O);break;
case"event.user.device.notify":w=n(O);break;case"event.user.meetup.invited":w=x.onMeetupMemberInvited(O);break;case"event.sessiongroups.session.added":w=l(O);break;case"event.user.sds.meetups.ack":w=o(O);break;case"event.user.sfdc.notification":w=B.EventManager.trigger("event.user.sfdc.notification",O);
break;default:if(typeof x.processAppSpecificEvents=="function"){O._eventIndex=d;var p=x.processAppSpecificEvents(O);w=p.isAsynch;d=p._eventIndex}}}catch(P){B.log("Exception while parsing events ="+P,"error")}if(b.pendingEvents.length>0){if(w===true){B.log("Previous event is asynch next will be triggered by the callback","info");
B.Controller.isProcessSche=true}else{h()}}};var x=function(w){if(!!w){b=B.Model.Owner.getInstance();var p=w.messages;b.pendingEvents=b.pendingEvents.concat(p);h();return true}return false};x.onMeetupMemberInvited=function(p){B.EventManager.trigger("event.user.meetup.invited",p)};x.updateUser=function(N){Jiffy.mark("Event.OnSummaryUpdated");
var p=B.Model.Owner.getInstance();p.pendingMembers[N]={};var w=(N==p.id)?p:p.users[N];var M=B.Model.UserStore.users[N];if(w){B.Controller.getUserDetails(N,function(O,P){if(!O){return}var Q=P.data;w.fromJSON({name:Q[N].screenName,fName:Q[N].firstName,lName:Q[N].lastName,picture:Q[N].thumbnailUrl});w.summaryUpdated();
delete p.pendingMembers[N]})}else{if(M){B.Controller.getUserDetails(N,function(O,P){if(!O){return}var Q=P.data;B.Model.UserStore.updateUser({id:N,name:Q[N].screenName,fName:Q[N].firstName,lName:Q[N].lastName,picture:Q[N].thumbnailUrl});delete p.pendingMembers[N]})}}};if(!window.presence.Controller.EventParser){window.presence.Controller.EventParser=x
}})(window,presence);(function(a,b){var c=function(){var i=0;var g=this;g.firstNetWorkDownTime=0;g.networkDownCount=0;g.timer=null;g.shortPoll=true;g.previousShortPoll=true;g.networkDownCount=0;g.interval=b.Controller.shortPollInterval;g.nodeDownMaxRetryCount=b.Controller.nodeDownMaxRetryCount;g.nodeDownRetryInterval=b.Controller.nodeDownRetryInterval;
g.nodeDownRetriedCount=0;this.startTimer=function(l,k){g.sc=l;g.fc=k;g.stopped=false;if(b.focus=="FOCUS_GAIN"||b.Controller.ownerObj.state.pollMode=="long"||b.View.PopOutWidget.active||popOut_ChatSubspaceId){g.sleepModeOff()}else{g.sleepModeOn()}};this.stopPoll=function(){window.clearTimeout(g.timer);
g.stopped=true};this.sleepModeOn=function(){window.clearTimeout(g.timer);g.shortPoll=true;b.Controller.ownerObj.state.pollMode="short";g.interval=b.Controller.shortPollInterval;g.timer=window.setTimeout(f,g.interval);b.log("switching to short poll");if(!b.View.PopOutWidget.active){b.EventManager.trigger("event.custom.poll.sleep",{})
}};this.sleepModeOff=function(l,k){if(!g.shortPoll&&l!==true){return}window.clearTimeout(g.timer);g.shortPoll=false;b.Controller.ownerObj.state.pollMode="long";g.interval=b.Controller.pollInterval;g.timer=window.setTimeout(function(){f(true)},g.interval+(g.httpObj?500:0));b.log("switching to long poll");
if(l!==true||(g.previousShortPoll===true&&g.shortPoll===false)){b.EventManager.trigger("event.custom.poll.wakeup",{})}if(b.Controller.ownerObj.deviceState.longPollTab!=_api_Caller_Source&&k!=true){new b.Controller.ApiGateway().makeAPICall("setdevicestate",{deviceState:JSON.stringify({longPollTab:_api_Caller_Source})},null,function(m){b.log("setDevice API succeeded","info")
},function(m){b.log("setDevice API failed longPollTab="+_api_Caller_Source,"error")})}};var f=function(l){var m=b.Controller.getHeaderObj({apiCallerSource:_api_Caller_Source});if(m&&m.umpsSessionId===undefined){return b.log("No API call should made without umpsSessionId","info")}if(!b.Controller.ownerObj){return null
}d();g.httpObj=new b.Controller.HttpGateway();var k={channelId:b.Controller.ownerObj.channelId,bufferIndex:b.Controller.ownerObj.bufferIndex.buffer};if(l===true){k.isLongPoll=true}i++;Jiffy.mark("TotalAPICall-"+i);g.httpObj.sendRequest(b.Controller.apiList.getEvents["url"],b.Controller.apiList.getEvents["method"],k,j,h,b.Controller.pollTimeout,m)
};var d=function(){if(g.httpObj){g.httpObj.abort()}};var j=function(p){Jiffy.measure(b.Controller.apiList.getEvents["url"],"TotalAPICall-"+i);g.networkDownCount=0;if(p.result===false){h(p)}else{if(p.deviceState){var n=JSON.parse(p.deviceState);if(n&&n.longPollTab){b.Controller.ownerObj.deviceState.longPollTab=n.longPollTab
}}if(p.messages){if(g.firstNetWorkDownTime){b.Model.Notify.stopNetworkReconnecting();g.firstNetWorkDownTime=undefined}try{if(g.sc){g.sc(p)}else{if(p.messages.length>0){Jiffy.mark("ReceiveEvents-"+p.bufferIndex);if(b.Controller.ownerObj.bufferIndex.event!=0){b.log("Previous buffer is half processed upto index "+b.Controller.ownerObj.bufferIndex.event,"info");
var m;for(var m=0;m<p.messages.length;m++){var o=p.messages[m];if(o.index==b.Controller.ownerObj.bufferIndex.event){if(b.Controller.ownerObj.bufferIndex.eventSubIndex!=-1&&o.header=="event.user.message.chat"){var k=o.data;for(var l=0;l<k.length;l++){if(l==b.Controller.ownerObj.bufferIndex.eventSubIndex){k=k.slice(l+1);
p.messages[m]=k;m=m-1;break}}}break}}if(m<p.messages.length){p.messages=p.messages.slice(m+1)}}if(b.Controller.EventParser(p)&&p.bufferIndex!=undefined){b.Controller.ownerObj.bufferIndex.buffer=p.bufferIndex;b.Controller.ownerObj.bufferIndex.event=0}}else{if(p.bufferIndex!=undefined){b.Controller.ownerObj.bufferIndex.buffer=p.bufferIndex
}}}}catch(q){b.log("exception in event parser ="+q,"error")}}if(g.nodeDownRetriedCount>0){presence.Controller.getAllActiveSubspacesAgainAndResumeReceivemessages(p.pollingMode)}else{g.scheduleReceiveMessagesCall(p.pollingMode)}}g.nodeDownRetriedCount=0;g.httpObj=null};this.scheduleReceiveMessagesCall=function(k){if(g.stopped!=true){g.previousShortPoll=g.shortPoll;
if(k=="shortPoll"&&b.View.PopOutWidget.active&&!popOut_ChatSubspaceId&&b.Controller.ownerObj.deviceState.longPollTab!="CHAT_POPOUT"){g.sleepModeOff(true,true)}else{if(k=="shortPoll"){g.sleepModeOn()}else{if(k=="longPoll"){g.sleepModeOff(true)}else{if(g.shortPoll){g.sleepModeOff()}else{g.timer=window.setTimeout(f,g.interval)
}}}}}};var h=function(l){l=(l.errorData&&l.errorData.result===false)?l.errorData:l;if(l.result===false||(l.errorData&&l.errorData.result===false)){var k=b.Model.Owner.getInstance();if(l.message=="channel closed"){if(k.presenceStatus!=20){g.timer=window.setTimeout(f,g.interval)}}else{if(l.channelClosed){if(l.device_closed_reason==="SFDC_LogOut_TimeOut"){b.isSFDC_LogOut_TimeOut=true
}b.Model.Notify.triggerEvent("event.channel.closed")}else{if((l.errorCode=="invalidUmpsSessionId"||l.errorCode=="invalidChannelId")&&b.EventManager.bootstrapDone&&!b.Controller.isFirstAPICallFailed){b.Controller.init(window.controllerInitData,true);b.Controller.isFirstAPICallFailed=true}else{g.stopped=true;
if(k.presenceStatus!=20){b.Model.Notify.fail({status:-100,reason:l.trace})}}}}}else{b.log("onFailure in event parser ="+JSON.stringify(l)+"page load happens value="+b.Controller.ownerObj.pageLoadHappens,"error");if(g.fc){g.fc(l)}if(!b.Controller.ownerObj.pageLoadHappens){if(l.status==0||l.status>=1000){g.networkDownCount++;
if(g.networkDownCount>=2){if(!g.firstNetWorkDownTime){b.log("Two successive long poll calls status=0 or >=1000 so showing connecting","error");b.Model.Notify.networkReconnecting();g.firstNetWorkDownTime=new Date().getTime();g.timer=window.setTimeout(f,5000)}else{if(((new Date().getTime()-g.firstNetWorkDownTime)/1000)>=85){b.Model.Notify.fail({status:-102,statusText:"Done all retries till 90 sec"})
}else{if(g.stopped!=true&&!b.Controller.ownerObj.forceBreak){g.timer=window.setTimeout(f,5000)}}}}else{g.timer=window.setTimeout(f,10)}}else{if(l.status==-5){g.nodeDownRetriedCount++;if(g.nodeDownRetriedCount<=g.nodeDownMaxRetryCount){b.log("Node down error occured so retrying-"+g.nodeDownRetriedCount,"error");
g.timer=window.setTimeout(f,g.nodeDownRetryInterval)}else{b.log("Three successive longpoll calls status failed with node down error, so collapsing widget","error");b.Model.Notify.fail(l);g.nodeDownRetriedCount=0}}else{if(l.status==504){g.networkDownCount=0;if(g.stopped!=true){g.timer=window.setTimeout(f,g.interval)
}}else{g.firstNetWorkDownTime=undefined;g.networkDownCount=0;b.Model.Notify.fail(l)}}}}else{if(g.stopped!=true){g.timer=window.setTimeout(f,5000)}}g.httpObj=null}}};if(!window.presence.Controller.EventPoller){window.presence.Controller.EventPoller=c}})(window,presence);(function(b,c){var a=function(){var g=this;
g.errorCount=0;g.socket=null;this.startTimer=function(l,k){g.sc=l;g.fc=k;g.stopped=false;d()};this.stopPoll=function(k){window.clearTimeout(g.timer);g.stopped=true;if(!k&&g.socket){g.socket.disconnect()}};this.heartbeat=function(){g.socket.send("OPEN");g.timer=window.setTimeout(this.heartbeat,c.Controller.socketHeartbeat)
};var d=function(p,m){if(c.Controller.socket&&c.Controller.socket.opened){c.Controller.socket._destroy()}c.Controller.socket=g.socket=new c.Controller.Websocket();var o=c.Model.Owner.getInstance().channelId;var n=umpsUrl.split("://",2);var l=n[1];var k=(n[0]=="http")?"ws://":"wss://";presence.log("connecting to websocket: "+k+l+c.Controller.apiList.websocket["url"]+"/"+c.Controller.parentData.orgId);
g.socket.connect(k+l+c.Controller.apiList.websocket["url"]+"/"+c.Controller.parentData.orgId,j,h,f,JSON.stringify(c.Controller.getHeaderObj({channelId:o,bufferIndex:c.Controller.ownerObj.bufferIndex.buffer})))};var j=function(m){c.log("EventPollerSocket:onData="+m,"info");m=JSON.parse(m);try{if(m.messages){g.errorCount=0;
if(g.sc){g.sc(m)}else{if(m.messages.length>0){if(c.Controller.ownerObj.bufferIndex.event!=0){c.log("Previous buffer is half processed upto index "+c.Controller.ownerObj.bufferIndex.event,"info");var k;for(var k=0;k<m.messages.length;k++){var l=m.messages[k];if(l.index==c.Controller.ownerObj.bufferIndex.event){break
}}if(k<m.messages.length){m.messages=m.messages.slice(k+1)}}if(c.Controller.EventParser(m)&&m.bufferIndex){c.Controller.ownerObj.bufferIndex.buffer=m.bufferIndex;c.Controller.ownerObj.bufferIndex.event=0}}}}}catch(n){c.log("exception in event parser ="+n,"error")}};var h=function(){c.Controller.websocketConnected=true;
presence.log("socket connected")};var i=function(){if(c.Controller.transportType=="websocket"){presence.log("falling back to long poll");c.Controller.socket=undefined;c.Controller.transportType="longpoll";c.Controller.eventPollObj=new c.Controller.EventPoller();c.Controller.eventPollObj.startTimer()}};
var f=function(k){if(k){i();return}presence.log("socket closed");g.errorCount++;if(g.stopped){if(typeof(g.sc)==="function"){g.sc({})}}else{if(c.Controller.transportType=="websocket"){if(g.errorCount<2){g.timer=window.setTimeout(d,c.Controller.pollInterval)}else{if(g.errorCount<4){g.timer=window.setTimeout(d,6000)
}else{i()}}}}}};if(!window.presence.Controller.EventPollerSocket){window.presence.Controller.EventPollerSocket=a}})(window,presence);(function(a){var b=function(h){var d;var f;var g=this;g.uuid=h;this.sendRequest=function(j,o,m,l,n){if(!n){n={}}if(!m){m={}}n.connectUrl=connectUrl||sfdcUrl;var k=umpsAjax({url:j,method:o,data:m,success:function(p){c(p)
},failure:function(p){i(p)},headers:n,timeout:l});b.reqs[g.uuid]=k};var c=function(j){var l={};l.uuid=g.uuid;if(!j.responseText){l.status=0}else{var k=JSON.parse(j.responseText);l.data=k}presence.EventManager.trigger(l.uuid,l,true,"api");delete b.reqs[g.uuid]};var i=function(k){var l=k.response?k.response:"{}";
var j=JSON.parse(l);var m={};m.uuid=g.uuid;m.status=k.status;m.response=j;presence.EventManager.trigger(m.uuid,m,true,"api");delete b.reqs[g.uuid]}};b.reqs=new Array();b.decodeRes=function(d){try{return JSON.parse(d)}catch(c){return{}}};b.getXhrById=function(c){return b.reqs[c]};a.RequestGateway=b})(window);
(function(b,g){g.Controller.uuidMap={};g.Controller.searchSubspace=function(n,i,j){var l=i?[]:false;if(j&&j==true){if(n&&g.Controller.ownerObj){for(var m in g.Controller.ownerObj.workspaces){if(g.Controller.ownerObj.workspaces[m].chatSessionId==n){if(i){l.push(m)}else{l=m}}}}g.log("Switch:call createworkspace->findExistingWorkspace retWk="+l,"info")
}else{if(n&&g.Controller.ownerObj){for(var m in g.Controller.ownerObj.workspaces){var k=[];for(var h in g.Controller.ownerObj.workspaces[m].users){k.push(h)}for(var h in g.Controller.ownerObj.workspaces[m].oldUsers){k.push(h)}if(i){if((k.sort().join("_")==n)){l.push(m)}}else{if((k.sort().join("_")==n)&&(!g.Controller.ownerObj.workspaces[m].disabled||!g.Controller.ownerObj.workspaces[m].once1toM)){l=m;
break}}}g.log("Switch:call createworkspace->findExistingWorkspace retWk="+l,"info")}}return l};g.Controller.doChatterConnect=function(h,i){if(canvas_window.umpsHttpGateWay){canvas_window.umpsHttpGateWay({url:"/umpsinternal/session/status",method:"GET",data:{refreshSid:true,cflag:new Date().getTime()},success:function(j){j=j.substring(9,j.length);
var k=JSON.parse(j);if(k.secondsLeft&&k.secondsLeft>0){h(k)}else{k.result=true;i(k)}},failure:function(j){i({result:false})},headers:{Authorization:"OAuth "+g.Controller.parentData.sid,"Content-Type":"application/json; charset=UTF-8",Accept:"*/*"}})}else{g.log("Controller.doChatterConnect : canvas_window.umpsHttpGateWay is not found so calling fail back","info")
}};g.Controller.getSessionStatus=function(h,i){if(canvas_window.umpsHttpGateWay){canvas_window.umpsHttpGateWay({url:"/umpsinternal/session/status",method:"GET",data:{cflag:new Date().getTime()},success:function(j){h(j)},failure:function(j){i(j)},headers:{Authorization:"OAuth "+g.Controller.parentData.sid,"Content-Type":"application/json; charset=UTF-8",Accept:"*/*"}})
}else{g.log("Controller.getSessionStatus : canvas_window.umpsHttpGateWay is not found so calling fail back","info")}};g.Controller.updateChatterActivity=function(){try{var i=new Date().getTime();if(g.Controller.previousChatterTime&&(i-g.Controller.previousChatterTime)<(2*60*1000)){return}g.Controller.previousChatterTime=i;
if(canvas_window.startSessionTimer&&canvas_window.lastPageActivityTime){canvas_window.lastPageActivityTime=new Date().getTime();canvas_window.startSessionTimer()}g.Controller.doChatterConnect(function(j){},function(j){g.log("Switch:updateChatterActivity Session completely timedout","info");if(j.result==true){g.closeChannel(function(){g.log("updateChatterActivity: calling close channel callback notifying UI","info");
g.Model.Notify.fail({status:-103,reason:"Logout inactivity"})})}})}catch(h){g.log("Switch:updateChatterActivity calling err="+h,"error")}};g.Controller.startInactivityTimer=function(){if(g.Controller.ownerObj&&g.Controller.ownerObj.presenceStatus!=20&&g.Controller.eventPollObj&&g.Controller.eventPollObj.shortPoll===false){if(g.sessionTimer){clearTimeout(g.sessionTimer)
}g.Controller.getSessionStatus(function(i){g.log("Switch:startInactivityTimer success="+i,"info");i=i.substring(9,i.length);var j=JSON.parse(i);if(j.secondsLeft&&j.secondsLeft>0){g.log("Switch:startInactivityTimer extending the timer next 3 min, secondsLeft="+j.secondsLeft,"info");g.sessionTimer=setTimeout(g.Controller.startInactivityTimer,3*60*1000)
}else{g.log("Switch:startInactivityTimer Session completely timedout","info");var h={channelId:g.Controller.ownerObj.channelId,device_closed_reason:"SFDC_LogOut_TimeOut"};g.Controller.call({method:"closeDevice",data:h,successCallBack:function(){g.log("logoutTimerCallBack: calling close channel callback notifying UI","info");
g.Model.Notify.fail({status:-103,reason:"Logout inactivity"});g.isSFDC_LogOut_TimeOut=true},failCallBack:function(){g.log("logoutTimerCallBack: calling close channel callback notifying UI","info");g.Model.Notify.fail({status:-103,reason:"Logout inactivity"});g.isSFDC_LogOut_TimeOut=true}})}},function(h){g.log("Switch:startInactivityTimer fail="+h,"error");
g.sessionTimer=setTimeout(g.Controller.startInactivityTimer,3*60*1000)})}};g.closeChannel=function(h){presence.Controller.call({method:"closechannel",data:{},successCallBack:function(i){if(h){h()}},failCallBack:function(i){if(h){h()}}})};var c=function(j){method=j.method;callData=j.data;tempData=j.tempData;
successCallBack=j.successCallBack;failCallBack=j.failCallBack;urlData=j.urlData;g.log("Switch:call calling "+method+" data="+callData,"info");try{switch(method){case"createWorkspace":new a(method,callData,urlData,successCallBack,failCallBack,tempData);break;case"sendMessage":new f(method,callData,urlData,successCallBack,failCallBack,tempData);
break;case"closechannel":new d(method,callData,urlData,successCallBack,failCallBack,tempData);break;case"closeDevice":new d(method,callData,urlData,successCallBack,failCallBack,tempData);break;case"sendCustomEvent":var h=new g.Controller.ApiGateway();h.makeAPICall("sendCustomEvent",callData,urlData,successCallBack,failCallBack,tempData);
break;default:var h=new g.Controller.ApiGateway();h.makeAPICall(method,callData,urlData,successCallBack,failCallBack,tempData);break}}catch(i){g.log("Switch:call exception="+i,"error");failCallBack({})}};var a=function(h,p,i,l,n,o){var k=this;k.method=h;k.callData=p;k.successCallBack=l;k.failCallBack=n;
k.urlData=i;var j=new g.Controller.ApiGateway();if(!g.Controller.uuidMap[o.uuid]){g.Controller.uuidMap[o.uuid]={}}j.makeAPICall(k.method,k.callData,k.urlData,function(z){if(z.result){var q=z.data;q.id=q.chatId;q.owner=g.Controller.ownerObj.id;var r;if(g.Controller.ownerObj.workspaces[q.id]){g.log("CreateWorkspace callback alread workspace found so taking that back","info");
r=g.Controller.ownerObj.workspaces[q.id]}else{r=new g.Model.Workspace(q)}if(k.callData.memberIds.length>1){r.once1toM=true}var w=q.memberIds,t=q.offlineMemberIds;if(w){g.log("adding members to workspace model","info");for(var v=0,x=w.length;v<x;v++){var m=g.Controller.ownerObj.users[w[v]];if(m){r.addUser(m)
}}}if(t){for(var v=0,x=t.length;v<x;v++){var B=g.Controller.ownerObj.users[t[v]];if(B){g.log("adding non members to workspace model","info");r.addUser(B,false,false)}}}g.Controller.ownerObj.addWorkspace(r);var y=g.Controller.uuidMap[o.uuid];delete g.Controller.uuidMap[o.uuid];k.successCallBack(q);if(y.pendingMsg){g.log("pending messages are present","info");
for(var v=0;v<y.pendingMsg.length;v++){var u={message:y.pendingMsg[v],topic:"event.user.message.text"};var A={chatId:q.chatId};presence.Controller.call({method:"sendMessage",data:u,urlData:A,successCallBack:function(C){y.pendingSuccessCallBack(C)},failCallBack:function(C){y.pendingFailCallBack(C)}})}}}else{k.failCallBack(z)
}},function(m){k.failCallBack(m)})};var f=function(i,o,q,t,k,j){var r=this;r.method=i;r.callData=o;r.successCallBack=t;r.failCallBack=k;r.urlData=q;if(r.urlData.chatId){var p=g.Controller.ownerObj.workspaces[r.urlData.chatId];if(r.callData.topic&&r.callData.topic=="event.user.message.text"){p.addToMessageHistory("me",r.callData.message)
}var h=new g.Controller.ApiGateway();h.makeAPICall(r.method,r.callData,r.urlData,r.successCallBack,r.failCallBack)}else{if(r.callData.topic=="event.user.message.text"){var l=g.Controller.uuidMap[j.uuid];if(l){var n=l.pendingMsg;if(n){n[n.length]=r.callData.message}else{n=[];n[0]=r.callData.message}l.pendingMsg=n;
l.pendingSuccessCallBack=r.successCallBack;l.pendingFailCallBack=r.failCallBack}else{r.failCallBack({invalid:"Invalid uuid provided"})}}}};var d=function(i,n,o,q,l){var p=this;p.method=i;p.callData=n;p.successCallBack=q;p.failCallBack=l;p.urlData=o;g.Controller.eventPollObj.stopPoll(true);g.Controller.ownerObj.wentOffline();
g.EventManager.stopProcessing();var j=function(m){g.Controller.ownerObj.umpsSessionId="";g.setClientId("");p.successCallBack(m)};var k=function(m){p.failCallBack()};if(g.Controller.socket){g.Controller.eventPollObj.sc=p.successCallBack}var h=new g.Controller.ApiGateway();h.makeAPICall(p.method,p.callData,p.urlData,j,k)
};window.presence.Controller.call=c})(window,presence);(function(c,d){var b=0;var a=function(){var j=++b;var g;var h;var i=this;this.sendRequest=function(n,m,r,u,q,v,p){g=u;h=q;if(!p){p={}}if(!r){r={}}d.EventManager.bind("umps_api_call_"+j,function(z,x){if(x.data){if(g){g(x.data)}}else{if(x.status!=undefined){if(h&&x.response){var y=x.response?x.response:{};
h({status:x.status,statusText:"",errorData:y})}else{h({status:x.status,statusText:""})}}}d.EventManager.unbindAll(x.uuid,"api")},"api");var w={uuid:"umps_api_call_"+j,url:n,method:m,data:r,timeout:v,headers:p};var o=JSON.stringify(w);if(d.config.App==="webmessenger"){umpsxdomain.postMessage(o,actualUmpsDomain,document.getElementById("api_iframe").contentWindow)
}else{try{k(o)}catch(t){}}};var k=function(o){var m=JSON.parse(o);if(m.method=="abort"){var p=RequestGateway.getXhrById(m.uuid);if(p){p.abort()}}else{var n=new RequestGateway(m.uuid);n.sendRequest(m.url,m.method,m.data,m.timeout,m.headers)}};this.abort=function(){var m=JSON.stringify({uuid:"umps_api_call_"+j,method:"abort"});
if(d.config.App==="webmessenger"){umpsxdomain.postMessage(m,actualUmpsDomain,document.getElementById("api_iframe").contentWindow)}else{}};var f=function(m){if(g){g(a.decodeRes(m.responseText))}};var l=function(n){var m=n.response?a.decodeRes(n.response):{};if(n){if(h){h({status:n.status,statusText:"",errorData:m})
}else{if(h){h({status:-105,statusText:"Ajax not supported"})}}}}};a.decodeRes=function(g){try{return JSON.parse(g)}catch(f){return{}}};if(!window.presence.Controller.HttpGateway){window.presence.Controller.HttpGateway=a}})(window,presence);(function(a,c){var d;var b=c.Controller.Websocket=function(){};
b.prototype.connect=function(j,k,h,g,f){var i=this;i.url=j;i.onData=k;i.onOpen=h;i.onClose=g;if(f){i.initData=f}else{i.initData="OPEN"}this.opened=false;this.timer=null;this.socket=new WebSocket(j);this.socket.onmessage=function(l){i._onData(l.data)};this.socket.onopen=function(l){i._onOpen()};this.socket.onclose=function(l){i._onClose()
};i.startAckTimer(i,c.Controller.socketEstablishMent);return this};b.prototype.startAckTimer=function(g,f){g.ackTimer=window.setTimeout(function(){var h=new Date().getTime();if(d){if(h-d>c.Controller.socketHeartbeatAck){presence.log("WS:Ack check didn't passed","error");g.onClose(true);g._destroy()}else{presence.log("WS:Ack check was passed","info");
if(g.opened){g.startAckTimer(g)}}}else{presence.log("WS: First heartbeat ack not received","error");g.onClose(true);g._destroy()}},f||c.Controller.socketHeartbeatAck)};b.prototype.send=function(f){if(this.socket){this.socket.send(f)}return this};b.prototype.disconnect=function(){this.disconnectCalled=true;
if(this.socket){this.socket.close()}return this};b.prototype.heartbeat=function(f){presence.log("heartbeat "+f.opened,"info");if(f.socket&&f.opened){f.send("OPEN")}f.timer=window.setTimeout(function(){if(f.opened){f.heartbeat(f)}},c.Controller.socketHeartbeat)};b.check=function(){return"WebSocket" in window&&WebSocket.prototype&&(WebSocket.prototype.send&&!!WebSocket.prototype.send.toString().match(/native/i))&&typeof WebSocket!=="undefined"
};b.prototype._destroy=function(){window.clearTimeout(this.timer);window.clearTimeout(this.ackTimer);if(this.socket){this.socket.onclose=null;this.socket.onopen=null;this.socket.onmessage=null;this.socket.close();this.socket=null}return this};b.prototype._onData=function(f){if(f=="true"){d=new Date().getTime()
}else{if(this.onData){this.onData(f)}}};b.prototype._onOpen=function(){this.opened=true;this.heartbeat(this);c.log("data to socket: "+this.initData);this.socket.send(this.initData);if(this.onOpen){this.onOpen()}return this};b.prototype._onClose=function(){window.clearTimeout(this.timer);window.clearTimeout(this.ackTimer);
this.opened=false;if(!!this.disconnectCalled){this.disconnectCalled=false;if(this.onClose){this.onClose()}}else{if(this.onClose){this.onClose()}}return this}})(window,presence);presence.config.headerHeight=175;presence.config.rosterMinHeight=416;presence.config.defaultHeight=500;presence.config.chatWindowHeight=285;
presence.config.maxChatWindowHeight=400;presence.config.autoIdleTime=900000;presence.config.showComposingTime=5000;presence.config.waitBeforeComposing=2000;presence.config.chatMaxChar=2000;presence.config.maxMultiChatUsers=(canvas_window.umps_config.maxParticipantsInAdhocChat&&parseInt(canvas_window.umps_config.maxParticipantsInAdhocChat))?parseInt(canvas_window.umps_config.maxParticipantsInAdhocChat):25;
presence.config.groupChatEnabled=(canvas_window.umps_config.isGroupChatEnabled=="false")?false:false;presence.config.timeFormat=(canvas_window.umps_config.timeFormat!=undefined)?canvas_window.umps_config.timeFormat:"h:mm a";presence.config.timeZoneDiff=(canvas_window.umps_config.timeZoneDiff!=undefined)?canvas_window.umps_config.timeZoneDiff:10.5;
presence.config.localeFileName=(canvas_window.umps_config.userLanguage)?canvas_window.umps_config.userLanguage:false;presence.config.nameMaxCharLimit=120;presence.config.clearSearchTime=60000;presence.config.maxFavorites=100;presence.config.maxFavChars=22;presence.config.presenceEventsTimeout=3000;presence.config.enableWebkitNotification=false;
presence.config.webkitNotificationTimeout=6000;presence.config.audibleLevel=1;presence.config.logLevel=1;Jiffy.options.USE_JIFFY=false;presence.config.chatMsgHistoryEnabled=(canvas_window.umps_config.chatMsgHistoryEnabled=="true")?true:false;presence.config.chatMsgDeepHistoryEnabled=(canvas_window.umps_config.chatMsgDeepHistoryEnabled=="true")?true:false;
presence.config.chatMsgDeepHistoryDarkLaunchEnabled=(canvas_window.umps_config.chatMsgDeepHistoryDarkLaunch=="true")?true:false;presence.config.orgWideSearchEnabled=(canvas_window.umps_config.orgWideSearchEnabled=="true")?true:false;presence.config.meetupsEnabled=(canvas_window.umps_config.isMeetupsEnabled==="false")?false:true;
(function(a){try{var c=window.top.location.href;if(c&&c.indexOf("umpsLogLevel=4")!=-1){a.config.logLevel=4}}catch(b){}})(presence);presence.config.chatWindowMinHeight=325;presence.config.chatWindowMinWidth=235;presence.config.optionsHelpURL=(canvas_window.umps_config.chat_options_help_url)?(canvas_window.umps_config.chat_options_help_url).replace("\\",""):"";
presence.config.helpURL=(canvas_window.umps_config.chat_using_help_url)?(canvas_window.umps_config.chat_using_help_url).replace("\\",""):"";presence.config.popOutBrowserWidth=224;presence.config.popOutBrowserMaximizedWidth=700;presence.config.popOutWindowWidth=300;presence.config.popOutWindowHeight=400;
presence.config.popOutBrowserHeight=600;presence.config.popOutURL="/umps/sfdc_umps_popout.html";presence.config.popOutWindowName="cpopout";presence.config.feedbackURL="http://uesurveys.salesforce.com/collector/Survey.ashx?Name=Chat_feedback_survey_pilot";presence.skin={};presence.skin.BuddylistChatWindowDiff=42;
presence.config.paintWaitTime=5000;presence.config.allowPainting=true;presence.config.paintTimer=null;presence.config.screenShareEnabled=(canvas_window.umps_config.isScreenShareEnabled=="false")?false:false;presence.config.ssClientDownloadPath="chatternow/ssclient/client/";presence.config.slipStreamDir="/chatternow/ssclient/";
presence.config.slipStreamAppName="ChatterRooms";presence.config.ssClientServiceName="SSClient";presence.config.appletVersion="";presence.config.winSSClientHashCode="";presence.config.macSSClientHashCode="";presence.config.ssClientUninstalerServiceName="ChatterRoomsUninstaller";presence.config.winSSClientUnistallerHashCode="";
presence.config.StaticFileLocaton="";presence.config.acknowledgeTimeOut="120000";presence.config.environmentCheckTimeout="15000";presence.getOSName();presence.config.isOSsupported=(presence.osName.indexOf("Mac")!=-1||presence.osName.indexOf("Win")!=-1);presence.config.ssConnectionTimeout=60;presence.config.ssRetries=10;
presence.config.autoDetectProxy=true;presence.config.SSFeedbackURL="http://uesurveys.salesforce.com/collector/Survey.ashx?Name=ScreenShare_feedback";presence.config.SSHelpURL="/help/doc/en/collab_screen_share_troubleshooting.htm";presence.config.SsSystemReqLink="/help/doc/en/collab_screen_share_support.htm";
presence.config.SSHelpLinks={JavaSettingsError:{MAC:"/help/doc/en/collab_screen_share_support_java_OS_Mac.htm",WIN:"/help/doc/en/collab_screen_share_support_java_OS.htm"},JavaPluginDisabled:{MACWIN:"/help/doc/en/collab_screen_share_support_java.htm"},JavaNotInstalled:{MACWIN:"/help/doc/en/collab_screen_share_troubleshooting.htm"},OSNotSupported:{MACWIN:"/help/doc/en/collab_screen_share_support.htm"}};
(function(a){KEY_ENTER=13;KEY_ESCAPE=27;KEY_LEFT_ARROW=37;KEY_UP_ARROW=38;KEY_RIGHT_ARROW=39;KEY_DOWN_ARROW=40;KEY_TAB=9;KEY_SHIFT=16;KEY_CTRL=17;KEY_ALT=18;KEY_SPACE=32;Accessibility=function(c){var b=null;this.onfocus=function(d){var d=(d)?d:((canvas_window.event)?canvas_window.event:null);var f=(d.target)?d.target:((d.srcElement)?d.srcElement:null);
b.stopEventPropogation(d);b._preventEventDefault(d);if(b.properties.onfocus){b.properties.onfocus()}else{if(b.isMouseFocus===false){if(b.hasClass(b.ele,"hideOutLine")){b.removeClass(b.ele,"hideOutLine")}b.isMouseFocus=true}}};this.onEscape=function(){if(b.properties.onEscape){b.properties.onEscape()}};
this.onEnter=function(f){if(b.properties.onEnter){b.properties.onEnter()}else{if(b.properties.isList){if(b.currentChild_Index==undefined||b.currentChild_Index==-1){var g=b._getChildElementById(b.properties.childIdStartWith);if(!b.hasClass(g,b.properties.onChildSelect)){return}b.currentChild_Index=b.firstChildIndx
}var d=b.ele.childNodes[b.currentChild_Index];if(b.isSafari()){b._dispatchClickEventonSafari(d)}else{if(d.click){d.click()}}if(b.properties.onChildEnter){b.properties.onChildEnter(d)}}}if(b.properties.click){b.properties.click()}else{if(b.isSafari()){b._dispatchClickEventonSafari(b.ele)}else{b.ele.click()
}}};this.onSpace=function(f){if(b.properties.click){b.properties.click()}else{if(b.properties.isList){var d=b.ele.childNodes[b.currentChild_Index];if(b.isSafari()){b._dispatchClickEventonSafari(d)}else{if(d.click){d.click()}}if(b.properties.onChildEnter){b.properties.onChildEnter(d)}}else{if(b.isSafari()){b._dispatchClickEventonSafari(b.ele)
}else{b.ele.click()}}}};this._dispatchClickEventonSafari=function(d){try{var f=canvas_doc.createEvent("HTMLEvents");f.initEvent("click",true,true);d.dispatchEvent(f)}catch(g){}};this.onRightArrow=function(d){if(b.properties.onRightArrow){b.properties.onRightArrow()}};this.onLeftArrow=function(d){if(b.properties.onLeftArrow){b.properties.onLeftArrow()
}};this.onDownArrow=function(f){if(b.properties.onDownArrow){b.properties.onDownArrow()}else{if(b.properties.isList){var d=b.properties.childIdStartWith;if(b.currentChild_Index==undefined||b.currentChild_Index==-1){var g=b._getChildElementById(d);if(g){b.currentChild_Index=b.firstChildIndx;b.addClass(g,b.properties.onChildSelect);
b._updateChild(g)}}else{b._goToNextChild(false)}}}};this.onUpArrow=function(){if(b.properties.onUpArrow){b.properties.onUpArrow()}else{if(b.properties.isList){var d=b.properties.childIdStartWith;if(b.currentChild_Index==undefined||b.currentChild_Index==-1){var f=b._getChildElementById(d);if(f){f=b.ele.childNodes[b.lastChildIndx];
b.currentChild_Index=b.lastChildIndx;b.addClass(f,b.properties.onChildSelect);b._updateChild(f)}}else{b._goToNextChild(true)}}}};this.onCTRL=function(d){if(b.properties.onCTRL){b.properties.onCTRL()}};this.onALT=function(d){if(b.properties.onALT){b.properties.onALT()}};this.onShift=function(d){if(b.properties.onShift){b.properties.onShift()
}};this.onTabClick=function(f){if(b.properties.onTabClick){var d=b.properties.onTabClick(f);if(d==undefined||d===false){b._preventEventDefault(f)}}};this._isChildContainsId=function(d,f){if(!f){return false}if(f.id!=""&&f.id.indexOf(d)!=-1){return true}if(f.className!=""&&f.className.indexOf(d)!=-1){return true
}return false};this._goToNextChild=function(f){var d=b.properties.childIdStartWith;if(b.totalChildCount!=b.ele.childNodes.length){b._getChildElementById(d)}if(b.currentChild_Index>=0){var j=b.currentChild_Index;if(b.lastChildIndx==b.firstChildIndx){return}else{if(b.lastChildIndx>b.currentChild_Index){b.currentChild_Index=f?(b.currentChild_Index==0?b.lastChildIndx:b.currentChild_Index-1):b.currentChild_Index+1;
if(b.currentChild_Index==b.lastChildIndx&&b.properties.customScrollbar){b.properties.customScrollbar._upkeyscroll(b.ele.offsetHeight,b.ele.offsetTop,true)}}else{if(b.lastChildIndx<=b.currentChild_Index){b.currentChild_Index=f?b.lastChildIndx-1:b.firstChildIndx;if(b.currentChild_Index==0&&b.properties.customScrollbar){b.properties.customScrollbar._downkeyscroll(-(b.ele.offsetHeight),b.ele.childNodes[b.lastChildIndx].offsetTop,true)
}}}}var g=b.ele.childNodes[b.currentChild_Index];try{while(!b._isChildContainsId(d,g)){b.currentChild_Index=f?b.currentChild_Index-1:b.currentChild_Index+1;if(b.currentChild_Index<b.firstChildIndx){b.currentChild_Index=b.lastChildIndx}g=b.ele.childNodes[b.currentChild_Index];if(b.lastChildIndx<b.currentChild_Index){b.currentChild_Index=b.firstChildIndx
}}}catch(h){g=null}if(g){b.addClass(g,b.properties.onChildSelect);b._updateChild(g);if(b.properties.scrollbar){if(!f){if(b.properties.scrollbar._scrollto){b.properties.scrollbar._scrollto((g.offsetHeight))}else{b.properties.scrollbar.scrollTop+=(g.offsetHeight/2)}}else{if(b.properties.scrollbar._scrollto){b.properties.scrollbar._scrollto(-(g.offsetHeight))
}else{b.properties.scrollbar.scrollTop-=(g.offsetHeight/2)}}if(b.firstChildIndx==b.currentChild_Index){if(b.properties.scrollbar._scrollto){b.properties.scrollbar._scrollto((g.offsetTop))}else{b.properties.scrollbar.scrollTop=0}}else{if(b.lastChildIndx==b.currentChild_Index){if(b.properties.scrollbar._scrollto){b.properties.scrollbar._scrollto((g.offsetTop))
}else{b.properties.scrollbar.scrollTop=(g.offsetTop)}}}}if(b.properties.customScrollbar){if(!f){b.properties.customScrollbar._downkeyscroll(-(g.offsetHeight),g.offsetTop)}else{b.properties.customScrollbar._upkeyscroll(g.offsetHeight,-g.offsetTop)}}if(j!=-1){var i=b.ele.childNodes[j];b.removeClass(i,b.properties.onChildSelect)
}}}};this._updateChild=function(d){if(d.id.trim()==""){a.View.Accessibility.childcounter++;d.id="child_"+a.View.Accessibility.childcounter}d.setAttribute("role","option");b.ele.setAttribute("aria-activedescendant",d.id)};this._getChildElementById=function(g){if(g){var f=0;b.lastChildIndx=-1;b.totalChildCount=b.ele.childNodes.length;
for(var d=b.ele.childNodes.length-1;d>=0;d--){var h=b.ele.childNodes[d];if(b._isChildContainsId(g,h)){if(b.lastChildIndx==-1){b.lastChildIndx=parseInt(d)}b.firstChildIndx=parseInt(d)}}return b.ele.childNodes[b.firstChildIndx]}return null};this.hasClass=function(f,d){if(!f){return false}if(f.classList){return f.classList.contains(d)
}return(" "+f.className+" ").indexOf(" "+d+" ")>-1};this.addClass=function(f,d){if(!f){return null}if(f.classList){return f.classList.add(d)}if(!b.hasClass(f,d)){f.className=b.getTrimString(f.className+" "+d)}};this.setClass=function(f,d){f.className=d};this.removeClass=function(f,d){if(!f){return null
}if(f.classList){return f.classList.remove(d)}if(b.hasClass(f,d)){f.className=b.getTrimString(f.className.replace(new RegExp("(^|\\s)"+d+"(\\s|$)")," "))}};this.getTrimString=function(d){if(d){var f=/^\s+|\s+$/g;return d.replace(f,"")}else{return""}};this.stopEventPropogation=function(d){var d=window.event||d;
if(d&&d.stopPropagation){d.stopPropagation()}if(d){d.cancelBubble=true}};this.onblur=function(d){try{var d=(d)?d:((canvas_window.event)?canvas_window.event:null);var f=(d.target)?d.target:((d.srcElement)?d.srcElement:null);b.stopEventPropogation(d);b._preventEventDefault(d);if(f!=b.ele){return}b.resetValues()
}catch(g){a.log("Error on Accessiblity"+g)}};this.resetValues=function(){if(b.properties.isList){var d=b.ele.childNodes[b.currentChild_Index];b.removeClass(d,b.properties.onChildSelect);b.currentChild_Index=undefined}if(b.hasClass(b.ele,"hideOutLine")){b.removeClass(b.ele,"hideOutLine")}b.isMouseFocus=false
};this.onkeyPress=function(d){try{var d=(d)?d:((canvas_window.event)?canvas_window.event:null);var f=(d.target)?d.target:((d.srcElement)?d.srcElement:null);b.stopEventPropogation(d);if(f!=b.ele){return}d.keyCode=(d.keyCode?d.keyCode:d.which);switch(d.keyCode){case KEY_ENTER:b._preventEventDefault(d);
b.onEnter(d);break;case KEY_SHIFT:b.onShift();break;case KEY_CTRL:b.onCTRL();break;case KEY_ALT:b.onALT();break;case KEY_SPACE:if(b.isTextField()){return}b._preventEventDefault(d);b.onSpace(d);break;default:if(b.properties.onkeyPress){b.properties.onkeyPress(d)}else{a.View.shortcutHandler(d)}}}catch(g){a.log("Error on Accessiblity"+g)
}};this._preventEventDefault=function(d){return d.preventDefault?d.preventDefault():d.returnValue=false};this.onkeydown=function(d){try{var d=(d)?d:((canvas_window.event)?canvas_window.event:null);var f=(d.target)?d.target:((d.srcElement)?d.srcElement:null);b.stopEventPropogation(d);if(f!=b.ele){return
}d.keyCode=(d.keyCode?d.keyCode:d.which);switch(d.keyCode){case KEY_ENTER:if(!b.isSafari()){return}b._preventEventDefault(d);b.onEnter(d);break;case KEY_UP_ARROW:b._preventEventDefault(d);b.onUpArrow();break;case KEY_DOWN_ARROW:b._preventEventDefault(d);b.onDownArrow();break;case KEY_LEFT_ARROW:b.onLeftArrow();
break;case KEY_RIGHT_ARROW:b.onRightArrow();break;case KEY_ESCAPE:b._preventEventDefault(d);b.onEscape(d);break;case KEY_TAB:b.onTabClick(d);break;case KEY_SPACE:if(b.isTextField()){return}b._preventEventDefault(d);b.onSpace(d);break}}catch(g){a.log("Error on Accessiblity"+g)}};this.isSafari=function(){var d=navigator.userAgent.toLowerCase();
if(d.indexOf("safari")!=-1){if(d.indexOf("chrome")>-1){}else{return true}}return false};this.onMouseDown=function(d){if(!b.hasClass(b.ele,"hideOutLine")){b.addClass(b.ele,"hideOutLine")}b.isMouseFocus=true};this.isTextField=function(){var d=b.ele.tagName;if(d=="INPUT"){if(b.ele.type){if(b.ele.type==="text"){return true
}}}else{if(d==="TEXTAREA"){return true}}return false};if(c){if(window===this){return new Accessibility(c)}this.ele=canvas_doc.getElementById(c.id);this.properties={id:c.id,onfocus:c.onfocus,onEnter:c.onEnter,onkeypress:c.onkeypress,onkeydown:c.onkeydown,onblur:c.onblur,onEscape:c.onEscape,onTabClick:c.onTabClick,click:c.click,onChildEnter:c.onChildEnter,isList:c.isList,showOutline:c.showOutline,childIdStartWith:c.childIdStartWith,onChildSelect:c.onChildSelect,scrollbar:c.scrollbar,customScrollbar:c.customScrollbar};
if(this.ele==null){return}b=this;if(b.ele.tabIndex==-1||a.isIE){b.ele.tabIndex=0;b.ele.setAttribute("tabIndex",0)}if(b.properties.isList){b.ele.setAttribute("role","listbox")}b.ele.onkeypress=function(d){b.onkeyPress(d)};b.ele.onkeydown=function(d){b.onkeydown(d)};b.ele.onblur=function(d){b.onblur(d)
};if(b.ele.style&&b.properties.showOutline===false){b.ele.style.outline=0}a.View.addHandler(b.ele,"mousedown",b.onMouseDown);a.View.addHandler(b.ele,"focus",b.onfocus);return this}};Accessibility.childcounter=1;a.View.Accessibility=Accessibility})(presence);(function(b){var a={};a.lostFocus=function(){b.View.addHandler(canvas_doc,"mousemove",a.idleToAvailable);
if(b.isIE&&b.activeElementFoused!=canvas_doc.activeElement){b.activeElementFoused=canvas_doc.activeElement;return}b.focus="FOCUS_LOST";b.log("presence.config.autoIdleTime::::"+presence.config.autoIdleTime);a.scheduleAutoIdle();setTimeout(function(){a.sendBrowserEvent({command:"onBlur"})},200);b.isChatterInFocus=false;
window.clearTimeout(b.pollTimer)};a.parentMouseDownListener=function(c){b.log("Parent MouseDown Listener");a.restartIdleTimer();if(!b.Controller.ownerObj||b.Controller.ownerObj.presenceStatus==20||b.reconnectInProgress||(b.View.PopOutWidget.popIn)||!b.Controller.eventPollObj||c==true){return}if(b.pollTimer){window.clearTimeout(b.pollTimer)
}b.pollTimer=window.setTimeout(b.Controller.eventPollObj.sleepModeOff,500)};a.parentKeyDownListener=function(){if(a.keyDownProcessed){return}a.keyDownProcessed=true;a.restartIdleTimer();window.setTimeout(function(){a.keyDownProcessed=false},10000)};a.restartIdleTimer=function(){if(b.isIdle===true){b.isIdle=false;
a.doPingCall()}a.scheduleAutoIdle()};a.idleToAvailable=function(){if(b.isIdle){b.isIdle=false;a.doPingCall()}};a.parentMouseMoveListener=function(){b.View.addHandler(canvas_doc,"mousemove",a.idleToAvailable);b.View.removeHandler(canvas_doc,"mousemove",a.parentMouseMoveListener);b.log("parent mouse move happened");
a.focusListener()};a.focusListener=function(){if(b.focus=="FOCUS_LOST"&&b.View.PopOutWidget.active){b.log("StartInactivityTimer on window Focus_lost");b.Controller.startInactivityTimer()}b.View.removeHandler(canvas_doc,"mousemove",a.idleToAvailable);var d=b.focus;b.focus="FOCUS_GAIN";var c=(b.titleMsgs.length>0);
a.resetTitle();if(c){a.sendCustomEvent({event:"muteNotify"});setTimeout(function(){a.sendBrowserEvent({command:"onFocus"})},200)}else{setTimeout(function(){a.sendBrowserEvent({command:"onFocus"})},200)}if(b.reconnectInProgress&&!b.Controller.ownerObj){window.clearTimeout(b.autoReconnectTimer);window.clearTimeout(b.autoReconnectTickerTimer);
window.clearTimeout(b.reconnectPreTimer);a.doAutoReconnect()}if(b.notifyWindow){b.notifyWindow.cancel()}if(b.isIdle===true){b.isIdle=false;a.doPingCall()}if(b.Controller.ownerObj&&b.Controller.ownerObj.state){var h=b.Controller.ownerObj.state.pollMode;b.config.previousPollMode=h}var g=false;if(b.View.PopOutWidget.popIn){var i=b.getCookie("umpsStatus");
try{i=JSON.parse(i)}catch(j){}if(i.popedOut==false){b.View.PopOutWidget.switchBack();g=true}}if(!b.Controller.ownerObj||b.Controller.ownerObj.presenceStatus==20||b.reconnectInProgress||(b.View.PopOutWidget.popIn&&!g)||!b.Controller.eventPollObj){return}window.clearTimeout(b.pollTimer);b.pollTimer=window.setTimeout(b.Controller.eventPollObj.sleepModeOff,500);
window.setTimeout(function(){b.View.WindowManager.getHistory()},1000);if(d=="FOCUS_LOST"){var f=b.View.WindowManager.curWindow;if(f){f.cleanAllPrEvntsByTimeout(b.config.presenceEventsTimeout)}}};a.doPingCall=function(){if(b.pingTimer){clearTimeout(b.pingTimer)}if(!b.isOffline&&b.Controller.ownerObj&&b.Controller.eventPollObj&&b.Controller.eventPollObj.shortPoll===false){b.Controller.call({method:"ping",data:{device_state:(b.isIdle===true)?"idle":"active"},successCallBack:function(){b.pingTimer=setTimeout(a.doPingCall,b.pingInterval)
},failCallBack:function(c){b.log("Ping API call failed","error");if(c.result===false){}else{b.pingTimer=setTimeout(a.doPingCall,30*1000)}}})}};a.resetTitle=function(){if(b.titleMsgs.length>0){var c=b.titleMsgs[0];setTimeout(function(){b.focusTitleRotation=0;b.focusTitleIndex=0;canvas_doc.title=c;b.titleMsgs=[]
},700)}if(b.focusTimer!=0){clearTimeout(b.focusTimer);b.focusTimer=0}};a.scheduleAutoIdle=function(){if(b.idleTimer){clearTimeout(b.idleTimer)}b.idleTimer=setTimeout(a.setAutoIdle,presence.config.autoIdleTime)};a.setAutoIdle=function(){b.log("p.setAutoidle:::"+b.setAutoidle+"______p.isOffline::::"+b.isOffline);
if(b.setAutoidle&&!b.isOffline&&b.Controller.ownerObj){if(b.idleTimer){clearTimeout(b.idleTimer)}b.isIdle=true;b.log("user went to idle state","info");a.doPingCall()}};a.requestSubspace=function(){};a.showWidgetLoader=function(){b.EventManager.trigger("event.owner.went.offline",{});if(b.View.WindowManager.popupPanel){b.View.WindowManager.popupPanel.hide()
}if(b.View.Buddylist.overlayPanel){b.View.Buddylist.overlayPanel.hide()}if(b.View.PopOutWidget.active){return}var j=b.View.getEl("presence_widget");var d=(b.ErrorRosterExpand)?" chat_pan_active":"";var i='<div class="chat_buddy_list_main_box main_box_shadow"><div class="chat_buddy_list_main_inner">';
var k='<div class="chat_buddy_list_menus"><span class="options_mink_menu float_left"><a class="roster_menu_btn"><span class="offline"><img class="chat_buddy_status_img float_left" src="'+b.imageLocation+'/1pxDummy.png"  alt="'+b.getCatalog("unavailable")+'"></span><span>'+presence.config.catalog.unavailable+'</span><img src="'+b.imageLocation+'/1pxDummy.png" class="down_arrow" /></span></a><a class="roster_menu_btn roster_menu_btn_right" target="_blank" href="'+b.config.helpURL+'"><span id="umpswidget_help_icon"><img src="'+b.imageLocation+'/1pxDummy.png" class="help_grey_icon image_hover float_right" border="0px" /></span></a></div>';
var c='<div class="chat_buddy_list_content_box content_box_shadow"><img alt="" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" border="0" class="presence_widget_spinner float_right" id="widget_loadingstat_img" /><img src="'+b.imageLocation+'/1pxDummy.png" border="0" alt="" class="presence_widget_spinner error_16 float_left hide" id="widget_errorloading_img" /> <div class="presence_widget_loadingstat" id="presence_widget_loadingstat">'+presence.config.catalog.widgetLoading+"</div></div>";
var g='<span id="roster_title_collapsed" class="roster_title_collapsed"><span id="chat_roster_collapsed_disconnect"><img class="chat_error float_right" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" /><span class="float_right connecting_text"></span></span><span id="presence_buddylist_presence_status" class="hide" ><img class="float_right error_12 error_icon_holder" alt="" id="presence_connection_error" src="'+b.imageLocation+'/1pxDummy.png"></span><img class="roster_header_min_icon alt="" float_left" src="'+b.imageLocation+'/1pxDummy.png"><span id="buddy_list_min_text" class="error_txt float_right hide"><span></span></span><span class="buddy_list_min_text">'+b.getCatalog("buddyListTitle_min")+"</span></span>";
var f="";if(b.View.PopOutWidget.active){f='style="width:220px;"'}var h='<div id="presence_failed_widget" class="chat_dock_pane_group chat_buddy_list_pane chat_roster_load_failed'+d+'">'+i+'<div id="presence_failed_widget_head" class="presence_buddylist_header"><div class="presence_buddylist_header_inner">'+g+'<span class="roster_title_expanded"><img class="roster_header_icon float_left" alt="loader" src="'+b.imageLocation+'/1pxDummy.png"><div class="buddy_list_max_text">'+presence.config.catalog.buddyListTitle+'</div></span></div></div><div class="chat_buddy_list_content_wrapper" '+f+">"+k+c+"</div></div></div></div>";
if(j){b.View.html(j,'<div class="chat_dock_pane"><div class="float_right">'+h+"</div>");b.View.addHandler(b.View.getEl("presence_failed_widget_head"),"click",a.toggleFailedRoster)}new b.View.Accessibility({id:"presence_failed_widget_head"});new b.View.Accessibility({id:"presence_widget_loadingstat",click:function(){b.View.dispatchClickEvent(b.View.getEl("try_again_link"))
}})};a.widgetLoadFailed=function(c){var d=b.View.getEl("presence_widget_loadingstat");if(d){b.View.html(d,(presence.config.catalog.WidgetLoadFailed+'<a id="try_again_link" class="try_again_link"> '+presence.config.catalog.tryRec+"</a>"));b.View.addClass(b.View.getEl("chat_roster_collapsed_disconnect"),"hide");
b.View.removeClass(b.View.getEl("presence_buddylist_presence_status"),"hide");b.View.removeClass(b.View.getEl("buddy_list_min_text"),"hide");b.View.addClass(b.View.getEl("widget_loadingstat_img"),"hide");b.View.removeClass(b.View.getEl("widget_errorloading_img"),"hide");b.View.addHandler(b.View.getEl("try_again_link"),"click",function(){window.clearTimeout(b.autoReconnectTimer);
window.clearTimeout(b.autoReconnectTickerTimer);a.showSpinner();b.Controller.doChatterConnect(function(f){a.reInitBootStrap()},function(f){if(canvas_window.umpsdoPageReload){if(b.View.PopOutWidget.active){b.View.PopOutWidget.showDisconnected()}else{canvas_window.umpsdoPageReload()}}})});new b.View.Accessibility({id:"try_again_link"});
b.View.focusEle("try_again_link")}else{if(popOut_ChatSubspaceId){b.View.WindowManager.curWindow.onError(b.getCatalog("ChatWindowPopOutFailed"),true);b.View.WindowManager.curWindow.disableWindowOnly()}}if(b.Controller.eventPollObj){b.Controller.eventPollObj.stopPoll()}b.Adapter.isReady=false;a.closeAllPopups();
b.resetValues();b.View.Buddylist.updateMessageCount(0);b.reconnectPreTimer=window.setTimeout(a.startAutoReconnect,2000)};a.startAutoReconnect=function(){window.clearTimeout(b.autoReconnectTickerTimer);window.clearTimeout(b.autoReconnectTimer);var c=Math.floor(Math.random()*400)+40;b.autoReconnectTimer=window.setTimeout(a.doAutoReconnect,c*1000);
a.showAutoReconnectTicker(c);b.reconnectInProgress=true};a.showAutoReconnectTicker=function(c){b.View.getEl("presence_connection_error").title=b.getCatalog("Disconnected");if(c>1){b.autoReconnectTickerTimer=window.setTimeout(function(){a.showAutoReconnectTicker(c-1)},1000)}};a.doAutoReconnect=function(){b.Controller.getSessionStatus(function(c){c=c.substring(9,c.length);
var d=JSON.parse(c);if(d.secondsLeft&&d.secondsLeft>0){a.showSpinner();b.Controller.init(controllerInitData,true);window.clearTimeout(b.autoReconnectTickerTimer)}else{b.reconnectInProgress=false;a.chatSessionExpired()}},function(c){a.startAutoReconnect()})};a.toggleFailedRoster=function(){var c=b.View.getEl("presence_failed_widget");
if(b.View.hasClass(c,"chat_pan_active")){b.View.removeClass(c,"chat_pan_active");b.ErrorRosterExpand=false}else{b.View.addClass(c,"chat_pan_active");b.ErrorRosterExpand=true}};a.reInitBootStrap=function(){a.showSpinner();b.Controller.init(controllerInitData,true)};a.showSpinner=function(){var c=b.View.getEl("presence_widget_loadingstat");
if(c){b.View.html(c,presence.config.catalog.widgetLoading);b.View.removeClass(b.View.getEl("widget_loadingstat_img"),"hide");b.View.addClass(b.View.getEl("widget_errorloading_img"),"hide");b.View.removeClass(b.View.getEl("chat_roster_collapsed_disconnect"),"hide");b.View.addClass(b.View.getEl("presence_buddylist_presence_status"),"hide");
b.View.addClass(b.View.getEl("buddy_list_min_text"),"hide")}};a.showReconnect=function(){if(popOut_ChatSubspaceId){return b.View.WindowManager.disableAllWindows()}var c=b.View.getEl("presence_buddylist");b.View.addClass(b.View.getEl("chat_buddy_roster_search"),"hide");b.View.removeClass(b.View.getEl("chat_buddy_roster_disconnect"),"hide");
b.View.removeClass(b.View.getEl("chat_roster_collapsed_disconnect"),"hide");b.View.addClass(b.View.getEl("presence_buddylist_presence_status"),"hide");b.View.addClass(b.View.getEl("buddy_list_min_text"),"hide");b.View.WindowManager.disableAllWindows();b.View.append(c,'<div id="roster_mask" class="roster_mask" style="height:'+c.offsetHeight+'px;"></div>')
};a.cleanReconnect=function(){if(popOut_ChatSubspaceId){return b.View.WindowManager.enableAllWindows()}b.View.removeClass(b.View.getEl("chat_buddy_roster_search"),"hide");b.View.addClass(b.View.getEl("chat_buddy_roster_disconnect"),"hide");b.View.addClass(b.View.getEl("chat_roster_collapsed_disconnect"),"hide");
b.View.removeClass(b.View.getEl("presence_buddylist_presence_status"),"hide");b.View.removeClass(b.View.getEl("buddy_list_min_text"),"hide");b.View.WindowManager.enableAllWindows();b.View.remove("presence_buddylist","roster_mask")};a.closeAllPopups=function(){if(b.View.Buddylist.SettingsMenu){b.View.Buddylist.SettingsMenu.hide()
}if(b.View.WindowManager.popupPanel){b.View.WindowManager.popupPanel.hide()}if(b.View.Buddylist.tooltip){b.View.Buddylist.tooltip.style.display="none"}if(b.View.WindowManager.timestampDiv){b.View.WindowManager.timestampDiv.style.display="none"}b.View.addClass(b.View.getEl("presence_status_options"),"hide");
b.View.addClass(b.View.getEl("optionsMenu"),"hide")};a.chatSessionExpired=function(){if(b.View.PopOutWidget.active){b.View.PopOutWidget.showDisconnected();return}b.View.Buddylist.updateMessageCount(0);b.View.Buddylist.updatePresenceUI(b.presenceStatus.UNAVAILABLE,"UNAVAILABLE");b.View.Buddylist.setBuddylistOffline(true)
};a.sendCustomEvent=function(d,f){if(b.isOffline||!b.Controller.ownerObj){return}if(d.subspaceId&&(d.event=="windowClosed"||d.event=="windowOpened"||d.event=="windowPopedIn")){b.View.WindowManager.synchWindows();if(d.event=="windowOpened"||d.event=="windowPopedIn"){b.setCookie("umps_open_subspaceid",d.subspaceId)
}}if((d.event=="windowCollapsed"||d.event=="windowClosed")){b.setCookie("umps_open_subspaceid","DUMMY")}if(d){d.clientId=b.getClientId()}var c={subspaceId:b.Model.Owner.getInstance().defaultSubSpaceId,message:JSON.stringify(d),topic:"event.user.message.custom"};b.Controller.call({method:"sendCustomEvent",data:c,successCallBack:function(g){if(typeof f=="function"){f(g)
}},failCallBack:function(g){if(typeof f=="function"){f(g)}}});if(b.Controller.transportType=="websocket"&&typeof f=="function"){window.setTimeout(f,100)}};a.sendBrowserEvent=function(f,c,d){if(!d&&!presence.Controller.ownerObj){return}b.XTab.sendCommand(JSON.stringify(f),c)};a.listenBrowserEvents=function(){b.XTab.listenCommands(function(c){var c=JSON.parse(c);
presence.log("received browser event: "+c.command);if(c.command=="popedIn"){b.log("listenBrowserEvent - popedIn","info");if(!b.View.PopOutWidget.active){b.View.PopOutWidget.close()}}if(!presence.Controller.ownerObj||presence.Controller.ownerObj.pageLoadHappens){return}if(c.command=="onBlur"){b.isChatterInFocus=false
}else{if(c.command=="onFocus"){b.isChatterInFocus=true;a.resetTitle()}else{if(c.command=="qn.isOnFocus"){if(b.focus=="FOCUS_GAIN"){a.sendBrowserEvent({command:"onFocus"})}}else{if(c.command=="chatPopin"){b.View.Actions.setDeviceAttribute(c.command,c.subspaceId)}else{if(c.command=="newMessage"){b.View.WindowManager.rotatePageTitle()
}}}}}})};a.setDeviceAttribute=function(c,l,m){var d=b.Model.Owner.getInstance(),n={};if(c=="chatPopout"){var f=d.device[c];if(!f){f=[]}f[f.length]=l;d.device[c]=f}else{if(c=="chatPopin"){var k=d.device.chatPopout;if(k){for(var h=0,j=k.length;h<j;h++){if(k[h]==l){break}}k.splice(h,1);d.device.chatPopout=k
}}else{d.device[c]=l}}n[c]=l;d.device.action=n;var g={channelsGroupDetails:d.device,spaceId:b.Controller.ownerObj.sessionId};b.Controller.call({method:"setChannelGroupPreferences",data:g,successCallBack:function(i){b.setCookie("prePopin",false);b.View.WindowManager.getHistory();if(typeof m=="function"){m(i)
}},failCallBack:function(i){if(typeof m=="function"){m(i)}}})};a.showWebkitNotification=function(d,g,c,f){};a.requestWebkitNotification=function(){};a.preDownloadChatFrame=function(g){if(b.preDownloadTimer){clearTimeout(b.preDownloadTimer)}var h=baseURL.split("://",2),d=b.Model.Owner.getInstance(),i=h[0]+"://"+g+"."+h[1]+jshtml_loc,c=document.getElementById("api_iframe_dummy");
if(c){c.src=i}else{var f=document.createElement("IFRAME");f.id="api_iframe_dummy";f.name="api_iframe_dummy";f.src=i;f.frameborder=0;document.body.appendChild(f)}d.cacheSubDomain=g};b.View.Actions=a})(presence);(function(a,b){var c=function(){var d=this;this.wavUrl=baseURL+b.getCodeLocation()+"images/new-chat-message.wav";
this.mp3Url=baseURL+b.getCodeLocation()+"images/lobbyclip.mp3";this.swfUrl=baseURL+b.getCodeLocation()+"images/message_alert_new.swf";this.support={};this.init=function(){d._loadSwf()};this.play=function(f){d._loadSwf();if(!d.player){d.player=swfobject.getObjectById("umps_audible_div")}if(d.player&&typeof d.player.play=="function"){d.player.play();
b.log("self.player.play")}else{b.log("swf audio self.player.playAudio");if(d.player&&d.player.playAudio){d.player.playAudio()}}};this.stop=function(f){if(d.player&&d.player.stop){d.player.stop()}};this._canPlayWav=function(){if(d.support.wav!=undefined){return d.support.wav}var f=document.createElement("audio");
d.support.wav=!!(f.canPlayType&&f.canPlayType('audio/wav; codecs="1"').replace(/no/,""));return d.support.wav};this._canPlayMp3=function(){if(d.support.mp3!=undefined){return d.support.mp3}var f=document.createElement("audio");d.support.mp3=!!(f.canPlayType&&f.canPlayType("audio/mpeg;").replace(/no/,""));
return d.support.mp3};this._loadSwf=function(){if(!b.View.getEl("umps_audible_div")){canvas_doc.body.appendChild(b.View.createEl("div",{id:"umps_audible_div"}));swfobject.embedSWF(d.swfUrl,"umps_audible_div","1","1","9.0.0","",{},{allowscriptaccess:"always"},{});b.log("done, swf painted! "+d.swfUrl)}};
this.unloadSwf=function(){var f=b.View.getEl(b.View.Audible.getID());if(b.config.audibleLevel==0&&f){swfobject.removeSWF("umps_audible_div");b.log("done, swf removed! "+d.swfUrl)}else{if(b.config.audibleLevel!=0&&f==null){b.View.Audible.init()}}d.player=null};this.getID=function(){return"umps_audible_div"
}};b.View.Audible=new c()})(window,presence);(function(a){var h={};var b=a.Model.Owner.getInstance();var g="";var l=null;var d=null;h.searchActive=false;h.favEditActive=false;h.searchBegin=false;var f=null;h.buddyNodes=new Array();h.defaultSearchTxt="";var i=0;var c=0;var n="Users";var k=null;var j=null;
var m=this;h.clrSearchTimer=null;h.curParticipantsList=null;h.participantsListTimer=null;h.init=function(){Jiffy.mark("RosterInit");a.createWorkspaceRequestsWithUuid={};h.searchActive=false;h.favEditActive=false;a.ErrorRosterExpand=false;h.defaultSearchTxt=(a.config.groupChatEnabled)?a.config.catalog.FollowedGroups:a.config.catalog.searchDefaultText;
h.ChatList=new a.View.ChatList();h.OrgSearchList=new a.View.OrgSearchList();b=a.Model.Owner.getInstance();var K=a.showFollowed?"":" hide";var J=a.showFavorites?"":" hide";var X=a.View.getEl("presence_widget");var V='<div id="presence_main" class="chat_dock_pane_group chat_buddy_list_pane">';if(b.presenceStatus==""){b.presenceStatus=10
}var p=(a.View.PopOutWidget.active)?"":" main_box_shadow";var M=(a.View.PopOutWidget.active)?" main_box_shadow":"";var I=" hide";var z=(a.View.PopOutWidget.active)?'target="_blank"':"";var r="",T="";presenceBuddyList='<div id="presence_buddylist" class="chat_buddy_list_main_box'+p+'"><div class="chat_buddy_list_main_inner">',settingsMenu='<a id="umpswidget_help_icon" tabindex="505" '+z+' href="'+a.config.helpURL+'"><img src="'+a.imageLocation+'/1pxDummy.png" id="help_grey_icon_id" class="help_grey_icon image_hover float_right" title="'+a.getCatalog("Help")+'" /></span><a id="optionsMenuBtn" class="roster_menu_btn roster_menu_btn_right"><img src="'+a.imageLocation+'/1pxDummy.png" id="settings_menu_btn" class="gear_icon image_hover float_right" title="'+a.getCatalog("Preferences")+'" /></a>',presenceOptions="";
if(a.config.chatMsgHistoryEnabled){settingsMenu=settingsMenu+'<a id="HistoryListBtn" class="roster_menu_btn roster_menu_btn_right"><img src="'+a.imageLocation+'/1pxDummy.png" class="history_icon image_hover float_right" id="history_icon_id" title="'+a.getCatalog("ViewHistory")+'" /></a>'}var N='<img id="popout_chat" src="'+a.imageLocation+'/1pxDummy.png" class="pop_out_chat float_right" title="'+presence.config.catalog.PopOutChat+'" style="display:none"/><img id="popout_chat_win" src="'+a.imageLocation+'/1pxDummy.png" class="popout_chat_win float_right hide" title="'+presence.config.catalog.PopOutChat+'" style="display:none"/>';
if(popOut_ChatSubspaceId){r='<div id="presence_widgetstatus" class="presence_buddylist_header"><div id="presence_buddylist_status" class="presence_buddylist_header_inner"><span id="roster_title_collapsed" class="roster_title_collapsed"><span id="chat_roster_collapsed_disconnect" class="hide"><img class="chat_error float_right" alt="loader" src="'+a.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.widgetLoading+'</span><img class="roster_header_min_icon float_left" src="'+a.imageLocation+'/1pxDummy.png"><span id="presence_buddylist_presence_status" class="'+h.getPresenceClass(b.presenceStatus)+'"><img class="chat_buddy_status_img float_right" src="'+a.imageLocation+'/1pxDummy.png"></span><span id="buddy_list_min_text" class="buddy_list_min_text">'+presence.config.catalog.buddyListTitle_min+'</span></span><span id="roster_title_expanded" class="roster_title_expanded">'+N+'<a target="_blank" href="'+presence.config.feedbackURL+'" id="chat_feedback_link" class="chat_feedback_link float_right'+I+'">'+a.getCatalog("FeedbackLink")+'</a><img class="roster_header_icon float_left hide" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("buddyListTitle")+'"><div class="buddy_list_max_text hide">'+presence.config.catalog.buddyListTitle+"</div></span></div></div>"
}else{r='<div id="presence_widgetstatus" class="presence_buddylist_header"><div id="presence_buddylist_status" class="presence_buddylist_header_inner"><span id="roster_title_collapsed" class="roster_title_collapsed"><img id="popout_chat_min" src="'+a.imageLocation+'/1pxDummy.png" class="pop_out_chat minimized float_right" title="'+presence.config.catalog.PopOutChat+'" /><span id="chat_roster_collapsed_disconnect" class="hide"><img class="chat_error float_right" alt="loader" src="'+a.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.widgetLoading+'</span><span id="presence_buddylist_presence_status" class="'+h.getPresenceClass(b.presenceStatus)+'"><img class="roster_header_min_icon float_left" src="'+a.imageLocation+'/1pxDummy.png"></span><img class="chat_buddy_status_img float_right hide" src="'+a.imageLocation+'/1pxDummy.png"><span id="buddy_list_notify" class="newMessages_roster hide" title="'+a.getCatalog("NewMessage")+'"></span><span id="buddy_list_min_text" class="buddy_list_min_text">'+presence.config.catalog.buddyListTitle_min+'</span></span><span id="roster_title_expanded" class="roster_title_expanded">'+N+'<a target="_blank" href="'+presence.config.feedbackURL+'" id="chat_feedback_link" class="chat_feedback_link float_right'+I+'">'+a.getCatalog("FeedbackLink")+'</a><img class="roster_header_icon float_left" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("buddyListTitle")+'"><div class="buddy_list_max_text">'+presence.config.catalog.buddyListTitle+"</div></span></div></div>"
}presenceOptions='<div class="chat_buddy_list_content_wrapper'+M+'"><div id="chat_buddy_list_menus" class="chat_buddy_list_menus">'+h.buildPresenceOptions()+settingsMenu;if(a.View.PopOutWidget.active){T=r;a.View.append(a.View.getEl("chat_dock_bg_pane"),T);a.View.addClass(a.View.getEl("presence_widgetstatus"),"chat_pan_active");
a.View.removeClass(a.View.getEl("presence_widgetstatus"),"presence_buddylist_header");a.View.addClass(a.View.getEl("presence_widgetstatus"),"presence_buddylist_header_pop");a.View.getEl("presence_widgetstatus").style.left="10px";a.View.getEl("presence_widgetstatus").style.top="-3px";r=""}var o='<div id="startMeetup_buddylist" class="startMeetup_buddylist" title="Start Meetup">Start Meetup</div>';
var G='<div id="chat_buddy_list_content_box">';var U='<div id="chat_buddy_search_container" class="chat_buddy_search_container"><div class="chat_buddy_search" id="chat_buddy_roster_search"><span id="chat_buddy_search_close" class="chat_buddy_search_close float_right hide"  title="'+a.getCatalog("ClearSearch")+'"></span><span class="chat_buddy_search_icon float_left"  title="'+a.getCatalog("Search")+'"></span><label for="presence_buddy_search" class="assistiveText">'+h.defaultSearchTxt+'</label><input type="text" class="lightGreyTxt input_default" id="presence_buddy_search" value="'+h.defaultSearchTxt+'" maxlength="'+presence.config.nameMaxCharLimit+'" title="'+a.getCatalog("Search")+'" /></div><div id="chat_buddy_roster_disconnect" class="chat_buddy_roster_disconnect hide"><img class="chat_error float_right" alt="loader" src="'+a.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.widgetLoading+"</div></div>";
var B='<div id="fav_popup_holder" class="fav_popup_holder hide"></div>';var t='<div id="fake_headers_holder" class="fake_headers_holder hide"><div id="umps_convList_dummy" class="followedList hide"><div class="followedList_inner"><div id="curConv_list_notify_dummy" class="newMessages expanded headers"></div><img class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png">'+a.getCatalog("conversations")+'</div></div><div id="umps_favorites_dummy" class="followedList hide"><div class="followedList_inner"><div id="fav_edt_btns_dummy"><div id="umps_fav_edit_dummy" class="fav_edit_btn float_right hide" title="'+a.getCatalog("edit")+'">'+a.getCatalog("edit")+'</div><div id="umps_fav_done_dummy" class="fav_edit_btn float_right hide" title="'+a.getCatalog("done")+'">'+a.getCatalog("done")+'</div></div><img id="fav_arrow_dummy" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png">'+a.getCatalog("favourites")+'</div></div><div id="followedList_dummy" class="followedList hide"><div class="followedList_inner"><img id="follow_arrow_dummy" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png">'+a.getCatalog("followed")+'</div></div><div id="searchList_dummy" class="followedList hide"><div class="followedList_inner"><img class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png">'+a.getCatalog("searchList")+"</div></div></div>";
var q='<div id="buddyScrollPane" class="chat_buddy_list_content_box content_box_shadow buddy_scroll_pane">';var S='<div id="buddyScrollPane_content" class="buddy_scroll_pane_content" >';var P="";var E="";if(a.BuddylistCollapsed){P='<img id="follow_arrow_image" class="right_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Expand")+'">';
E='<div id="presence_buddylist_body" class="chat_buddy_list_body last hide">'}else{P='<img id="follow_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'">';E='<div id="presence_buddylist_body" class="chat_buddy_list_body last'+K+'">'}var y='<div id="followedList" class="followedList'+K+'"><div class="followedList_inner">'+P+presence.config.catalog.followed+'<span class="hide"> (<span id="followedListCount">0 / 0</span>)</span></div></div><div class="hide" id="jiffy_tocsv">test</div>';
var F='<img id="group_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'">';var A='<div id="umps_groupList" class="followedList">'+F+presence.getCatalog("groups")+'<span class="hide"> (<span id="umps_groupListCount">0 / 0</span>)</span></div>';var D='<div id="umps_grouplist_body" class="chat_buddy_list_body">';
var R='<img id="favorites_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'">';var W='<div id="umps_favorites" class="followedList'+J+'"><div class="followedList_inner"><div id="umps_fav_edit" class="fav_edit_btn float_right hide" title="'+a.getCatalog("edit")+'">'+a.getCatalog("edit")+'</div><div id="umps_fav_done" class="fav_edit_btn float_right hide" title="'+a.getCatalog("done")+'">'+a.getCatalog("done")+"</div>"+R+presence.getCatalog("favourites")+"</div></div>";
var O='<div id="umps_favorites_body" class="chat_buddy_list_body'+J+'">';var L='<img id="conv_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'">';var H='<div id="umps_convList" class="followedList expanded hide"><div class="followedList_inner"><div id="curConv_list_notify" class="newMessages headers" title="'+a.getCatalog("NewMessage")+'"></div>'+L+presence.getCatalog("conversations")+"</div></div>";
var w='<div id="umps_convlist_body" class="chat_buddy_list_body hide">';if(a.isMeetupApp||!a.config.meetupsEnabled){o=""}var Q='<img id="search_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'">';var v='<div id="user_searchlist" class="followedList hide"><div class="followedList_inner">'+Q+presence.getCatalog("searchList")+"</div></div>";
var C='<div id="user_searchlist_body" class="chat_buddy_list_body last hide">';var x=V+presenceBuddyList+r+presenceOptions+a.closeDiv+o+G+U+B+t+q+S+H+w+a.closeDiv+W+O+a.closeDiv+y+E+a.closeDiv+v+C+a.closeDiv+a.closeDiv;if(a.config.groupChatEnabled){x+=A+D+a.closeDiv}x+=a.closeDiv+a.closeDiv+a.closeDiv+a.closeDiv+a.closeDiv+a.closeDiv;
a.View.append(a.View.getEl("chat_dock_bg_pane"),x);h.SettingsMenu=new a.View.SettingsMenu();h.HistoryPanel=new a.View.HistoryPanel();if(a.HistoryExpanded&&a.BuddyListActive){h.HistoryPanel.open(true)}g=a.View.getEl("presence_buddylist_status");l=a.View.getEl("presence_buddy_search");d=a.View.getEl("chat_buddy_search_close");
if(!a.View.PopOutWidget.active){a.View.addHandler(a.View.getEl("presence_widgetstatus"),"click",h.toggleBuddyList)}a.View.addHandler(a.View.getEl("umpswidget_help_icon"),"click",function(Y){a.View.Buddylist.searchOfffocus(Y);a.View.stopEventPropogation(Y)});if(a.BuddyListActive){a.View.Buddylist.toggleBuddyList()
}h.mainEl=a.View.getEl("presence_buddylist");a.View.addHandler(a.View.getEl("optionsMenuBtn"),"click",function(Y){a.View.stopEventPropogation(Y);h.SettingsMenu.toggle()});if(a.config.chatMsgHistoryEnabled){a.View.addHandler(a.View.getEl("HistoryListBtn"),"click",function(Y){a.View.stopEventPropogation(Y);
h.HistoryPanel.toggle(Y)})}if(a.config.App==="webmessenger"&&a.config.meetupsEnabled){a.View.addHandler(a.View.getEl("startMeetup_buddylist"),"click",function(){a.View.MeetupsLauncher.invokeMeetups("startMeetup")})}a.View.addHandler(a.View.getEl("presence_status_options_btn"),"click",function(Y){h.togglePresenceMenu(Y,true);
a.Controller.updateChatterActivity()});a.View.addHandler(a.View.getEl("optAvailable"),"click",function(){h.changePresence("AVAILABLE")});a.View.addHandler(a.View.getEl("optAway"),"click",function(){h.changePresence("AWAY")});a.View.addHandler(a.View.getEl("optUnavailable"),"click",function(){h.changePresence("UNAVAILABLE")
});a.View.addHandler(l,"keyup",h.scheduleSearch);a.View.addHandler(l,"keydown",h.searchOnKeyup);a.View.addHandler(l,"focus",h.searchOnfocus);a.View.addHandler(d,"click",h.searchOfffocus);a.View.addHandler(a.View.getEl("followedList"),"click",h.toggleFollowPanel);a.View.addHandler(a.View.getEl("user_searchlist"),"click",h.toggleSearchPanel);
a.View.addHandler(a.View.getEl("jiffy_tocsv"),"click",function(){Jiffy.toCSV()});if(a.config.groupChatEnabled){a.View.addHandler(a.View.getEl("umps_groupList"),"click",h.toggleGroupPanel)}a.View.addHandler(a.View.getEl("umps_convList"),"click",h.toggleConversationPanel);a.View.addHandler(a.View.getEl("umps_favorites"),"click",h.toggleFavoritesPanel);
a.View.addHandler(a.View.getEl("umps_fav_edit"),"click",function(Y){h.Favorites.editModeOn(Y);h.toggleFavoritesPanel(true);a.View.focusEle("umps_fav_done")});a.View.addHandler(a.View.getEl("umps_fav_done"),"click",function(Y){a.View.stopEventPropogation(Y);h.Favorites.editModeOff();a.View.focusEle("umps_fav_edit")
});a.View.addHandler(a.View.getEl("chat_feedback_link"),"click",function(Y){a.View.Buddylist.searchOfffocus(Y);a.View.stopEventPropogation(Y)});if(!h.tooltip){h.tooltip=a.View.createEl("div",{id:"umps_tooltip",className:"presence_chat_widget tooltip hide"});h.tooltip.style.display="none";canvas_doc.body.appendChild(h.tooltip)
}h.ChatList.paintList();h.Favorites.paintList();if(b.state.rosterLoaded){h.paintBuddyList()}else{a.View.html(a.View.getEl("presence_buddylist_body"),'<div id="presence_buddylist_empty_ele1" class="presence_buddylist_empty">'+a.getCatalog("Loading")+"</div>")}if(a.isOffline){a.isOffline=false;h.toggleBuddyList();
a.View.focusEle("presence_widgetstatus")}if(parseInt(b.presenceStatus)==20){a.isOffline=true;a.View.addClass(a.View.getEl("popout_chat_min"),"hide")}if(!h.overlayPanel){h.overlayPanel=new a.View.OverlayPanel({overlayTitle:a.getCatalog("Preferences"),width:"650px",height:"400px"});h.prefPanel=new a.View.PreferencesPanel();
h.prefPanel.init();h.overlayPanel.html(h.prefPanel.panel)}if(a.View.PopOutWidget.active){if(a.View.getEl("roster_hide_arrow_container")){a.View.addHandler(a.View.getEl("roster_hide_arrow_container"),"click",h.toggleHide)}a.View.addHandler(canvas_window,"resize",h.resize);h.resize();if(popOut_ChatSubspaceId){h.toggleHide()
}}try{a.View.RosterHeaders.init();h.buddyScrollBar=new a.View.CustomScrollBar({scrollPane:a.View.getEl("buddyScrollPane_content"),scrollMainPan:a.View.getEl("buddyScrollPane"),callback:a.View.RosterHeaders.stickyHeaders});h.buddyScrollBar.setHeight(a.View.getEl("buddyScrollPane").offsetHeight);Jiffy.measure("Done","RosterInit");
a.View.RosterParticipantsList.init();k=a.View.getByClass(a.View.getEl("presence_status_options"),"menu_box_list",false);j=new a.View.Navigate(a.View.getEl("presence_status_options"),k,"select")}catch(u){a.log("err.message"+u.message)}h.initializeAccessibility();a.View.updateAltAttrByTag(a.View.getEl("presence_widget"),"img")
};h.initializeAccessibility=function(){new a.View.Accessibility({id:"umps_favorites"});if(a.config.orgWideSearchEnabled){new a.View.Accessibility({id:"user_searchlist"})}new a.View.Accessibility({id:"umps_fav_edit"});new a.View.Accessibility({id:"umps_fav_done"});new a.View.Accessibility({id:"popout_chat_min",onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("presence_widgetstatus");
return false}return true}});new a.View.Accessibility({id:"popout_chat",onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("presence_widgetstatus")}else{a.View.focusEle("options_mink_menu_id")}}});new a.View.Accessibility({id:"presence_buddy_search",onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("help_grey_icon_id")
}else{if(!a.View.hasClass(a.View.getEl("umps_convList"),"hide")){a.View.focusEle("umps_convList")}else{if(!a.View.hasClass(a.View.getEl("umps_favorites"),"hide")){a.View.focusEle("umps_favorites")}else{if(!a.View.hasClass(a.View.getEl("followedList"),"hide")){a.View.focusEle("followedList")}}}}}});new a.View.Accessibility({id:"presence_widgetstatus",onTabClick:function(){if(e.shiftKey===true){return true
}if(a.BuddyListActive){a.View.focusEle("popout_chat")}else{a.View.focusEle("popout_chat_min")}return false}});new a.View.Accessibility({id:"followedList",onTabClick:function(o){h.buddyScrollBar._scrollto_panel(a.View.getEl("followedList").offsetTop);return true}});new a.View.Accessibility({id:"help_grey_icon_id",onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("settings_menu_btn")
}else{a.View.focusEle("presence_buddy_search")}}});new a.View.Accessibility({id:"options_mink_menu_id",click:function(){a.View.dispatchClickEvent(a.View.getEl("presence_status_options_btn"))},onTabClick:function(o){if(o.shiftKey===true){if(a.BuddyListActive){a.View.focusEle("popout_chat")}else{a.View.focusEle("popout_chat_min")
}}else{a.View.focusEle("history_icon_id")}}});new a.View.Accessibility({id:"settings_menu_btn",click:function(){a.View.dispatchClickEvent(a.View.getEl("optionsMenuBtn"));a.View.getEl("settings_menu_boxId").focus()},onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("history_icon_id")}else{a.View.focusEle("help_grey_icon_id")
}}});new a.View.Accessibility({id:"presence_status_options",onEscape:function(){h.togglePresenceMenu(null,true);a.View.focusEle("options_mink_menu_id")},onChildEnter:function(){a.View.focusEle("options_mink_menu_id")},isList:true,onChildSelect:"select",showOutline:false,childIdStartWith:"opt",onTabClick:function(){h.togglePresenceMenu(null,true);
a.View.focusEle("options_mink_menu_id")}});new a.View.Accessibility({id:"settings_menu_boxId",onEscape:function(){h.SettingsMenu.toggle();a.View.focusEle("settings_menu_btn")},onChildEnter:function(o){if(o.innerText==a.getCatalog("PreferencesMenuText")||o.textContent==a.getCatalog("PreferencesMenuText")){a.View.focusEle("help_chat_options");
return}a.View.focusEle("settings_menu_btn")},isList:true,showOutline:false,onChildSelect:"select",childIdStartWith:"menu_box_list",onTabClick:function(){h.SettingsMenu.toggle();a.View.focusEle("settings_menu_btn")}});new a.View.Accessibility({id:"history_icon_id",click:function(){a.View.dispatchClickEvent(a.View.getEl("HistoryListBtn"))
},onTabClick:function(o){if(o.shiftKey===true){a.View.focusEle("options_mink_menu_id")}else{a.View.getEl("settings_menu_btn").focus()}}});new a.View.Accessibility({id:"umps_favorites_body",isList:true,childIdStartWith:"umps_fav_",onChildSelect:"select",customScrollbar:h.buddyScrollBar,onChildEnter:function(p){var o=a.View.getEl(p.id+"_name");
if(o){a.View.dispatchClickEvent(o)}}});new a.View.Accessibility({id:"user_searchlist_body",isList:true,childIdStartWith:"searchbuddy_",customScrollbar:h.buddyScrollBar,onChildSelect:"select"});new a.View.Accessibility({id:"presence_buddylist_body",isList:true,childIdStartWith:"buddy_",onChildSelect:"select",customScrollbar:h.buddyScrollBar});
new a.View.Accessibility({id:"umps_convList"});new a.View.Accessibility({id:"umps_convlist_body",isList:true,childIdStartWith:"umps_chat_umps_",onChildSelect:"select",customScrollbar:h.buddyScrollBar})};h.paintBuddyList=function(r,y,x){Jiffy.mark("PaintBuddyList");var p=r?r:b.users;if(!r&&(h.searchActive||h.favEditActive)){return
}var v=a.View.getEl("presence_buddylist_body");if(y){a.View.removeClass(v,"last")}else{a.View.addClass(v,"last")}var o=a.View.getEl("buddyScrollPane");var w=canvas_doc.createDocumentFragment();if(p){a.onlineBuddyCount=0;a.totalBuddyCount=0;for(var u in p){if(p[u].isAnonymous!=true){if(p[u].presenceStatus!=a.presenceStatus.UNAVAILABLE){var q=h.buddyEl(p[u]);
q.onclick=function(z){return function(){h.onUserClick(z)}}(p[u].id);w.appendChild(q);a.onlineBuddyCount++}else{if(a.hideOfflineUsers||h.searchActive||h.favEditActive){var q=h.buddyEl(p[u]);q.onclick=function(z){return function(){h.onUserClick(z);try{if(h.Favorites.curEditEl){h.Favorites.curEditEl.blur()
}}catch(A){}a.View.Actions.parentMouseDownListener()}}(p[u].id);w.appendChild(q)}}a.totalBuddyCount++}}h.scrollTop=o.scrollTop;v.innerHTML="";v.appendChild(w);if(a.onlineBuddyCount<1&&v.innerHTML==""){var t='<div id="presence_buddylist_empty" class="presence_buddylist_empty">'+presence.config.catalog.noBuddies+"</div>";
a.View.html(v,t)}h.updateBuddyCount();if(!h.searchActive&&!h.favEditActive&&(!x||x.length!=1)){h.setPanelHeight()}o.scrollTop=h.scrollTop;a.View.updateAltAttrByTag(v,"img");Jiffy.measure("Done","PaintBuddyList")}};h.paintGroupList=function(o){};h.updateMessageCount=function(q){var p=a.View.getEl("buddy_list_notify");
var t=a.View.getEl("curConv_list_notify");var v=a.View.getEl("curConv_list_notify_dummy");window.clearTimeout(a.messageCountTimer);a.log("Buddylist.updateMessageCount: "+q);if(q===undefined||q<0){var u=a.View.WindowManager.getWindows(),r=0;for(var o in u){if(u[o].isActive&&!u[o].isPopped){if(u[o].msgCount>0){u[o].hasUnreadMessages=true
}else{u[o].hasUnreadMessages=false}r+=u[o].msgCount}}q=r}if(q<=0||b.presenceStatus==20){a.View.addClass(p,"hide");a.View.addClass(t,"hide");a.View.addClass(v,"hide")}else{a.View.removeClass(p,"hide");a.View.removeClass(t,"hide");a.View.removeClass(v,"hide")}return q};h.buddyEl=function(o){if(!o.picture){o.picture=a.imageLocation+"/blankman200.png"
}if(o.presenceStatus==a.presenceStatus.AWAY){presenceClassName="chat_buddy_list_display away"}else{if(o.presenceStatus==a.presenceStatus.IDLE){presenceClassName="chat_buddy_list_display idle"}else{if(o.presenceStatus==a.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_list_display offline"}else{presenceClassName="chat_buddy_list_display active"
}}}var t=b.users[o.id].getName();var r=a.View.escapeHtml(t);if(o._startIndex!==undefined){t=a.View.escapeHtml(t.substring(0,o._startIndex))+"<span class='search_highlight'>"+a.View.escapeHtml(t.substring(o._startIndex,o._endIndex))+"</span>"+a.View.escapeHtml(t.substring(o._endIndex))}else{t=a.View.escapeHtml(t)
}var v='<img id="buddy_'+o.id+'_image" class="chat_buddy_list_img" src="'+o.picture+'">',q='<span id="buddy_'+o.id+'_name" class="chat_buddy_list_name">'+t+"</span>",p='<img class="chat_buddy_status_img float_right" src="'+a.imageLocation+'/1pxDummy.png" >';var u=a.View.createEl("div",{id:"buddy_"+o.id+"",className:""+presenceClassName+"",title:a.View.escapeStr(r)});
u.setAttribute("buddyid",o.id);a.View.html(u,p+v+q);h.makeItemDraggable(u,{userId:o.id,type:"user"});return u};h.constructBuddyEl=function(o){if(b.users[o.id]){o.presenceStatus=b.users[o.id].presenceStatus}if(!o.picture){o.picture=a.imageLocation+"/blankman200.png"}if(o.presenceStatus==a.presenceStatus.AWAY){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display away"
}else{if(o.presenceStatus==a.presenceStatus.IDLE){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display idle"}else{if(o.presenceStatus==a.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display offline"}else{presenceClassName="chat_buddy_list_display chat_search_buddy_list_display active"
}}}var t=o.getName();var r=a.View.escapeHtml(t);var q=o.title;if(o._startIndex!==undefined){t=a.View.escapeHtml(t.substring(0,o._startIndex))+"<span class='search_highlight'>"+a.View.escapeHtml(t.substring(o._startIndex,o._endIndex))+"</span>"+a.View.escapeHtml(t.substring(o._endIndex))}else{t=a.View.escapeHtml(t)
}var w='<img id="buddy_'+o.id+'_image" class="chat_buddy_list_img" src="'+o.picture+'">',v='<span id="buddy_'+o.id+'_name" class="chat_buddy_list_name chat_search_buddy_list_name">'+t+'<br /><span id="buddy_'+o.id+'_title" class="lightGreyTxt" style="font-size:10px;">'+q+"</span></span>",p='<img class="chat_buddy_status_img float_right" src="'+a.imageLocation+'/1pxDummy.png" >';
if(q==""){presenceClassName=presenceClassName.replace("chat_search_buddy_list_display","");v='<span id="buddy_'+o.id+'_name" class="chat_buddy_list_name">'+t+"</span>"}var u=a.View.createEl("div",{id:"searchbuddy_"+o.id+"",className:""+presenceClassName+"",title:a.View.escapeStr(r)});u.setAttribute("buddyid",o.id);
a.View.html(u,p+w+v);h.makeItemDraggable(u,{userId:o.id,type:"searchuser"});return u};h.makeItemDraggable=function(q,o){var p;new a.View.Draggable(q,function(r,t){if(o.source=="favorites"&&h.Favorites.editMode){return}if(r=="dragstart"){p=a.View.createEl("div",{className:"presence_chat_widget buddy_drag_clone"});
p.appendChild(q.cloneNode(true));canvas_doc.body.appendChild(p)}else{if(r=="drag"){p.style.left=(t.lastX+15)+"px";p.style.top=(t.lastY+10)+"px"}else{if(r=="dragend"){canvas_doc.body.removeChild(p)}else{if(r=="dropAllowed"){a.View.removeClass(p,"denied");a.View.addClass(p,"allowed")}else{if(r=="dropDenied"){a.View.removeClass(p,"allowed");
a.View.addClass(p,"denied")}else{if(r=="dropCleared"){a.View.removeClass(p,"allowed");a.View.removeClass(p,"denied")}}}}}}},canvas_doc,o)};h.groupEl=function(o){};h.addBuddy=function(q){if(h.searchActive||q.isAnonymous==true||h.favEditActive){return}var p=a.View.getEl("buddy_"+q.id);if(!p){var o=a.View.getEl("presence_buddylist_body");
o.appendChild(h.buddyEl(q));a.onlineBuddyCount++;h.updateBuddyCount()}};h.removeBuddy=function(p){if(h.searchActive||h.favEditActive){return}var o=a.View.getEl("buddy_"+p.id);var q=a.View.getEl("presence_buddylist_body");if(o&&q){if(a.View.remove("presence_buddylist_body","buddy_"+p.id)){a.onlineBuddyCount--
}}h.updateBuddyCount()};h.updateBuddy=function(o){var p=a.View.getEl("buddy_"+o.id);if(p){p.parentNode.replaceChild(h.buddyEl(o),p)}};h.addGroup=function(o){};h.removeGroup=function(o){};h.updateGroup=function(o){};h.groupCounterUpdated=function(o){};h.groupMuted=function(o){};h.groupUnmuted=function(o){};
h.onGroupMessage=function(o){};h.onUserClick=function(o){a.View.Actions.parentMouseDownListener();a.View.RosterHeaders.hideDummyHeaders();if(a.createWorkspaceRequestsWithUuid[o]&&a.createWorkspaceRequestsWithUuid[o].isDisabled){a.View.WindowManager.searchSubspace(o,false,false,false,{showHistoryIcon:false})
}else{a.View.WindowManager.searchSubspace(o,"")}};h.onGroupClick=function(o){a.View.WindowManager.joinGroupChat(o)};h.onChatClick=function(o){Jiffy.mark("OnChatClick");a.View.Actions.parentMouseDownListener();a.View.RosterHeaders.hideDummyHeaders();a.View.WindowManager.openConversation(o.id);Jiffy.measure("Done","OnChatClick")
};h.onFavoriteClick=function(p){a.View.Actions.parentMouseDownListener();a.View.RosterHeaders.hideDummyHeaders();var o;if(a.config.chatMsgDeepHistoryEnabled){o={chatSessionId:b.favorites[p].chatSessionId}}else{o={chatSessionType:2}}a.View.WindowManager.searchSubspace(b.favorites[p].entityIds,null,null,false,o)
};h.updateBuddyCount=function(){if(a.onlineBuddyCount<0){a.onlineBuddyCount=0}if(a.onlineBuddyCount>=0){if(a.onlineBuddyCount>0&&a.View.getEl("presence_buddylist_empty")){a.View.getEl("presence_buddylist_body").removeChild(a.View.getEl("presence_buddylist_empty"))}a.View.html(a.View.getEl("followedListCount"),a.onlineBuddyCount+" / "+a.totalBuddyCount)
}};h.buildPresenceOptions=function(){var r='<span class="options_mink_menu float_left" id="options_mink_menu_id"><a id="presence_status_options_btn" tabindex="-1" href="javascript:void(0);" onclick="return false;" class="roster_menu_btn" title="'+a.getCatalog("ChangeStatus")+'" >';var o='<ul id="presence_status_options" class="options_menu menu_box_shadow hide" tabindex="513">';
var p=null;var u="";var t=h.getPresenceClass(b.presenceStatus);for(variable in a.presenceStatus){if(a.presenceStatus[variable]==b.presenceStatus){var q="";q='<span id="buddylist_presence_status" class="'+h.getPresenceClass(b.presenceStatus)+'"><img class="chat_buddy_status_img float_left" alt="'+(t=="offline"?a.getCatalog("unavailable"):a.getCatalog(t))+'" border="0" src="'+a.imageLocation+'/1pxDummy.png"></span>';
r+=q+'<span id="buddylist_presence_text" class="underline_hover">'+presence.config.catalog[variable.toLowerCase()]+'</span><img src="'+a.imageLocation+'/1pxDummy.png" class="down_arrow"  border="0"/></a></span>';p='<li class="presence_mink"><a class="roster_menu_btn"><span id="buddylist_presence_status_mink" class="'+h.getPresenceClass(b.presenceStatus)+'"><img class="chat_buddy_status_img float_left" alt="'+(t=="offline"?a.getCatalog("unavailable"):a.getCatalog(t))+'" border="0" src="'+a.imageLocation+'/1pxDummy.png"></span><span id="buddylist_presence_text_mink" class="underline_hover">'+presence.config.catalog[variable.toLowerCase()]+'</span><img src="'+a.imageLocation+'/1pxDummy.png" class="down_arrow" /></a></li>';
a.CurPresenceEl=variable}if(variable!="IDLE"){u+='<li id="opt'+a.View.toTitleCase(variable)+'" presenceStat="'+variable+'" class="menu_box_list '+h.getPresenceClass(a.presenceStatus[variable])+'" tabindex="1"><img src="'+a.imageLocation+'/1pxDummy.png" class="chat_buddy_status_img float_left" alt="'+(t=="offline"?a.getCatalog("unavailable"):a.getCatalog(t))+'"  border="0" /> '+presence.config.catalog[variable.toLowerCase()]+"   </li>"
}}return r+o+p+u+"</ul>"};h.changePresence=function(q){if(q){a.CurPresenceEl=q;h.togglePresenceMenu()}var o=a.presenceStatus[a.CurPresenceEl];if(o!=b.presenceStatus){h.updatePresenceUI(o,a.CurPresenceEl);if(o!=20){var p={presenceStatus:{status:o,message:a.View.toTitleCase(a.View.getPresenceMessage(o))}};
a.Controller.call({method:"setPresence",data:p,successCallBack:h.changePresenceSuccess,failCallBack:h.changePresenceFailed});a.EventManager.trigger("event.owner.presence.status",a.Model.Owner.getInstance())}else{if(a.View.PopOutWidget.active){a.View.PopOutWidget.close(false,true)}else{h.closeChannel()
}}}};h.onOwnerPresence=function(){if(b.channelState=="idle"&&b.presenceStatus!=100){return h.updatePresenceUI(a.presenceStatus.IDLE,"IDLE")}for(variable in a.presenceStatus){if(a.presenceStatus[variable]==b.presenceStatus){a.CurPresenceEl=variable;var o=a.presenceStatus[a.CurPresenceEl];h.updatePresenceUI(o,a.CurPresenceEl)
}}};h.changePresenceSuccess=function(){a.log("presence Status set success","info")};h.changePresenceFailed=function(){a.View.Actions.showWidgetLoader();a.View.Actions.widgetLoadFailed();a.log("problem in presence Status change","error")};h.getPresenceClass=function(o){if(o==a.presenceStatus.AWAY){return"away"
}else{if(o==a.presenceStatus.IDLE){return"idle"}else{if(o==a.presenceStatus.UNAVAILABLE){return"offline"}else{return"active"}}}};h.updatePresenceUI=function(o,q){Jiffy.mark("StatusChangeByUser");b.presenceStatus=o;var p="";p=a.View.getEl("buddylist_presence_status");var t=a.View.getEl("buddylist_presence_status_mink");
var r=a.View.getEl("presence_buddylist_presence_status");a.View.html(a.View.getEl("buddylist_presence_text"),presence.config.catalog[q.toLowerCase()]);a.View.html(a.View.getEl("buddylist_presence_text_mink"),presence.config.catalog[q.toLowerCase()]);a.View.setClass(p,h.getPresenceClass(o));a.View.setClass(t,h.getPresenceClass(o));
a.View.setClass(r,h.getPresenceClass(o));for(variable in a.presenceStatus){a.View.removeClass(a.View.getEl("opt"+a.View.toTitleCase(variable)),"active");if(variable==a.CurPresenceEl){a.View.addClass(a.View.getEl("opt"+a.View.toTitleCase(variable)),"active")}}Jiffy.measure("Done","StatusChangeByUser")
};a.View.getPresenceMessage=function(o){for(variable in a.presenceStatus){if(a.presenceStatus[variable]==o){return variable}}return""};h.toggleBuddyList=function(p){Jiffy.mark("RosterMaximize");Jiffy.mark("RosterMinimize");var u=a.View.getEl("presence_main");a.View.RosterHeaders.hideDummyHeaders();var o=a.Model.Owner.getInstance();
if(a.View.hasClass(u,"chat_pan_active")){a.BuddyListActive=false;if(a.isIE){window.setTimeout(function(){a.log("toggleBuddyList with timeout");a.View.removeClass(u,"chat_pan_active");a.View.getEl("buddyScrollPane").style.height="";if(a.View.WindowManager.curWindow){a.View.WindowManager.curWindow.minimize()
}if(h.HistoryPanel&&h.HistoryPanel.isOpen){h.HistoryPanel.close(true)}},10)}else{a.View.removeClass(u,"chat_pan_active");a.log("toggleBuddyList");a.View.getEl("buddyScrollPane").style.height="";if(a.View.WindowManager.curWindow){a.View.WindowManager.curWindow.minimize()}if(h.HistoryPanel&&h.HistoryPanel.isOpen){h.HistoryPanel.close(true)
}}o.state.rosterExpanded=false;a.View.Actions.sendCustomEvent({event:"rosterCollapsed"});Jiffy.measure("Done","RosterMinimize")}else{if(p!==true){if(a.isOffline){try{a.Controller.doChatterConnect(function(v){a.View.Actions.showWidgetLoader();a.Controller.init(controllerInitData,true);a.setCookie("umps_status","")
},function(w){try{if(canvas_window.umpsdoPageReload){canvas_window.umpsdoPageReload()}}catch(v){}})}catch(r){}}else{a.View.addClass(u,"chat_pan_active");a.BuddyListActive=true;h.setPanelHeight();a.View.removeClass(a.View.getEl("popout_chat_min"),"hide");Jiffy.measure("Done","RosterMaximize");if(a.View.WindowManager.curWindow){var t=a.View.WindowManager.curWindow.msgCount;
a.View.WindowManager.curWindow.maximizeAndFocus();if(t){var q=h.updateMessageCount()}}if(a.HistoryExpanded){h.HistoryPanel.open(true)}o.state.rosterExpanded=true;a.View.Actions.sendCustomEvent({event:"rosterExpanded"})}}}};h.setPanelHeight=function(r){if(a.BuddyListActive){var v=a.View.getEl("buddyScrollPane"),q;
if(!v){return}v.style.height="";var p=a.View.getEl("presence_buddylist").offsetHeight;var t=0;if(!a.View.PopOutWidget.active){t=a.View.getEl("presence_widgetstatus").offsetHeight}var B=a.View.getEl("chat_buddy_list_menus").offsetHeight;var z=a.View.getEl("startMeetup_buddylist"),y=0;if(z&&a.config.App==="webmessenger"&&a.config.meetupsEnabled){y=z.offsetHeight
}var C=a.View.getEl("chat_buddy_search_container").offsetHeight;var w;if(a.isIE){w=(canvas_doc.documentElement.clientHeight!=0)?(canvas_doc.documentElement.clientHeight-13):a.config.defaultHeight}else{w=(canvas_window.innerHeight!=0)?canvas_window.innerHeight:a.config.defaultHeight}var o=w-a.config.headerHeight;
var x=t+B+C+y;a.log("maxAllowedHeight::"+o+" buddyScrollPane::"+p);if(r&&r==true){p=o}if(p>o){var A=o;if(A>a.config.rosterMinHeight){q=(A-x)}else{q=(a.config.rosterMinHeight-x)}}else{if(p<a.config.rosterMinHeight){q=(a.config.rosterMinHeight-x)}else{q=(p-x)}}v.style.height=q+"px";h.height=q;if(h.buddyScrollBar){h.buddyScrollBar.setHeight(q)
}a.View.PopOutWidget.setRosterHeight();var u=a.View.WindowManager.curWindow;presence.config.maxChatWindowHeight=q-20;if(!a.View.PopOutWidget.active&&u&&u.chatPanelContainer.offsetHeight>presence.config.maxChatWindowHeight){a.View.WindowManager.curWindow._resizeChatWindow(null,presence.config.maxChatWindowHeight)
}}};h.closeChannel=function(o,r){var q={channelId:b.channelId};if(!o&&!(a.View.PopOutWidget.active&&!r)){if(a.config.screenShareEnabled&&(b.isViewingScreen||b.isSharingScreen)){var p=null;if(b.sharingSubspaceId){p=b.sharingSubspaceId}else{if(b.viewingSubspaceId){p=b.viewingSubspaceId}}if(p){a.View.ScreenShare.onCloseChannel(p)
}}a.Controller.call({method:"closeDevice",data:q,successCallBack:h.closeChannelSuccess,failCallBack:h.closeChannelFailure});a.setCookie("umps_status","offline",new Date((new Date().getTime())+1000*60*60*24*30))}else{a.Controller.call({method:"closechannel",data:q,successCallBack:h.closeChannelSuccess,failCallBack:h.closeChannelFailure})
}h.updateMessageCount(0);a.View.Actions.resetTitle();h.setBuddylistOffline(o)};h.closeChannelSuccess=function(){a.log("closeChannel success ","info");if(a.View.PopOutWidget.active){canvas_window.close()}h.updateMessageCount(0)};h.closeChannelFailure=function(){a.log("closeChannel success ","info");if(a.View.PopOutWidget.active){canvas_window.close()
}h.updateMessageCount(0)};h.setBuddylistOffline=function(p){a.EventManager.trigger("event.owner.went.offline",{});a.isOffline=true;if(a.View.PopOutWidget.active){return}h.toggleBuddyList(p);a.View.addClass(a.View.getEl("popout_chat_min"),"hide");if(a.View.Buddylist.overlayPanel){a.View.Buddylist.overlayPanel.hide()
}a.View.WindowManager.closeAllWindows();var o=a.View.getEl("presence_chat_container");o.parentNode.removeChild(o);a.resetValues()};h.togglePresenceMenu=function(q,p){Jiffy.mark("TogglePresenceMenu");a.View.Buddylist.searchOfffocus(q);a.View.WindowManager.popupPanel.hide();var o=a.View.getEl("presence_status_options");
h.resetNavigationIndex();if(p==true){if(a.View.hasClass(o,"hide")){a.View.removeClass(o,"hide");a.View.stopEventPropogation(q);h.SettingsMenu.hide();k[0].focus();o.focus();a.View.addClass(k[0],"select");a.View.addHandler(canvas_doc,"click",h.togglePresenceMenu)}else{a.View.addClass(o,"hide");a.View.removeHandler(canvas_doc,"click",h.togglePresenceMenu)
}}else{a.View.addClass(o,"hide");a.View.removeHandler(canvas_doc,"click",h.togglePresenceMenu)}Jiffy.measure("Done","TogglePresenceMenu")};h.resetNavigationIndex=function(){m.navigatePresenceOptionsIndex=j.getCurrentIndex();try{a.View.removeClass(k[m.navigatePresenceOptionsIndex],"select")}catch(o){}j.resetCurrentIndex()
};h.toggleOptionsMenu=function(o,p){Jiffy.mark("ToggleOptionsMenu");a.View.Buddylist.searchOfffocus(o);a.View.WindowManager.popupPanel.hide();h.togglePresenceMenu(false);if(a.config.App==="webmessenger"&&a.config.meetupsEnabled&&a.View.MeetupsLauncher){if(a.View.MeetupsLauncher.overlayPanel){a.View.MeetupsLauncher.overlayPanel.hide()
}}h.overlayPanel.show();h.prefPanel.showPanel();a.View.stopEventPropogation(o);Jiffy.measure("Done","ToggleOptionsMenu")};h.autoSetAway=function(){var o=a.View.getEl("setAway");if(a.setAutoidle){a.setAutoidle=false;a.View.removeClass(o,"active")}else{a.setAutoidle=true;a.View.addClass(o,"active")}};h.hideOffline=function(){var o=a.View.getEl("hideOffline");
if(a.hideOfflineUsers){a.hideOfflineUsers=false;a.View.addClass(o,"active")}else{a.hideOfflineUsers=true;a.View.removeClass(o,"active")}h.paintBuddyList()};h.scheduleSearch=function(p){var p=window.event||p;var o=p.charCode||p.keyCode;if(o==27){l.blur();h.searchOfffocus(p)}else{if(!h.searchScheduled){h.searchScheduled=true;
window.setTimeout(function(){h.search(o)},600)}}};h.searchOnfocus=function(){a.View.Actions.closeAllPopups();a.View.removeClass(l,"lightGreyTxt");a.View.removeClass(d,"hide");a.View.removeClass(l,"input_default");if(l.value==h.defaultSearchTxt){l.value=""}};h.searchOfffocus=function(o){clearTimeout(h.clrSearchTimer);
if(a.isOffline||popOut_ChatSubspaceId){return}var p=a.View.getTrimString(l.value);if(p==h.defaultSearchTxt){return}a.View.addClass(d,"hide");a.View.addClass(l,"input_default");l.blur();l.value="";h.search();a.View.addClass(l,"lightGreyTxt");l.value=h.defaultSearchTxt};h.navigateSearch=function(r){var u=a.View.getTrimString(l.value);
if(r&&(r==38||r==40||r==13)&&u.length>0&&u!=presence.config.catalog.searchDefaultText){a.log("keyunicode:::"+r);var p=a.View.getEl("presence_buddylist_body").childNodes;var q=a.View.getEl("umps_grouplist_body");q=q?q.childNodes:[];var v={up:38,down:40,enter:13};switch(r){case v.up:try{a.View.removeClass(q[c],"select")
}catch(t){}if(n=="Groups"&&q.length>0){if((c-1)>=0){c=c-1;a.View.addClass(q[c],"select")}else{if(a.View.hasClass(p[0],"presence_buddylist_empty")){a.View.addClass(q[c],"select")}else{n="Users";c=p.length}}}if(n=="Users"&p.length>0){if((c-1)>=0){try{a.View.removeClass(p[c],"select")}catch(t){}c=c-1;a.View.addClass(p[c],"select");
n="Users"}}break;case v.down:try{a.View.removeClass(p[c],"select")}catch(t){}if(n=="Users"&p.length>0){if((c+1)<p.length){c=c+1;a.View.addClass(p[c],"select");n="Users"}else{if(a.View.hasClass(q[0],"presence_buddylist_empty")||!a.config.groupChatEnabled){a.View.addClass(p[c],"select")}else{n="Groups";
c=-1}}}if(n=="Groups"&&q.length>0){if((c+1)<q.length){try{a.View.removeClass(q[c],"select")}catch(t){}c=c+1;a.View.addClass(q[c],"select")}}break;case v.enter:var o=null;if(n=="Users"){o=p[c].getAttribute("buddyid");if(b.users[o].presenceStatus!=20){h.onUserClick(o);h.searchOfffocus()}}else{if(n=="Groups"){o=q[c].getAttribute("groupid");
h.onGroupClick(o);h.searchOfffocus()}}break}}};h.searchOnKeyup=function(p){var p=window.event||p;var o=p.charCode||p.keyCode;if(o==27){a.View.cancelEvent(p);return false}};h.search=function(t){i=0;Jiffy.mark("RosterSearch");clearTimeout(h.clrSearchTimer);var v=a.View.getTrimString(l.value);if(v.length<2||v==h.defaultSearchTxt){h.searchActive=false;
h.paintBuddyList(null,null,v);if(a.config.groupChatEnabled){h.paintGroupList()}h.ChatList.paintList(null,v);h.Favorites.paintList(null,v);if(a.config.orgWideSearchEnabled){var p=a.View.OrgSearchCache.getInstance();p.updateCurrentSearchString(v);h.OrgSearchList.paintList()}h.searchScheduled=false;return
}if(!h.searchActive){h.searchBegin=true}h.searchActive=true;var q=new a.View.Search();var o=q.doSearch(v);if(a.config.orgWideSearchEnabled){h.paintBuddyList(o,true)}else{h.paintBuddyList(o)}var u=q.doConversationSearch(v);h.ChatList.paintList(u);var r=q.doFavoriteSearch(v);h.Favorites.paintList(r);if(a.config.orgWideSearchEnabled){q.doOrgSearch(v,h.OrgSearchList.paintList,null,null,"roster")
}h.searchScheduled=false;h.clrSearchTimer=setTimeout(function(w){l.blur();h.searchOfffocus(w)},a.config.clearSearchTime);Jiffy.measure("Done","RosterSearch")};h.toggleFollowPanel=function(q){var p=a.View.getEl("presence_buddylist_body");var o=a.View.getEl("follow_arrow_image");if(a.View.hasClass(p,"hide")||q==true){a.BuddylistCollapsed=false;
a.View.removeClass(p,"hide");a.View.setClass(o,"down_arrow");o.title=a.getCatalog("Collapse")}else{a.BuddylistCollapsed=true;a.View.addClass(p,"hide");a.View.setClass(o,"right_arrow");o.title=a.getCatalog("Expand")}a.View.RosterHeaders.hideDummyHeaders();h.setPanelHeight()};h.toggleSearchPanel=function(p){var o=a.View.getEl("user_searchlist_body");
var q=a.View.getEl("search_arrow_image");if(a.View.hasClass(o,"hide")||p==true){a.View.removeClass(o,"hide");a.View.setClass(q,"down_arrow");q.title=a.getCatalog("Collapse")}else{a.View.addClass(o,"hide");a.View.setClass(q,"right_arrow");q.title=a.getCatalog("Expand")}a.View.RosterHeaders.hideDummyHeaders();
h.setPanelHeight()};h.toggleGroupPanel=function(){var p=a.View.getEl("umps_grouplist_body");var o=a.View.getEl("group_arrow_image");if(a.View.hasClass(p,"hide")){a.View.removeClass(p,"hide");a.View.setClass(o,"down_arrow");o.title=a.getCatalog("Collapse")}else{a.View.addClass(p,"hide");a.View.setClass(o,"right_arrow");
o.title=a.getCatalog("Expand")}h.setPanelHeight()};h.toggleConversationPanel=function(r){var q=a.View.getEl("umps_convlist_body");var p=a.View.getEl("conv_arrow_image");var o=a.View.getEl("umps_convList");if(a.View.hasClass(q,"hide")||r==true){a.conversationCollapsed=false;a.View.removeClass(q,"hide");
a.View.addClass(o,"expanded");a.View.setClass(p,"down_arrow");p.title=a.getCatalog("Collapse")}else{a.conversationCollapsed=true;a.View.addClass(q,"hide");a.View.removeClass(o,"expanded");a.View.setClass(p,"right_arrow");p.title=a.getCatalog("Expand")}a.View.RosterHeaders.hideDummyHeaders();h.setPanelHeight()
};h.toggleFavoritesPanel=function(q){var p=a.View.getEl("umps_favorites_body");var o=a.View.getEl("favorites_arrow_image");if(a.View.hasClass(p,"hide")||q==true){a.favoritesCollapsed=false;a.View.removeClass(p,"hide");a.View.setClass(o,"down_arrow");o.title=a.getCatalog("Collapse")}else{a.favoritesCollapsed=true;
a.View.addClass(p,"hide");a.View.setClass(o,"right_arrow");o.title=a.getCatalog("Expand")}a.View.RosterHeaders.hideDummyHeaders();h.setPanelHeight()};h.resize=function(){a.View.getEl("presence_widgetstatus").style.width=(a.getBrowserWidth()-20)+"px";a.View.getEl("roster_hide_arrow_container").style.marginTop="-"+(a.getBrowserHeight()/2-25)+"px";
if(!a.BuddyListActive){a.View.getEl("roster_hide_arrow_container").style.right="5px"}else{a.View.getEl("roster_hide_arrow_container").style.right="228px"}};h.toggleHide=function(){a.log("Buddylist: toggleHide ","info");var o=a.View.getEl("toggle_roster_arrow");var p=a.View.getEl("presence_main");var q=a.View.getEl("roster_hide_arrow_container");
if(a.View.hasClass(p,"hide")){h.setPanelHeight();a.BuddyListActive=true;a.View.removeClass(p,"hide");a.View.setClass(o,"right");a.View.WindowManager.updateRightMargin(280);q.style.right="228px";a.log("Buddylist: toggleHide - show ","info")}else{a.BuddyListActive=false;a.View.addClass(p,"hide");a.View.setClass(o,"left");
a.View.WindowManager.updateRightMargin(54);q.style.right="5px";a.log("Buddylist: toggleHide - hide ","info")}if(a.View.WindowManager.curWindow){a.View.WindowManager.curWindow.resize();a.log("Buddylist: toggleHide currWin resize","info")}a.log("Buddylist: toggleHide collapseOtherWindows ","info")};h.toggleFollowedPeople=function(o){if(o=="hide"){a.View.addClass(a.View.getEl("followedList"),"hide");
a.View.addClass(a.View.getEl("presence_buddylist_body"),"hide")}else{a.View.removeClass(a.View.getEl("followedList"),"hide");h.toggleFollowPanel(true)}};this.navigatePresenceOptionsIndex=0;a.View.Buddylist=h})(presence);(function(b){var a=function(g,h,f,d){var c=this;this.subspaceId=g;this.callback=h;
this.reInviteCall=f;this.id=b.View.WindowManager.getuuid();this.panel=canvas_doc.createElement("div");this.ownerObj=b.Model.Owner.getInstance();this.onlineUsers=1;this.reinvSpanIds=[];this.show=function(){b.View.removeClass(c.panel,"hide")};this.hide=function(){b.View.addClass(c.panel,"hide")};this.dispose=function(){try{delete c.panel
}catch(i){}};this.html=function(i){b.View.html(c.panel,i)};this.add=function(i){b.View.append(c.panel,i)};this.showDetails=function(u){if(u){c.onlineUsers=u}var r=b.View.createEl("div",{className:"chat_buddy_search_result"});var p=b.View.createEl("div");var w=b.View.createEl("div");var m=b.View.createEl("div",{className:"result_span_header",id:"result_span_header_"+c.id});
var q=b.View.createEl("div",{id:"result_details_body",className:"result_span_body"});r.appendChild(m);var k=false;var o=0,n=0;for(var t in c.ownerObj.workspaces[c.subspaceId].users){o++;p.appendChild(c.getBuddyEl(b.Controller.ownerObj.users[t]))}for(var v in c.ownerObj.workspaces[c.subspaceId].oldUsers){n++;
w.appendChild(c.getOfflineBuddyEl(b.Controller.ownerObj.users[v]));k=true}m.innerHTML='<img class="down_arrow" id="popup_details_arrow" alt="Down arrow" src="'+b.imageLocation+'/1pxDummy.png">'+u+"/"+(o+n+1)+'<span class="chat_button_details_txt">'+presence.config.catalog.details+'</span> <img class="chat_buddy_status_img" src="'+b.imageLocation+'/1pxDummy.png">';
q.appendChild(p);if(n>0){q.appendChild(w)}p.appendChild(c.getBuddyEl(b.Controller.ownerObj));r.appendChild(q);c.panel.innerHTML="";c.panel.appendChild(r);m.onclick=function(){if(b.View.hasClass(q,"hide")){b.View.removeClass(q,"hide");b.View.setClass(b.View.getEl("popup_details_arrow"),"down_arrow");b.View.WindowManager.togglePopPanelTabs("details")
}else{b.View.addClass(q,"hide");b.View.setClass(b.View.getEl("popup_details_arrow"),"right_arrow")}};if(k){q.appendChild(w)}c.resultSpanHeader=m;new b.View.Accessibility({id:"result_span_header_"+c.id,onEscape:function(){if(c.callback&&typeof c.callback=="function"){c.callback(null,true)}}});for(var l in c.reinvSpanIds){new b.View.Accessibility({id:c.reinvSpanIds[l]})
}c.reinvSpanIds=[]};this.getOfflineBuddyEl=function(q){if(!q.picture){q.picture=b.imageLocation+"/blankman200.png"}var m="";if(q.presenceStatus==b.presenceStatus.AWAY){presenceClassName="chat_buddy_popup_list away";m="away"}else{if(q.presenceStatus==b.presenceStatus.IDLE){presenceClassName="chat_buddy_popup_list idle";
m="idle"}else{if(q.presenceStatus==b.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_popup_list offline";m="unavailable"}else{presenceClassName="chat_buddy_popup_list active";m="available"}}}var k=b.View.createEl("div",{id:"buddy_"+c.id+"_"+q.id,className:presenceClassName+" italicTxt"});var j=b.View.escapeHtml(q.getName());
var n=(b.View.PopOutWidget.active)?"#":"/"+q.id;var p='<img id="buddy_'+c.id+"_"+q.id+'_image" class="chat_buddy_list_img" alt="'+j+'"  src="'+q.picture+'" >';var o=b.View.createEl("div",{id:"buddy_"+c.id+"_"+q.id+"_name",className:"chat_buddy_list_name_disable float_left"});o.innerHTML='<a href="'+n+'" class="chat_messages_title">'+j+"</a>";
var i='<img class="float_right chat_buddy_status_img" alt="'+b.getCatalog(m)+'" src="'+b.imageLocation+'/1pxDummy.png" align="right">';var l=b.View.createEl("span",{id:"buddy_"+c.id+"_"+q.id+"_ReInvite",className:"normalTxt chat_button_add_pop re_invite_lnk"});l.innerHTML=presence.config.catalog.detailsReInvite;
if(c.reInviteCall&&typeof c.reInviteCall=="function"){c.reinvSpanIds.push(l.id);l.onclick=function(){c.reInviteCall(q)}}k.innerHTML=i+p;k.appendChild(o);if(q.presenceStatus!=20&&c.onlineUsers<b.config.maxMultiChatUsers){k.appendChild(l);b.View.addClass(o,"_retry_")}return k};this.getBuddyEl=function(q){if(!q.picture){q.picture=b.imageLocation+"/blankman200.png"
}var l="";if(q.presenceStatus==b.presenceStatus.AWAY){presenceClassName="chat_buddy_popup_list away";l="away"}else{if(q.presenceStatus==b.presenceStatus.IDLE){presenceClassName="chat_buddy_popup_list idle";l="idle"}else{if(q.presenceStatus==b.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_popup_list offline";
l="unavailable"}else{presenceClassName="chat_buddy_popup_list active";l="available"}}}var k=b.View.createEl("div",{id:"buddy_"+c.id+"_"+q.id,className:presenceClassName+" blueTxt"});var m=(b.View.PopOutWidget.active)?"#":"/"+q.id;var j=b.View.escapeHtml(q.getName());var p='<img id="buddy_'+c.id+"_"+q.id+'_image" class="chat_buddy_list_img" src="'+q.picture+'" alt="'+j+'" >';
var n=(c.ownerObj.id==q.id)?'<span class="chat_buddy_list_you float_left greyTxt">('+b.getCatalog("You")+")</span>":"";var o=b.View.createEl("div",{id:"buddy_"+c.id+"_"+q.id+"_name",className:"chat_buddy_list_name_m float_left"});o.innerHTML='<a href="'+m+'" class="chat_messages_title normalTxt" >'+j+"</a>";
var i='<img class="float_right chat_buddy_status_img" alt="'+b.getCatalog(l)+'" src="'+b.imageLocation+'/1pxDummy.png" align="right">';if(n!=""){b.View.addClass(o,"_you_")}b.View.append(k,i+p);k.appendChild(o);b.View.append(k,n);return k}};b.View.ChatDetailsPanel=a})(presence);(function(b){var a=function(){var c=b.Model.Owner.getInstance();
var d=this;var f=b.View.Buddylist;this.paintList=function(j,p){if(popOut_ChatSubspaceId){return}Jiffy.mark("PaintChatList");b.log("Buddylist.paintChatList");var t=j?j:b.View.WindowManager.getWindows(),n=0,l=0,q=new Array();if(!j&&(f.searchActive||f.favEditActive)){return}var r=b.View.getEl("umps_convlist_body");
var h=b.View.getEl("umps_convList");var o=canvas_doc.createDocumentFragment();for(var m in t){q.push(t[m])}for(var k=q.length-1;k>=0;k--){if(q[k].isActive){if(!q[k].showHistoryIcon){if(q[k].msgCount==0&&q[k].hasUnreadMessages){q[k].msgCount=1}var g=d.createEl(q[k]);g.onclick=function(i){return function(){try{if(f.Favorites.curEditEl){f.Favorites.curEditEl.blur()
}}catch(u){}f.onChatClick(i)}}(q[k]);o.appendChild(g);n++;l+=q[k].msgCount}}}r.innerHTML="";if(n==0){b.View.addClass(r,"hide");b.View.addClass(h,"hide")}else{r.appendChild(o);if(!b.conversationCollapsed){b.View.removeClass(r,"hide")}b.View.removeClass(h,"hide")}b.View.RosterHeaders.hideDummyHeaders();
if(!f.searchActive&&!f.favEditActive&&(!p||p.length!=1)){f.setPanelHeight()}f.updateMessageCount(l);b.View.updateAltAttrByTag(r,"img");Jiffy.measure("Done","PaintChatList")};this.hideList=function(){var h=b.View.getEl("umps_convlist_body");var g=b.View.getEl("umps_convList");b.View.addClass(h,"hide");
b.View.addClass(g,"hide")};this.createEl=function(g){var q={id:g.id,name:f.searchActive?g.fullTitle:g.title,picture:g.windowIcon.src,_startIndex:g._startIndex,_endIndex:g._endIndex};delete g._startIndex;delete g._endIndex;if(!q.picture){q.picture=b.imageLocation+"/blankgroups16.png"}var j=g.owner.favorites[g.owner.generateFvtId(g.entities)];
var i=(g.chatSessionType==2&&g.sourceId&&g.sourceId==g.owner.id&&j&&j.favoriteName&&j.favoriteName!="")?j.favoriteName:q.name;b.log("chat is of type "+g.chatSessionType+" name constructed = "+i);if(q._startIndex!==undefined){i=b.View.escapeHtml(i.substring(0,q._startIndex))+"<span class='search_highlight'>"+b.View.escapeHtml(i.substring(q._startIndex,q._endIndex))+"</span>"+b.View.escapeHtml(i.substring(q._endIndex))
}else{i=b.View.escapeHtml(i)}var k=b.View.createEl("div",{className:"conv_icon_holder float_left"});var m=g.roomType=="multi"?" group_chat_icon":"";var r=g.isOpen?" open":"";var n="";if(b.config.screenShareEnabled&&(g.subspaceId==c.sharingSubspaceId||g.subspaceId==c.viewingSubspaceId)&&g.msgCount==0){n=" notify_share"
}if(g.isMeetups&&b.config.App==="webmessenger"&&b.config.meetupsEnabled){n=" meetups"}var l='<img id="umps_chat_'+q.id+'_image" class="chat_buddy_list_img'+m+'" alt="'+b.View.escapeStr(q.name)+'" src="'+q.picture+'">',t='<span id="umps_chat_'+q.id+'_name" class="chat_buddy_list_name" title="'+b.View.escapeStr(q.name)+'">'+i+"</span>",p='<span id="umps_chat_'+q.id+'_notify" class="newMessages float_left'+n+((g.msgCount||n!="")?"":" hide")+'" title="'+b.getCatalog("NewMessage")+'" ></span>',o=g.presenceClass?'<span id="umps_chat_'+q.id+'_presence" class="'+g.presenceClass+'"><img class="chat_buddy_status_img float_right" alt="'+(g.presenceClass=="offline"?b.getCatalog("unavailable"):b.getCatalog(g.presenceClass))+'"  src="'+b.imageLocation+'/1pxDummy.png" ></span>':"";
var h=b.View.createEl("div",{id:"umps_chat_"+q.id,className:"chat_buddy_list_display"+r,title:b.View.escapeStr(q.name)});p=g.isPopped?'<img id="presence_'+q.id+'_chat_pop_out" class="chat_window_popped float_left" alt=" " src="'+b.imageLocation+'/1pxDummy.png">':p;h.appendChild(k);if(!g.isOpen){k.innerHTML=p
}b.View.append(h,o+l+t);f.makeItemDraggable(h,{type:"conversation",chatWindow:g});if(g.roomType=="multi"){h.onmouseover=function(z){z=canvas_window.event||z;var w=(g.subspaceId&&g.subspaceId!=""&&c.workspaces[g.subspaceId])?c.workspaces[g.subspaceId].users:null;var x=(g.subspaceId&&g.subspaceId!=""&&c.workspaces[g.subspaceId])?c.workspaces[g.subspaceId].oldUsers:null;
var y=[];var u=[];if(w){for(var v in w){y.push(w[v].id)}}else{y=g.entities}b.View.RosterParticipantsList.elHover({evt:z,buddyListObj:y,curActiveEl:h,showUserCnt:false})};h.onmouseout=function(){b.View.RosterParticipantsList.elHoverOut()}}return h};this.addChat=function(i){if(f.searchActive||f.favEditActive){return
}var g=b.View.getEl("umps_chat_"+i.id);if(!g){var h=b.View.getEl("umps_convlist_body");h.appendChild(f.chatEl(i))}};this.removeChat=function(h){var g=b.View.getEl("umps_chat_"+h.id);if(g){g.parentNode.removeChild(g)}};this.updateChat=function(h){var g=b.View.getEl("umps_chat_"+h.id);if(g){g.parentNode.replaceChild(f.chatEl(h),g)
}else{d.addChat(h)}};this.onNewMessage=function(i){b.log("Buddylist.onNewChatMessage");i.isActive=true,c.workspaces[i.subspaceId].isActive=true;if(i.isOpen&&i.collapsed){b.messageCountTimer=window.setTimeout(function(){f.updateMessageCount()},200)}if(i.isOpen||i.isPopped){return}var g=b.View.getEl("umps_chat_"+i.id+"_notify");
var h=false;if(g){if(i.msgCount!=0||i.hasUnreadMessages||(i.isMeetups&&b.config.App==="webmessenger"&&b.config.meetupsEnabled)){b.View.removeClass(g,"hide");b.View.removeClass(g,"notify_share");if(!i.hasUnreadMessages){i.hasUnreadMessages=true;h=true}if(!c.workspaces[i.subspaceId].hasUnreadMessages){c.workspaces[i.subspaceId].hasUnreadMessages=true
}}else{if(i.hasUnreadMessages){i.hasUnreadMessages=false}if(c.workspaces[i.subspaceId].hasUnreadMessages){c.workspaces[i.subspaceId].hasUnreadMessages=false}}b.messageCountTimer=window.setTimeout(function(){f.updateMessageCount()},200);if(h){b.View.WindowManager.synchWindows()}}else{d.paintList();b.View.WindowManager.synchWindows()
}};this.onPresenceChange=function(h){var g=b.View.getEl("umps_chat_"+h.id+"_presence");if(g){b.View.setClass(g,h.presenceClass)}}};b.View.ChatList=a})(presence);(function(b){var a=function(d){this.id=d||b.View.WindowManager.getuuid();this.subspaceId="";this.chatSessionId="";this.userId="";this.chatSessionType=0;
this.sourceId="";this.userName="";this.isOpen=false;this.isActive=true;this.hasUnreadMessages=false;this.collapsed=false;this.composeScheduled=false;this.composeTimer=null;this.removeComposeTimer=null;this.initComposing=false;this.firstTyping=true;this.userCount=1;this.totalUserCount=1;this.msgCount=0;
this.windowHeight=b.config.chatWindowHeight;this.popupPanelAdjustHeight=51;this.enableAutoScroll=true;this.recentHistory=false;this.inHistory=false;this.historyInprogress=true;this.pushToHistoryTries=0;this.autoAddMemTries=0;this.presenceWidget="";this.mainElement="";this.newMessageEl="";this.presenceElement=null;
this.chatPanel=null;this.chatPanelContent=null;this.chatPanelContainer=null;this.composeTextArea=null;this.composeTextAreaWrap=null;this.windowTitleContainer=null;this.windowIcon=null;this.lastMessagesDiv=null;this.lastMessageFrom=null;this.lastPresenceEvent=null;this.lastTimeStampDiv=null;this.lastMessagesHis=null;
this.histTimeStampDiv=null;this.composingDiv=null;this.chatTextErrorMsg=null;this.chatErrorEl=null;this.minimizeBtn=null;this.bufferMsgsFragment=canvas_doc.createDocumentFragment();this.bufferMessageQueue=[];this.presenceEvntsCount=0;this.owner=null;var c=this;this.init=function(K){c.owner=b.Model.Owner.getInstance();
if(K.id){c.subspaceId=K.id;if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].uuid=c.id}}if(K.chatSessionId){c.chatSessionId=K.chatSessionId}var i=c.owner.workspaces[c.subspaceId];if(i){if(i.height){c.windowHeight=i.height}if(i.isPopped){c.isPopped=i.isPopped}if(i.meetupSessionId){c.meetupSessionId=i.meetupSessionId
}}if(K.chatSessionType){c.chatSessionType=K.chatSessionType}c.showHistoryIcon=K.showHistoryIcon;if(b.config.chatMsgDeepHistoryEnabled){this.windowHeight=b.config.chatWindowHeight-41}c.historyInprogress=b.config.chatMsgHistoryEnabled;if(K.sourceId){c.sourceId=K.sourceId;b.log("source id inside init chat "+c.sourceId)
}c.presenceWidget=popOut_ChatSubspaceId?b.View.getEl("presence_widget"):b.View.getEl("presence_chat_dock");if(c.presenceWidget){var u=b.View.createEl("div",{id:"presence_"+c.id,className:"chat_dock_pane_group chat_buddy_msg_pane chat_pan_active hide"});var x='<span id="presence_'+c.id+'_presence_status"><img class="chat_buddy_status_img float_left" src="'+b.imageLocation+'/1pxDummy.png"></span>';
var m="<span id='presence_"+c.id+"_chat_newmessage' class='newMessages hide' >1</span>";var C='<span id="presence_'+c.id+'_chat_minimize_wrap" class="chat_close_wrap" title="'+presence.getCatalog("Minimize")+'"> <img class="chat_min_max_icon" src="'+b.imageLocation+'/1pxDummy.png"></span>';var g='<span title="'+presence.getCatalog("PopOutChat")+'" id="presence_'+c.id+'_chat_pop_out_wrap"> <img id="presence_'+c.id+'_chat_pop_out" class="pop_out_chat_window float_right" src="'+b.imageLocation+'/1pxDummy.png"></span>';
if(popOut_ChatSubspaceId){var h='<span class="chat_close_wrap hide" title="'+presence.getCatalog("Close")+'"> <img id="presence_'+c.id+'_chat_close" class="chat_close" src="'+b.imageLocation+'/1pxDummy.png"></span>'}else{var h='<span class="chat_close_wrap" title="'+presence.getCatalog("Close")+'" id="presence_'+c.id+'_chat_close_wrap"> <img id="presence_'+c.id+'_chat_close" class="chat_close" src="'+b.imageLocation+'/1pxDummy.png"></span>'
}var F="<div id='presence_"+c.id+"_chat' class='chat_buddy_msg_mainpane main_box_shadow'><div class='chat_buddy_msg_mainpanetopbg'>";var z=(popOut_ChatSubspaceId)?"<div class='chat_buddy_list_title' id='presence_"+c.id+"_chat_title_container'>":"<div class='chat_buddy_list_title pointer_cursor' id='presence_"+c.id+"_chat_title_container'>";
var o='<div id="presence_'+c.id+'_drag_handle" class="chat_drag_handle" ></div>';var E="<img id='presence_"+c.id+"_icon' class='chat_window_icon'>";var t='<img id="presence_'+c.id+'_history" class="history_chat_icon float_left hide"  src="'+b.imageLocation+'/1pxDummy.png" title="'+presence.getCatalog("BackToHistory")+'" />';
var r='<div id="presence_'+c.id+'_chat_title" class="chat_title_name" >(empty)</div>';var y='<div id="presence_'+c.id+'_share_pannel" class="share_status_bar hide"><div class="notification_arrow" ></div></div>';var H="<img src='"+b.imageLocation+"/1pxDummy.png' class='screen_share float_left' id='presence_"+c.id+"_screen_share'  title='"+presence.getCatalog("StartShare")+"' />";
var I="<img src='"+b.imageLocation+"/1pxDummy.png' class='screen_share float_left' id='presence_"+c.id+"_startmeetup'  title='Start Meetup' />";var j='<div id="presence_'+c.id+'_meetup_panel" class="meetup_panel hide"></div>';b.getOSName();if(!b.config.screenShareEnabled||!b.config.isOSsupported){y="";
H=""}var J='<div class="chat_body_panel"><div id="presence_'+c.id+'_overlay" class="chat_window_overlay hide"><div id="presence_'+c.id+'_prompt" class="chat_window_prompt hide"></div></div>';var G='<div id="presence_'+c.id+'_msg_loader" class="history_msg_loader float_right hide">'+b.getCatalog("LoadingHistoryMsgs")+'<img class="his_loader_img float_right" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" /></div>';
if(b.isMeetupApp||!b.config.meetupsEnabled){I="";j=""}var n="<div id='presence_"+c.id+"_button_bar' class='chat_toolbar'>"+G+"<img src='"+b.imageLocation+"/1pxDummy.png' class='chat_button_add add_users float_left' id='presence_"+c.id+"_button_add'  title='"+presence.config.catalog.inviteHeader+"'/><img src='"+b.imageLocation+"/1pxDummy.png' class='chat_button_favorite float_left' id='presence_"+c.id+"_button_favorite'  title='"+b.getCatalog("favorite")+"'/>"+H+I;
var q="<div class='chat_popup_holder' id='presence_"+c.id+"_popup_holder'></div>";var l;if(!b.config.chatMsgDeepHistoryEnabled){l="<div class='chat_window_content_box' id='presence_content"+c.id+"_box_id'><div id='presence_"+c.id+"_chat_display' class='chat_buddy_msg_display' style='height:"+b.View.PopOutWidget.getChatWindowContainerHeight(c.windowHeight)+"px;'>"+((K.chatType=="groupChat")?b.View.build.presenceBuddyGroupOptions(c.id):"")+"<div class='chat_event_error hide' id='chat_"+c.id+"_event_error'></div><div id='presence_"+c.id+"_chat_display_container' class='chat_buddy_msg_container'></div></div></div>"
}else{l="<div class='chat_window_content_box' id='presence_content"+c.id+"_box_id'><div id='presence_"+c.id+"_history_links' class='chat_history_info' align='center'></div><div id='presence_"+c.id+"_chat_display' class='chat_buddy_msg_display' style='height:"+b.View.PopOutWidget.getChatWindowContainerHeight(c.windowHeight)+"px;'>"+((K.chatType=="groupChat")?b.View.build.presenceBuddyGroupOptions(c.id):"")+"<div class='chat_event_error hide' id='chat_"+c.id+"_event_error'></div><div id='presence_"+c.id+"_chat_display_container' class='chat_buddy_msg_container'></div></div></div>"
}var A="<div class='chat_buddy_compose_area_wrapper'><div id='chat_buddy_compose_wrapper_"+c.id+"' class='chat_buddy_compose_wrapper'><label for='presence_"+c.id+"_compose' class='assistiveText'>Compose Message</label><textarea rows='1' class='chat_buddy_msg_compose' id='presence_"+c.id+"_compose' style='height:16px;' tabindex = '500' ></textarea></div><div id='chat_limit_error_"+c.id+"' class='chat_limit_error hide'></div><div id='chat_submit_message_btn_"+c.id+"' class='hide'>Send</div></div>";
var D="<div id='presence_"+c.id+"_bottom_title_container' class='chat_buddy_list_bottom_title hide'>";var L="<img id='presence_"+c.id+"_bottom_icon' class='chat_window_icon'>";var B='<div id="presence_'+c.id+'_chat_bottom_title" class="chat_title_name" >(empty)</div>';var f='<img id="presence_'+c.id+'_chat_pop_in" style="display: block;" title="'+presence.getCatalog("PopInChat")+'" class="pop_in_chat_window float_right" src="'+b.imageLocation+'/1pxDummy.png" id="popout_chat">';
if(b.View.PopOutWidget.active){if(popOut_ChatSubspaceId){u.innerHTML=D+L+B+b.closeDiv+F+z+h+m+E+r+x+f+b.closeDiv+J+q+n+b.closeDiv+y+j+l+A+b.closeDiv+b.closeDiv}else{u.innerHTML=D+L+B+b.closeDiv+F+z+h+m+t+E+r+x+b.closeDiv+J+q+n+b.closeDiv+y+j+l+A+b.closeDiv+b.closeDiv}}else{u.innerHTML=F+z+o+h+C+g+m+t+E+r+x+b.closeDiv+J+q+n+b.closeDiv+y+j+l+A+b.closeDiv+b.closeDiv+b.closeDiv
}c.presenceWidget.appendChild(u);c.mainElement=u;c.newMessageEl=b.View.getEl("presence_"+c.id+"_chat_newmessage");c.windowTitleContainer=b.View.getEl("presence_"+c.id+"_chat_title_container");c.windowTitle=b.View.getEl("presence_"+c.id+"_chat_title");if(b.config.App==="webmessenger"&&b.config.meetupsEnabled){var w=b.View.getEl("presence_"+c.id+"_startmeetup");
b.View.addHandler(w,"click",function(){b.View.MeetupsLauncher.invokeMeetups("startMeetup",c.subspaceId)})}if(b.View.PopOutWidget.active){c.windowBottomTitleContainer=b.View.getEl("presence_"+c.id+"_bottom_title_container");c.windowBottomTitle=b.View.getEl("presence_"+c.id+"_chat_bottom_title");c.windowBottomIcon=b.View.getEl("presence_"+c.id+"_bottom_icon")
}else{c.chatDragHandle=b.View.getEl("presence_"+c.id+"_drag_handle")}c.windowIcon=b.View.getEl("presence_"+c.id+"_icon");c.historyIcon=b.View.getEl("presence_"+c.id+"_history");c.chatPanel=b.View.getEl("presence_"+c.id+"_chat_display_container");c.chatPanelContainer=b.View.getEl("presence_"+c.id+"_chat_display");
c.composeTextArea=b.View.getEl("presence_"+c.id+"_compose");c.composeTextAreaWrap=b.View.getEl("chat_buddy_compose_wrapper_"+c.id);c.popupHolder=b.View.getEl("presence_"+c.id+"_popup_holder");c.meetupPanel=b.View.getEl("presence_"+c.id+"_meetup_panel");c.chatPanelContent=b.View.getEl("presence_"+c.id+"_chat");
c.chatErrorEl=b.View.getEl("chat_"+c.id+"_event_error");c.overlayEl=b.View.getEl("presence_"+c.id+"_overlay");c.promptEl=b.View.getEl("presence_"+c.id+"_prompt");c.minimizeBtn=b.View.getEl("presence_"+c.id+"_chat_minimize_wrap");c.msgLoaderEl=b.View.getEl("presence_"+c.id+"_msg_loader");c.popOutEle=b.View.getEl("presence_"+c.id+"_chat_pop_out");
c.screenShareEl=b.View.getEl("presence_"+c.id+"_screen_share");c.deepHistoryEl=b.View.getEl("presence_"+c.id+"_history_links");c.presenceElement=b.View.getEl("presence_"+c.id+"_presence_status");c.inviteElement=b.View.getEl("presence_"+c.id+"_button_add");c.chatTextErrorMsg=b.View.getEl("chat_limit_error_"+c.id);
c.favoriteBtn=b.View.getEl("presence_"+c.id+"_button_favorite");setTimeout(c.makeResizeable,400);if(c.minimizeBtn){b.View.addHandler(c.minimizeBtn,"click",function(M){c.animateClose(M)})}if(b.View.getEl("presence_"+c.id+"_chat_close")){b.View.addHandler(b.View.getEl("presence_"+c.id+"_chat_close"),"click",function(M){c.close(M,true)
})}var p=b.View.getEl("presence_"+c.id+"_chat_pop_out");if(p){b.View.addHandler(p,"click",function(M){c.popOut(M)})}var k=b.View.getEl("presence_"+c.id+"_chat_pop_in");if(k){b.View.addHandler(k,"click",function(M){c.popIn(M)})}b.View.addHandler(b.View.getEl("presence_"+c.id+"_chat_title_container"),"click",function(){if(popOut_ChatSubspaceId||b.View.PopOutWidget.active||c.dragging){return
}b.View.Buddylist.toggleBuddyList()});b.View.addHandler(b.View.getEl("presence_"+c.id+"_compose"),"keydown",c.sendMessage);b.View.addHandler(b.View.getEl("chat_submit_message_btn_"+c.id),"click",c.sendMessage);b.View.addHandler(b.View.getEl("presence_"+c.id+"_compose"),"keyup",c.textAreaKeyUp);b.View.addHandler(b.View.getEl("presence_"+c.id+"_compose"),"focus",c.hideHistoryIcon);
b.View.addHandler(b.View.getEl("presence_"+c.id),"click",c.resetCount);b.View.addHandler(b.View.getEl("presence_"+c.id+"_button_add"),"click",c.showSearch);b.View.addHandler(c.historyIcon,"click",c.showHistoryPnl);b.View.addHandler(c.favoriteBtn,"click",c.toggleFavorite);b.View.SSChatWindow(c);this.initSS(i);
if(b.timeStampHover){b.View.addClass(c.chatPanel,"time_stamp_hover")}if(!popOut_ChatSubspaceId&&!b.View.PopOutWidget.active){c.chatScrollBar=new b.View.CustomScrollBar({scrollPane:c.chatPanel,scrollMainPan:c.chatPanelContainer});c.chatScrollBar.setHeight(c.chatPanelContainer.offsetHeight)}if(b.View.PopOutWidget.active){b.View.addHandler(canvas_window,"resize",c.resize)
}c.initializeAccessibility();b.View.updateAltAttrByTag(c.mainElement,"img");c._removeFromDom();c.updateTitle(K.entityIds);if(b.config.chatMsgDeepHistoryEnabled){c.paintHistoryLinks()}if(c.meetupSessionId){this.showJoinMeetupNotification(c.meetupSessionId)}if(!K.uuid){for(var v in K.users){if(K.users[v].isAnonymous){c.paintFollowLink(K.users[v])
}}}}};this.showJoinMeetupNotification=function(h){if(b.config.App==="webmessenger"&&b.config.meetupsEnabled){var g;if(c.meetupPanel){var f=c.meetupPanel.innerHTML;if(f.search("_join_meetup")!=-1){c.meetupPanel.innerHTML=""}}g=b.View.createEl("a",{id:"presence_"+c.id+"_join_meetup",className:"join_meetup",title:"Join Meetup",html:"Join Meetup"});
if(h){c.meetupSessionId=h;if(g){b.View.addHandler(g,"click",function(){b.View.MeetupsLauncher.invokeMeetups("joinMeetup",c.subspaceId,c.meetupSessionId)})}}else{b.log("MeetupSessionId Not found","error")}if(c.meetupPanel){c.meetupPanel.appendChild(g)}else{b.log("meetup panel not found","error")}b.View.removeClass(c.meetupPanel,"hide")
}};this.initializeAccessibility=function(){var g=function(h){if(h.shiftKey===true){if(!c.composeTextArea.disabled){b.View.focusEle("presence_"+c.id+"_compose")}else{b.View.focusEle("presence_content"+c.id+"_box_id")}return}b.View.focusEle("presence_"+c.id+"_chat_minimize_wrap")};var f=function(h){if(h.shiftKey===true){if(!c.composeTextArea.disabled){b.View.focusEle("presence_"+c.id+"_compose")
}else{b.View.focusEle("presence_content"+c.id+"_box_id")}return}b.View.focusEle("presence_"+c.id+"_button_add")};new b.View.Accessibility({id:"presence_"+c.id+"_chat_pop_out",onTabClick:g});new b.View.Accessibility({id:"presence_"+c.id+"_chat_pop_in",onTabClick:f});new b.View.Accessibility({id:"presence_"+c.id+"_chat_minimize_wrap",onTabClick:function(h){if(h.shiftKey===true){b.View.focusEle("presence_"+c.id+"_chat_pop_out");
return}b.View.focusEle("presence_"+c.id+"_chat_close_wrap")}});new b.View.Accessibility({id:"presence_"+c.id+"_chat_close_wrap",click:function(h){c.close(h,true)},onTabClick:function(h){if(h.shiftKey===true){if(c.showHistoryIcon){b.View.focusEle("presence_"+c.id+"_history")}else{if(b.View.PopOutWidget.active&&!c.composeTextArea.disabled){b.View.focusEle("presence_"+c.id+"_compose")
}else{b.View.focusEle("presence_"+c.id+"_chat_minimize_wrap")}}return}else{if(c.showHistoryIcon){if(!c.composeTextArea.disabled){b.View.focusEle("presence_"+c.id+"_compose")}else{b.View.focusEle("presence_"+c.id+"_history")}}else{b.View.focusEle("presence_"+c.id+"_button_add")}}}});new b.View.Accessibility({id:"presence_"+c.id+"_button_add",onTabClick:function(h){if(h.shiftKey===true){b.View.focusEle("presence_"+c.id+"_chat_close_wrap");
if(popOut_ChatSubspaceId){b.View.focusEle("presence_"+c.id+"_chat_pop_in")}return}b.View.focusEle("presence_"+c.id+"_button_favorite")}});new b.View.Accessibility({id:"presence_"+c.id+"_button_favorite",onTabClick:function(h){if(h.shiftKey===true){b.View.focusEle("presence_"+c.id+"_button_add");return
}if(b.config.screenShareEnabled&&b.config.isOSsupported){b.View.focusEle("presence_"+c.id+"_screen_share")}else{b.View.focusEle("presence_content"+c.id+"_box_id")}}});if(b.config.screenShareEnabled&&b.config.isOSsupported){new b.View.Accessibility({id:"presence_"+c.id+"_screen_share",onTabClick:function(h){if(h.shiftKey===true){b.View.focusEle("presence_"+c.id+"_button_favorite");
return}b.View.focusEle("presence_content"+c.id+"_box_id")}})}new b.View.Accessibility({id:"presence_content"+c.id+"_box_id",onTabClick:function(h){if(h.shiftKey===true){if(b.config.screenShareEnabled&&b.config.isOSsupported){b.View.focusEle("presence_"+c.id+"_screen_share")}else{b.View.focusEle("presence_"+c.id+"_button_favorite")
}return}if(!c.composeTextArea.disabled){b.View.focusEle("presence_"+c.id+"_compose")}else{if(!b.View.PopOutWidget.active){b.View.focusEle("presence_"+c.id+"_chat_pop_out")}else{if(popOut_ChatSubspaceId){b.View.focusEle("presence_"+c.id+"_chat_pop_in")}b.View.focusEle("presence_"+c.id+"_chat_close_wrap")
}}}});new b.View.Accessibility({id:"presence_"+c.id+"_history",onTabClick:function(){b.View.focusEle("presence_"+c.id+"_chat_close_wrap")}});new b.View.Accessibility({id:"presence_"+c.id+"_compose",onTabClick:function(h){if(h.shiftKey===true){b.View.focusEle("presence_content"+c.id+"_box_id");return}if(b.View.PopOutWidget.active){b.View.focusEle("presence_"+c.id+"_chat_close_wrap");
if(popOut_ChatSubspaceId){b.View.focusEle("presence_"+c.id+"_chat_pop_in")}}else{b.View.focusEle("presence_"+c.id+"_chat_pop_out")}}})};this.setSubspaceId=function(h,f){c.subspaceId=h;c.chatSessionId=f;if(b.config.screenShareEnabled&&b.config.isOSsupported&&(c.owner.isSharingScreen||c.owner.isViewingScreen)&&(c.owner.workspaces[c.subspaceId].publisherstatus!="started")){b.View.addClass(c.screenShareBtn,"disabled");
c.disableScreenShare()}if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].isActive=c.isActive;c.owner.workspaces[c.subspaceId].hasUnreadMessages=c.hasUnreadMessages;c.owner.workspaces[c.subspaceId].uuid=c.id}var g=c.owner.workspaces[c.subspaceId];for(var i in g.users){if(g.users[i].isAnonymous){c.paintFollowLink(g.users[i]);
c.owner.workspaces[c.subspaceId].addFollowOnlyHistory(g.users[i].id)}}b.log("okay, i got subspaceId: "+h,"info")};this.makeResizeable=function(){c.composeTextArea=new b.View.ElasticInput(c.composeTextArea,70,16,c.chatPanelContainer,c.scrollToBottom);if(b.View.PopOutWidget.active){c.resize()}else{if(c.owner.workspaces[c.subspaceId]){var f=c.owner.workspaces[c.subspaceId].height;
if(f){c.popupHolder.style.bottom=(f+c.popupPanelAdjustHeight)+"px";c.composeTextArea.heightChanged(f)}}c.makeDraggable()}c.makeDroppable()};this.makeDraggable=function(){var f=0;new b.View.Draggable(c.chatDragHandle,function(k,i){var g=false;var l=b.config.chatMsgDeepHistoryEnabled;if(b.config.screenShareEnabled&&b.config.isOSsupported){g=!b.View.hasClass(c.sharePanel,"hide")
}if(k=="dragstart"){var h=parseInt(c.chatPanelContainer.style.height);if(g){c.sharePanelHeight=(c.sharePanel.clientHeight)?c.sharePanel.clientHeight:41;h=h+c.sharePanelHeight}if(l){h=h+c.deepHistoryEl.offsetHeight}c.startHeight=h;c.dragging=true}else{if(k=="dragend"){var j=f;if(g){j=j-c.sharePanelHeight
}if(l){j=j-c.deepHistoryEl.offsetHeight}c.composeTextArea.heightChanged(j);c.popupHolder.style.bottom=(f+c.popupPanelAdjustHeight+c.composeTextArea.getHeightDiff())+"px";if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].height=f}c.windowHeight=f;window.setTimeout(function(){c.dragging=false
},50)}else{f=c.startHeight+i.startY-i.lastY;if(c.startHeight<presence.config.chatWindowHeight&&f<c.startHeight){f=c.startHeight}else{if(f<presence.config.chatWindowHeight&&c.startHeight>=presence.config.chatWindowHeight){f=presence.config.chatWindowHeight}}if(f>presence.config.maxChatWindowHeight){f=presence.config.maxChatWindowHeight
}if(l){if(g){c.chatPanelContainer.style.height=(f-c.deepHistoryEl.offsetHeight-c.sharePanelHeight)+"px"}else{c.chatPanelContainer.style.height=(f-c.deepHistoryEl.offsetHeight)+"px"}}else{c.chatPanelContainer.style.height=((g)?(f-c.sharePanelHeight):f)+"px"}}}c.scrollToBottom()},canvas_doc);b.View.addHandler(c.chatDragHandle,"click",function(g){g=window.event||g;
b.View.Buddylist.searchOfffocus(g);b.View.stopEventPropogation(g)})};this.makeDroppable=function(){new b.View.Droppable(c.chatPanelContainer,function(k,o){if(k=="dropover"){if(!c.subspaceId||c.composeTextArea.disabled){return}if(c.userCount>=b.config.maxMultiChatUsers||(o.data.type=="user"&&c.owner.users[o.data.userId].presenceStatus==20)||(o.data.type=="conversation"&&o.data.chatWindow.entities.length==1&&c.owner.users[o.data.chatWindow.entities[0]].presenceStatus==20)){if(c.userCount>=b.config.maxMultiChatUsers){var m=b.View.createEl("div",{className:"chat_popup_warn",id:"presence_"+c.id+"_maxUsersErr",html:b.getCatalog("maxUsersExceed",b.config.maxMultiChatUsers)});
c.chatPanel.appendChild(m);c.scrollToBottom()}b.View.addClass(c.chatPanelContainer.parentNode.parentNode,"dropblocked");if(b.View.Draggable.callbackFromTarget){b.View.Draggable.callbackFromTarget("dropDenied")}}else{b.View.addClass(c.chatPanelContainer.parentNode,"dropover");if(b.View.Draggable.callbackFromTarget){b.View.Draggable.callbackFromTarget("dropAllowed")
}}}else{if(k=="dropout"){b.View.removeClass(c.chatPanelContainer.parentNode,"dropover");b.View.removeClass(c.chatPanelContainer.parentNode.parentNode,"dropblocked");var l=b.View.getEl("presence_"+c.id+"_maxUsersErr");if(l){c.chatPanel.removeChild(l);c.scrollToBottom()}if(b.View.Draggable.callbackFromTarget){b.View.Draggable.callbackFromTarget("dropCleared")
}}else{if(k=="dropped"){b.View.removeClass(c.chatPanelContainer.parentNode,"dropover");b.View.removeClass(c.chatPanelContainer.parentNode.parentNode,"dropblocked");var l=b.View.getEl("presence_"+c.id+"_maxUsersErr");if(l){c.chatPanel.removeChild(l);c.scrollToBottom()}if(!c.subspaceId||c.composeTextArea.disabled){return
}if(o.data&&o.data.userId&&c.userCount<b.config.maxMultiChatUsers){if(!c.owner.workspaces[c.subspaceId].users[o.data.userId]){c.addMembersToChat({id:o.data.userId});c.scrollToBottom()}}else{if(o.data&&o.data.type=="conversation"){if(!o.data.chatWindow||!o.data.chatWindow.subspaceId||!c.owner.workspaces[o.data.chatWindow.subspaceId]||c.userCount>=b.config.maxMultiChatUsers){return
}var f=c.owner.workspaces[o.data.chatWindow.subspaceId].users,g=c.owner.workspaces[o.data.chatWindow.subspaceId].oldUsers,n=new Array();for(var j in f){if(!c.owner.workspaces[c.subspaceId].users[j]){n.push(j)}}for(var j in g){if(!c.owner.workspaces[c.subspaceId].users[j]){n.push(j)}}if(n.length){c.addMembersToChat(n,function(i,q){if(!i){if(q&&q.errorCode=="allUsersAreOffline"){for(var p=0;
p<n.length;p++){b.Controller.EventParser({messages:[{data:{presence:{message:"Unavailable",status:20},userId:n[p],screenName:c.owner.users[n[p]].getName()},header:{topic:"event.user.presence.status"}}]})}}}},function(){});c.scrollToBottom()}}else{if(o.data&&o.data.type=="favorite"){var f=c.owner.favorites[o.data.favId].users,n=new Array();
for(var h=0;h<f.length;h++){if(!c.owner.workspaces[c.subspaceId].users[f[h]]){n.push(f[h])}}if(n.length){c.addMembersToChat(n,function(i,q){if(!i){if(q&&q.errorCode=="allUsersAreOffline"){for(var p=0;p<n.length;p++){b.Controller.EventParser({messages:[{data:{presence:{message:"Unavailable",status:20},userId:n[p],screenName:c.owner.users[n[p]].getName()},header:{topic:"event.user.presence.status"}}]})
}}}},function(){});c.scrollToBottom()}}}}}}}},canvas_doc)};this.close=function(i,h,f){i=canvas_window.event||i;try{b.View.stopEventPropogation(i)}catch(g){}b.View.Actions.closeAllPopups();if(c.roomType=="multi"&&c.owner.workspaces[c.subspaceId]&&!c.owner.workspaces[c.subspaceId].disabled&&h){return c.promptClose(i)
}Jiffy.mark("ChatWindowClose");b.View.addClass(c.chatTextErrorMsg,"hide");c.composeTextArea.blur();if(c.isOpen){c._removeFromDom()}c.goOutOfView();c.isOpen=false;if(h){c.resetTextArea();c.isActive=false;if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].isActive=false}!f&&b.View.Actions.sendCustomEvent({event:"windowClosed",subspaceId:c.subspaceId})
}else{if(c.isActive){!f&&b.View.Actions.sendCustomEvent({event:"windowCollapsed",subspaceId:c.subspaceId})}else{c.resetTextArea();!f&&b.View.Actions.sendCustomEvent({event:"windowClosed",subspaceId:c.subspaceId})}}b.View.WindowManager.windowClosed(c);b.View.Buddylist.searchOfffocus(i);b.histObj={};if(b.View.getEl("umps_convlist_body").className.indexOf("hide")==-1){b.View.focusEle("umps_convlist_body")
}else{b.View.focusEle("options_mink_menu_id")}if(!b.View.hasClass(c.historyIcon,"hide")){b.View.focusEle("history_icon_id")}Jiffy.measure("Done","ChatWindowClose")};this.closeSilently=function(){Jiffy.mark("ChatWindowClose");b.View.addClass(c.chatTextErrorMsg,"hide");c.composeTextArea.blur();if(c.isOpen){c._removeFromDom()
}c.goOutOfView();c.isOpen=false;c.resetTextArea();b.View.WindowManager.windowClosed(c);b.histObj={};if(b.View.getEl("umps_convlist_body").className.indexOf("hide")==-1){b.View.focusEle("umps_convlist_body")}else{b.View.focusEle("options_mink_menu_id")}if(!b.View.hasClass(c.historyIcon,"hide")){b.View.focusEle("history_icon_id")
}Jiffy.measure("Done","ChatWindowClose")};this.promptClose=function(j){if(b.config.screenShareEnabled&&b.config.isOSsupported){if(c.owner.isSharingScreen&&c.subspaceId==c.owner.sharingSubspaceId){b.View.ScreenShare.paintErrorMessage(c,presence.getCatalog("CantLeaveChat"));return}}if(b.showCloseDialog!=0){c.removeMember(c.owner,function(m){c.isActive=false;
c.owner.workspaces[c.subspaceId].isActive=false;c.close(j);b.View.addClass(c.promptEl,"hide");b.View.addClass(c.overlayEl,"hide")});return}c.promptEl.innerHTML="";var i=b.View.createEl("div",{className:"chat_window_prompt_btn primary_button",html:b.getCatalog("leaveChat"),id:"leaveBtn_"+c.id+"_id"});
var g=b.View.createEl("div",{className:"chat_window_prompt_btn standard_button",html:b.getCatalog("minimizeChat"),id:"minimizeBtn_"+c.id+"_id"});i.onclick=function(p){c.enableWindowOnly();b.showCloseDialog=(b.View.getEl("showCloseDialogCBox_"+c.id).checked)?1:0;b.View.WindowManager.synchWindows();var m=function(){c.removeMember(c.owner,function(r){c.isActive=false;
c.owner.workspaces[c.subspaceId].isActive=false;c.close(p);if(b.config.chatMsgDeepHistoryEnabled&&c.roomType=="multi"&&c.owner.workspaces[c.subspaceId]){var q=c.owner.workspaces[c.subspaceId];c.owner.removeWorkspace(q)}b.View.addClass(c.promptEl,"hide");b.View.addClass(c.overlayEl,"hide")})};if(b.config.screenShareEnabled&&b.config.isOSsupported){if(c.owner.isViewingScreen&&c.subspaceId==c.owner.viewingSubspaceId){b.View.ScreenShare.stopView();
b.setCookie("viewerSpace",null);b.setCookie("viewerStatus",false);b.View.ScreenShare.resetStateValues();var o={status:"stop",type:"viewer"};var n={data:o,subspaceId:c.subspaceId,message:"viewer stopped successfully",result:true};var o={message:JSON.stringify(n),topic:"event.user.device.notify"};b.Controller.call({method:"notifyDevice",data:o,successCallBack:function(q){m()
},failCallBack:function(q){b.log("notifyDevice failed","error")}})}else{m()}}else{m()}};var l=b.View.createEl("div");var k=(b.showCloseDialog!=0)?'checked="checked"':"";l.innerHTML='<input type="checkbox" name="showCloseDialogCBox"  id="showCloseDialogCBox_'+c.id+'" '+k+' /> <label for="showCloseDialogCBox">'+b.getCatalog("DontShowMessageAgain")+"</label>";
g.onclick=function(m){b.View.addClass(c.promptEl,"hide");b.View.addClass(c.overlayEl,"hide");b.showCloseDialog=(b.View.getEl("showCloseDialogCBox_"+c.id).checked)?2:0;b.View.WindowManager.synchWindows();c.close(m);c.enableWindowOnly()};var f=b.View.createEl("div",{className:"chat_close_wrap",title:presence.getCatalog("Close"),id:"closePrompt_"+c.id+"_id"});
f.innerHTML='<img class="chat_close" src="'+b.imageLocation+'/1pxDummy.png" alt="'+presence.getCatalog("Close")+'">';f.onclick=function(){b.View.addClass(c.overlayEl,"hide");c.enableWindowOnly();c.composeTextArea.focus()};var h=b.View.createEl("div",{className:"chat_window_prompt_text",html:"<br>"+presence.getCatalog("leaveChatWarning")});
c.promptEl.appendChild(f);c.promptEl.appendChild(h);c.promptEl.appendChild(i);c.promptEl.appendChild(g);c.promptEl.appendChild(l);b.View.removeClass(c.overlayEl,"hide");b.View.removeClass(c.promptEl,"hide");c.disableWindowOnly();if(!c.isOpen){c.open();b.View.PopOutWidget.resizeToFitChatWindow()}new b.View.Accessibility({id:"leaveBtn_"+c.id+"_id"});
new b.View.Accessibility({id:"minimizeBtn_"+c.id+"_id"});new b.View.Accessibility({id:"closePrompt_"+c.id+"_id"});new b.View.Accessibility({id:"showCloseDialogCBox_"+c.id,onTabClick:function(){b.View.focusEle("closePrompt_"+c.id+"_id")}});if(i){i.focus()}};this.open=function(f,g){b.View.Buddylist.searchOfffocus();
if(c.isOpen){return}if(c.isPopped&&!popOut_ChatSubspaceId){return c.focusPopout()}!f&&c.maximize();f&&!b.BuddyListActive&&c.minimize();c._appendToDom();c.isOpen=true;c.isActive=true;c.hasUnreadMessages=false;c.msgCount=0;if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].isActive=true;
c.owner.workspaces[c.subspaceId].newMsgCount=c.msgCount;c.owner.workspaces[c.subspaceId].hasUnreadMessages=false}b.View.WindowManager.windowOpened(c,f);!f&&c.subspaceId&&b.View.Actions.sendCustomEvent({event:"windowOpened",subspaceId:c.subspaceId,entityId:g,showHistoryIcon:c.showHistoryIcon});if(c.owner.workspaces[c.subspaceId]&&c.owner.workspaces[c.subspaceId]["meetupSessionId"]){this.showJoinMeetupNotification(c.owner.workspaces[c.subspaceId]["meetupSessionId"])
}c.checkAnyShareActivity();if(c.showHistoryIcon){c.addHistoryIcon()}else{c.hideHistoryIcon()}if(c.composeTextArea.disabled){b.View.focusEle("presence_content"+c.id+"_box_id")}if(c.showHistoryIcon){b.View.focusEle("presence_"+c.id+"_history")}};this.addHistoryIcon=function(){if(!c.showHistoryIcon){return
}if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].showHistoryIcon=true}b.View.addClass(c.mainElement,"history_pan");b.View.addClass(c.windowIcon,"hide");b.View.removeClass(c.historyIcon,"hide");b.View.addClass(c.inviteElement,"hide");b.View.addClass(c.favoriteBtn,"hide");b.View.addClass(c.minimizeBtn,"hide");
if(c.screenShareEl){b.View.addClass(c.screenShareEl,"hide")}if(c.popOutEle){b.View.addClass(c.popOutEle,"hide")}};this.hideHistoryIcon=function(g){g=canvas_window.event||g;if(!c.showHistoryIcon){return}c.showHistoryIcon=false;if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].showHistoryIcon=false
}b.View.removeClass(c.mainElement,"history_pan");b.View.removeClass(c.windowIcon,"hide");b.View.addClass(c.historyIcon,"hide");var f=(c.historyParams)?c.historyParams:false;if(f){f.showHistoryIcon=false}c.historyParams=false;if(g){b.View.WindowManager.searchSubspace(c.entities.sort().join("_"),false,false,false,f)
}b.View.removeClass(c.inviteElement,"hide");b.View.removeClass(c.favoriteBtn,"hide");b.View.removeClass(c.minimizeBtn,"hide");if(c.screenShareEl){b.View.removeClass(c.screenShareEl,"hide")}if(c.popOutEle){b.View.removeClass(c.popOutEle,"hide")}b.histObj={}};this.showHistoryPnl=function(f){f=canvas_window.event||f;
b.View.Buddylist.HistoryPanel.toggle(f);b.View.stopEventPropogation(f)};this.addHistoryHandle=function(f){c.historyParams=f;b.View.addClass(c.mainElement,"disabled");b.View.removeHandler(c.inviteElement,"click",c.showSearch);b.View.addClass(c.presenceElement,"hide");c.composeTextArea.blur()};this._appendToDom=function(){c.presenceWidget.appendChild(c.mainElement);
b.log("user initiated window, adding to right","info")};this._removeFromDom=function(){try{c.presenceWidget.removeChild(c.mainElement)}catch(f){b.log("Failed to remove window node "+f.message,"error")}};this.focusPopout=function(){if(c.isPopped){var f=canvas_window.open("",b.config.popOutWindowName+(b.View.PopOutWidget.chatWindowPopoutName(c.subspaceId)));
if(f.umps_config){f.focus()}else{f.close();c.isPopped=false;c.owner.workspaces[c.subspaceId].isPopped=false;c.open(true);b.View.Actions.setDeviceAttribute("chatPopin",c.subspaceId);b.View.Actions.sendCustomEvent({event:"windowPopedIn",subspaceId:c.subspaceId})}}};this.minimize=function(){Jiffy.mark("MinimizeChatWindow");
b.View.Actions.closeAllPopups();c.composeTextArea.blur();b.View.removeClass(c.mainElement,"chat_pan_active");c.collapsed=true;if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].collapsed=true}Jiffy.measure("Done","MinimizeChatWindow")};this.maximizeAndFocus=function(){c.maximize();
c.cleanAllPrEvntsByTimeout(b.config.presenceEventsTimeout);if(c.composeTextArea.disabled){b.View.focusEle("presence_content"+c.id+"_box_id")}if(c.showHistoryIcon){b.View.focusEle("presence_"+c.id+"_history")}try{if(!c.showHistoryIcon){c.composeTextArea.focus()}}catch(f){b.log("error focusing chat window")
}};this.popOut=function(g){b.View.stopEventPropogation(g);if(c.ispopping===true){return}c.ispopping=true;var f=c.owner.workspaces[c.subspaceId];if(!f||f.disabled){c.ispopping=false;return}c.isPopped=true;f.isPopped=c.isPopped;b.View.PopOutWidget.open(c.subspaceId);c.close(null,null,true);if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()
}c.ispopping=false;b.setCookie("umps_open_subspaceid","DUMMY")};this.popIn=function(f){if(b.EventManager.bootstrapDone){b.View.PopOutWidget.close()}};this.maximize=function(){Jiffy.mark("MaximizeChatWindow");b.View.addClass(c.mainElement,"chat_pan_active");b.View.addClass(c.newMessageEl,"hide");c.msgCount=0;
c.collapsed=false;if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].collapsed=false;c.owner.workspaces[c.subspaceId].newMsgCount=c.msgCount}c.scrollToBottom();if(b.View.PopOutWidget.active){c.resize()}Jiffy.measure("Done","MaximizeChatWindow")};this.bringIntoView=function(f){if(!c.collapsed){c.msgCount=0
}if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){if(!c.collapsed){c.owner.workspaces[c.subspaceId].newMsgCount=0}}window.setTimeout(c.scrollToBottom,100);c.checkAnyShareActivity();if(f===true||popOut_ChatSubspaceId){if(rtlLnaguage){c.mainElement.style.left="0px"}else{c.mainElement.style.right="0px"
}b.View.removeClass(c.mainElement,"hide");return}Jiffy.mark("AnimateOpen");c.rightMargin=-180;c.mainElement.style.right=c.rightMargin+"px";b.View.removeClass(c.mainElement,"hide");c.animateOpen()};this.animateOpen=function(){c.mainElement.style.right=c.rightMargin+"px";c.rightMargin+=90;if(c.rightMargin<=0){setTimeout(c.animateOpen,40)
}else{c.maximizeAndFocus();Jiffy.measure("Done","AnimateOpen")}};this.animateClose=function(g,f){g=canvas_window.event||g;if(rtlLnaguage){c.close(null,null,f)}else{c.mainElement.style.right="-100px";setTimeout(function(){c.close(null,null,f)},40)}b.View.stopEventPropogation(g)};this.goOutOfView=function(){b.View.addClass(c.mainElement,"hide")
};this.setTitle=function(h,f,g){c.windowIcon.title=h;c.windowTitle.title=h;c.htmlTitle=g;if(g){c.windowTitle.innerHTML=g}else{b.View.text(c.windowTitle,h)}c.title=h;c.fullTitle=f?f:h};this.updateTitle=function(x){if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){var w=0,q=new Array(),j,y,p=0,f=new Array(),k=new Array(),o=0;
c.entities=[];var n=c.owner.workspaces[c.subspaceId].users;var r=c.owner.workspaces[c.subspaceId].oldUsers;var l=b.View.objectToArray(n);var m=b.View.objectToArray(r);var g=l.concat(m);g=b.View.sortUserIdsByUserName(g);for(var t=0;t<g.length;t++){var v=g[t];q.push(c.owner.users[v].getName().split(" ",2)[0]);
f.push(c.owner.users[v].getName());k[o]=c.owner.users[v].presenceStatus==20;c.entities.push(v);if(n[v]){w++;j=v}if(r[v]){p++;if(!j){j=v}}o++}c.updateFvtButton();c.userCount=w+1;c.totalUserCount=w+p+1;if(c.totalUserCount>2){if(!c.owner.workspaces[c.subspaceId].once1toM&&b.config.chatMsgHistoryEnabled){c.recentHistory=false;
b.View.WindowManager.getHistory(c);if(c.singlememId){b.View.WindowManager.searchSubspace(c.singlememId,null,true,false,{conWindow:true,hasUnreadMessages:c.hasUnreadMessages});c.hasUnreadMessages=false;c.owner.workspaces[c.subspaceId].hasUnreadMessages=false;c.resetCount()}}c.owner.workspaces[c.subspaceId].once1toM=true
}if(c.presenceElement&&c.owner.users[j]){c.presenceClass=b.View.Buddylist.getPresenceClass(c.owner.users[j].presenceStatus);b.View.setClass(c.presenceElement,c.presenceClass)}if(w<2&&!c.owner.workspaces[c.subspaceId].once1toM){c.setTitle(c.owner.users[j].getName());c.setIcon(c.owner.users[j].picture,false);
c.roomType="single";b.View.removeClass(c.presenceElement,"hide");if(b.View.WindowManager.popupPanel&&b.View.WindowManager.popupPanel.isShown&&b.View.WindowManager.popupPanel.owner=="details_"+c.id){b.View.WindowManager.popupPanel.hide()}if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()
}return}if(c.userCount<2){c.disableWindow()}c.owner.workspaces[c.subspaceId].once1toM=true;c.make1_Mtitle({userName:q,fullNames:f,userId:j,statusArray:k})}else{if(x){c.entities=x=x.split("_");x=b.View.sortUserIdsByUserName(x);var h=x.length;if(h==1){var u=c.owner.users[x[0]];c.setTitle(u.getName());c.setIcon(u.picture,false);
c.presenceClass=b.View.Buddylist.getPresenceClass(u.presenceStatus);b.View.setClass(c.presenceElement,c.presenceClass)}else{var q=[],j=x[h-1],f=[];for(var w=0;w<h;w++){q.push(c.owner.users[x[w]].getName().split(" ",2)[0]);f.push(c.owner.users[x[w]].getName())}c.make1_Mtitle({userName:q,fullNames:f,userId:j})
}c.updateFvtButton()}}if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()}};this.make1_Mtitle=function(l){b.log(JSON.stringify(l));c.presenceClass="";c.roomType="multi";b.View.addClass(c.presenceElement,"hide");var k=l.userName.join(", ");var f=l.fullNames.join(", ");if(l.statusArray){for(var h=0;
h<l.userName.length;h++){if(l.statusArray[h]){l.userName[h]="<i>"+b.View.escapeHtml(l.userName[h])+"</i>"}}}var g=l.userName.join(", ");var j;if(b.config.chatMsgDeepHistoryEnabled){j=c.owner.favorites[c.chatSessionId];if(j&&j.favoriteName&&j.favoriteName!=""){k=j.favoriteName}}else{j=c.owner.favorites[c.owner.generateFvtId(c.entities)];
if(c.chatSessionType==2&&c.sourceId&&c.sourceId==c.owner.id&&j&&j.favoriteName&&j.favoriteName!=""){b.log("this is a 1:m chat and type is of fav so using the fav name self.sourceId = "+c.sourceId+" ownerid = "+c.owner.id);k=j.favoriteName}}c.setTitle(k,f);c.setIcon(c.owner.users[l.userId].picture,true)
};this.updateFvtButton=function(){b.View.addClass(c.favoriteBtn,"chat_button_make_favorite");var f;if(!b.config.chatMsgDeepHistoryEnabled){f=c.owner.generateFvtId(c.entities)}else{f=c.chatSessionId}if(c.owner.favorites[f]){b.View.addClass(c.favoriteBtn,"favorited");c.favoriteBtn.title=b.getCatalog("RemoveFavorite")
}else{b.View.removeClass(c.favoriteBtn,"favorited");c.favoriteBtn.title=b.getCatalog("favorite")}};this.setIcon=function(g,f){c.windowIcon.src=g;if(f){b.View.addClass(c.windowIcon,"group_chat_icon")}else{b.View.removeClass(c.windowIcon,"group_chat_icon")}};this.sendMessage=function(j){if(c.composeTextArea.disabled){return
}var j=window.event||j;var i=j.charCode||j.keyCode;if(i==27||(i==13&&b.isChrome)){b.View.cancelEvent(j)}if(i==9){b.View.focusEle("presence_"+c.id+"_chat_pop_out_wrap")}if(i==13&&j.shiftKey){return}else{if(i==13||j.type=="click"){c.pushToHistory();b.Controller.updateChatterActivity();clearTimeout(c.composeTimer);
c.composeScheduled=false;var g=c.composeTextArea.value;if(g.length>presence.config.chatMaxChar){return}if(b.View.getTrimString(g).length>0){c.resetTextArea();c.processBulkEvents([{from:"me",message:g}]);var h={message:b.View.getTrimString(g),topic:"event.user.message.text"};var f={chatId:c.hanging?null:c.subspaceId};
b.Controller.call({method:"sendMessage",data:h,urlData:f,tempData:{uuid:c.id},successCallBack:c.sendMessageSuccess,failCallBack:function(){c.sendMessageFailed(h,f)}})}else{c.resetTextArea()}}}};this.scheduleComposing=function(){var f=c.composeTextArea.value;if(!c.composeScheduled){c.composeScheduled=true;
c.composeTimer=setTimeout(c.sendComposing,presence.config.waitBeforeComposing)}};this.sendComposing=function(){c.firstTyping=false;if(c.initComposing&&c.roomType!="multi"){var g={message:presence.config.catalog.composingTxt,topic:"event.user.message.composing"};var f={chatId:c.subspaceId};b.Controller.call({method:"sendMessage",data:g,urlData:f,tempData:{uuid:c.id},successCallBack:c.sendComposingSuccess,failCallBack:c.sendComposingFailed});
c.composeScheduled=false;b.Controller.updateChatterActivity()}};this.removeComposing=function(){c.updateScrollFlag();var f=b.View.getEl("chat_composing_"+c.id);if(f&&f.parentNode){f.parentNode.removeChild(f)}if(c.composingDiv&&c.composingDiv.parentNode){c.composingDiv.parentNode.removeChild(c.composingDiv);
c.composingDiv=null;c.scrollToBottom()}};this.addComposing=function(h){c.removeComposing();c.updateScrollFlag();username=c.owner.users[h].getName();username=b.View.escapeHtml(username);username=(username.length>15)?username.substr(0,12)+"...":username;thumbnail=c.owner.users[h]?c.owner.users[h].picture:"";
var g=b.View.createEl("div",{className:"chat_messages_group_compose"});var f=b.View.createEl("div",{className:"chat_messages_compose"});f.innerHTML='<span class="chat_messages_title">'+username+"</b>:";f.innerHTML='<div class="chat_composing" id="chat_composing_'+c.id+'"> '+b.getCatalog("composingTxt",username)+"</div>";
g.appendChild(f);c.chatPanel.appendChild(g);c.composingDiv=g;c.scrollToBottom();clearTimeout(c.removeComposeTimer);c.removeComposeTimer=setTimeout(function(){c.removeComposing()},presence.config.showComposingTime)};this.textAreaKeyUp=function(i){var i=window.event||i;var h=i.charCode||i.keyCode;if(h==27){c.composeTextArea.blur();
if(popOut_ChatSubspaceId){b.View.PopOutWidget.close()}else{c.close(i)}return}var g=c.composeTextArea.value.length;if(g>presence.config.chatMaxChar){b.View.removeClass(c.chatTextErrorMsg,"hide");b.View.html(c.chatTextErrorMsg,presence.getCatalog("chatTextExceeded",(g-presence.config.chatMaxChar),presence.config.chatMaxChar))
}else{b.View.addClass(c.chatTextErrorMsg,"hide")}var f=c.composeTextArea.value;if(h==13&&b.View.getTrimString(f).length==0){c.resetTextArea()}else{if(f.indexOf("\n",0)==0){c.composeTextArea.value=c.composeTextArea.value.replace(/^\n+/,"")}else{if(g>presence.config.chatMaxChar&&f.match("\n")==0){c.composeTextArea.value=c.composeTextArea.value.replace(/\n+/,"");
c.composeTextArea.scrollTop=c.composeTextArea.scrollHeight}}}if(h!=13){if(g>1){if(c.firstTyping){c.sendComposing();c.scrollToBottom()}else{c.scheduleComposing()}}}};this.resetTextArea=function(){c.composeTextArea.value="";if(c.composeTextArea.resetSize){c.composeTextArea.resetSize()}};this.sendMessageSuccess=function(f){if(c.composeTextArea.disabled==true&&!!(b.View.hasClass(c.chatErrorEl,"hide"))){return b.log("Some error happend in chat window, but window is disabled")
}c.enableWindow();b.View.addClass(c.chatErrorEl,"hide");b.log("message sent success","info")};this.sendMessageFailed=function(i,f){b.log("problem in sending message","error");var m=(i.message.length>10)?i.message.substr(0,7)+"...":i.message;var l='<img class="chat_error error_16 float_left" alt="error" src="'+b.imageLocation+'/1pxDummy.png" />';
var h='<img class="chat_error float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.sendingMsg;var j=b.View.createEl("div",{className:"status_error"});var k=b.View.createEl("span",{className:"chat_error_link"});b.View.append(k,presence.config.catalog.msgTryAgain);
b.View.append(j,'"'+m+'"&nbsp;'+presence.config.catalog.MsgDeliveryErr+"<br />");j.appendChild(k);var g=b.View.createEl("div",{className:"chat_event_error_msg"});b.View.append(g,l);g.appendChild(j);c.chatPanel.appendChild(g);b.View.addHandler(k,"click",function(){b.View.html(g,h);b.Controller.call({method:"sendMessage",data:i,urlData:f,tempData:{uuid:c.id},successCallBack:function(){c.chatPanel.removeChild(g)
},failCallBack:function(){b.log("problem in sending message try again","error");b.View.html(g,l);b.View.html(k,presence.config.catalog.msgTryAgain);b.View.html(j,'"'+m+'"&nbsp;'+presence.config.catalog.MsgDeliveryErr+"<br />");j.appendChild(k);g.appendChild(j)}})});c.lastMessageFrom=null;c.scrollToBottom()
};this.sendComposingSuccess=function(f){b.log("message sent compose success","info")};this.sendComposingFailed=function(f){b.log("problem in sending compose message","error")};this.getFinalMessage=function(f){Jiffy.mark("FinalMessage");var g=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/  /g," &nbsp;").replace(/\n/g,"<br/>");
g=b.View.TextUtil.filterURL(g);Jiffy.measure("Done","FinalMessage");return g};this.processBulkEvents=function(m,g,F,w){Jiffy.mark("PaintMessage");if(c.showHistoryIcon&&!w){c.hideHistoryIcon()}c.removeComposing();c.initComposing=true;c.firstTyping=true;c.enableWindowOnly();var g=c.getFormattedTime(g);
var l=b.View.createEl("div",{align:"right",className:"chat_time_stamp"});l.innerHTML=g;var u="",x,n=m.length,E=0,y,A,C=0;c.updateScrollFlag();var h=true;var K=0;if(c.historyInprogress===true&&!b.Controller.eventPollObj.shortPoll&&!w){c.bufferMessageQueue.push(m)}if(popOut_ChatSubspaceId||b.View.PopOutWidget.active){h=!(c.chatPanelContainer.scrollHeight-c.chatPanelContainer.clientHeight-c.chatPanelContainer.scrollTop)
}while(C<n){var v=(m[E]["from"]==c.owner.id)?"me":m[E]["from"];if(v==c.lastMessageFrom){var o=m[E]["message"];var H=c.getFinalMessage(o);u+='<div class="chat_message">'+H+"</div>";if(H&&H.length>0){K++}E++}C++}if(E>0){(c.lastMessageFrom=="me")?y=false:y=true;c.lastMessagesDiv.innerHTML+=u;c.lastTimeStampDiv.innerHTML=g;
A=c.lastMessageFrom;if(!w&&c.historyInprogress===true&&!b.Controller.eventPollObj.shortPoll){c.lastMessagesHis.innerHTML+=u;c.histTimeStampDiv.innerHTML=g}}if(E<n){m=m.slice(E);var q,r,J,B=canvas_doc.createDocumentFragment();for(var E=0;E<m.length;E++){var k="",L="",A=(m[E]["from"]==c.owner.id)?"me":m[E]["from"],o=m[E]["message"];
(A=="me")?y=false:y=true;var H=c.getFinalMessage(o);if(H&&H.length>0){K++}if(q==A){r.innerHTML+='<div class="chat_message">'+H+"</div>"}else{var D="/"+c.owner.id,I=b.View.PopOutWidget.active?'target = "_blank"':"";if(A=="me"){k=presence.config.catalog.selfMsg;L=c.owner.picture?c.owner.picture:b.imageLocation+"/blankman200.png"
}else{var G=c.owner.users[A].getName();k=c.owner.users[A]?G:A;k=b.View.escapeHtml(k);L=c.owner.users[A]?c.owner.users[A].picture:"";D="/"+A}var t=b.View.createEl("div",{className:"chat_messages_group"});t.innerHTML='<a href="'+D+'" '+I+' class="chat_messages_links"><img src="'+L+'" class="chat_user_thumbnail" title="'+k+'" alt="'+k+'"></a>';
var p=t.cloneNode(true);var f=b.View.createEl("div",{className:"chat_messages"});f.innerHTML='<a href="'+D+'" '+I+' class="chat_messages_title chat_msg_user_name">'+k+"</a>:";f.innerHTML+='<div class="chat_message">'+H+"</div>";t.appendChild(f);t.appendChild(l);B.appendChild(t);c.lastMessagesDiv=r=f;
c.lastMessageFrom=q=A;c.lastTimeStampDiv=J=l}}if(w&&w===true){c.historyMsgsFragment.appendChild(B);y=false}else{if(c.historyInprogress===true&&!b.Controller.eventPollObj.shortPoll){var z=(r)?r.cloneNode(true):null;if(p&&z){c.histTimeStampDiv=c.lastTimeStampDiv.cloneNode(true);p.appendChild(z);p.appendChild(c.histTimeStampDiv);
c.lastMessagesHis=z;c.bufferMsgsFragment.appendChild(p)}}c.chatPanel.appendChild(B)}}if(w&&w===true){y=false}Jiffy.measure("inwindow","PaintMessage");if((h||!F)&&!w){c.scrollToBottom()}Jiffy.measure("scrolltobottom","PaintMessage");if(y&&!c.isPopped&&K>0){c.notifyMessage(A,K)}Jiffy.measure("nofifymessage","PaintMessage")
};this.repaintPanel=function(f){b.View.html(c.chatPanel,f);c.scrollToBottom()};this.reclaimSubspace=function(f){c.enableWindow();if(c.presenceElement){c.presenceClass=b.View.Buddylist.getPresenceClass(f.presenceStatus);b.View.setClass(c.presenceElement,c.presenceClass);if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.onPresenceChange(c)
}}c._paintUserEvent(f,"joined")};this.onPresence=function(f){if(c.presenceElement){c.presenceClass=b.View.Buddylist.getPresenceClass(f.presenceStatus);b.View.setClass(c.presenceElement,c.presenceClass);if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.onPresenceChange(c)}}if(f.presenceStatus==20){if(c.owner.workspaces[c.subspaceId].once1toM){c._paintUserEvent(f,"left")
}else{c._paintPresence(f,"offline")}c.updateTitle();if(c.roomType!="multi"){c.disableWindow()}}else{if(c.roomType=="multi"){c.updateTitle();c.enableWindow()}if(f.presenceStatus==100){c._paintPresence(f,"away")}else{if(f.presenceStatus==101){c._paintPresence(f,"idle")}else{c._paintPresence(f,"available")
}}if(!!b.View.hasClass(c.chatErrorEl,"hide")){c.enableWindow()}}};this._paintPresence=function(h,i,j,m){var l=h.id+"_"+i;if(l==c.lastPresenceEvent){return}c.lastPresenceEvent=l;var n,g=b.View.escapeHtml(c.owner.users[h.id].getName()),k="/"+h.id,f=(b.View.PopOutWidget.active)?'target="_blank"':"";if(i=="offline"){return
}else{if(i=="idle"){n=presence.getCatalog("idleWentMsg",'<a class="chat_messages_title" href="'+k+'" '+f+">"+g+"</a>")}else{if(i=="away"){n=presence.getCatalog("awayWentMsg",'<a class="chat_messages_title" href="'+k+'" '+f+">"+g+"</a>")}else{n=presence.getCatalog("onlineWentMsg",'<a class="chat_messages_title" href="'+k+'" '+f+">"+g+"</a>")
}}}c._removePresenceStatusEvent(h,false,true);c.onEvent('<span class="'+i+'" id="'+c.id+"_pstatus_"+h.id+'"><img class="chat_buddy_status_img  float_left" alt="'+(i=="offline"?b.getCatalog("unavailable"):b.getCatalog(i))+'" src="'+b.imageLocation+'/1pxDummy.png"></span><div class="status_message" id="'+c.id+"_pmessage_"+h.id+'">'+n+"</div>",j,null,m);
c.presenceEvntsCount++;this._CleanPresenceStatusEle(h)};this._getEleByIdfromChatPanelDiv=function(j,f){var i=c.chatPanel.getElementsByTagName(f.toUpperCase());for(var g=i.length-1;g>=0;g--){var h=i[g];if(h.id===j){return h}}return null};this._CleanPresenceStatusEle=function(f){setTimeout(function(){c._removePresenceStatusEvent(f,false)
},b.config.presenceEventsTimeout-300)};this.cleanAllPrEvntsByTimeout=function(f){if(!c.isOpen||(!b.BuddyListActive&&!b.View.PopOutWidget.active)||c.presenceEvntsCount<=0){return}setTimeout(function(){if(c.isOpen){c._removePresenceStatusEvents()}},f)};this._removePresenceStatusEvent=function(h,g,f){try{if((b.focus=="FOCUS_LOST"||!c.isOpen||(!b.BuddyListActive&&!b.View.PopOutWidget.active))&&!f){return
}var i=b.View.getEl(c.id+"_pstatus_"+h.id);if(!i&&!c.isOpen){i=c._getEleByIdfromChatPanelDiv(c.id+"_pstatus_"+h.id,"span")}if(!i){return}if(b.isIE){i.parentElement.style.filter="alpha(opacity=70)"}else{i.parentElement.style.opacity="0.70"}if(f){c._removePresentsEvtsRecursive(i,false)}else{setTimeout(function(){if(b.isIE){i.parentElement.style.filter="alpha(opacity=35)"
}else{i.parentElement.style.opacity="0.35"}setTimeout(function(){var k=b.View.getEl(c.id+"_pstatus_"+h.id);if(!k&&!c.isOpen){k=c._getEleByIdfromChatPanelDiv(c.id+"_pstatus_"+h.id,"span");if(!k){return}}c._removePresentsEvtsRecursive(k,g)},150)},150)}}catch(j){b.log("Failed to remove presence status element"+j,"error")
}};this._removePresentsEvtsRecursive=function(g,f){if(!g){return}var h=g.parentElement.parentElement;if(h){h.removeChild(g.parentElement)}c.scrollToBottom();c.presenceEvntsCount--;if(c.presenceEvntsCount<0){c.presenceEvntsCount=0}if(f){var g=b.View.getEl(c.id+"_pstatus_"+user.id);if(!g&&!c.isOpen){g=c._getEleByIdfromChatPanelDiv(c.id+"_pstatus_"+user.id,"span")
}if(g){c._removePresenceStatusEvent(user,f)}}};this._removePresenceStatusEvents=function(){try{if(c.subspaceId==""){return}var h=c.owner.workspaces[c.subspaceId].users;if(h){for(user in h){c._removePresenceStatusEvent(h[user],true)}}var f=c.owner.workspaces[c.subspaceId].oldUsers;if(f){for(user in f){c._removePresenceStatusEvent(f[user],true)
}}}catch(g){b.log("Failed to clean presence status element"+g,"error")}};this.onUserAdded=function(h){if(c.showHistoryIcon){c.hideHistoryIcon()}if(h.chatSessionId){c.chatSessionId=h.chatSessionId}if(h.user.isAnonymous){var f="chat_follow_"+h.user.id+"_"+c.id+"_holder";if(!b.View.getEl(f)){c.paintFollowLink(h.user,c._buildMemberAddedInfo(h));
c.owner.users[h.user.id].isAnonymousLnk=true}else{c._paintUserEvent(h.user,"joined",null,h.sourceId)}}else{var g=(h&&h.sourceId)?h.sourceId:null;if(c.owner.id==h.user.id&&c.roomType=="multi"){c._paintUserEvent(null,"addedBack")}else{if(c.owner.id!=h.user.id){c._paintUserEvent(h.user,"joined",null,g)}}}c.singlememId=c.entities.sort().join("_");
c.updateTitle();if(b.View.WindowManager.popupPanel.isShown){if(b.View.WindowManager.popupPanel.owner=="details_"+c.id&&c.displayPanel){b.log("chatWindow:onUserAdded details pop up panel was shown fetching details again","info");c.displayPanel.showDetails(c.userCount)}}};this._buildMemberAddedInfo=function(j){var k="/"+j.user.id,i=(b.View.PopOutWidget.active)?'target="_blank"':"";
var g="chat_follow_"+j.user.id+"_"+c.id+"_holder";var f=c.owner.users[j.sourceId]?c.owner.users[j.sourceId].getName():"";var h='<img class="person_icon float_left" alt="Person icon" src="'+b.imageLocation+'/1pxDummy.png"><span class="chat_join_event_txt">'+b.getCatalog("userAddedUser",'<a class="chat_messages_title" href="/'+j.sourceId+'">'+b.View.escapeHtml(f)+"</a>",'<a class="chat_messages_title" href="'+k+'" '+i+">"+b.View.escapeHtml(c.owner.users[j.user.id].getName())+"</a>")+"</span>";
if(!f){h='<img class="person_icon float_left" alt="Person icon" src="'+b.imageLocation+'/1pxDummy.png"><span class="chat_join_event_txt">'+b.getCatalog("userAdded",'<a class="chat_messages_title" href="'+k+'" '+i+">"+b.View.escapeHtml(c.owner.users[j.user.id].getName())+"</a>")+"</span>"}return h};this._paintUserEvent=function(j,i,k,n,m){var g=(j&&j.id)?j.id+"_"+i:c.owner.id+"_"+i;
if(g==c.lastUserEvent){return}c.lastUserEvent=g;var l="#",h=(n&&n!=j.id&&c.owner.users[n])?c.owner.users[n].getName():"";var f=(b.View.PopOutWidget.active)?'target="_blank"':"";if(i=="joined"||i=="left"){l="/"+j.id}var o="<img class='person_icon float_left' src='"+b.imageLocation+"/1pxDummy.png' alt='Person icon'> ";
if(i=="joined"&&h&&c.roomType=="multi"){o+='<span class="chat_join_event_txt">'+presence.getCatalog("userAddedUser",'<a class="chat_messages_title" href="/'+n+'">'+b.View.escapeHtml(h)+"</a>",'<a class="chat_messages_title" href="'+l+'" '+f+">"+b.View.escapeHtml(c.owner.users[j.id].getName())+"</a>")+"</span>"
}else{if(i=="joined"&&c.roomType=="multi"){o+='<span class="chat_join_event_txt">'+presence.getCatalog("userAdded",'<a class="chat_messages_title" href="'+l+'" '+f+">"+b.View.escapeHtml(c.owner.users[j.id].getName())+"</a>")+"</span>"}else{if(i=="left"&&c.roomType=="multi"){o+='<span class="chat_join_event_txt">'+presence.getCatalog("userLeft",'<a class="chat_messages_title" href="'+l+'" '+f+">"+b.View.escapeHtml(c.owner.users[j.id].getName())+"</a>")+"</span>"
}else{if(i=="removed"){o+='<span class="chat_join_event_txt">'+presence.config.catalog.userRemoved+"</span>"}else{if(i=="addedBack"){o+='<span class="chat_join_event_txt">'+presence.config.catalog.userAddedBack+"</span>"}else{return}}}}}c.onEvent(o,k," chat_join_event",m)};this.onUserLeft=function(f){if(!f.user){return
}if(f.user&&f.user.id==c.owner.id){c._paintUserEvent(f.user,"removed");c.disableWindow();if(c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].addToEventHistory(f.user.id,"user","removed")}}else{c._paintUserEvent(f.user,"left")}if(b.View.WindowManager.popupPanel.isShown){if(b.View.WindowManager.popupPanel.owner=="details_"+c.id&&c.displayPanel){b.log("chatWindow:onUserLeft details pop up panel was shown fetching details again","info");
if(f.user.id==b.Controller.ownerObj.id){b.View.WindowManager.popupPanel.hide()}else{c.displayPanel.showDetails(c.userCount)}}}c.updateTitle()};this.getAnonymousUsers=function(){var f=c.owner.workspaces[c.subspaceId];for(var g in f.users){if(f.users[g].isAnonymous){c.paintFollowLink(f.users[g])}}};this.paintHistoryLinks=function(){if(c.deepHistoryEl.hasChildNodes()){return
}var k=b.View.createEl("span",{className:"history_divider"});b.View.append(k,"|");var j=b.View.createEl("span",{className:"history_divider"});b.View.append(j,"|");var i=b.View.createEl("div",{className:"history_links"});var g=b.View.createEl("div",{align:"center",className:"lightGreyTxt"});b.View.append(g,presence.getCatalog("historyMessage"));
i.appendChild(g);var f=b.View.createEl("span",{id:"one_week_"+c.id+"_history",className:"chat_history"});b.View.append(f,presence.getCatalog("oneWeek"));f.onclick=function(){c.fetchDeepHistory(f,1)};i.appendChild(f);i.appendChild(k);var l=b.View.createEl("span",{id:"one_month_"+c.id+"_history",className:"chat_history"});
b.View.append(l,presence.getCatalog("oneMonth"));l.onclick=function(){c.fetchDeepHistory(l,2)};i.appendChild(l);i.appendChild(j);var h=b.View.createEl("span",{id:"all_"+c.id+"_history",className:"chat_history"});b.View.append(h,presence.getCatalog("allTime"));h.onclick=function(){c.fetchDeepHistory(h,3)
};i.appendChild(h);c.deepHistoryEl.appendChild(i);c.scrollToBottom()};this.fetchDeepHistory=function(g,f){if(!g){return}b.View.WindowManager.getDeepHistory(c,f)};this.disableHistoryLink=function(f){var j=b.View.getEl("one_week_"+c.id+"_history");var h=b.View.getEl("one_month_"+c.id+"_history");var g=b.View.getEl("all_"+c.id+"_history");
var i;if(f==1){i=j}else{if(f==2){i=h}else{if(f==3){i=g}else{return}}}b.View.removeClass(i,"chat_history");b.View.addClass(i,"lightGreyTxt");i.onclick=function(){};if(j==i){c.owner.workspaces[c.subspaceId].setAttribute("historyLink",1);c.enableHistoryLinks(h,2,g,3)}else{if(h==i){c.owner.workspaces[c.subspaceId].setAttribute("historyLink",2);
c.enableHistoryLinks(j,1,g,3)}else{if(g==i){c.owner.workspaces[c.subspaceId].setAttribute("historyLink",2);c.enableHistoryLinks(j,1,h,2)}}}};this.enableHistoryLinks=function(g,i,f,h){b.View.removeClass(g,"lightGreyTxt");b.View.addClass(g,"chat_history");g.onclick=function(){c.fetchDeepHistory(g,i)};b.View.removeClass(f,"lightGreyTxt");
b.View.addClass(f,"chat_history");f.onclick=function(){c.fetchDeepHistory(f,h)}};this.paintFollowLink=function(l,j,k,p){if(l.isAnonymous){c.updateScrollFlag();var i=b.View.createEl("div",{className:"chat_event_info"});var h=c.getFormattedTime();var o=b.View.createEl("div",{align:"right",className:"chat_time_stamp"});
if(p){j=c._buildMemberAddedInfo({user:l,sourceId:p})}if(j){var j=(j)?j:"";if(j=="followOnlyLink"){j=""}if(!b.isIE){b.View.addClass(i,"chat_join_event")}b.View.append(i,j);o.innerHTML=h}else{if(c.owner.users[l.id].isAnonymousLnk){if(k){h=c.getFormattedTime(k)}var n="";var m="/"+l.id,g=(b.View.PopOutWidget.active)?'target="_blank"':"";
if(c.roomType=="multi"){n="<span>"+presence.getCatalog("userAdded",'<a class="chat_messages_title" href="'+m+'" '+g+">"+b.View.escapeHtml(c.owner.users[l.id].getName())+"</a>")+"</span>"}b.View.append(i,n);o.innerHTML=h}}var f=c.buildFollowLink(l,"chat_join_event_txt");if(f){if(j){b.View.addClass(f,"chat_join_event_txt")
}i.appendChild(f)}if(j){i.appendChild(o)}else{if(c.owner.users[l.id].isAnonymousLnk){i.appendChild(o)}}if(f){c.chatPanel.appendChild(i)}c.scrollToBottom()}};this.buildFollowLink=function(g){var f="";var k="chat_follow_"+g.id+"_"+c.id+"_holder";var j=null;var h=b.View.WindowManager.getFollowLink(c,k);
if(!h){var i=b.View.escapeHtml(c.owner.users[g.id].getName());i=(i.length>20)?i.substr(0,17)+"...":i;j=b.View.createEl("span",{id:k,title:presence.config.catalog.followTextTip});var m=b.View.createEl("span",{className:"chat_follow_anonymous"});var l=b.View.createEl("span");f='<span><img src="'+b.imageLocation+'/1pxDummy.png" class="chat_info_icon" alt="'+presence.config.catalog.followTextTip+'" /></span>';
b.View.append(l,presence.getCatalog("followText",i));m.appendChild(l);b.View.append(m,f);j.appendChild(m);l.onclick=function(){c.followUser(g)}}return j};this.onSubspaceClosed=function(){c.updateTitle();c.onEvent("This chat session is closed");c.disableWindow();if(b.View.WindowManager.popupPanel.isShown){if(b.View.WindowManager.popupPanel.owner=="details_"+c.id&&c.displayPanel){b.log("chatWindow:onSubspaceClosed details pop up panel was shown fetching details again","info");
b.View.WindowManager.popupPanel.hide()}}};this.onError=function(f,g){if(!g&&c.composeTextArea.disabled==true){return b.log("Some error happend in chat window, but window is disabled")}c.updateScrollFlag();b.View.append(c.chatPanel,'<div class="chat_event_error_msg">'+f+"</div>");c.scrollToBottom();c.lastMessageFrom=null
};this.onEvent=function(g,j,i,f){if(c.composeTextArea.disabled==true){return b.log("Some event received, but window is disabled","warn")}c.updateScrollFlag();var h=i?i:"";var m=b.View.createEl("div",{className:"chat_event_info"+h});var l=j?c.getFormattedTime(j):c.getFormattedTime();var k=b.View.createEl("div",{align:"right",className:"chat_time_stamp"});
k.innerHTML=l;b.View.append(m,g);m.appendChild(k);if(f&&f===true){c.historyMsgsFragment.appendChild(m)}else{if(c.historyInprogress===true){c.bufferMsgsFragment.appendChild(m)}c.chatPanel.appendChild(m);c.scrollToBottom()}c.lastMessageFrom=null};this.scrollToBottom=function(){try{if(c.chatPanelContainer){if(popOut_ChatSubspaceId||b.View.PopOutWidget.active){c.chatPanelContainer.scrollTop=c.chatPanelContainer.scrollHeight
}else{if(c.enableAutoScroll||b.View.hasClass(c.chatScrollBar.scrollBar,"hide")){c.chatScrollBar.setHeight(c.chatPanelContainer.offsetHeight,true)}c.enableAutoScroll=true}}}catch(f){b.log("chat window scrollToBottom"+f.message)}};this.disableWindow=function(){c.composeTextArea.disabled=true;b.View.addClass(c.composeTextAreaWrap,"disabled");
b.View.addClass(c.mainElement,"disabled");c.composeTextArea.blur();if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].disabled=true}b.View.removeHandler(c.inviteElement,"click",c.showSearch);if(b.View.WindowManager.popupPanel.isShown&&(b.View.WindowManager.popupPanel.owner=="search_"+c.id||b.View.WindowManager.popupPanel.owner=="details_"+c.id)){b.View.WindowManager.popupPanel.hide()
}if(c.roomType!="multi"){b.View.setClass(c.presenceElement,b.View.Buddylist.getPresenceClass(20))}};this.disableWindowOnly=function(){c.composeTextArea.disabled=true;b.View.addClass(c.composeTextAreaWrap,"disabled");b.View.addClass(c.mainElement,"disabled");c.composeTextArea.blur();b.View.removeHandler(c.inviteElement,"click",c.showSearch)
};this.enableWindowOnly=function(){c.composeTextArea.disabled=false;b.View.removeClass(c.composeTextAreaWrap,"disabled");b.View.removeClass(c.mainElement,"disabled");b.View.removeHandler(c.inviteElement,"click",c.showSearch);b.View.addHandler(c.inviteElement,"click",c.showSearch)};this.enableWindow=function(){if(c.composeTextArea.disabled==true){c.composeTextArea.disabled=false;
b.View.removeClass(c.composeTextAreaWrap,"disabled");b.View.removeClass(c.mainElement,"disabled");if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){delete c.owner.workspaces[c.subspaceId].disabled}b.View.removeHandler(c.inviteElement,"click",c.showSearch);b.View.addHandler(c.inviteElement,"click",c.showSearch)
}else{b.log("enableWindow: window already enabled")}};this.notifyMessage=function(g,f){Jiffy.mark("ChatWindowAlert");b.log("chatWindow notifyMessage from: "+g+" count: "+f);if(c.collapsed||!c.isOpen){if(f){c.msgCount+=f}else{c.msgCount++}}if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){c.owner.workspaces[c.subspaceId].newMsgCount=c.msgCount
}Jiffy.measure("Done","ChatWindowAlert")};this.resetCount=function(){c.msgCount=0;if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){if(c.isOpen){delete c.owner.workspaces[c.subspaceId].newMsgCount}}};this.showSearch=function(g){Jiffy.mark("InvitePeoplePopUp");b.View.Buddylist.searchOfffocus(g);b.View.stopEventPropogation(g);
b.View.WindowManager.popupPanel.clear();var f=b.View.WindowManager.popupPanel;if(f.owner=="search_"+c.id&&f.isShown){return f.hide()}if(c.roomType=="multi"){c.showDetails()}c.popupHolder.appendChild(f.holder);f.setTitle(presence.config.catalog.detailsHeader);b.View.WindowManager.popupPanel.owner="search_"+c.id;
if(c.userCount>=b.config.maxMultiChatUsers){b.View.addClass(c.inviteElement,"clicked");f.show(null,{offsetLeft:0},function(){b.View.removeClass(c.inviteElement,"clicked");b.View.focusEle("presence_"+c.id+"_button_add")});b.View.append(b.View.WindowManager.popupPanel.panel,'<div class="chat_buddy_list_body"><div class="chat_popup_warn">'+b.getCatalog("maxUsersExceed",b.config.maxMultiChatUsers)+"</div></div>");
return}b.View.addClass(c.inviteElement,"clicked");f.show(null,{color:"grey"},function(){b.View.removeClass(c.inviteElement,"clicked");b.View.focusEle("presence_"+c.id+"_button_add")});c.findAndAddUsers();Jiffy.measure("Done","InvitePeoplePopUp");new b.View.Accessibility({id:f.panelClosebtn.id,onTabClick:function(){c.displayPanel.resultSpanHeader.focus()
},onEscape:function(){f.panelClosebtn.click()}})};this.findAndAddUsers=function(){var f={};if(c.subspaceId&&c.owner.workspaces[c.subspaceId]){f=c.owner.workspaces[c.subspaceId].users}c.searchPanel=new b.View.SearchPanel(function(h,g){if(g&&g==true){b.View.WindowManager.popupPanel.hide();return null}Jiffy.mark("UserAddedToChat");
c.addMembersToChat(h);c.scrollToBottom();b.View.WindowManager.popupPanel.hide();b.Controller.updateChatterActivity()},f,true);b.View.WindowManager.popupPanel.appendChild(c.searchPanel.panel);b.View.WindowManager.popupPanel.appendToolBar(c.searchPanel.inputDiv);c.searchPanel.searchInput.focus();new b.View.Accessibility({id:c.searchPanel.searchInput.id,onTabClick:function(){b.View.WindowManager.popupPanel.panelClosebtn.focus()
},onEscape:function(){popup.panelClosebtn.click()}})};this.addMembersToChat=function(i,l,j){if(c.owner.users[i.id]&&c.owner.users[i.id].presenceStatus==20){return}var h;if(i instanceof Array){h=i}else{h=[i.id]}var g=c.owner.workspaces[c.subspaceId].once1toM;c.singlememId=c.entities.sort().join("_");var k={memberIds:h};
var f={chatId:c.subspaceId};b.Controller.call({method:"addMemberToWorkspace",data:k,urlData:f,successCallBack:function(m){Jiffy.measure("Done","UserAddedToChat");if(c.showHistoryIcon){c.hideHistoryIcon()}c.chatSessionId=m.data.chatSessionId;c.owner.workspaces[m.data.subspaceId].chatSessionId=m.data.chatSessionId;
if(l&&typeof l=="function"){l(true)}else{if(c.composeTextArea.disabled==true){c.enableWindow()}}},failCallBack:function(m){if(l&&typeof l=="function"){l(false,m)}else{c.addMembersFailed(k,f,i.getName(),m)}}})};this.addMembersFailed=function(j,h,k,i){if(i&&i.errorCode=="allUsersAreOffline"){if(i&&i.errorCode=="allUsersAreOffline"){var g=j.memberIds;
for(var f=0;f<g.length;f++){b.Controller.EventParser({messages:[{data:{presence:{message:"Unavailable",status:20},userId:g[f],screenName:k},header:{topic:"event.user.presence.status"}}]})}}}else{if(i&&i.errorCode=="subspaceDoesNotExist"){c.onSubspaceClosed()}else{b.View.removeClass(c.chatErrorEl,"hide");
var m='<img class="chat_error error_16 float_left" alt="error" src="'+b.imageLocation+'/1pxDummy.png" />'+presence.getCatalog("addMembersFailed",k)+'<a id="presence_'+c.id+'_msg_error" class="chat_error_link">'+presence.config.catalog.tryAgain+"</a>";b.View.html(c.chatErrorEl,m);b.View.addHandler(b.View.getEl("presence_"+c.id+"_msg_error"),"click",function(){c.retryAddUser(j,h,k)
})}}};this.retryAddUser=function(g,f,h){b.View.html(c.chatErrorEl,'<img class="chat_error float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.widgetLoading);b.Controller.call({method:"addMemberToWorkspace",data:g,urlData:f,successCallBack:function(i){b.View.addClass(c.chatErrorEl,"hide")
},failCallBack:function(i){c.addMembersFailed(g,f,h,i)}})};this.showDetails=function(g){b.View.Buddylist.searchOfffocus(g);b.View.stopEventPropogation(g);var f=b.View.WindowManager.popupPanel;if(f.owner=="details_"+c.id&&f.isShown){return f.hide()}c.popupHolder.appendChild(f.holder);f.owner="details_"+c.id;
c.displayPanel=new b.View.ChatDetailsPanel(c.subspaceId,function(i,h){if(h&&h==true){b.View.WindowManager.popupPanel.hide();return null}c.removeMember(i);b.View.WindowManager.popupPanel.hide();b.Controller.updateChatterActivity()},function(h){Jiffy.mark("UserAddedToChat");c.addMembersToChat(h);c.scrollToBottom();
b.View.WindowManager.popupPanel.hide();b.Controller.updateChatterActivity()},b.View.WindowManager.popupPanel.id);b.View.WindowManager.popupPanel.appendChild(c.displayPanel.panel);c.displayPanel.showDetails(c.userCount)};this.removeMember=function(g,h){Jiffy.mark("UserRemovedFromChat");var f={memberId:g.id,chatId:c.subspaceId};
b.Controller.call({method:"removeMemberToWorkspace",data:{},urlData:f,successCallBack:function(i){Jiffy.measure("Done","UserRemovedFromChat");if(h&&typeof h=="function"){h(i)}},failCallBack:function(i){if(h&&typeof h=="function"){h(i)}c.removeMembersFailed(f,g.getName(),i)}})};this.removeMembersFailed=function(g,h,f){if(f&&f.errorCode=="subspaceDoesNotExist"){c.onSubspaceClosed()
}else{b.View.removeClass(c.chatErrorEl,"hide");var i='<img class="chat_error error_16 float_left" alt="error" src="'+b.imageLocation+'/1pxDummy.png" />'+presence.getCatalog("removeMembersFailed",b.View.escapeHtml(h))+'<a id="presence_'+c.id+'_msg_error" class="chat_error_link">'+presence.config.catalog.tryAgain+"</a>";
b.View.html(c.chatErrorEl,i);b.View.addHandler(b.View.getEl("presence_"+c.id+"_msg_error"),"click",function(){c.retryRemoveUser(g,h)})}};this.retryRemoveUser=function(f,g){b.View.html(c.chatErrorEl,'<img class="chat_error float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.widgetLoading);
b.Controller.call({method:"removeMemberToWorkspace",data:{},urlData:f,successCallBack:function(h){b.View.addClass(c.chatErrorEl,"hide")},failCallBack:function(h){c.removeMembersFailed(f,g,h)}})};this.followUser=function(f){if(canvas_window.umpsHttpGateWay){canvas_window.umpsHttpGateWay({url:"/services/data/v23.0/chatter/users/me/following?subjectId="+f.id,method:"POST",data:{subjectId:f.id},success:function(h){b.log("Follow:follow "+f.name+" success="+h,"info");
b.View.WindowManager.followUserSuccess(f);var g={method:"umps.chatter.addFollowee",data:{entityID:f.id},callbackFn:function(){}};b.Adapter.executeAction(g);b.View.Actions.sendCustomEvent({event:"followUser",userId:f.id})},failure:function(g){b.View.WindowManager.followUserSuccess(f);b.log("Follow:follow "+f.name+" failure="+g,"info");
c.followUserFailed(f)},headers:{Authorization:"OAuth "+b.Controller.parentData.sid,"Content-Type":"application/x-www-form-unicode; charset=UTF-8",Accept:"*/*"}})}};this.followUserFailed=function(f){b.log("Follow sent failed","info")};this.getFormattedTime=function(f){return b.View.getFormattedTime(f)
};this.repaintThumbnails=function(j,g){var f=b.View.getByClass(c.chatPanel,"chat_user_thumbnail");for(var h=0;h<f.length;h++){if(f[h].parentNode.href&&f[h].parentNode.href.search("/"+j)!=-1){if(g){f[h].src=c.owner.picture}else{if(c.owner.users[j]){f[h].src=c.owner.users[j].picture}else{if(b.Model.UserStore.users[j]){f[h].src=b.Model.UserStore.users[j].picture
}}}}}if(g){return}var k=b.View.getByClass(c.chatPanel,"chat_messages_title");for(var h=0;h<k.length;h++){if(k[h].href.search("/"+j)!=-1){var l;if(c.owner.users[j]){l=c.owner.users[j].getName()}else{if(b.Model.UserStore.users[j]){l=b.Model.UserStore.users[j].name}}l=b.View.escapeHtml(l);if(l){k[h].innerHTML=l
}}}};this.resize=function(){if(b.View.PopOutWidget.active){if(b.View.WindowManager.curWindow&&b.View.WindowManager.curWindow.id!=c.id){return}if(b.View.getEl("chat_buddy_"+c.id+"_title_error")){return}var g=b.isIE?20:25;var f=b.getBrowserHeight()-g;var h=b.getBrowserWidth()-225-20;if(!b.BuddyListActive||popOut_ChatSubspaceId){h=h+220
}if(h<b.config.chatWindowMinWidth){h=b.config.chatWindowMinWidth}if(f<b.config.chatWindowMinHeight){f=b.config.chatWindowMinHeight}var i=(popOut_ChatSubspaceId)?90:140;f=f-i-(parseInt(c.composeTextArea.style.height)-16);c._resizeChatWindow(h,f)}};this._resizeChatWindow=function(g,f){if(b.config.screenShareEnabled&&b.config.isOSsupported){if(!b.View.hasClass(c.sharePanel,"hide")){c.sharePanel.style.width=(g-20)+"px"
}if(!b.View.hasClass(c.sharePanel,"hide")){f=f-c.sharePanelHeight}if(g!=null){c.viewNofityDisable.style.width=g+"px"}}if(b.config.chatMsgDeepHistoryEnabled){f=f-c.deepHistoryEl.offsetHeight}if(typeof c.composeTextArea.heightChanged=="function"){c.composeTextArea.heightChanged(f)}c.chatPanelContainer.style.height=f+"px";
if(!g){return c.scrollToBottom()}c.chatPanelContainer.style.width=g+"px";c.composeTextArea.style.width=g-7+"px";c.chatErrorEl.style.width=(g-20)+"px";c.chatPanelContent.style.width=g+22+"px";if(typeof c.composeTextArea.widthChanged=="function"){c.composeTextArea.widthChanged(g-7)}if(typeof c.composeTextArea.elongate=="function"){c.composeTextArea.elongate()
}c.scrollToBottom()};this.resetWidthHeight=function(){c.chatPanelContainer.style.width="";c.chatPanelContainer.style.height="";c.chatPanelContent.style.height=""};this.toggleFavorite=function(g){b.View.Buddylist.searchOfffocus(g);var f;if(b.config.chatMsgDeepHistoryEnabled){f=c.chatSessionId}else{f=c.owner.generateFvtId(c.entities)
}if(c.owner.favorites[f]){b.View.Buddylist.Favorites.remove(f)}else{b.View.Buddylist.Favorites.add(c.entities,"",c.subspaceId,c.chatSessionId)}};this.updateScrollFlag=function(){if(popOut_ChatSubspaceId||b.View.PopOutWidget.active){return}var f=c.chatScrollBar.scrollBar.offsetHeight-c.chatScrollBar.scrollbarDrag.offsetHeight-1;
var g=c.chatScrollBar.scrollbarDrag.offsetTop;if(f==g){c.enableAutoScroll=true}else{c.enableAutoScroll=false}};this.pushToHistory=function(){};this.isMessageinBufferQueue=function(m){if(!m){return false}if(c.bufferMessageQueue.length>0){var h=c.bufferMessageQueue[0][0];if(m.timestamp<h.timestamp){return false
}}for(var j=c.bufferMessageQueue.length-1;j>=0;j--){var l=c.bufferMessageQueue[j];for(var g=l.length-1;g>=0;g--){var f=l[g];var n=(m.sourceId==c.owner.id)?"me":m.sourceId;if(f.from===n&&f.timestamp===m.timestamp){return true}}}return false}};b.View.ChatWindow=a})(presence);(function(b){var a=function(i){var d=this;
this.callback=i.callback;this.scrollPane=i.scrollPane;this.scrollMainPan=i.scrollMainPan;this.scrollBar=b.View.createEl("div",{className:"scrollbar_holder"});this.scrollbarDrag=b.View.createEl("div",{className:"scroll_drag"});d.scrollBar.appendChild(d.scrollbarDrag);d.scrollMainPan.appendChild(d.scrollBar);
d.fadeTimer=null;d.scrollActive=false;var g=0;new b.View.Draggable(d.scrollbarDrag,function(m,l){if(m=="dragstart"){g=d.scrollbarDrag.offsetTop}var k=l.startY-l.lastY;d.scrollbarDrag.style.top=g-k+"px";c()},canvas_doc);b.View.addHandler(d.scrollPane,"mouseover",function(k){if(d.scrollActive){return}j()
});b.View.addHandler(d.scrollPane,"mouseout",function(k){d.scrollActive=false});b.View.addHandler(d.scrollbarDrag,"mousedown",function(k){f(d.scrollBar,"scroll_visible");clearTimeout(d.fadeTimer);d.scrollActive=true});b.View.addHandler(d.scrollbarDrag,"mouseup",function(k){j()});b.View.addHandler(d.scrollMainPan,"mousewheel",function(l){l=canvas_window.event||l;
b.View.cancelEvent(l);var k=l.wheelDelta;d.mouseWheelListner(k)});b.View.addHandler(d.scrollMainPan,"DOMMouseScroll",function(l){l=canvas_window.event||l;b.View.cancelEvent(l);var k=-40*l.detail;d.mouseWheelListner(k)});this.mouseWheelListner=function(l){if(b.View.hasClass(d.scrollBar,"hide")){return
}var k=d.scrollbarDrag.offsetTop;var m=k-(d.scrollbarDrag.offsetHeight*l/d.scrollPane.offsetHeight);d.scrollbarDrag.style.top=m+"px";c()};var j=function(){d.scrollActive=true;f(d.scrollBar,"scroll_visible");clearTimeout(d.fadeTimer);d.fadeTimer=setTimeout(function(){f(d.scrollBar,"scroll_semiVisible");
setTimeout(function(){f(d.scrollBar,"scroll_invisible")},100)},1000)};var f=function(k,l){b.View.removeClass(k,"scroll_visible");b.View.removeClass(k,"scroll_semiVisible");b.View.removeClass(k,"scroll_invisible");b.View.addClass(k,l)};var c=function(k){f(d.scrollBar,"scroll_visible");clearTimeout(d.fadeTimer);
d.scrollActive=true;var l=d.scrollBar.offsetHeight-d.scrollbarDrag.offsetHeight-1;var m=(d.scrollPane.offsetHeight*d.scrollbarDrag.offsetTop)/d.scrollBar.offsetHeight;m=(isFinite(m))?m:0;d.scrollPane.style.top=-(m)+"px";if(d.scrollbarDrag.offsetTop<0){d.scrollPane.style.top="0px";d.scrollbarDrag.style.top="0px"
}else{if(d.scrollbarDrag.offsetTop>=l){d.scrollPane.style.top=(d.scrollBar.offsetHeight-d.scrollPane.offsetHeight)+"px";d.scrollbarDrag.style.top=l+"px"}}if(k!=false&&d.callback&&typeof d.callback=="function"){d.callback(d)}j()};var h=function(){f(d.scrollBar,"scroll_visible");clearTimeout(d.fadeTimer);
d.scrollActive=true;var k=d.scrollBar.offsetHeight-d.scrollbarDrag.offsetHeight-1;var l=(d.scrollbarDrag.offsetHeight*d.scrollPane.offsetTop)/d.scrollMainPan.offsetHeight;l=(isFinite(l))?l:0;d.scrollbarDrag.style.top=-(l)+"px";if(d.scrollbarDrag.offsetTop<0){d.scrollPane.style.top="0px";d.scrollbarDrag.style.top="0px"
}else{if(d.scrollbarDrag.offsetTop>=k){d.scrollPane.style.top=(d.scrollBar.offsetHeight-d.scrollPane.offsetHeight)+"px";d.scrollbarDrag.style.top=k+"px"}}j()};this._scrolltoBottom=function(){if(b.View.hasClass(d.scrollBar,"hide")){return}var k=d.scrollBar.offsetHeight-d.scrollbarDrag.offsetHeight-1;d.scrollPane.style.top=(d.scrollBar.offsetHeight-d.scrollPane.offsetHeight)+"px";
d.scrollbarDrag.style.top=k+"px"};this._scrolltop=function(){d.scrollPane.style.top="0";d.scrollbarDrag.style.top="0"};this._scrollto=function(k){d.scrollbarDrag.style.top=k+"px";c(false)};this._scrollto_panel=function(k){d.scrollbarDrag.style.top=-k+"px";h(false)};this._downkeyscroll=function(l,k,m){if(k<d.scrollMainPan.offsetHeight){return null
}if(m){d.scrollPane.style.top=-(l+d.scrollPane.offsetHeight-30)+"px"}else{d.scrollPane.style.top=(d.scrollPane.offsetTop+l)+"px"}h()};this._upkeyscroll=function(l,k,m){if(k>=0&&!m){return null}if(m){d.scrollPane.style.top=-(k+l-d.scrollMainPan.offsetHeight+30)+"px"}else{d.scrollPane.style.top=(d.scrollPane.offsetTop+l)+"px"
}h()};this.setHeight=function(k,n){try{var k=k;if(k-3<=0){d.hide();return}d._scrolltop();var l=Math.round(k-(k*(d.scrollPane.offsetHeight-k+d.scrollPane.offsetTop))/d.scrollPane.offsetHeight);l=(isFinite(l)&&l>0)?l:0;d.scrollbarDrag.style.height=l+"px";d.scrollBar.style.height=k-3+"px";if(d.scrollPane.offsetHeight<=k){d.hide()
}else{d.show();if(n){d._scrolltoBottom()}}}catch(m){b.log("scroll bar setheight:::"+m.message)}};this.show=function(){b.View.removeClass(d.scrollBar,"hide")};this.hide=function(){b.View.addClass(d.scrollBar,"hide")}};b.View.CustomScrollBar=a})(presence);(function(b,c){var a=function(f,i,h,g){var d=this;
this.callback=i;this.ele=f;this.doc=h||b.document;this.dragStarted=false;this.mouseIsDown=false;this.dragData=g;this.dragThreshold=5;this.onMouseDown=function(k){k=window.event||k;var j=k.which||k.button;if(j!=1){return}if(d.mouseIsDown){return}d.mouseIsDown=true;d.startX=d.lastX=k.clientX;d.startY=d.lastY=k.clientY;
c.View.addHandler(d.doc,"mousemove",d.onMouseMove);c.View.addHandler(d.doc,"mouseup",d.onMouseUp);c.View.addHandler(d.doc,"blur",d.onMouseUp);c.View.cancelEvent(k);c.View.stopEventPropogation(k)};this.onMouseUp=function(j){d.mouseIsDown=false;j=window.event||j;c.View.removeHandler(d.doc,"mousemove",d.onMouseMove);
c.View.removeHandler(d.doc,"mouseup",d.onMouseUp);c.View.removeHandler(d.doc,"blur",d.onMouseUp);if(d.dragStarted){d.doCallback("dragend")}d.dragStarted=false;c.View.cancelEvent(j);c.View.stopEventPropogation(j);setTimeout(function(){a.dragData=null;a.callbackFromTarget=null},50)};this.onMouseMove=function(k){k=window.event||k;
if(c.isIE&&k.button==0&&!window.performance){return d.onMouseUp()}if(!d.dragStarted){var j=Math.max(Math.abs(d.startX-k.clientX),Math.abs(d.startY-k.clientY))}if(!d.dragStarted&&j>=d.dragThreshold){d.dragStarted=true;d.doCallback("dragstart");a.dragData=d.dragData;a.callbackFromTarget=d.callbackFromTarget
}else{if(!d.dragStarted){return c.View.cancelEvent(k)}}d.lastX=k.clientX;d.lastY=k.clientY;c.View.cancelEvent(k);d.doCallback("drag")};this.doCallback=function(j){if(d.callback&&typeof d.callback=="function"){d.callback.call(d.ele,j,{startX:d.startX,lastX:d.lastX,startY:d.startY,lastY:d.lastY})}};this.callbackFromTarget=function(j){d.doCallback(j)
};c.View.addHandler(f,"mousedown",d.onMouseDown)};c.View.Draggable=a})(window,presence);(function(a,c){var b=function(f,h,g){var d=this;this.callback=h;this.ele=f;this.doc=g||a.document;this.onMouseOver=function(i){if(!c.View.Draggable.dragData){return}i=window.event||i;c.View.addHandler(d.ele,"mouseup",d.onMouseUp);
c.View.addHandler(d.ele,"mouseout",d.onMouseOut);c.View.cancelEvent(i);c.View.stopEventPropogation(i);d.doCallback("dropover")};this.onMouseOut=function(i){i=window.event||i;c.View.removeHandler(d.ele,"mouseup",d.onMouseUp);c.View.removeHandler(d.ele,"mouseout",d.onMouseOut);d.doCallback("dropout")};
this.onMouseUp=function(i){i=window.event||i;c.View.removeHandler(d.ele,"mouseup",d.onMouseUp);c.View.removeHandler(d.ele,"mouseout",d.onMouseOut);d.doCallback("dropped")};this.doCallback=function(i){if(d.callback&&typeof d.callback=="function"){d.callback.call(d.ele,i,{data:c.View.Draggable.dragData})
}};c.View.addHandler(f,"mouseover",d.onMouseOver)};c.View.Droppable=b})(window,presence);(function(b,d){var a=function(f,h,i){var g=undefined;if(f.currentStyle){g=f.currentStyle[h]}else{if(canvas_doc.defaultView&&canvas_doc.defaultView.getComputedStyle){g=canvas_doc.defaultView.getComputedStyle(f,"")[h]
}else{if(f.style[h]){g=f.style[h]}else{g=undefined}}}if(i){return parseInt(g)||0}else{return g}};var c=function(h,k,n,g,m){var f=16;var l=a(h,"width",true);var m=m;if(g){var i=d.View.PopOutWidget.getChatWindowContainerHeight()}k=k?k:f*2;n=n?n:f;h.style.overflow="hidden";var j=canvas_doc.createElement("textarea");
j.style.position="absolute";j.style.top="-2000px";j.style.left="-1000px";j.style.wordWrap="break-word";j.style.overflow="hidden";j.className=h.className;j.style.height="0px";if(h.parentNode){h.parentNode.appendChild(j)}h.elongate=function(){j.value=h.value;var o=j.scrollHeight;if(!d.isFF){o=o-a(j,"paddingTop",true)-a(j,"paddingBottom",true)
}if(o>=k){h.style.overflowX="hidden";h.style.overflowY="auto";o=k}else{if(o<=n){h.style.overflow="hidden";o=n}else{h.style.overflowX="hidden";h.style.overflowY="hidden";o=o+3}}var p=h.style.height;h.style.height=o+"px";if(g){g.style.height=(i-(o-f))+"px"}if((p>h.style.height||p<h.style.height)&&m&&typeof m=="function"){m()
}};d.View.addHandler(h,"keyup",h.elongate);d.View.addHandler(h,"change",h.elongate);h.resetSize=function(){h.style.height=n+"px";if(g){g.style.height=i+"px"}};h.heightChanged=function(o){i=o+parseInt(h.style.height)-f};h.widthChanged=function(o){j.style.width=o+"px"};h.getHeightDiff=function(){return parseInt(h.style.height)-f
};return h};d.View.ElasticInput=c})(window,presence);(function(b){var a=function(){var c=b.Model.Owner.getInstance();var d=this;this.favsCount=0;var f=b.View.Buddylist;this.hoverTimeOut=null;this.errorTimer=null;this.curEditEl=null;this.curSel=null;this.errEl=null;this.preFavId=null;this.paintList=function(i,m){if(b.View.Buddylist.favEditActive||d.favupDated){return
}b.log("Buddylist.Favorites.paintList");Jiffy.mark("PaintFvtList");var l=i?i:c.favorites;if(!i&&(f.searchActive||f.favEditActive)){return}var n=b.View.getEl("umps_favorites_body");if(!n){return}var g=canvas_doc.createDocumentFragment();var j=0;for(var k in l){var h=d.createEl(l[k]);if(h){j++;g.appendChild(h)
}d.updateFvtButton(k)}n.innerHTML="";if(j>0){d.errEl=null;d.errEl=b.View.createEl("div",{className:"chat_buddy_list_error hide"});n.appendChild(d.errEl);n.appendChild(g);b.View.append(n,'<div class="umps_favorites_not_empty"></div>');if(!d.editMode){b.View.removeClass(b.View.getEl("umps_fav_edit"),"hide");
b.View.removeClass(b.View.getEl("umps_fav_edit_dummy"),"hide")}}else{n.innerHTML='<div class="umps_favorites_empty">'+b.getCatalog("pleaseAddFavorites")+"</div>";d.editModeOff();b.View.addClass(b.View.getEl("umps_fav_edit"),"hide");b.View.addClass(b.View.getEl("umps_fav_edit_dummy"),"hide")}b.View.RosterHeaders.hideDummyHeaders();
if(!d.inited){d.makeDroppable(n);d.makeDroppable(b.View.getEl("umps_favorites"));d.makeDroppable(b.View.getEl("umps_favorites_dummy"))}d.inited=true;d.favsCount=j;if(!f.searchActive&&!f.favEditActive&&(!m||m.length!=1)){f.setPanelHeight()}Jiffy.measure("Done","PaintFvtList");d.toggleFavsAccessibility(false)
};this.showHide=function(h){var i=b.View.getEl("umps_favorites_body");var g=b.View.getEl("umps_favorites");if(h=="show"){b.View.removeClass(g,"hide");f.toggleFavoritesPanel(true)}else{b.View.addClass(i,"hide");b.View.addClass(g,"hide")}};this.makeDroppable=function(g){new b.View.Droppable(g,function(j,i){if(i.data&&i.data.source=="favorites"){return
}if(d.favsCount>=b.config.maxFavorites){if(b.View.Draggable.callbackFromTarget){b.View.Draggable.callbackFromTarget("dropDenied");d.addErrorMessage(b.getCatalog("FavoritesLimit",b.config.maxFavorites));return}}if(j=="dropover"){b.View.addClass(g,"dropover");if(b.View.Draggable.callbackFromTarget){if(i.data.userId||i.data.type=="conversation"){b.View.Draggable.callbackFromTarget("dropAllowed")
}else{b.View.Draggable.callbackFromTarget("dropDenied")}}}else{if(j=="dropout"){b.View.removeClass(g,"dropover");if(b.View.Draggable.callbackFromTarget){b.View.Draggable.callbackFromTarget("dropCleared")}}else{if(j=="dropped"){b.View.removeClass(g,"dropover");if(!i.data){return}if(i.data.userId){if(i.data.type=="searchuser"){var h=i.data.userId;
if(!c.users[h]){b.View.addUserToOwnerList(h,d.add,null,true)}else{d.add([h])}}else{d.add([i.data.userId])}b.View.RosterHeaders.hideDummyHeaders();d.showHide("show")}else{if(i.data.type=="conversation"){d.add(i.data.chatWindow.entities);b.View.RosterHeaders.hideDummyHeaders();d.showHide("show")}}}}}},canvas_doc)
};this.createEl=function(n){var o={},l="",r,q="",j=0,t=0;var k=d.getName(n.id),o=c.users[n.users[n.users.length>0?n.users.length-1:0]];if(n._startIndex!==undefined){r=b.View.escapeHtml(k.substring(0,n._startIndex))+"<span class='search_highlight'>"+b.View.escapeHtml(k.substring(n._startIndex,n._endIndex))+"</span>"+b.View.escapeHtml(k.substring(n._endIndex))
}else{r=b.View.escapeHtml(k)}var m=b.View.createEl("div",{id:"umps_fav_"+n.id,className:"chat_buddy_list_display",title:b.View.escapeStr(k)});var g=b.View.createEl("div",{className:"remove_fav",title:b.getCatalog("removeFavorite"),id:"umps_fav_"+n.id+"_remove"});g.onclick=function(v){b.View.stopEventPropogation(v);
try{if(d.curEditEl){d.curEditEl.blur()}}catch(u){}d.remove(n.id)};m.appendChild(g);if(n.users.length==1){var i=f.getPresenceClass(o.presenceStatus);l+='<img class="chat_buddy_status_img float_right" src="'+b.imageLocation+'/1pxDummy.png" alt="'+(i=="offline"?b.getCatalog("unavailable"):b.getCatalog(i))+'">';
b.View.addClass(m,i);if(o.presenceStatus!=20){m.onclick=function(){if(d.editMode){try{if(d.curEditEl){d.curEditEl.blur()}}catch(u){}return}f.onFavoriteClick(n.id)}}else{if(!b.hideOfflineUsers&&(!f.searchActive&&!f.favEditActive)){return false}else{m.onclick=function(){if(d.editMode){return}f.onFavoriteClick(n.id)
}}}f.makeItemDraggable(m,{type:"user",userId:o.id,source:"favorites"})}else{m.onmouseover=function(x){if(d.editMode){return}x=canvas_window.event||x;var u=n.users,v=u.length,w=0;while(v){c.users[u[v-1]]&&(c.users[u[v-1]].presenceStatus!=20)&&w++;v--}b.View.RosterParticipantsList.elHover({evt:x,buddyListObj:u,curActiveEl:m})
};m.onmouseout=function(){b.View.RosterParticipantsList.elHoverOut()};m.onclick=function(){if(d.editMode){if(d.curEditEl&&d.curEditEl.id!="umps_fav_"+n.id+"_editname"){d.curEditEl.blur()}return}var u=n.users,v=u.length,w=0;while(v){c.users[u[v-1]]&&(c.users[u[v-1]].presenceStatus!=20)&&w++;v--}f.onFavoriteClick(n.id)
};q=" group_chat_icon";f.makeItemDraggable(m,{type:"favorite",favId:n.id,source:"favorites"})}l+='<img id="umps_fav_'+n.id+'_image" class="chat_buddy_list_img'+q+'" alt="'+b.View.escapeStr(k)+'" src="'+o.picture+'">';b.View.append(m,l);if(n.users.length>1){var h=b.View.createEl("span",{id:"umps_fav_"+n.id+"_name",className:"chat_buddy_list_name",html:r});
h.onclick=function(){if(!d.editMode){return}window.setTimeout(function(){d.inlineEdit(n.id,h)},100)};var p=b.View.createEl("span",{id:"umps_fav_"+n.id+"_name_error",className:"errorMark float_right hide",html:"!"});m.appendChild(p);m.appendChild(h);b.View.addClass(m,"multiChat")}else{l='<span id="umps_fav_'+n.id+'_name" class="chat_buddy_list_name">'+r+"</span>";
b.View.append(m,l)}return m};this.add=function(m,i,l,h){if(d.favsCount>=b.config.maxFavorites){d.addErrorMessage(b.getCatalog("FavoritesLimit",b.config.maxFavorites));return}var j;if(b.config.chatMsgDeepHistoryEnabled){j=h}else{j=c.generateFvtId(m)}if(c.favorites[j]&&!i){return}var g;if(b.config.chatMsgDeepHistoryEnabled){g={chatSessionMembers:m,favoriteName:i?i:""}
}else{g={memberIds:m,favoriteName:i?i:""}}if(l){g.chatId=l}if(h){g.chatSessionId=h}b.log("addFavorite success");j=c.addFavorite(g);d.removeErrorMessage(j);if(!f.searchActive||!f.favEditActive){d.paintList()}else{f.search()}if(f.searchActive&&!f.favEditActive){f.searchOfffocus()}d.updateFvtButton(j);d.highlightNewBorn(j);
var k;if(b.config.chatMsgDeepHistoryEnabled){if(h){k={chatSessionId:h}}else{k={userId:m[0]}}}else{k={favorites:[g]}}b.Controller.call({method:"addFavorite",data:k,successCallBack:function(o){if((o.data.favorites&&!o.data.favorites[0].favoriteId)||(o.data.favorite&&!o.data.favorite.chatSessionId)){c.removeFavorite(j);
d.removeErrorMessage(j);if(!f.searchActive||!f.favEditActive){d.paintList()}else{f.search()}d.updateFvtButton(j);return}if(!b.config.chatMsgDeepHistoryEnabled){var n=c.favorites[j];if(n){n.actualFavId=o.data.favorites[0].favoriteId}}else{var n=c.favorites[j];if(n){n.chatSessionId=o.data.favorite.chatSessionId
}}},failCallBack:function(n){c.removeFavorite(j);d.removeErrorMessage(j);if(!f.searchActive||!f.favEditActive){d.paintList()}else{f.search()}d.updateFvtButton(j);if(n&&n.errorCode=="favoritesMaxLimitReached"){d.addErrorMessage(b.getCatalog("FavoritesLimit",b.config.maxFavorites))}else{d.addErrorMessage(b.getCatalog("FavNotSaved"))
}b.log("addFavorite failed","warn")}});b.Controller.updateChatterActivity()};this.remove=function(k){var n;if(b.config.chatMsgDeepHistoryEnabled){n=c.favorites[k].chatSessionId}else{n=c.favorites[k].actualFavId}if(!n){return}var j=c.favorites[k]?c.favorites[k].users:[];var m=c.favorites[k]?c.favorites[k].favoriteName:"";
var l;var i;var h;if(b.config.chatMsgDeepHistoryEnabled){i={};l={chatSessionId:c.favorites[k].chatSessionId};h="removeFavoriteDH"}else{i={favoriteId:c.favorites[k].actualFavId};l={};h="removeFavorite"}d.removeErrorMessage(k);if(!f.searchActive||!f.favEditActive){d.paintList()}else{f.search()}if(f.searchActive&&!f.favEditActive){f.searchOfffocus()
}d.updateFvtButton(k);var g=c.favorites[k];c.removeFavorite(k);b.View.addClass(b.View.getEl("fav_popup_holder"),"hide");clearTimeout(d.hoverTimeOut);b.Controller.call({method:h,data:l,urlData:i,successCallBack:function(o){b.log("removeFavorite success");b.View.focusEle("umps_fav_done")},failCallBack:function(o){b.log("removeFavorite failed","warn");
c.addFavorite(g);d.removeErrorMessage(k);if(!f.searchActive||!f.favEditActive){d.paintList()}else{f.search()}d.updateFvtButton(k);d.addErrorMessage(b.getCatalog("FavNotSaved"))}});b.Controller.updateChatterActivity()};this.updateFvtButton=function(m){d.favupDated=false;var k=false;if(b.config.chatMsgDeepHistoryEnabled){k=true
}if(m){var j=b.Controller.searchSubspace(m,true,k);for(var l=0,g=j.length;l<g;l++){var h=c.workspaces[j[l]],n;h&&(n=b.View.WindowManager.getWindows()[h.uuid])&&n.updateTitle()}}};this.update=function(h){var g=b.View.getEl("umps_fav_"+h.id);if(g&&c.favorites[h.id]){var i=d.createEl(c.favorites[h.id]);
i&&g.parentNode.replaceChild(i,g)}};this.editModeOn=function(g){b.View.stopEventPropogation(g);b.View.Actions.closeAllPopups();b.View.addClass(b.View.getEl("umps_favorites_body"),"editmode");b.View.addClass(b.View.getEl("umps_fav_edit"),"hide");b.View.addClass(b.View.getEl("umps_fav_edit_dummy"),"hide");
b.View.removeClass(b.View.getEl("umps_fav_done"),"hide");b.View.removeClass(b.View.getEl("umps_fav_done_dummy"),"hide");d.editMode=true;d.toggleFavsAccessibility(false)};this.editModeOff=function(g){b.View.stopEventPropogation(g);b.View.Actions.closeAllPopups();b.View.removeClass(b.View.getEl("umps_favorites_body"),"editmode");
b.View.removeClass(b.View.getEl("umps_fav_edit"),"hide");b.View.removeClass(b.View.getEl("umps_fav_edit_dummy"),"hide");b.View.addClass(b.View.getEl("umps_fav_done"),"hide");b.View.addClass(b.View.getEl("umps_fav_done_dummy"),"hide");d.editMode=false;d.toggleFavsAccessibility(true)};this.focusToNextEle=function(h,g){var i=g===true?d.getPreEle(h):d.getNextEle(h);
if(i&&i.id.indexOf("umps_fav_")!=-1){b.View.focusEle(i.id)}else{b.View.focusEle("umps_fav_done")}};this.getNextEle=function(h){try{var i=function(k){do{k=k.nextSibling}while(k&&k.nodeType!==1);return k};var g=b.View.getEl("umps_fav_"+h);return i(g)}catch(j){}};this.getPreEle=function(h){try{var i=function(k){do{k=k.previousSibling
}while(k&&k.nodeType!==1);return k};var g=b.View.getEl("umps_fav_"+h);return i(g)}catch(j){}};this.toggleFavsAccessibility=function(l){try{if(l&&d.editMode==false){for(var h in c.favorites){var g=b.View.getEl("umps_fav_"+h);if(g==null){continue}g.setAttribute("tabIndex",-1);var i=b.View.getEl("umps_fav_"+h+"_remove");
i.setAttribute("tabIndex",-1)}return}else{if(!l&&!d.editMode){return}}for(var h in c.favorites){var g=b.View.getEl("umps_fav_"+h);if(g==null){continue}var j=g.getAttribute("tabIndex");if(j==0){break}new b.View.Accessibility({id:"umps_fav_"+h,onTabClick:(function(m){return function(){var n=c.favorites[m];
if(n.users.length>1){b.View.dispatchClickEvent(b.View.getEl("umps_fav_"+m+"_name"))}else{b.View.focusEle("umps_fav_"+m+"_remove")}}})(h)});new b.View.Accessibility({id:"umps_fav_"+h+"_remove",onTabClick:(function(m){return function(n){d.focusToNextEle(m,n.shiftKey)}})(h)});d.updateFocus(h)}}catch(k){}};
this.updateFocus=function(g){if(d.preFavId==g){if(d.isEnterkeyPressed===true){d.isEnterkeyPressed=false;new b.View.Accessibility({id:"umps_fav_"+d.preFavId+"_name",onTabClick:(function(h){return function(i){b.View.focusEle("umps_fav_"+h+"_remove")}})(d.preFavId)});if(b.isFF){setTimeout((function(h){return function(i){b.View.focusEle("umps_fav_"+h+"_name")
}})(d.preFavId),200)}else{b.View.focusEle("umps_fav_"+d.preFavId+"_name")}}else{b.View.focusEle("umps_fav_"+d.preFavId+"_remove")}d.preFavId=null;d.favupDated=true}};this.inlineEdit=function(i,j){var h=b.View.createEl("input",{type:"text",className:"fav_name_edit",value:d.getName(i),id:"umps_fav_"+i+"_editname"});
h.onclick=function(k){b.View.stopEventPropogation(k)};h.onmousedown=function(k){b.View.stopEventPropogation(k)};var g=b.View.createEl("label",{className:"assistiveText","for":"umps_fav_"+i+"_editname",innerText:d.getName(i),id:"umps_fav_"+i+"_editnameLbl"});b.View.addHandler(h,"focus",function(k){b.View.Buddylist.favEditActive=true;
d.favupDated=false;h.select();d.curEditEl=h;b.View.stopEventPropogation(k)});b.View.addHandler(h,"blur",function(k){if(d.isEnterkeyPressed===true){return}d.curEditEl=null;d.preFavId=i;d.updateName(i,h,j);b.View.focusEle("umps_fav_"+d.preFavId+"_remove")});b.View.addHandler(h,"keydown",function(l){l=canvas_window.event||l;
var k=l.charCode||l.keyCode;if(k==27&&b.isFF||k===13){b.View.cancelEvent(l)}if(k!=13){return}b.View.stopEventPropogation(l);d.isEnterkeyPressed=true;d.preFavId=i;d.updateName(i,h,j)});j.parentNode.replaceChild(h,j);h.parentNode.insertBefore(g,h);b.View.Buddylist.favEditActive=true;h.focus()};this.updateName=function(n,l,g){if(!c.favorites[n].actualFavId&&!c.favorites[n].chatSessionId){return
}b.View.Buddylist.favEditActive=false;var j=c.favorites;var h=(c.favorites[n].favoriteName)?c.favorites[n].favoriteName:"";var o=c.favorites[n]?c.favorites[n].users:[];if(d.getName(n)==l.value){d.updateFavEdit(n,l,g);d.updateFocus(n);return}if(l.value.length>b.config.maxFavChars){d.updateFavEdit(n,l,g);
d.addErrorMessage(b.getCatalog("MaxFavChars",b.config.maxFavChars),true,n);return}else{if(l.value.length<1){d.updateFavEdit(n,l,g);return}}for(var i in j){if(j[i].favoriteName==l.value){d.updateFavEdit(n,l,g);d.addErrorMessage(b.getCatalog("DuplicateFavName"));return}}c.favorites[n].favoriteName=l.value;
d.updateFavEdit(n,l,g);if(!c.favorites[n].actualFavId&&!c.favorites[n].chatSessionId){return}var k;var m;var p;if(b.config.chatMsgDeepHistoryEnabled){m={};k={chatSessionId:c.favorites[n].chatSessionId,favoriteName:l.value};p="renameFavoriteDH"}else{m={favoriteId:c.favorites[n].actualFavId};k={favoriteName:l.value};
p="renameFavorite"}b.Controller.call({method:p,data:k,urlData:m,successCallBack:function(q){b.log("renameFavorites success")},failCallBack:function(q){b.log("renameFavorites failed","warn");c.favorites[n].favoriteName=h;d.updateFavEdit(n,l,g);d.addErrorMessage(b.getCatalog("FavNotSaved"))}})};this.updateFavEdit=function(i,h,j){if(f.searchActive&&j){j.innerHTML=d.getName(i);
var g=b.View.getEl(h.id+"Lbl");if(g){h.parentNode.removeChild(g)}h.parentNode.replaceChild(j,h)}else{d.paintList();if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()}d.updateFvtButton(i)}};this.getName=function(j,l){var n=new Array(),g={},k=c.favorites[j];if(k.favoriteName&&k.favoriteName!=""){return k.favoriteName
}var m=b.View.sortUserIdsByUserName(k.users.slice(0));for(var h=0;h<m.length;h++){g=c.users[m[h]];if(g){n.push(m.length>1&&!f.searchActive?g.getName().split(" ",2)[0]:g.getName())}else{n.push(m[h])}}return n.join(", ")};this.highlightNewBorn=function(i,k,j){var h=["#FAF37B","#FDF67E","#FFF880","#FFFA99","#FFFBBB","#FFF"];
var g=k||b.View.getEl("umps_fav_"+i);if(!g){return}var j=j||0;b.log("highlightNewBorn: step"+j);if(j<h.length){g.style.backgroundColor=h[j];window.setTimeout(function(){d.highlightNewBorn(null,g,j+1)},100)}else{g.style.backgroundColor=null}};this.addErrorMessage=function(i,h,g){b.View.Buddylist.favEditActive=true;
b.View.removeClass(d.errEl,"hide");d.errEl.innerHTML=i;clearTimeout(d.errorTimer);if(h){b.View.removeClass(b.View.getEl("umps_fav_"+g+"_name_error"),"hide")}d.errorTimer=window.setTimeout(function(){d.removeErrorMessage(g)},5000)};this.removeErrorMessage=function(h){b.View.Buddylist.favEditActive=false;
b.View.addClass(d.errEl,"hide");var g=b.View.getEl("umps_fav_"+h+"_name_error");if(g){b.View.addClass(g,"hide")}}};b.View.Favorites=a})(presence);(function(a){var b=function(f,d){var c=this;this.groupId=d;this.subspaceId=f;this.id=a.View.WindowManager.getuuid();this.panel=canvas_doc.createElement("div");
this.owner=a.Model.Owner.getInstance();this.show=function(){a.View.removeClass(c.panel,"hide")};this.hide=function(){a.View.addClass(c.panel,"hide")};this.dispose=function(){try{delete c.panel}catch(g){}};this.html=function(g){a.View.html(c.panel,g)};this.add=function(g){a.View.append(c.panel,g)};this.showDetails=function(){c.panel.innerHTML="";
var h=a.View.createEl("div",{className:"chat_buddy_search_result"});var k=a.View.createEl("div",{className:"result_span_header"});k.innerHTML='<img class="down_arrow" id="popup_grouplist_arrow" src="'+a.imageLocation+'/1pxDummy.png">'+c.owner.groups[c.groupId].activeCount+"/"+c.owner.groups[c.groupId].totalCount+'<span class="chat_button_details_txt">'+presence.config.catalog.details+'</span> <img class="chat_buddy_status_img" src="'+a.imageLocation+'/1pxDummy.png">';
var g=a.View.createEl("div",{className:"result_span_body group_chat"});h.innerHTML='<img class="chat_error float_left" src="'+a.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+a.getCatalog("Loading");c.panel.appendChild(h);var i=canvas_doc.createDocumentFragment();var j={subspaceId:c.subspaceId,startIndex:0,numberOfMembers:1000};
a.Controller.call({method:"getWorkspaceMembers",data:j,successCallBack:function(m){var l=m.data,o;h.innerHTML="";for(var n=0;n<m.data.length;n++){o=c.getBuddyEl(new a.Model.User({id:l[n].objectId,name:l[n].screenName,lName:l[n].lastName,fName:l[n].firstName,name:l[n].screenName,picture:l[n].thumbnailUrl,presenceStatus:l[n].presence.aggregatedChannelsState=="idle"&&l[n].presence.status!=100?a.presenceStatus.IDLE:l[n].presence.status,isAnonymous:!l[n].isFollowee}));
i.appendChild(o)}g.appendChild(i);h.appendChild(k);h.appendChild(g);k.onclick=function(){if(a.View.hasClass(g,"hide")){a.View.removeClass(g,"hide");a.View.setClass(a.View.getEl("popup_grouplist_arrow"),"down_arrow")}else{a.View.addClass(g,"hide");a.View.setClass(a.View.getEl("popup_grouplist_arrow"),"right_arrow")
}}},failCallBack:function(){h.innerHTML="";h.appendChild(a.View.createEl("div",{}))}})};this.getBuddyEl=function(g){if(!g.picture){g.picture=a.imageLocation+"/blankman200.png"}if(g.presenceStatus==a.presenceStatus.AWAY){presenceClassName="chat_buddy_popup_list away"}else{if(g.presenceStatus==a.presenceStatus.IDLE){presenceClassName="chat_buddy_popup_list idle"
}else{if(g.presenceStatus==a.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_popup_list offline"}else{presenceClassName="chat_buddy_popup_list active"}}}var m=a.View.createEl("div",{id:"buddy_"+c.id+"_"+g.id,className:presenceClassName+" blueTxt"});var h=a.View.escapeHtml(g.getName());var l='<img id="buddy_'+c.id+"_"+g.id+'_image" class="chat_buddy_list_img" src="'+g.picture+'" >';
var k=(c.owner.id==g.id)?'<span class="chat_buddy_list_you float_left greyTxt">('+a.getCatalog("You")+")</span>":"";var j='<span id="buddy_'+c.id+"_"+g.id+'_name" class="chat_buddy_list_name float_left">'+h+"</span>"+k;var i='<img class="float_right chat_buddy_status_img" src="'+a.imageLocation+'/1pxDummy.png">';
a.View.append(m,i+l+j);return m}};a.View.GroupChatDetailsPanel=b})(presence);(function(a){var b=function(d){var f=new a.View.ChatWindow(d.uuid);var c=f;c.groupId=d.groupId;c.groupDisplayPanel=new a.View.GroupChatDetailsPanel(d.id,d.groupId);f.updateTitle=function(){a.View.addClass(c.inviteElement,"hide");
a.View.setClass(c.detailsElement,"chat_button_add float_left");a.View.addClass(c.presenceElement,"hide");c.setTitle(c.owner.groups[d.groupId].name);c.setIcon(c.owner.groups[d.groupId].picture,false);c.detailsElement.innerHTML="";c.youAreAlone()};f.showDetails=function(h){a.View.Buddylist.searchOfffocus(h);
a.View.stopEventPropogation(h);var g=a.View.WindowManager.popupPanel;if(g.owner=="details_"+c.id&&g.isShown){return g.hide()}c.popupHolder.appendChild(g.holder);a.View.addClass(c.detailsElement,"clicked");g.show(null,{color:"white"},function(){a.View.removeClass(c.detailsElement,"clicked")});g.owner="details_"+c.id;
g.setTitle(a.getCatalog("detailsHeader"));g.clear();g.appendChild(c.groupDisplayPanel.panel);c.groupDisplayPanel.showDetails()};f.sendMessage=function(j){if(c.composeTextArea.disabled){return}var j=window.event||j;var i=j.charCode||j.keyCode;if(i==27){a.View.cancelEvent(j)}if(i==13&&j.shiftKey){return
}else{if(i==13||j.type=="click"){var g=c.composeTextArea.value;if(g.length>presence.config.chatMaxChar){return}if(a.View.getTrimString(g).length>0){c.resetTextArea();c.processBulkEvents([{from:"me",message:g}]);var h={subspaceId:c.subspaceId,message:a.View.getTrimString(g),topic:"event.user.message.text",optionalParam:{}};
a.Controller.call({method:"sendMessage",data:h,tempData:{uuid:c.id},successCallBack:c.sendMessageSuccess,failCallBack:function(){c.sendMessageFailed(h)}})}else{c.resetTextArea()}}}};f.processBulkEvents=function(l,h,B){Jiffy.mark("PaintMessage");var h=c.getFormattedTime(h);var u="",v,m=l.length,A=0,w;
var j=!(c.chatPanelContainer.scrollHeight-c.chatPanelContainer.clientHeight-c.chatPanelContainer.scrollTop);c.isActive=true;c.owner.workspaces[c.subspaceId].isActive=true;while(A<m&&l[A]["from"]==c.lastMessageFrom){var p=l[A]["message"];var C=c.getFinalMessage(p);u+='<div class="chat_message">'+C+"</div>";
A++}if(A>0){(c.lastMessageFrom=="me")?w=false:w=true;c.lastMessagesDiv.innerHTML+=u;c.lastMessagesDiv.onmouseover=function(i){c.showTimestamp(i,h)}}if(A<m){l=l.slice(A);var q,r,y=canvas_doc.createDocumentFragment();for(var A=0;A<l.length;A++){var k="",D="",x=l[A]["from"],p=l[A]["message"],o=l[A]["name"],n=l[A]["picture"];
(x=="me")?w=false:w=true;var C=c.getFinalMessage(p);if(q==x){r.innerHTML+='<div class="chat_message">'+C+"</div>"}else{var z=(a.View.PopOutWidget.active)?"#":"/"+c.owner.id;if(x=="me"){k=presence.config.catalog.selfMsg;D=c.owner.picture?c.owner.picture:a.imageLocation+"/blankman200.png"}else{k=o||x;k=(k.length>15)?k.substr(0,12)+"...":k;
k=a.View.escapeHtml(k);D=n||a.imageLocation+"/blankman200.png";z=(a.View.PopOutWidget.active)?"#":"/"+x}var t=a.View.createEl("div",{className:"chat_messages_group"});t.innerHTML='<a href="'+z+'" class="chat_messages_links"><img src="'+D+'" class="chat_user_thumbnail"></a>';var g=a.View.createEl("div",{className:"chat_messages"});
g.innerHTML='<a href="'+z+'" class="chat_messages_title">'+k+"</a></b>:";g.innerHTML+='<div class="chat_message">'+C+"</div>";g.onmouseover=function(i){c.showTimestamp(i,h)};g.onmouseout=function(){c.hideTimestamp()};t.appendChild(g);y.appendChild(t);c.lastMessagesDiv=r=g;c.lastMessageFrom=q=x}}c.chatPanel.appendChild(y)
}Jiffy.measure("inwindow","PaintMessage");if(j||!B){c.scrollToBottom()}Jiffy.measure("scrolltobottom","PaintMessage");if(w){c.notifyMessage(c.groupId,m)}Jiffy.measure("nofifymessage","PaintMessage")};f.muteWindow=function(){c.disableWindowOnly();if(c.paintedNobody==true){c.chatPanel.removeChild(c.nobodyDiv);
c.paintedNobody=false}if(!c.unmutePainted){c.paintUnmuteLink(c.owner.groups[c.groupId])}};f.unmuteWindow=function(){c.enableWindowOnly();if(c.unmutePainted==true){c.chatPanel.removeChild(c.unmuteDiv);c.unmutePainted=false}};f.groupRemoved=function(){c.enableWindowOnly();c.onUserLeft({user:{id:c.owner.id}});
if(c.unmutePainted){c.chatPanel.removeChild(c.unmuteDiv);c.unmutePainted=false}if(c.paintedNobody){c.chatPanel.removeChild(c.nobodyDiv);c.paintedNobody=false}c.disableWindowOnly()};f.paintUnmuteLink=function(h){if(h.deleted){return}c.unmutePainted=true;c.unmuteDiv=a.View.createEl("div",{className:"chat_event_info"});
a.View.append(c.unmuteDiv,"<b>"+a.getCatalog("cantChat")+"</b> <br>");var g=a.View.createEl("span",{className:"chat_error_link"});a.View.append(g,a.getCatalog("enableGroupNow"));g.onclick=function(){a.View.WindowManager.unmuteGroup(h);c.chatPanel.removeChild(c.unmuteDiv);c.unmutePainted=false};c.unmuteDiv.appendChild(g);
c.chatPanel.appendChild(c.unmuteDiv);c.scrollToBottom()};f.youAreAlone=function(g){var h=c.owner.groups[c.groupId];if(h.muted||h.deleted){return}if(h.activeCount==1&&(!c.paintedNobody||g)){if(!c.nobodyDiv){c.nobodyDiv=a.View.createEl("div",{className:"chat_event_info chat_join_event",id:"nobodyThere_"+c.subspaceId})
}c.nobodyDiv.innerHTML=a.getCatalog("nobodyElseInChat");c.chatPanel.appendChild(c.nobodyDiv);c.scrollToBottom();c.paintedNobody=true}else{if(h.activeCount>1&&c.paintedNobody){if(c.nobodyDiv){c.chatPanel.removeChild(c.nobodyDiv)}c.paintedNobody=false}}};f.makeDroppable=function(){};return f};a.View.GroupChatWindow=b
})(presence);(function(b){var a=function(){var c=b.Model.Owner.getInstance();var d=this;this.isAccessibilityAval=false;this.historyWidget=null;this.isOpen=false;this.mainElement=b.View.createEl("div",{id:"historyPanel",className:"chat_dock_pane_group chat_buddy_msg_pane chat_pan_active history_pan"});
this.mainElInner=b.View.createEl("div",{className:"chat_buddy_msg_mainpane main_box_shadow"});this.titleContainer=b.View.createEl("div",{className:"chat_buddy_list_title"});this.bodyContainerWrap=b.View.createEl("div",{className:"history_content_box"});this.bodyContainer=b.View.createEl("div",{className:"history_content_box_inner",id:"history_content_box_inner_id"});
d.bodyContainerWrap.appendChild(d.bodyContainer);d.mainElInner.appendChild(d.titleContainer);d.mainElInner.appendChild(d.bodyContainerWrap);d.mainElement.appendChild(d.mainElInner);d.historyWidget=b.View.getEl("presence_chat_dock");var g=b.View.createEl("img",{className:"chat_close",src:b.imageLocation+"/1pxDummy.png",id:"hist_close_btn",alt:presence.getCatalog("Close")});
var f=b.View.createEl("span",{className:"chat_close_wrap",title:presence.getCatalog("Close")});var h=b.View.createEl("span",{html:b.getCatalog("History")});f.appendChild(g);b.View.addHandler(g,"click",function(){d.close()});d.titleContainer.appendChild(f);d.titleContainer.appendChild(f);d.titleContainer.appendChild(h);
this.initializeAccessibility=function(){new b.View.Accessibility({id:"history_content_box_inner_id",isList:true,onChildSelect:"select",childIdStartWith:"hist_",onTabClick:function(){b.View.getEl("hist_close_btn").focus()},scrollbar:d.bodyContainer});new b.View.Accessibility({id:"hist_close_btn",onTabClick:function(){b.View.getEl("history_content_box_inner_id").focus()
}});d.isAccessibilityAval=true};this.toggle=function(i){i=canvas_window.event||i;if(d.isOpen){d.close()}else{var j=b.View.WindowManager.curWindow;if(j){if(j.showHistoryIcon){j.close(i,true)}else{j.close()}}d.open()}};this.open=function(i){d.historyWidget.appendChild(d.mainElement);if(!d.isAccessibilityAval){this.initializeAccessibility()
}b.View.addClass(b.View.getEl("HistoryListBtn"),"clicked");d.fetchHistory();d.isOpen=true;b.HistoryExpanded=true;if(i){return}d.rightMargin=-180;d.mainElement.style.right=d.rightMargin+"px";d.animateOpen();b.View.PopOutWidget.resizeToFitChatWindow();d.resize();b.View.focusEle("history_content_box_inner_id")
};this.animateOpen=function(){d.mainElement.style.right=d.rightMargin+"px";d.rightMargin+=90;if(d.rightMargin<=0){setTimeout(d.animateOpen,40)}};this.close=function(i){try{d.historyWidget.removeChild(d.mainElement)}catch(j){b.log("Failed to remove history node "+j.message,"error")}if(!i){d.isOpen=false;
b.HistoryExpanded=false}b.View.removeClass(b.View.getEl("HistoryListBtn"),"clicked");b.View.focusEle("history_icon_id")};this.fetchHistory=function(){d.bodyContainer.innerHTML='<div align="center" class="loading_history"><img  alt="loading history"src="'+b.imageLocation+'/spinner_16.gif" border="0" width="16" height="12" /><br/>'+b.getCatalog("LoadingHistory")+"</div>";
var i={includeMembers:true,fromArchive:true};Jiffy.mark("fireGetHistoryList");presence.Controller.call({method:"getAllWorkspaces",data:i,successCallBack:function(j){Jiffy.measure("Done","fireGetHistoryList");d.paintList(j.data)},failCallBack:function(j){Jiffy.measure("Done","fireGetHistoryList");d.bodyContainer.innerHTML='<div align="center" class="loading_history">'+b.getCatalog("HistoryFailed","<br />")+"</div>"
}})};this.paintList=function(k){Jiffy.mark("paintGetHistoryList");var k=(k)?k:null;if(!k||k.length<1){d.bodyContainer.innerHTML='<div align="center" class="loading_history">'+b.getCatalog("NoChatsFound","<br />")+"</div>";Jiffy.measure("Done","paintGetHistoryList");return}var i=canvas_doc.createDocumentFragment(),l=0;
for(var m in k){var j=d.createEl(k[m]);if(j){i.appendChild(j);l++}}if(l==0){d.bodyContainer.innerHTML='<div align="center" class="loading_history">'+b.getCatalog("NoChatsFound","<br />")+"</div>"}else{d.bodyContainer.innerHTML="";d.bodyContainer.appendChild(i)}Jiffy.measure("Done","paintGetHistoryList")
};this.createEl=function(w){var v=w.chatSessionId;var x=w.subspaceId;var o=w.chatSessionType;if(!x&&!v){return null}var j=w.members,r=[],k=d.getName(w),m="",t=(j.length>2)?" group_chat_icon":"",l="",q=null;for(var n in j){var p=j[n];if(p&&p.objectId){if(p.objectId==c.id){q=p.lastModifiedTime}else{r.push(p.objectId);
l=(c.users[p.objectId])?c.users[p.objectId].picture:p.thumbnailUrl}}}q=(q!=null)?b.View.getFormattedTime(q):"";var i=b.View.createEl("div",{id:"hist_"+v,className:"chat_buddy_list_display",title:b.View.escapeStr(k)});var u={subspaceId:x,chatSessionId:v,chatSessionType:o,entityIds:r,sourceId:w.sourceId};
i.onclick=function(){d.openHistoryWindow(u)};m='<img id="hist_'+v+'_image" class="chat_buddy_list_img'+t+'" alt="'+b.View.escapeStr(k)+'" src="'+b.Controller.parseImageUrl(l)+'">';m+='<span id="hist_'+v+'_name" class="chat_buddy_list_name">'+b.View.escapeHtml(k)+'</span><span id="hist_'+v+'_time" class="chat_buddy_list_time">'+q+"</span>";
b.View.append(i,m);return i};this.openHistoryWindow=function(p,n){var n=(n)?true:false;b.histObj=p;var o=p.entityIds.sort().join("_");var m=false;var i=[];for(var l=0;l<p.entityIds.length;l++){if(!c.users[p.entityIds[l]]){m=true;i.push(p.entityIds[l])}}if(m){var j={userIds_list:i};b.Controller.call({method:"getmembersdetails",urlData:j,successCallBack:function(r){r=r.data;
for(var q in r){if(r[q].presence.aggregatedChannelsState=="idle"&&r[q].presence.status!=100){r[q].presence.status=b.presenceStatus.IDLE}var k=new b.Model.User({id:q,name:r[q].screenName,fName:r[q].firstName,lName:r[q].lastName,picture:r[q].thumbnailUrl,presenceStatus:r[q].presence.status,presenceMessage:r[q].presence.message});
k.isAnonymous=!r[q].isFollowee;c.addToUserList(k)}d.searchSubspace(p.subspaceId,p.chatSessionId,p.chatSessionType,o,p.sourceId,n)},failCallBack:function(k){}})}if(!m){d.searchSubspace(p.subspaceId,p.chatSessionId,p.chatSessionType,o,p.sourceId,n)}};this.searchSubspace=function(n,j,m,i,l,k){b.View.WindowManager.searchSubspace(i,k,null,false,{chatSessionId:j,subspaceExists:n,chatSessionType:m,sourceId:l,showHistoryIcon:true})
};this.getName=function(u){var j=u.members;var m=u.chatSessionType;var l=new Array(),n={};var k=new Array();var r="";if(u.favoriteName){return u.favoriteName}d.sortUserIdsByUserName(j);for(var p=0;p<j.length;p++){n=c.users[j[p].objectId];if(j[p].objectId!=c.id){k.push(j[p].objectId)}if(n){if((j[p].objectId!=c.id)){l.push(j.length>2?n.getName().split(" ",2)[0]:n.getName())
}}else{if((j[p].objectId!=c.id)){l.push(j[p].screenName)}}}var o=c.favorites;var t;if(b.config.chatMsgDeepHistoryEnabled){t=u.chatSessionId}else{t=c.generateFvtId(k)}var q=o[t];if(m==2&&u.sourceId&&u.sourceId==c.id&&q&&q.favoriteName&&q.favoriteName!=""){r=q.favoriteName}else{r=l.join(", ")}return r};
this.resize=function(){if(!b.HistoryExpanded||popOut_ChatSubspaceId||!b.View.PopOutWidget.active){return}var j=b.isIE?20:25;var i=b.getBrowserHeight()-j;if(i<b.config.chatWindowMinHeight){i=b.config.chatWindowMinHeight}var k=74;i=i-k;d.bodyContainer.style.height=i+"px"};if(b.View.PopOutWidget.active){b.View.addHandler(canvas_window,"resize",d.resize)
}this.sortUserIdsByUserName=function(i){var j=function(l,k){if(typeof l=="string"){l=l.toLowerCase()}if(typeof k=="string"){k=k.toLowerCase()}if(l>k){return 1}if(l<k){return -1}if(l==k){return 0}};i.sort(function(l,k){return j(l.screenName,k.screenName)});return i}};b.View.HistoryPanel=a})(presence);
(function(c){var b={},a,d;b.onBootstrap=function(m,i,p){a=c.Model.Owner.getInstance();c.reconnectInProgress=false;c.View.Buddylist.Favorites=new c.View.Favorites();if(a.presenceStatus!=20&&c.config.audibleLevel!=0){c.View.Audible.init()}else{if(a.presenceStatus!=20){c.View.Audible.unloadSwf()}}c.View.addHandler(canvas_doc,"mousemove",c.View.Actions.parentMouseMoveListener);
if(popOut_ChatSubspaceId){c.View.WindowManager.curWindow.enableWindowOnly();c.View.WindowManager.curWindow.owner=a;c.View.WindowManager.preinit();return}window.clearTimeout(c.autoReconnectTickerTimer);window.clearTimeout(c.autoReconnectTimer);window.clearTimeout(c.reconnectPreTimer);var o=c.View.getEl("presence_widget");
if(o){if(c.isIE){c.View.addClass(o,"isIE")}var g="";if(c.View.PopOutWidget.active){c.View.addClass(o,"chat_popout_widget");g=" chat_dock_popout"}var h='<div id="presence_chat_container" class="chat_dock_pane_group'+g+'"></div><div id="presence_chat_dock" class="chat_dock_pane_group"></div>';var l="float_right";
var n='<div class="chat_dock_pane" id="chat_dock_pane"><div class="'+l+'" id="chat_dock_bg_pane"></div></div>';c.View.html(o,n);if(c.View.PopOutWidget.active){var k=c.View.PopOutWidget.parseHelpURL(c.config.optionsHelpURL);if(k!=""){c.config.optionsHelpURL=k}var j=c.View.PopOutWidget.parseHelpURL(c.config.helpURL);
if(j!=""){c.config.helpURL=j}c.View.append(c.View.getEl("chat_dock_bg_pane"),h);var f='<div  id="roster_hide_arrow_container" class="float_left hide_roster_arrow hide"><span id="toggle_roster_arrow" class="right"></span></div>';c.View.append(c.View.getEl("chat_dock_bg_pane"),f);c.View.Buddylist.init()
}else{c.View.append(c.View.getEl("chat_dock_bg_pane"),h);c.View.Buddylist.init()}if(c.config.screenShareEnabled){c.View.ScreenShare.init();if(a.processShareEvent==true){c.View.ScreenShare.resetStateValues()}}if(!(p&&c.isIE)){c.View.WindowManager.init()}c.View.PopOutWidget.init();c.View.addHandler(canvas_doc,"keyup",function(q){var q=window.event||q;
c.View.shortcutHandler(q)});window.setTimeout(function(){c.log("Set Height timer");c.View.RosterHeaders.hideDummyHeaders();c.View.Buddylist.setPanelHeight();var q=c.View.WindowManager.curWindow;if(!c.View.PopOutWidget.active&&q&&q.chatPanelContainer.offsetHeight<c.config.chatWindowHeight){c.View.WindowManager.curWindow._resizeChatWindow(null,c.config.chatWindowHeight)
}},2000)}else{c.log("Listeners.onBootstrap: Main element not available","error")}Jiffy.measure("Done","CompleteBootstrap");presence.View.Actions.parentMouseDownListener(true);c.Adapter.isReady=true;c.View.addHandler(o,"click",function(q){c.View.Actions.closeAllPopups();c.View.stopEventPropogation(q)});
c.View.addHandler(c.View.getEl("presence_chat_container"),"click",function(q){c.View.Buddylist.searchOfffocus(q)});c.View.addHandler(c.View.getEl("presence_widgetstatus"),"click",function(q){c.View.Buddylist.searchOfffocus(q)});c.View.addHandler(c.View.getEl("chat_buddy_list_menus"),"click",function(q){c.View.Buddylist.searchOfffocus(q)
});if(a.cacheSubDomain==undefined){c.preDownloadTimer=setTimeout(function(){c.View.Actions.preDownloadChatFrame(Math.floor(Math.random()*max_subdomains))},3000)}if(c.listenersReady){return}c.View.addHandler(canvas_doc,"click",function(r){c.View.Buddylist.searchOfffocus(r);if(c.View.WindowManager.curWindow&&c.View.WindowManager.curWindow.dragging){return
}var q=c.View.WindowManager.collapseAllWindows(r)});c.listenersReady=true};b.onBootstrapFailed=function(g,f){b.onError({},f);Jiffy.measure("Done","CompleteBootstrap")};b.onError=function(g,f){switch(f.status){case 0:c.View.Actions.showWidgetLoader();c.View.Actions.widgetLoadFailed();break;case 502:c.View.Actions.showWidgetLoader();
c.View.Actions.widgetLoadFailed(true);break;case 500:c.View.Actions.showWidgetLoader();c.View.Actions.widgetLoadFailed(true);break;case -100:c.View.Actions.showWidgetLoader();c.View.Actions.widgetLoadFailed();break;case -101:c.View.Actions.showWidgetLoader();c.View.Actions.widgetLoadFailed();break;case -102:c.View.Actions.showWidgetLoader();
c.View.Actions.widgetLoadFailed();break;case -103:c.View.Actions.chatSessionExpired();c.Adapter.isReady=false;c.log("User is inactive on the page so disconnnecting the chat","info");break;case -110:c.View.Actions.showWidgetLoader();c.View.Actions.doAutoReconnect();break;default:c.View.Actions.showWidgetLoader();
c.View.Actions.widgetLoadFailed(true);break}};b.onBuddySort=function(h,g){clearTimeout(presence.config.paintTimer);if(c.config.allowPainting){c.View.Buddylist.paintBuddyList();if(c.View.Buddylist.Favorites){c.View.Buddylist.Favorites.paintList()}if(!c.View.hasClass(c.View.getEl("user_searchlist"),"hide")){var f=c.View.OrgSearchCache.getInstance();
var j=f.getCurrentSearchResult();var i=new c.View.OrgSearchList();i.paintList(j)}}else{presence.config.paintTimer=setTimeout(function(){b.onBuddySort(h,g)},c.config.paintWaitTime)}};b.onGroupSort=function(g,f){c.View.Buddylist.paintGroupList()};b.onPresence=function(i,h){Jiffy.measure("EventManager","Event.FollowedPersonStatusChange-"+h.eventIndex);
try{if(h.workspaces){if(h.workspaces.length>0){c.View.WindowManager.onPresence(h)}}var m=c.View.WindowManager.getOfflineWorkspaceRequests(h.id);if(m){for(var o in m){var n=m[o];if(n.isDisabled&&h.oldPresenceStatus==20){c.View.WindowManager.searchSubspace(o,true,true)}}}var k=c.View.WindowManager.getWindows();
for(var l in k){var f=k[l];if(f){c.log("chatWindow:onPresence popu panel isShown="+c.View.WindowManager.popupPanel.isShown,"info");if(c.View.WindowManager.popupPanel.isShown){if(c.View.WindowManager.popupPanel.owner=="search_"+f.id&&f.searchPanel){c.log("chatWindow:onPresence search pop up panel was shown doing search again","info");
f.searchPanel.doSearch();f.displayPanel.showDetails(f.userCount)}}}}if(popOut_ChatSubspaceId){Jiffy.measure("Done","Event.FollowedPersonStatusChange-"+h.eventIndex);return}var j=c.View.getEl("buddy_"+h.id);if(!j){if(h.presenceStatus!=c.presenceStatus.UNAVAILABLE){c.View.Buddylist.addBuddy(h)}}else{if(h.presenceStatus==c.presenceStatus.UNAVAILABLE){c.View.setClass(j,"chat_buddy_list_display offline");
j.parentNode.replaceChild(c.View.Buddylist.buddyEl(h),j)}else{if(h.presenceStatus==c.presenceStatus.AWAY){c.View.addHandler(c.View.getEl("buddy_"+h.id),"click",function(){c.View.WindowManager.searchSubspace(h.id,"")});c.View.setClass(j,"chat_buddy_list_display away")}else{if(h.presenceStatus==c.presenceStatus.IDLE){c.View.addHandler(c.View.getEl("buddy_"+h.id),"click",function(){c.View.WindowManager.searchSubspace(h.id,"")
});c.View.setClass(j,"chat_buddy_list_display idle")}else{if(h.presenceStatus==c.presenceStatus.AVAILABLE){c.View.addHandler(c.View.getEl("buddy_"+h.id),"click",function(){c.View.WindowManager.searchSubspace(h.id,"")});c.View.setClass(j,"chat_buddy_list_display active")}}}}}c.View.Buddylist.Favorites.update(h);
Jiffy.measure("Done","Event.FollowedPersonStatusChange-"+h.eventIndex)}catch(g){c.log("Listeners.onPresence: exception="+g,"error")}};b.onOwnerPresence=function(g,f){c.View.Buddylist.onOwnerPresence(f)};b.onTextMessage=function(g,f){Jiffy.measure("EventManager","Event.OnMessage-"+f.eventIndex);c.View.WindowManager.onMessage(f);
Jiffy.measure("View-"+f.bulkMsgs.length,"Event.OnMessage-"+f.eventIndex)};b.onUserAddSubspace=function(g,f){Jiffy.measure("EventManager","Event.MemberAdded-"+f.eventIndex);c.View.WindowManager.onUserAddedSubspace(f);Jiffy.measure("View","Event.MemberAdded-"+f.eventIndex)};b.onMeetupMemberInvitationReceived=function(g,f){if(c.config.App==="webmessenger"&&c.config.meetupsEnabled){c.View.MeetupsLauncher.onMeetupInviteReceived(f)
}};b.onAddedToSessionGroups=function(g,f){if(c.config.App==="webmessenger"&&c.config.meetupsEnabled){c.View.MeetupsLauncher.onAddedToSessionGroups(f)}};b.onSDSAckReceived=function(g,f){if(c.config.App==="webmessenger"&&c.config.meetupsEnabled){c.View.MeetupsLauncher.onSDSAckReceived(f)}};b.onUserRemoveSubspace=function(g,f){Jiffy.measure("EventManager","Event.MemberRemoved-"+f.eventIndex);
c.View.WindowManager.onUserRemovedSubspace(f);Jiffy.measure("View","Event.MemberRemoved-"+f.eventIndex)};b.onWorkspaceDelete=function(g,f){c.View.WindowManager.onWorkspaceDelete(f)};b.onUserUpdateSubspace=function(g,f){};b.onWorkspaceRefresh=function(g,f){Jiffy.measure("EventManager","Event.OnFirstMessageReceived-"+f.eventIndex);
c.View.WindowManager.repaintWindow(f);Jiffy.measure("View","Event.OnFirstMessageReceived-"+f.eventIndex)};b.onWorkspaceRefreshTitle=function(g,f){c.View.WindowManager.repaintWindowTitle(f)};b.onUserSummaryUpdated=function(g,f){Jiffy.measure("EventManager","Event.OnSummaryUpdated");c.View.Buddylist.updateBuddy(f);
c.View.WindowManager.userUpdated(f);Jiffy.measure("View","Event.OnSummaryUpdated")};b.onOwnerSummaryUpdated=function(g,f){Jiffy.measure("EventManager","Event.OnSummaryUpdated");c.View.WindowManager.userUpdated(f,true);Jiffy.measure("View","Event.OnSummaryUpdated")};b.onStoreUserSummaryUpdated=function(g,f){c.View.WindowManager.userUpdated(f)
};b.onGroupCounterUpdated=function(g,f){Jiffy.measure("EventManager","Event.GroupCounterUpdated-"+f.eventIndex);c.View.Buddylist.updateGroup(f);c.View.WindowManager.groupUpdated(f);Jiffy.measure("View","Event.GroupCounterUpdated-"+f.eventIndex)};b.onGroupUnmuted=function(g,f){Jiffy.measure("EventManager","Event.GroupChatUnMuted-"+f.eventIndex);
c.View.WindowManager.groupUnmuted(f);Jiffy.measure("View","Event.GroupChatUnMuted-"+f.eventIndex)};b.onGroupMuted=function(g,f){Jiffy.measure("EventManager","Event.GroupChatMuted-"+f.eventIndex);c.View.WindowManager.groupMuted(f);Jiffy.measure("View","Event.GroupChatMuted-"+f.eventIndex)};b.onGroupRemoved=function(g,f){Jiffy.measure("EventManager","Event.GroupRemoved-"+f.eventIndex);
c.View.Buddylist.removeGroup(f);c.View.WindowManager.groupRemoved(f);Jiffy.measure("View","Event.GroupRemoved-"+f.eventIndex)};b.onGroupAdded=function(g,f){Jiffy.measure("EventManager","Event.GroupAdded-"+f.eventIndex);c.View.Buddylist.addGroup(f);Jiffy.measure("View","Event.GroupAdded-"+f.eventIndex)
};b.onGroupSummaryUpdated=function(g,f){Jiffy.measure("EventManager","Event.GroupSummaryUpdated-"+f.eventIndex);c.View.WindowManager.groupUpdated(f);c.View.Buddylist.updateGroup(f);Jiffy.measure("View","Event.GroupSummaryUpdated-"+f.eventIndex)};b.notificationMuted=function(){c.View.Actions.resetTitle()
};b.collapseAll=function(g,f){c.View.WindowManager.collapseAllWindows()};b.onOtherCustomEvents=function(j,i){if(i.event=="followUser"){c.log("onOtherCustomEvents > followUser : "+i.userId);c.View.WindowManager.followUserSuccess(c.Model.Owner.getInstance().users[i.userId])}else{if(i.event=="isOffline"){if(c.getClientId()!=i.clientId){return
}if(popOut_ChatSubspaceId){c.View.PopOutWidget.close();return}c.View.Buddylist.updatePresenceUI(20,"UNAVAILABLE");c.View.Buddylist.closeChannel(true);if(c.View.PopOutWidget.popIn){c.View.PopOutWidget.switchBack()}}else{if(i.event=="windowOpened"){if(popOut_ChatSubspaceId){return}var f=c.Model.Owner.getInstance();
d=c.getCookie("umps_open_subspaceid");if(i.subspaceId){if(f.workspaces[i.subspaceId]){var l=c.View.WindowManager.getWindows();var h=f.workspaces[i.subspaceId].uuid;if(l[h]){l[h].open(true);if(d==i.subspaceId){if(c.BuddyListActive){l[h].maximizeAndFocus()}c.View.WindowManager.updateChatWinOnOpen(l[h]);
c.View.PopOutWidget.resizeToFitChatWindow()}else{if(c.View.WindowManager.curWindow){if(c.View.WindowManager.curWindow.showHistoryIcon){c.View.WindowManager.curWindow.close(null,true)}else{c.View.WindowManager.curWindow.close(null,null,true)}if(c.View.Buddylist.HistoryPanel&&c.View.Buddylist.HistoryPanel.isOpen){c.View.Buddylist.HistoryPanel.close(true)
}}}c.View.Buddylist.updateMessageCount();if(c.View.Buddylist.ChatList){c.View.Buddylist.ChatList.paintList()}}else{var k=c.View.WindowManager.getChatWindow(f.workspaces[i.subspaceId]);b.onOtherCustomEvents(null,{event:"windowOpened",subspaceId:i.subspaceId,showHistoryIcon:i.showHistoryIcon})}}}}else{if(i.event=="windowCollapsed"){if(popOut_ChatSubspaceId){return
}var f=c.Model.Owner.getInstance();if(f.workspaces[i.subspaceId]){var l=c.View.WindowManager.getWindows();var h=f.workspaces[i.subspaceId].uuid;l[h]&&l[h].close(null,null,true)}}else{if(i.event=="windowClosed"){if(popOut_ChatSubspaceId&&popOut_ChatSubspaceId==i.subspaceId){return c.View.PopOutWidget.close(true)
}var f=c.Model.Owner.getInstance();if(f.workspaces[i.subspaceId]){var l=c.View.WindowManager.getWindows();var h=f.workspaces[i.subspaceId].uuid;if(l[h]){l[h].isActive=false;f.workspaces[i.subspaceId].isActive=false;l[h].close(null,null,true)}}}else{if(i.event=="rosterExpanded"){if(c.View.PopOutWidget.active){return
}var f=c.Model.Owner.getInstance();f.state.rosterExpanded=true;if(c.View.WindowManager.curWindow){c.View.WindowManager.curWindow.msgCount=0}c.View.Buddylist.updateMessageCount()}else{if(i.event=="rosterCollapsed"){if(c.View.PopOutWidget.active){return}var f=c.Model.Owner.getInstance();f.state.rosterExpanded=false
}else{if(i.event=="windowPopedIn"){if(popOut_ChatSubspaceId){return}var f=c.Model.Owner.getInstance();var g=f.workspaces[i.subspaceId],k;if(!g){return}k=c.View.WindowManager.getChatWindow(g);c.log("Received windowPopedIn - subspaceId="+i.subspaceId+" -wkObj.isPopped="+g.isPopped+" -chatWindow.isPopped="+k.isPopped,"info");
k.isPopped=false;g.isPopped=false;k.open(true);if(c.BuddyListActive){k.maximizeAndFocus()}}else{}}}}}}}}};b.onDeviceAttributesChanged=function(i,h){c.log("onDeviceAttributesChanged: "+JSON.stringify(h));Jiffy.measure("EventManager","Event.DeviceAttrChanged");if(popOut_ChatSubspaceId){if(popOut_ChatSubspaceId==h.chatPopin){c.View.PopOutWidget.closeChannelnWindow()
}Jiffy.measure("View","Event.DeviceAttrChanged");return}if(h.popedOut===true){if(c.View.PopOutWidget.active){return}var g=c.getCookie("umpsStatus");try{g=JSON.parse(g)}catch(j){}if(g.popedOut==true){c.View.PopOutWidget.showPopInChat()}}else{if(h.popedOut===false){c.View.PopOutWidget.close(true)}else{if(h.chatPopout){var f=a.workspaces[h.chatPopout],k;
if(!f||f.isPopped===true){return}k=c.View.WindowManager.getChatWindow(f);c.log("Received chatPopout - subspaceId="+h.chatPopout+" -wkObj.isPopped="+f.isPopped+" -chatWindow.isPopped="+k.isPopped,"info");f.isPopped=true;k.isPopped=true;if(k.isOpen){k.close(null,false,true)}if(c.View.Buddylist.ChatList){c.View.Buddylist.ChatList.paintList()
}}else{if(h.chatPopin){var f=a.workspaces[h.chatPopin],k;if(!f||!f.isPopped){return}k=c.View.WindowManager.getChatWindow(f);c.log("Received chatPopin - subspaceId="+h.chatPopin+" -wkObj.isPopped="+f.isPopped+" -chatWindow.isPopped="+k.isPopped,"info");k.isPopped=false;f.isPopped=false;k.msgCount=0;c.View.Buddylist.updateMessageCount();
if(c.View.Buddylist.ChatList){c.View.Buddylist.ChatList.paintList()}}}}}Jiffy.measure("View","Event.DeviceAttrChanged")};b.onPreferenceChange=function(g,f){Jiffy.measure("EventManager","Event.PreferenceChanged");c.View.WindowManager.updatePreferences(g);Jiffy.measure("View","Event.PreferenceChanged")
};b.onFavoritesChanged=function(g,f){if(c.View.Buddylist.Favorites){Jiffy.measure("EventManager","Event.FavoriteChanged");if(!c.View.Buddylist.searchActive||!c.View.Buddylist.favEditActive){c.View.Buddylist.Favorites.paintList()}else{c.View.Buddylist.search()}c.View.Buddylist.Favorites.updateFvtButton(f);
Jiffy.measure("View","Event.FavoriteChanged")}};b.onSleepModeOn=function(){if(c.BuddyListActive){c.View.Buddylist.toggleBuddyList()}};b.onSleepModeOff=function(){if(c.focus=="FOCUS_LOST"){c.View.Actions.sendCustomEvent({event:"rosterCollapsed"})}c.View.Actions.scheduleAutoIdle();c.View.Actions.doPingCall();
c.Controller.startInactivityTimer()};b.onSubspacePropertiesChange=function(g,f){c.log("Listeners.onSubspacePropertiesChange","info");c.View.WindowManager.onSubspacePropertiesChange(f)};b.onSubspacePropertiesDeleted=function(g,f){c.log("Listeners.onSubspacePropertiesDeleted","info");c.View.WindowManager.onSubspacePropertiesDeleted(f)
};b.onNotifyDevice=function(g,f){c.log("Listeners.onNotifyDeviceEvent","info");c.View.WindowManager.onNotifyDevice(f)};b.onChannelClosed=function(f){if(a.presenceStatus==20){return}if(c.View.PopOutWidget.active){c.View.PopOutWidget.close(null,null,true);return}c.View.Buddylist.updatePresenceUI(20,"UNAVAILABLE");
c.View.Buddylist.updateMessageCount(0);c.View.Actions.resetTitle();c.View.Buddylist.setBuddylistOffline(true);if(c.View.PopOutWidget.popIn){c.View.PopOutWidget.switchBack()}};c.View.Listeners=b})(presence);(function(b){var a={};a.sdsRunning=false;a.overlayPanel=null;a.invokeMeetups=function(d,i,m){var h=b.getCookie("groupId"),f,g,j,l;
a.sdsRunning=false;l=a.getFrontServerUrl(canvas_window.umps_config.umpsUrl);if(d==="startMeetup"){if(i){f={type:"start",orgId:canvas_window.umps_config.orgId,baseSfdcUrl:canvas_window.umps_config.baseSfdcUrl,umpsUrl:canvas_window.umps_config.umpsUrl,frontServerUrl:l,userId:canvas_window.umps_config.userId,chatId:i,umpsSessionId:b.Controller.ownerObj.umpsSessionId}
}else{f={type:"start",orgId:canvas_window.umps_config.orgId,baseSfdcUrl:canvas_window.umps_config.baseSfdcUrl,umpsUrl:canvas_window.umps_config.umpsUrl,frontServerUrl:l,userId:canvas_window.umps_config.userId,umpsSessionId:b.Controller.ownerObj.umpsSessionId}}}else{if(d==="joinMeetup"){f={type:"join",orgId:canvas_window.umps_config.orgId,baseSfdcUrl:canvas_window.umps_config.baseSfdcUrl,umpsUrl:canvas_window.umps_config.umpsUrl,frontServerUrl:l,userId:canvas_window.umps_config.userId,chatId:i,umpsSessionId:b.Controller.ownerObj.umpsSessionId,meetupSessionId:m}
}}g=JSON.stringify(f);if(b.osName==="Mac"){var k={appName:"ChatterDesktop",installerUrl:l+"/static/ChatterDesktop.pkg",invocationParams:g};var c=JSON.stringify(k);j=l+"/installer/mac?tag="+c}else{j=l+"/installer/win?tag="+g}if(!h){a.launchMeetupsOverlay(j)}else{a.postEventToSessionGroup(f,h);a.showBusyIcon();
canvas_window.setTimeout(function(){if(!a.sdsRunning){a.launchMeetupsOverlay(j,true)}},3000)}};a.getFrontServerUrl=function(f){var c=f.split("//"),d;if(c[0]&&c[1]){d=c[0]+"//frontserver."+c[1];return d}else{b.log("Front Server Url creation failed","error")}};a.showBusyIcon=function(){var c=b.View.getEl("meetups-spinner-holder"),d;
if(!c){c=b.View.createEl("div",{id:"meetups-spinner-holder","class":"presence_chat_overlay_mask overlay_mask"});d=b.View.createEl("img",{id:"meetups-spinner","class":"meetups-spinner",src:b.imageLocation+"/spinner.gif"});if(c){c.appendChild(d)}canvas_doc.body.appendChild(c)}c.style.display="block"};a.hideBusyIcon=function(){var c=b.View.getEl("meetups-spinner-holder");
if(c){c.style.display="none"}};a.launchMeetupsOverlay=function(d,h){var f;if(h){a.hideBusyIcon()}if(!a.overlayPanel){a.overlayPanel=new b.View.OverlayPanel({overlayTitle:"Meetups",width:"650px",height:"400px"});f=b.View.createEl("div",{id:"meetups_overlay","class":"meetups_overlay"})}else{f=b.View.getEl("meetups_overlay")
}if(h){var c="<div id='meetups_headerTxt' class='meetups_headerTxt'>"+b.config.catalog.MeetupsSDSDown+"</div><div class='meetups_desc'>"+b.config.catalog.MeetupsDownloadTxt+b.config.catalog.MeetupsDownloadTxt+"</div>"}else{var c="<div id='meetups_headerTxt' class='meetups_headerTxt'>"+b.config.catalog.MeetupsIntro+"</div><div class='meetups_desc'>"+b.config.catalog.MeetupsDownloadTxt+b.config.catalog.MeetupsDownloadTxt+"</div>"
}var g="<div id='dwnldMeetups' class='dwnldMeetups'>"+b.config.catalog.MeetupsButtonTxt+"</div>";b.View.html(f,c+g);a.overlayPanel.html(f);b.View.addHandler(b.View.getEl("dwnldMeetups"),"click",function(){a.downloadSmartInstaller(d)});if(b.View.Buddylist.overlayPanel){b.View.Buddylist.overlayPanel.hide()
}b.View.PopOutWidget.resizeToFitChatWindow();a.overlayPanel.show();canvas_doc.body.scrollTop=canvas_doc.documentElement.scrollTop=0};a.downloadSmartInstaller=function(d){var c=canvas_doc.getElementById("meetups_installer_iframe");if(c){c.src=d}else{var i=canvas_doc.createElement("IFRAME");i.id="meetups_installer_iframe";
i.name="meetups_installer_iframe";i.src=d;i.style.display="none";i.frameborder=0;canvas_doc.body.appendChild(i)}var g=b.View.getEl("meetups_overlay");var h=b.imageLocation+"/meetupsInstructions";if(b.isIE){h=h+"-ie.png"}else{if(b.isFF){h=h+"-firefox.png"}else{h=h+"-chrome.png"}}var f="<img src='"+h+"' width='600'/><div class='meetups_desc'>"+b.config.catalog.MeetupsDownloadTxt+"</div>";
b.View.html(g,f)};a.onSDSAckReceived=function(){a.sdsRunning=true;a.hideBusyIcon();if(a.overlayPanel){a.overlayPanel.hide()}};a.onAddedToSessionGroups=function(c){var f=c.data,d=f.groupId;if(a.overlayPanel){a.overlayPanel.hide()}if(d){b.setCookie("groupId",d,new Date((new Date().getTime())+1000*60*60*24*365*5))
}};a.registerToSessionGroup=function(d,g){var f=new b.Controller.ApiGateway();var c={sessionGroupId:g},h={appType:"desktop",umpsSessionIds:d,data:{}};f.makeAPICall("registerToSessionGroup",h,c,function(i){if(i&&i.result){b.log("Register to Session Group is successful.")}},function(){b.log("Register to Session Group is Failed.")
})};a.postEventToSessionGroup=function(h,g){var d=new b.Controller.ApiGateway(),f;if(h){if(h.type==="start"){f="event.user.sds.meetups.started"}else{if(h.type==="join"){f="event.user.sds.meetups.join"}}}var c={sessionGroupId:g},i={appType:"desktop",eventType:f,data:h};d.makeAPICall("postEventToSessionGroup",i,c,function(j){if(j&&j.result){b.log("Posted to Session Group successfully.")
}},function(){b.log("Posted to Session Group Failed.")})};a.onMeetupInviteReceived=function(f){var d=f.data,c=b.Model.Owner.getInstance();var j=d.meetupSessionId,h=d.chatId,i=d.sourceId;if(c.workspaces[h]){var g=c.workspaces[h];g.meetupSessionId=j;a.notifyMeetupInvitation(i,g,j)}else{b.log("Received Meetups invite without subspace obj on client, so doing getallsubspace members","info");
c.addWorkspace(new b.Model.Workspace({id:h,meetupSessionId:j}));c.workspaces[h].fetchingUsers=true;b.Controller.getSubspaceMembers(h,function(k,r){if(k&&r.data.length>0){var q=r.data[0];var p=q.members;for(var o=0;o<p.length;o++){var m=p[o];if(m.objectId!=b.Controller.ownerObj.id){if(m.presence.aggregatedChannelsState=="idle"&&m.presence.status!=100){m.presence.status=b.presenceStatus.IDLE
}var l=new b.Model.User({id:m.objectId,name:m.screenName,fName:m.firstName,lName:m.lastName,presenceStatus:m.presence.status,presenceStatusMessage:m.presence.message,picture:m.thumbnailUrl});c.workspaces[h].addUser(l,false,m.isMember);l.isAnonymous=!m.isFollowee;c.addToUserList(l)}}b.Controller.ownerObj.sortUsers();
b.log("Got all subspace members of subspace id="+h+" ,count="+p.length,"info");c.workspaces[h].refreshWkTitle(true);c.workspaces[h].fetchingUsers=false;var n=c.workspaces[q.subspaceId];a.notifyMeetupInvitation(i,n,j)}else{delete c.workspaces[h]}})}};a.notifyMeetupInvitation=function(f,h,d){var c=b.Model.Owner.getInstance();
var g=b.View.WindowManager.getChatWindow(h);g.showJoinMeetupNotification(d);if(b.View.Buddylist.ChatList&&(!b.View.WindowManager.curWindow||g.id!=b.View.WindowManager.curWindow.id||c.state.rosterExpanded!=true)){g.isMeetups=true;b.View.Buddylist.ChatList.onNewMessage(g);b.View.WindowManager.notifyMessage(f,g,true)
}};b.View.MeetupsLauncher=a})(presence);(function(b){var a=function(g,d,f,h){this.menuList=d;this.itemStyleClass=f;this.target=g;this.callBack=null;this.index=0;var c=this;if(typeof h=="function"){c.callBack=h}c.target.onkeydown=function(i){c.onNavigate(i)};c.target.onmouseover=function(i){if((c.index)>=0){try{b.View.removeClass(c.menuList[c.index],c.itemStyleClass)
}catch(i){}}};this.setCurrentIndex=function(i){c.index=i};this.getCurrentIndex=function(){return c.index};this.resetCurrentIndex=function(){c.index=0};this.dispatchMouseClick=function(i){var j;if(canvas_doc.createEvent){j=canvas_doc.createEvent("MouseEvents");j.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);
i.dispatchEvent(j)}else{j=canvas_doc.createEventObject();j.eventType="onclick";i.fireEvent(j.eventType,j)}};this.onNavigate=function(j){var j=canvas_window.event||j;var i=j.charCode||j.keyCode;if(i&&(i==38||i==40||i==32||i==13||i==27)){b.View.cancelEvent(j);var k={up:38,down:40,enter:13,space:32,escape:27};
switch(i){case k.up:if(c.menuList.length>0){if((c.index-1)>=0){try{b.View.removeClass(c.menuList[c.index],c.itemStyleClass)}catch(j){}c.index=c.index-1;b.View.addClass(c.menuList[c.index],c.itemStyleClass)}}break;case k.down:if(c.menuList.length>0){if((c.index+1)<c.menuList.length){try{b.View.removeClass(c.menuList[c.index],c.itemStyleClass)
}catch(j){}c.index=c.index+1;b.View.addClass(c.menuList[c.index],c.itemStyleClass)}}break;case k.space:case k.enter:try{b.View.removeClass(c.menuList[c.index],c.itemStyleClass)}catch(j){}c.dispatchMouseClick(c.menuList[c.index]);break}}if(c.callBack){c.callBack(j)}}};b.View.Navigate=a})(presence);(function(b){var a=function(){this.resultCache={};
this.currentStr="";this.currentStrResult={};var c=this;this.addToResultCache=function(f,d){if(f&&f!=""){c.resultCache[f]=d;window.setTimeout(function(){c.deleteFromResultCache(f)},55*1000)}else{b.log("addToResultCache: prefix is empty","error")}};this.deleteFromResultCache=function(d){if(d&&d!=""){delete c.resultCache[d]
}else{b.log("deleteFromResultCache: prefix not removed","error")}};this.isCacheHit=function(d){if(d&&d!=""){if(c.resultCache[d]){return true}}return false};this.getResults=function(d){if(d&&d!=""){return c.resultCache[d]}else{b.log("addToResultCache: prefix is empty","error")}};this.updateCurrentSearchString=function(d){c.currentStr=d
};this.getCurrentSearchString=function(){return c.currentStr};this.updateCurrentSearchResult=function(d){c.currentStrResult=d};this.getCurrentSearchResult=function(){return c.currentStrResult}};a.getInstance=function(){if(window._orgSearchCache){return window._orgSearchCache}else{window._orgSearchCache=new a();
return window._orgSearchCache}};b.View.OrgSearchCache=a})(presence);(function(b){var a=function(){var c=b.View.Buddylist;this.paintList=function(f){b.log("Buddylist.OrgSearchList.paintList");Jiffy.mark("PaintOrgSearchList");var l=f?f:null;if(!f&&(c.searchActive||c.favEditActive)){return}var k=b.View.getEl("user_searchlist_body");
var h=b.View.getEl("buddyScrollPane");var g=canvas_doc.createDocumentFragment();var j=0;if(l){for(var d in l){if(l[d].presenceStatus!=b.presenceStatus.UNAVAILABLE){var i=c.constructBuddyEl(l[d]);i.onclick=function(m){return function(){b.View.addUserToOwnerList(m,c.onUserClick,null,null,true)}}(l[d].id);
g.appendChild(i);j++}else{if(b.hideOfflineUsers||c.searchActive||c.favEditActive){var i=c.constructBuddyEl(l[d]);i.onclick=function(m){return function(){b.View.addUserToOwnerList(m,c.onUserClick,null,null,true);try{if(c.Favorites.curEditEl){c.Favorites.curEditEl.blur()}}catch(n){}b.View.Actions.parentMouseDownListener()
}}(l[d].id);g.appendChild(i);j++}}}c.scrollTop=h.scrollTop;k.innerHTML="";if(j==0){b.View.addClass(b.View.getEl("user_searchlist"),"hide");b.View.addClass(k,"hide")}else{b.View.removeClass(b.View.getEl("user_searchlist"),"hide");b.View.removeClass(k,"hide");k.appendChild(g)}c.updateBuddyCount();if(c.searchBegin&&!c.favEditActive){c.setPanelHeight(true);
c.searchBegin=false}h.scrollTop=c.scrollTop;b.View.updateAltAttrByTag(k,"img");Jiffy.measure("Done","PaintOrgSearchList")}else{b.View.addClass(b.View.getEl("user_searchlist"),"hide");b.View.addClass(k,"hide")}};this.paintSpinner=function(){b.log("Buddylist.OrgSearchList.paintSpinner");Jiffy.mark("PaintSpinner");
var g=b.View.getEl("user_searchlist_body");var d=b.View.getEl("buddyScrollPane");b.View.removeClass(b.View.getEl("user_searchlist"),"hide");b.View.removeClass(g,"hide");c.scrollTop=d.scrollTop;g.innerHTML="";var f='<img class="chat_error float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.Searching;
b.View.html(g,f);Jiffy.measure("Done","PaintSpinner")};this.paintEmptyResults=function(){b.log("Buddylist.OrgSearchList.paintEmptyResults");Jiffy.mark("PaintEmptyResults");var g=b.View.getEl("user_searchlist_body");var f=b.View.getEl("buddyScrollPane");b.View.removeClass(b.View.getEl("user_searchlist"),"hide");
b.View.removeClass(g,"hide");c.scrollTop=f.scrollTop;g.innerHTML="";var d='<div id="search_buddylist_empty" class="presence_buddylist_empty">'+presence.config.catalog.noBuddies+"</div>";b.View.html(g,d);Jiffy.measure("Done","PaintEmptyResults")}};b.View.OrgSearchList=a})(presence);(function(a){var b=function(d){var q=this;
var l=a.View.createEl("div",{className:"presence_chat_overlay_mask overlay_mask"});var g=a.View.createEl("div",{className:"presence_chat_overlay"});if(a.isIE){a.View.addClass(g,"isIE")}var p=(d.width)?d.width:"600px";var c=(d.height)?d.height:"470px";var i='<a id="overlayPanelFocusElement" href="javascript:void(0);" onclick="return false;">';
var m=a.View.createEl("div",{className:"main_panel"});m.style.width=p;m.style.height=c;var f=a.View.createEl("div",{className:"overlay_top_right"});var n=a.View.createEl("div",{className:"overlay_top_left"});a.View.addHandler(f,"mouseup",function(t){a.View.focusEle("overlayPanelFocusElement")});var o=a.View.createEl("span",{className:"chat_close_wrap",title:a.getCatalog("Close")});
o.innerHTML='<img class="chat_close" alt="'+a.getCatalog("Close")+'" src="'+a.imageLocation+'/1pxDummy.png">';f.innerHTML=i;f.appendChild(n);n.appendChild(o);a.View.append(n,d.overlayTitle);m.appendChild(f);var r=a.View.createEl("div",{className:"overlay_middle"});var k=a.View.createEl("div",{className:"overlay_inner_content"});
r.appendChild(k);m.appendChild(r);var h=a.View.createEl("div",{className:"overlay_bottom_right"});var j=a.View.createEl("div",{className:"overlay_bottom_left"});h.appendChild(j);m.appendChild(h);g.appendChild(m);canvas_doc.body.appendChild(g);canvas_doc.body.appendChild(l);a.View.addHandler(o,"click",function(t){q.hide(t)
});a.View.addHandler(g,"click",function(t){a.View.stopEventPropogation(t)});this.show=function(){l.style.display="block";g.style.display="block";a.View.addHandler(canvas_doc.body,"keydown",q.onEscape);canvas_doc.body.scrollTop=0};this.hide=function(u){l.style.display="none";g.style.display="none";a.View.removeHandler(canvas_doc.body,"keydown",q.onEscape);
try{if(u){a.View.stopEventPropogation(u)}a.View.focusEle("settings_menu_btn")}catch(t){}};this.onEscape=function(u){var u=canvas_window.event||u;var t=u.charCode||u.keyCode;if(t&&t==27){q.hide()}};this.html=function(t){k.appendChild(t)}};a.View.OverlayPanel=b})(presence);(function(d){var c={};var b=true;
c.active=null;c.parentWindow=null;c.setOffline=false;c.popIn=false;if(popOut_UMPSWidget==undefined){b=false;c.active=false}else{c.active=popOut_UMPSWidget;if(c.active){c.popIn=false}}c.isEnable=function(){return b},c.init=function(){var i="";if(b){if(c.active){var h=d.View.getEl("popout_chat");h.style.display="block";
h.title=d.config.catalog.PopInChat;d.View.addHandler(d.View.getEl("popout_chat"),"click",function(){c.close()});d.View.addHandler(canvas_window,"resize",function(){c.setRosterHeight();d.View.RosterHeaders.hideDummyHeaders()});c.setRosterHeight()}else{var g=d.View.getEl("popout_chat");g.title=d.config.catalog.PopOutChat;
g.style.display="block";d.View.addHandler(d.View.getEl("popout_chat"),"click",c.addPopOutHandler);d.View.addHandler(d.View.getEl("popout_chat_min"),"click",c.addPopOutHandler);c.checkPopOutCookie()}d.log("PopOutWidget:  Init ","info")}},c.addPopOutHandler=function(h,g){d.View.stopEventPropogation(h);
if(c.inProgress){return}c.inProgress=true;c.open(null,g);c.inProgress=false;c.showPopInChat();c.sendPopedOutEvent(true)},c.checkPopOutCookie=function(){var g=d.Model.Owner.getInstance();if(g.device.popedOut){c.showPopInChat()}else{c.switchBack()}},c.closeWindow=function(i,h,g){if(c.popIn){c.popIn=false;
d.View.WindowManager.onCanvasLoad();if(!i){c.sendPopedInEvent(g)}}if(c.active){d.log("PopOutWidget:  closeWindow child","info");if(d.getCookie("umps_status")=="offline"){d.View.Buddylist.closeChannelFailure();return}if(!i){c.sendPopedInEvent(g)}d.View.Buddylist.closeChannel(false,h)}d.log("PopOutWidget:  closeWindow ","info")
},c.switchBack=function(){if(popOut_ChatSubspaceId){return}if(c.active){try{if(canvas_window.opener&&canvas_window.opener.presence){var g=canvas_window.opener.presence.View.getEl("popinchat");if(g){g.style.display="none"}var h=canvas_window.opener.presence.View.getEl("chat_dock_pane");if(h){h.style.display="block"
}canvas_window.opener.presence.View.PopOutWidget.popIn=false;d.setCookie("prePopin",true)}}catch(i){d.log("PopOutWidget: switch back "+i,"error")}}else{c.popIn=false;if(d.View.getEl("popinchat")){d.View.getEl("popinchat").style.display="none"}if(d.View.getEl("chat_dock_pane")){d.View.getEl("chat_dock_pane").style.display="block"
}}d.log("PopOutWidget:  switchBack ","info")},c.open=function(o,l){if(!c.active){var h=d.Model.Owner.getInstance();var g=d.config.popOutBrowserWidth,r=d.config.popOutBrowserHeight;if((canvas_window.console&&canvas_window.console.firebug)||h.currentWindow){g=presence.config.popOutBrowserMaximizedWidth
}if(o){g=d.config.popOutWindowWidth,r=d.config.popOutWindowHeight}if(d.isIE){g=g-20}var m=c.getPopoutCoordinates(o?g+d.config.popOutBrowserWidth:g,r);var j=m.x;var p=m.y;var k="width="+g;k+=", height="+r;k+=", top="+p;k+=", left="+j;k+=", resizable=yes";k+=", location=no";k+=", menubar=no";k+=", scrollbars=no";
k+=", status=no";k+=", toolbar=no";if(l){umps_popoutChatWindow=window.open(d.config.popOutURL,(o)?d.config.popOutWindowName+(c.chatWindowPopoutName(o)):d.config.popOutWindowName)}else{umps_popoutChatWindow=window.open(d.config.popOutURL,(o)?d.config.popOutWindowName+(c.chatWindowPopoutName(o)):d.config.popOutWindowName,k)
}if(!umps_popoutChatWindow.opener){umps_popoutChatWindow.opener=canvas_window}var q=d.Model.Owner.getInstance().cacheSubDomain;d.preDownloadTimer=setTimeout(function(){d.View.Actions.preDownloadChatFrame(q+1)},100);if(d.isIE){var i=canvas_window.umps_config;i.popOut=true;if(canvas_window.umps_config.randomMask){i.sessionId=canvas_window.Sfdc.String.decryptXOR(canvas_window.umps_config.xoredSessionId,canvas_window.umps_config.randomMask)
}if(o||d.isIE7){i.subDomain=q}else{i.subDomain=umpsSubdomain}delete i.chatSubspaceId;i.chatSubspaceId=o;var n='<script type="text/javascript">';n+="var secondsLeftValue = "+canvas_window.secondsLeftValue+";";n+="var umps_config = "+JSON.stringify(i)+";";n+="function updatePage(){ ";n+='var sfdc_umps_frame = document.createElement("IFRAME");';
n+='sfdc_umps_frame.id = "chat_widget_frame";';n+='sfdc_umps_frame.name = "iframe_js";';n+='sfdc_umps_frame.className = "iframe_js";';n+='sfdc_umps_frame.src = "'+canvas_window.umps_config.umpsUrl+d.getCodeLocation()+"_js.html?parentUrl="+canvas_window.location.protocol+"//"+canvas_window.location.host+'&popOut=1";';
n+="sfdc_umps_frame.frameborder = 0;";n+='sfdc_umps_frame.style.display = "none";   document.body.appendChild(sfdc_umps_frame);}';n+="<\/script>";umps_popoutChatWindow.document.open();umps_popoutChatWindow.document.writeln('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Chatter - Salesforce.com</title>'+n+'</head><body onload="updatePage()"><div></div></body></html>');
umps_popoutChatWindow.document.close()}else{d.View.addHandler(umps_popoutChatWindow,"load",function(u,t){return function(){c.writeToPopoutWindow(u,t)}}(o,q))}if(window.focus){umps_popoutChatWindow.focus()}d.log("PopOutWidget:  open parent","info")}else{}},c.writeToPopoutWindow=function(k,j){var i=canvas_window.umps_config;
if(canvas_window.umps_config.randomMask){i.sessionId=canvas_window.Sfdc.String.decryptXOR(canvas_window.umps_config.xoredSessionId,canvas_window.umps_config.randomMask)}i.popOut=true;if(k){i.subDomain=j}else{i.subDomain=umpsSubdomain}delete i.chatSubspaceId;if(k){i.chatSubspaceId=k}var h=document.createElement("script");
h.type="text/javascript";h.text="var umps_config = "+JSON.stringify(i)+"; var secondsLeftValue = "+canvas_window.secondsLeftValue+";";var g=canvas_window.location.protocol+"//"+canvas_window.location.host;var l=document.createElement("IFRAME");l.id="chat_widget_frame";l.name="iframe_js";l.className="iframe_js";
l.src=canvas_window.umps_config.umpsUrl+d.getCodeLocation()+"_js.html?parentUrl="+g;l.frameborder=0;l.style.display="none";if(umps_popoutChatWindow){umps_popoutChatWindow.document.getElementsByTagName("body")[0].appendChild(h);umps_popoutChatWindow.document.body.appendChild(l);d.log("wrote to popoutpage","info")
}},c.getPopoutCoordinates=function(g,k){var h,j,l,i;h=d.getBrowserHeight();j=d.getBrowserWidth();if(d.isIE){l=canvas_window.screenLeft;i=canvas_window.screenTop}else{l=canvas_window.screenX;i=canvas_window.screenY}return{x:l+j-g-20,y:i+h-k-10}},c.resizeToFitChatWindow=function(){if(c.active&&d.getBrowserWidth()<400){var g=c.getPopoutCoordinates(d.config.popOutBrowserMaximizedWidth,d.config.popOutBrowserHeight);
canvas_window.moveTo(g.x,g.y);canvas_window.resizeTo(d.config.popOutBrowserMaximizedWidth,d.config.popOutBrowserHeight)}},c.close=function(i,h,g){window.onbeforeunload={};canvas_window.onbeforeunload={};c.closeWindow(i,h,g);c.switchBack();d.log("PopOutWidget:  close","info")},c.beforeUnload=function(g){c.switchBack();
d.log("PopOutWidget:  beforeUnload","info")},c.setOffline=function(){try{if(c.active){if(d.isIE){window.onbeforeunload={}}else{canvas_window.onbeforeunload={}}}c.setOffline=true;if(canvas_window.opener){canvas_window.opener.presence.View.Buddylist.changePresence("UNAVAILABLE")}}catch(g){d.log("popout: setOffline "+g,"error")
}},c.onBootstrap=function(j,i){if(c.active){if(canvas_window.opener){c.parentWindow=canvas_window.opener}c.getWorkspaceFromParent();if(popOut_ChatSubspaceId){canvas_window.name=d.config.popOutWindowName+(c.chatWindowPopoutName(popOut_ChatSubspaceId));var h=d.Model.Owner.getInstance().workspaces[popOut_ChatSubspaceId],k=(h.groupId)?d.View.WindowManager.getGroupChatWindow(h):d.View.WindowManager.getChatWindow(h);
if(!d.config.chatMsgHistoryEnabled){k.chatPanel.innerHTML="";k.lastMessageFrom="";d.View.WindowManager.paintCacheHistory(h,k)}else{d.View.WindowManager.getHistory(k)}var g={userIds_list:k.entities};d.Controller.call({method:"getPresences",data:{},urlData:g,successCallBack:function(m){for(var l in m.data){if(m.data[l].presence.status){d.Controller.EventParser({messages:[{data:{presence:{message:m.data[l].presence.message,status:m.data[l].presence.status,aggregatedChannelsState:m.data[l].presence.aggregatedChannelsState},userId:m.data[l].userId,screenName:d.Model.Owner.getInstance().users[m.data[l].userId].getName()},header:{topic:"event.user.presence.status"}}]})
}}},failCallBack:function(l){}});d.log("PopOutWidget:  painted history by clearing old content","info")}else{d.BuddyListActive=true;canvas_window.name=d.config.popOutWindowName}c.sendPopedOutEvent();d.log("PopOutWidget:  onBootStrap","info");if(d.config.screenShareEnabled&&popOut_ChatSubspaceId){d.View.ScreenShare.init()
}}},c.getChatWindowContainerHeight=function(g){if(c.active){return(d.getBrowserHeight()-183)}else{if(!g){g=d.config.chatWindowHeight;if(d.config.chatMsgDeepHistoryEnabled){g=g-41}}return g}},c.setRosterHeight=function(){if(c.active){var k=d.View.getEl("buddyScrollPane");if(!k){return}k.style.height="";
var m=d.View.getEl("presence_buddylist").offsetHeight;var i=d.View.getEl("presence_widgetstatus").offsetHeight;var g=d.View.getEl("chat_buddy_list_menus").offsetHeight;var j=d.View.getEl("chat_buddy_search_container").offsetHeight;if(i==0){i=42}if(g==0){g=32}if(j==0){j=48}d.log(" headerPnlHeight : "+i+" menusPnlHeight : "+g+" searchPnlHeight : "+j,"info");
var h=g+j+i;var l=(d.getBrowserHeight()-(h+10));d.View.getEl("buddyScrollPane").style.height=l+"px";if(d.View.Buddylist.buddyScrollBar){d.View.Buddylist.buddyScrollBar.setHeight(l)}d.log("PopOutWidget:  setRosterHeight ","info")}};c.getWorkspaceFromParent=function(){try{var k=d.Model.Owner.getInstance();
var i=canvas_window.opener.presence.Model.Owner.getInstance();var h=canvas_window.opener.presence;k.id=i.id;k.picture=i.picture;k.fName=i.fName;k.lName=i.lName;k.processShareEvent=i.processShareEvent;if(k.processShareEvent!=true){k.isSharingScreen=i.isSharingScreen;k.isViewingScreen=i.isViewingScreen;
k.sharingSubspaceId=i.sharingSubspaceId;k.viewingSubspaceId=i.viewingSubspaceId}k.set("users",{});if(i.users){for(user in i.users){k.addToUserList(new presence.Model.User(i.users[user].toJSON()))}}k.set("groups",{});if(i.groups){for(group in i.groups){k.addToGroupList(new presence.Model.Group(i.groups[group].toJSON()))
}}k.set("workspaces",{});for(workspace in i.workspaces){var g=new d.Model.Workspace(i.workspaces[workspace].toJSON());for(user in i.workspaces[workspace].users){g.addUser(k.users[user])}k.addWorkspace(g)}k.set("favorites",{});k.currentWindow=i.currentWindow;for(var l in i.favorites){k.favorites[l]=i.favorites[l]
}d.hideOfflineUsers=h.hideOfflineUsers,d.showEmoticons=h.showEmoticons,d.showFavorites=h.showFavorites,d.showFollowed=h.showFollowed,d.timeStampHover=h.timeStampHover;k.state.rosterLoaded=i.state.rosterLoaded;k.uuidCounter=i.uuidCounter+"";d.log("PopOutWidget:  getWorkspaceFromParent ","info")}catch(j){d.log("popout: getWorkspaceFromParent "+j,"error");
c.resizeToFitChatWindow();c.showDisconnected(d.getCatalog("WidgetLoadFailed"))}},c.sendPopedInEvent=function(i){var g,h,j;if(popOut_ChatSubspaceId){g={command:"chatPopin",subspaceId:popOut_ChatSubspaceId};h="chatPopin";j=popOut_ChatSubspaceId}else{g={command:"popedIn"};h="popedOut";j=false;if(!popOut_ChatSubspaceId){d.setCookie("umpsStatus",'{"popedOut": false}')
}}d.View.Actions.sendBrowserEvent({command:"onBlur"});if(!i){d.View.Actions.sendBrowserEvent(g,true)}d.View.Actions.setDeviceAttribute(h,j)},c.sendPopedOutEvent=function(g){if(!g){(popOut_ChatSubspaceId)?d.View.Actions.setDeviceAttribute("chatPopout",popOut_ChatSubspaceId):d.View.Actions.setDeviceAttribute("popedOut",true)
}if(!popOut_ChatSubspaceId){d.setCookie("umpsStatus",'{"popedOut": true}')}},c.checkPopOutOpened=function(){if(umps_popoutChatWindow){if(umps_popoutChatWindow.closed){c.sendPopedInEvent();c.switchBack()}}},c.showPopInChat=function(){try{var m=null,k=null;if(c.active){m=canvas_window.opener.canvas_doc;
k=canvas_window.opener.presence}else{m=canvas_doc;k=d;c.popIn=true}var i=m.getElementById("popinchat");if(i){i.parentNode.removeChild(i)}var l=m.getElementById("presence_widget");var n='<div class="chat_buddy_list_main_box main_box_shadow popin_chat"><div class="chat_buddy_list_main_inner">';var o='<span class="roster_title_collapsed"><img class="roster_header_min_icon float_left" alt="'+d.getCatalog("Collapse")+'" src="'+d.imageLocation+'/1pxDummy.png"><span class="buddy_list_min_text">'+d.getCatalog("buddyListTitle_min")+"</span></span>";
var g='<div id="popinchat" class="chat_dock_pane" title="'+d.config.catalog.PopInChat+'"><div class="float_right"><div class="chat_dock_pane_group chat_buddy_list_pane">'+n+'<div class="presence_buddylist_header" id="presence_buddylist_header_popin_id"><div class="presence_buddylist_header_inner">'+o+"</div></div></div></div></div></div>";
if(l){k.View.append(l,g);k.View.addHandler(m.getElementById("popinchat"),"click",function(){c.close(null,null,true);d.Controller.eventPollObj.sleepModeOff()})}d.View.RosterHeaders.hideDummyHeaders();var j=m.getElementById("chat_dock_pane");if(j){j.style.display="none"}new d.View.Accessibility({id:"presence_buddylist_header_popin_id",click:function(){c.close(null,null,true);
d.Controller.eventPollObj.sleepModeOff();k.View.focusEle("presence_widgetstatus")}})}catch(h){d.log("popout: showPopInChat "+h,"error")}};c.showDisconnected=function(h){d.View.Actions.sendBrowserEvent({command:"popedIn"},false,true);canvas_window.focus();c.disconnectPanel=new d.View.OverlayPanel({overlayTitle:d.getCatalog("LoginAlert"),width:"300px",height:"200px"});
var g=d.View.createEl("div",{align:"center"});var k=d.View.createEl("div",{className:"disconnectMessage"});k.innerHTML=h||d.config.catalog.DisconnectAlertText;var j=d.View.createEl("input",{type:"submit",value:d.getCatalog("ok"),className:"overlay_btn",id:"disconnect_okbtn"});var i=d.View.createEl("label",{className:"assistiveText","for":"disconnect_okbtn",innerText:d.getCatalog("ok")});
g.appendChild(k);g.appendChild(i);g.appendChild(j);c.disconnectPanel.html(g);c.disconnectPanel.show();d.View.addHandler(j,"click",function(l){a()});setTimeout(a,5000)};var a=function(){window.onbeforeunload={};canvas_window.onbeforeunload={};canvas_window.close()};c.closeChannelnWindow=function(){var g=d.Model.Owner.getInstance(),h={channelId:g.channelId};
d.Controller.call({method:"closechannel",data:{},successCallBack:function(){a()},failCallBack:function(){a()}})};c.chatWindowPopoutName=function(g){if(g){g=g.replace(/[-#$]/g,"_")}return g};c.parseHelpURL=function(g){return g.substr((g.indexOf("(")+2),(g.indexOf(",")-1-(g.indexOf("(")+2)))};var f=function(i,g,h){if(i==null||i==undefined){return
}if(i.addEventListener){i.addEventListener(g,h,false)}else{if(i.attachEvent){i.attachEvent("on"+g,h)}}};if(b){d.EventManager.bind("event.bootstrap",c.onBootstrap);if(c.active){if(d.isIE){window.onbeforeunload=function(){return presence.config.catalog.PageLeaveMessage}}else{canvas_window.onbeforeunload=function(){return presence.config.catalog.PageLeaveMessage
}}f(window,"unload",function(){c.sendPopedInEvent()})}}d.View.PopOutWidget=c})(presence);(function(b){var a=function(i){var g={width:"auto",height:"auto",arrowPosition:"bottom",offsetLeft:0,mouseOffsetLeft:20,mouseOffsetBottom:0};var f=b.isIE?30:15;this.id=b.View.WindowManager.getuuid();var d=this;var c=b.View.createEl("div",{className:"presence_chat_widget umps_popup_panel hide"});
d.holder=c;if(!i||i.header!==false){this.panelHeader=b.View.createEl("div",{className:"chat_search_header"});this.panelClosebtnWrap=b.View.createEl("span",{className:"chat_close_wrap",title:presence.getCatalog("Close")});this.panelClosebtn=b.View.createEl("img",{className:"chat_close",id:"presence_"+d.id+"_popup_close",src:b.imageLocation+"/1pxDummy.png",alt:presence.getCatalog("Close")});
d.panelClosebtnWrap.appendChild(d.panelClosebtn);d.panelHeader.appendChild(d.panelClosebtnWrap);this.panelHeaderTxt=b.View.createEl("span",{id:"presence_"+d.id+"_popup_hdr_txt"});d.panelHeader.appendChild(d.panelHeaderTxt);c.appendChild(d.panelHeader);b.View.addHandler(this.panelClosebtn,"click",function(){d.hide()
})}var h=b.View.createEl("div",{id:d.id});c.appendChild(h);this.toolBar=b.View.createEl("div",{className:"umps_popup_toolbar"});c.appendChild(this.toolBar);this.arrow=b.View.createEl("div",{className:"umps_popup_arrow"});c.appendChild(this.arrow);c.style.height=g.height;d.panel=h;canvas_doc.body.appendChild(c);
this.setTitle=function(j){b.View.html(b.View.getEl("presence_"+d.id+"_popup_hdr_txt"),j)};this.show=function(n,k,m){var n=window.event||n;b.View.Actions.closeAllPopups();d.closeCallBack=m;var j,l;if(b.isIE){j=(canvas_doc.documentElement.clientHeight!=0)?(canvas_doc.documentElement.clientHeight-13):presence.config.defaultHeight
}else{j=(canvas_window.innerHeight!=0)?canvas_window.innerHeight:presence.config.defaultHeight}if(b.isIE){l=(canvas_doc.documentElement.clientWidth!=0)?(canvas_doc.documentElement.clientWidth):960}else{l=(canvas_window.innerWidth!=0)?(canvas_window.innerWidth-20):960}c.style.display="block";if(k){if(k.color=="grey"){b.View.addClass(c,"popup_gray")
}else{b.View.removeClass(c,"popup_gray")}g.offsetLeft=k.offsetLeft||0;g.offsetBottom=k.offsetBottom||0;g.mouseOffsetBottom=k.mouseOffsetBottom||0;g.mouseOffsetLeft=k.mouseOffsetLeft||0;g.mouseOffsetRight=k.mouseOffsetRight||0;if(k.width){c.style.width=k.width+"px"}}if(n){c.style.position="fixed";if(k&&k.arrowPos=="right"){c.style.right=(l-n.clientX-20+g.mouseOffsetRight)+"px"
}else{c.style.left=(n.clientX-20+g.mouseOffsetLeft)+"px"}c.style.bottom=(j-n.clientY+f-g.mouseOffsetBottom)+"px"}else{c.style.position="absolute"}if(k){if(k.arrowPos=="left"){b.View.addClass(d.arrow,"left");if(g.offsetBottom){d.arrow.style.bottom=(g.offsetBottom+10)+"px"}else{d.arrow.style.bottom="10px"
}}else{if(k.arrowPos=="right"){b.View.addClass(d.arrow,"right");if(g.offsetBottom){d.arrow.style.bottom=(g.offsetBottom+10)+"px"}else{d.arrow.style.bottom="10px"}}else{if(g.offsetLeft){d.arrow.style.left=(g.offsetLeft+10)+"px"}else{if(b.View.PopOutWidget.active){d.arrow.style.left="7px"}else{d.arrow.style.left="115px"
}}}}}d.isShown=true;b.View.addHandler(canvas_doc,"click",d.hide);b.View.addHandler(c,"mouseover",b.View.stopEventPropogation);b.View.addHandler(c,"click",b.View.stopEventPropogation);b.View.addHandler(c,"keydown",d.keyDown)};this.hide=function(){c.style.display="none";d.isShown=false;b.View.removeHandler(canvas_doc,"click",d.hide);
b.View.removeHandler(c,"click",b.View.stopEventPropogation);b.View.removeHandler(c,"mouseover",b.View.stopEventPropogation);b.View.removeHandler(c,"keydown",d.keyDown);if(d.closeCallBack&&typeof d.closeCallBack=="function"){d.closeCallBack()}d.closeCallBack=null};this.dispose=function(){try{if(c.parentNode){c.parentNode.removeChild(c)
}delete c}catch(j){}};this.clear=function(){d.panel.innerHTML="";d.toolBar.innerHTML=""};this.append=function(j){b.View.append(h,j)};this.appendChild=function(j){d.panel.appendChild(j)};this.appendToolBar=function(j){d.toolBar.appendChild(j)};this.keyDown=function(k){var k=k||window.event;var j=k.charCode||k.keyCode;
if(j==27){b.View.cancelEvent(k);d.hide()}}};b.View.PopupPanel=a})(presence);(function(a){var b=function(){var c=this;this.panel=a.View.createEl("div");this.generalBtn=null;this.notificationsBtn=null;this.groupsBtn=null;this.chatListBtn=null;this.ScreenShareBtn=null;this.loaderMask=null;this.errorPanel=null;
this.generalTab=null;this.notificationsTab=null;this.groupsTab=null;this.chatListTab=null;this.ScreenShareTab=null;this.curMenu=null;this.preferenceTabs=null;this.navigatePreferenceMenu=null;this.networkOptionExpand=true;this.init=function(){c.loaderMask=a.View.createEl("div",{className:"pref_loader_mak hide",align:"center"});
c.errorPanel=a.View.createEl("div",{className:"pref_error_text hide",align:"center"});var m=a.View.createEl("div",{className:"overlay_btns_pnl float_left"});var p=a.View.createEl("ul");var f=a.View.createEl("div",{className:"overlay_tabs_pnl"});var k=a.View.createEl("div",{align:"center",className:"overlay_btm_btns_pnl"});
var i=a.View.createEl("div");var l=a.View.createEl("div",{align:"right",className:"help_icon_holder"});var g=(a.View.PopOutWidget.active)?'target="_blank"':"";l.innerHTML='<a id="help_chat_options" '+g+' href="'+a.config.optionsHelpURL+'" title="'+a.getCatalog("Help")+'"><div class="float_right help_grey_icon"></div>'+a.getCatalog("Help")+"</a>";
c.generalBtn=a.View.createEl("li",{className:"overlay_tab_btns active"});c.generalBtn.innerHTML='<a href="javascript:void(0);" onclick="return false;" class="outline_none">'+a.getCatalog("General")+"</a>";p.appendChild(c.generalBtn);a.View.addHandler(c.generalBtn,"click",function(){c.showTab(c.generalBtn,c.generalTab)
});c.notificationsBtn=a.View.createEl("li",{className:"overlay_tab_btns"});c.notificationsBtn.innerHTML='<a href="javascript:void(0);" onclick="return false;" tabindex="-1" class="outline_none">'+a.getCatalog("Notifications")+"</a>";p.appendChild(c.notificationsBtn);a.View.addHandler(c.notificationsBtn,"click",function(){c.showTab(c.notificationsBtn,c.notificationsTab)
});c.chatListBtn=a.View.createEl("li",{className:"overlay_tab_btns"});c.chatListBtn.innerHTML='<a href="javascript:void(0);" onclick="return false;"  tabindex="-1" class="outline_none">'+a.getCatalog("ChatList")+"</a>";p.appendChild(c.chatListBtn);a.View.addHandler(c.chatListBtn,"click",function(){c.showTab(c.chatListBtn,c.chatListTab)
});var h=false;if(a.config.screenShareEnabled&&a.config.isOSsupported&&h){c.ScreenShareBtn=a.View.createEl("li",{className:"overlay_tab_btns"});c.ScreenShareBtn.innerHTML='<a href="javascript:void(0);" onclick="return false;" tabindex="-1" class="outline_none">'+a.getCatalog("ScreenSharing")+"</a>";p.appendChild(c.ScreenShareBtn);
a.View.addHandler(c.ScreenShareBtn,"click",function(){c.showTab(c.ScreenShareBtn,c.ScreenShareTab)})}if(a.config.groupChatEnabled){c.groupsBtn=a.View.createEl("li",{className:"overlay_tab_btns"});c.groupsBtn.innerHTML='<a href="javascript:void(0);" onclick="return false;"  tabindex="-1" class="outline_none">'+a.getCatalog("ChatterGroups")+"</a>";
p.appendChild(c.groupsBtn);a.View.addHandler(c.groupsBtn,"click",function(){c.showTab(c.groupsBtn,c.groupsTab)})}m.appendChild(p);c.generalTab=a.View.createEl("div",{className:"overlay_tab_content active"});f.appendChild(c.generalTab);c.notificationsTab=a.View.createEl("div",{className:"overlay_tab_content"});
f.appendChild(c.notificationsTab);c.chatListTab=a.View.createEl("div",{className:"overlay_tab_content"});f.appendChild(c.chatListTab);if(a.config.screenShareEnabled&&a.config.isOSsupported&&h){c.ScreenShareTab=a.View.createEl("div",{className:"overlay_tab_content"});f.appendChild(c.ScreenShareTab)}if(a.config.groupChatEnabled){c.groupsTab=a.View.createEl("div",{className:"overlay_tab_content"});
f.appendChild(c.groupsTab)}var j=a.View.createEl("input",{type:"submit",value:a.getCatalog("Save"),className:"overlay_btn",id:"pref_saveBtn_id"});var d=a.View.createEl("label",{className:"assistiveText","for":"pref_saveBtn_id",innerText:a.getCatalog("Save")});var o=a.View.createEl("input",{type:"submit",value:a.getCatalog("Cancel"),className:"overlay_btn",id:"pref_canceBnt_id"});
var n=a.View.createEl("label",{className:"assistiveText","for":"pref_canceBnt_id",innerText:a.getCatalog("Cancel")});k.appendChild(d);k.appendChild(j);k.appendChild(n);k.appendChild(o);a.View.addHandler(o,"click",function(q){a.View.Buddylist.overlayPanel.hide(q)});a.View.addHandler(j,"click",function(q){c.savePreferences(q)
});i.appendChild(m);i.appendChild(f);c.panel.appendChild(c.loaderMask);c.panel.appendChild(l);c.panel.appendChild(i);c.panel.appendChild(c.errorPanel);c.panel.appendChild(k);c.preferenceTabs=a.View.getByClass(m,"overlay_tab_btns",false);c.navigatePreferenceMenu=new a.View.Navigate(m,c.preferenceTabs,"select",c.navigatePreference)
};this.showTab=function(g,d){a.View.removeClass(c.generalBtn,"active");a.View.removeClass(c.notificationsBtn,"active");a.View.removeClass(c.chatListBtn,"active");a.View.removeClass(c.ScreenShareBtn,"active");a.View.removeClass(c.groupsBtn,"active");a.View.removeClass(c.generalTab,"active");a.View.removeClass(c.notificationsTab,"active");
a.View.removeClass(c.chatListTab,"active");a.View.removeClass(c.ScreenShareTab,"active");a.View.removeClass(c.groupsTab,"active");a.View.addClass(g,"active");a.View.addClass(d,"active");if(c.navigatePreferenceMenu){for(var f=0;f<c.preferenceTabs.length;f++){if(a.View.hasClass(c.preferenceTabs[f],"select")){a.View.removeClass(c.preferenceTabs[f],"select")
}if(a.View.hasClass(c.preferenceTabs[f],"active")){c.navigatePreferenceMenu.setCurrentIndex(f)}}}g.childNodes[0].focus()};this.showPanel=function(){a.View.addClass(c.loaderMask,"hide");a.View.addClass(c.errorPanel,"hide");c.generalTab.innerHTML="";c.generalTab.appendChild(c.buildGeneralTab());c.notificationsTab.innerHTML="";
c.notificationsTab.appendChild(c.buildNotificationsTab());c.chatListTab.innerHTML="";c.chatListTab.appendChild(c.buildChatTab());if(a.config.groupChatEnabled){c.groupsTab.innerHTML="";c.groupsTab.appendChild(c.buildGroupsTab());a.View.addHandler(c.panel,"click",function(){if(c.curMenu){a.View.getEl(c.curMenu).style.display="none"
}})}if(a.config.audibleLevel==0){a.View.getEl("playSoundCBox").checked=false;a.View.getEl("audible_options_pnl_disable").style.display="block"}var f=false;if(a.config.screenShareEnabled&&a.config.isOSsupported&&f){c.ScreenShareTab.innerHTML="";c.ScreenShareTab.appendChild(c.buildScreenShareTab());c.updateScreensharePref();
a.View.getEl("auto_detect_proxy_pnl_disable").onclick=function(g){a.View.stopEventPropogation(g)};a.View.getEl("networkOptions").onclick=function(h){var g=a.View.getEl("network_arrow_image");if(c.networkOptionExpand){c.networkOptionExpand=false;a.View.getEl("networkOptionsContainer").style.display="none";
a.View.setClass(g,"right_arrow");g.title=a.getCatalog("Expand")}else{c.networkOptionExpand=true;a.View.getEl("networkOptionsContainer").style.display="block";a.View.setClass(g,"down_arrow");g.title=a.getCatalog("Collapse")}};a.View.getEl("autoDetectProxyCBox").onclick=function(g){a.log("Auto detect proxy change "+a.View.getEl("autoDetectProxyCBox").checked);
c.updateScreensharePref()};a.View.getEl("byPassProxyCBox").onclick=function(g){a.log("Auto detect proxy change "+a.View.getEl("byPassProxyCBox").checked);if(!a.View.getEl("byPassProxyCBox").checked){a.View.getEl("auto_detect_proxy_pnl_disable").style.display="none";if(a.View.hasClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")){a.View.removeClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")
}}else{a.View.getEl("auto_detect_proxy_pnl_disable").style.display="block";if(!a.View.hasClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")){a.View.addClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")}}};a.View.getEl("socksProxyCBox").onclick=function(g){a.log("Auto detect proxy change "+a.View.getEl("socksProxyCBox").checked);
if(a.View.getEl("socksProxyCBox").checked){a.View.getEl("socks_proxy_disable").style.display="none";if(!a.View.getEl("socksv4").checked&&!a.View.getEl("socksv5").checked){a.View.getEl("socksv5").checked=true}}else{a.View.getEl("socks_proxy_disable").style.display="block"}}}a.View.getEl("playSoundCBox").onclick=function(g){a.log("sound and notification change "+a.View.getEl("playSoundCBox").checked);
if(!a.View.getEl("playSoundCBox").checked){a.View.getEl("audible_options_pnl_disable").style.display="block";a.View.getEl("playAudioBtn").tabIndex=-1}else{a.View.getEl("audible_options_pnl_disable").style.display="none";a.View.getEl("playAudioBtn").tabIndex=null}};if(c.navigatePreferenceMenu){for(var d=0;
d<c.preferenceTabs.length;d++){if(a.View.hasClass(c.preferenceTabs[d],"select")){a.View.removeClass(c.preferenceTabs[d],"select")}if(a.View.hasClass(c.preferenceTabs[d],"active")){c.navigatePreferenceMenu.setCurrentIndex(d)}}}new a.View.Accessibility({id:"pref_canceBnt_id",onTabClick:function(){a.View.focusEle("help_chat_options")
}});new a.View.Accessibility({id:"help_chat_options",onTabClick:function(){c.navigatePreference(null)}});a.View.focusEle("help_chat_options")};this.updateScreensharePref=function(){a.log("Auto detect proxy "+a.View.getEl("autoDetectProxyCBox").checked);a.log("By pass proxy "+a.View.getEl("byPassProxyCBox").checked);
a.log("Socks proxy "+a.View.getEl("socksProxyCBox").checked);if(!a.View.getEl("autoDetectProxyCBox").checked){if(a.View.getEl("byPassProxyCBox").checked){if(!a.View.hasClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")){a.View.addClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")
}}else{a.View.getEl("auto_detect_proxy_pnl_disable").style.display="none"}}else{a.View.getEl("auto_detect_proxy_pnl_disable").style.display="block";if(a.View.hasClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")){a.View.removeClass(a.View.getEl("auto_detect_proxy_pnl_disable"),"by_pass_proxy_enabled")
}}};this.updateDefaultPref=function(){var f=a.View.getEl("awayTimeVal");for(var d=0;d<f.length;d++){if(f[d].value==autoIdleTime){f.selectedIndex=d}}};this.buildGeneralTab=function(){var f=a.View.createEl("div",{className:"overlay_tab_content_inner"});var g=a.setAutoidle?'checked="checked"':"";var h=a.showEmoticons?'checked="checked"':"";
var j=a.timeStampHover?'checked="checked"':"";var i=a.config.autoIdleTime/60000;var d=a.View.createEl("fieldset",{className:"border_none"});d.innerHTML+="<legend>"+a.getCatalog("Status")+"</legend>";d.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showAwayCBox" id="showAwayCBox" '+g+'/><label for="showAwayCBox">'+a.getCatalog("options_inactive")+'</label><input name="awayTimeVal" id="awayTimeVal" class="awayTimeVal" type="text" value="'+i+'" /><label class="">'+a.getCatalog("Minutes")+"</label></div>";
f.appendChild(d);var k=a.View.createEl("fieldset",{className:"border_none"});k.innerHTML+="<legend>"+a.getCatalog("Messages")+"</legend> ";k.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showEmoticonsCBox" id="showEmoticonsCBox" '+h+' /> <label for="showEmoticonsCBox">'+a.getCatalog("ShowEmoticons")+"</label></div>";
k.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="displayTimeStamp" id="displayTimeStamp" '+j+' /> <label for="displayTimeStamp">'+a.getCatalog("DisplayTimeStamp")+"</label></div>";f.appendChild(k);return f};this.buildNotificationsTab=function(){var h=a.View.createEl("div",{className:"overlay_tab_content_inner"});
var k=a.View.createEl("div");var p=a.View.createEl("div");var m=a.blinkBrowserTab?'checked="checked"':"";var t=a.expandChatWindow?'checked="checked"':"";var o=a.config.enableWebkitNotification?'checked="checked"':"";var d='checked=""';var i=false;if(a.config.audibleLevel==1){d='checked="checked"'}else{if(a.config.audibleLevel==0){d='checked=""'
}}var l=a.View.createEl("fieldset",{className:"border_none"});l.innerHTML+="<legend>"+a.getCatalog("Sounds")+"</legend> ";var u=a.View.Audible.player;if(!u){u=swfobject.getObjectById("umps_audible_div")}if(swfobject.isFlashPlayerAvailable){i=true}if(!i){l.innerHTML+='<div class="pref_error_text">'+a.getCatalog("InstallFlash")+"</div>"
}l.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="playSoundCBox" id="playSoundCBox" '+d+'  /> <label for="playSoundCBox">'+a.getCatalog("PlayAudible")+"</label></div>";var n=a.View.createEl("div",{className:"overlay_pnl_audio_holder"});var r=a.View.createEl("input",{type:"button",id:"playAudioBtn",className:"AudioBtn float_left",title:a.getCatalog("Play")});
var q=a.View.createEl("label",{className:"assistiveText","for":"playAudioBtn",innerText:a.getCatalog("Play")});n.appendChild(q);n.appendChild(r);var g=a.View.createEl("div",{className:"overlay_btn stream_bar float_left"});n.appendChild(g);var v=a.View.createEl("div",{className:"stream_bar_inner"});g.appendChild(v);
var j=a.View.createEl("div",{className:"audible_options_pnl",id:"audible_options_pnl"});a.View.append(j,'<div class="audible_options_pnl_disable" id="audible_options_pnl_disable"></div>');j.appendChild(n);l.appendChild(j);p.appendChild(l);r.href="javascript:void(0);";r.onclick=function(){if(!i){return
}if(a.View.hasClass(r,"pause")){a.View.removeClass(r,"pause");r.title=a.getCatalog("Play");v.style.width="0"}else{a.View.Audible.play();a.View.addClass(r,"pause");r.title=a.getCatalog("Pause");v.style.width="50%";window.setTimeout(function(){v.style.width="100%";window.setTimeout(function(){a.View.removeClass(r,"pause");
r.title=a.getCatalog("Play");v.style.width="0"},200)},250)}};var f=a.View.createEl("fieldset",{className:"border_none"});f.innerHTML+="<legend>"+a.getCatalog("SetNotifications")+"</legend> ";f.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showTitleMsgCBox" id="showTitleMsgCBox" '+m+' /> <label for="showTitleMsgCBox">'+a.getCatalog("MessageBrowserTab")+"</label></div>";
k.appendChild(f);h.appendChild(p);h.appendChild(k);return h};this.buildChatTab=function(){var d=a.View.createEl("div",{className:"overlay_tab_content_inner"});var h=(a.hideOfflineUsers)?'checked="checked"':"";var f=a.showFavorites?'checked="checked"':"";var g=a.showFollowed?'checked="checked"':"";var i=a.View.createEl("fieldset",{className:"border_none"});
i.innerHTML="<legend>"+a.getCatalog("ShowLists")+"</legend>";i.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showFavoriteCBox" id="showFavoriteCBox" '+f+' /> <label for="showFavoriteCBox">'+a.getCatalog("favourites")+"</label></div>";i.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showFollowedCBox" id="showFollowedCBox" '+g+' /> <label for="showFollowedCBox">'+a.getCatalog("followed")+"</label></div>";
i.innerHTML+='<div class="overlay_pnl_row"><input type="checkbox" name="showOfflineCBox" id="showOfflineCBox" '+h+' /> <label for="showOfflineCBox">'+a.getCatalog("options_offline_people")+"</label></div>";d.appendChild(i);return d};this.buildScreenShareTab=function(){var d=a.View.createEl("div",{className:"overlay_tab_content_inner"});
var h=a.View.createEl("fieldset",{className:"border_none"});h.innerHTML="<legend>"+a.getCatalog("ScreenSharingOptions")+"</legend>";h.innerHTML+='<div class="overlay_pnl_row"> <div class="inlineHelp float_left"><label >'+a.getCatalog("ConnectionTimeout")+'</label><span title="'+a.getCatalog("ConnectionTimeoutHelp")+'"></span></div><input class="awayTimeVal" type="input" name="ssConnectionTimeoutVal" id="ssConnectionTimeoutVal"  value="'+a.config.ssConnectionTimeout+'"/><label >'+a.getCatalog("seconds")+"</label></div>";
h.innerHTML+='<div class="overlay_pnl_row"> <div class="inlineHelp float_left"><label >'+a.getCatalog("Retries")+'</label><span title="'+a.getCatalog("RetriesHelp")+'"></span></div> <input class="awayTimeVal" type="input" name="ssRetriesVal" id="ssRetriesVal"  value="'+a.config.ssRetries+'"/></div>';
d.appendChild(h);var k=a.config.autoDetectProxy?'checked="checked"':"";var p=a.byPassProxy?'checked="checked"':"";var g="";var j=a.View.createEl("fieldset",{className:"border_none"});j.innerHTML='<legend><div id="networkOptions"><img id="network_arrow_image" class="down_arrow" src="'+a.imageLocation+'/1pxDummy.png" title="'+a.getCatalog("Collapse")+'" alt="'+a.getCatalog("Collapse")+'"><label>'+a.getCatalog("NetworkOptions")+"</label><em>"+a.getCatalog("Advanced")+"</em></div></legend>";
d.appendChild(j);var f=a.View.createEl("div",{id:"networkOptionsContainer"});var i=a.View.createEl("div",{className:"border_none"});i.innerHTML+='<div class="overlay_pnl_row"> <div class="inlineHelp float_left"><input type="checkbox" name="autoDetectProxyCBox" id="autoDetectProxyCBox" '+k+'  /><label for="autoDetectProxyCBox">'+a.getCatalog("AutoDetectProxy")+'</label><span title="'+a.getCatalog("AutoDetectProxyHelp")+'"></span></div></div>';
f.appendChild(i);var l=a.View.createEl("div",{className:"border_none float_left"});l.innerHTML+='<div class="overlay_pnl_row"><div class="screen_share_pref_label float_left"> <label >'+a.getCatalog("ProxyAddress")+'</label></div> <input class="screen_share_pref_input" type="input" name="proxyAddressInput" id="proxyAddressInput"  value="'+a.proxyAddress+'"/></div>';
l.style.position="relative";var n="";var m="";var o="";if(a.socksProxy==4){n="checked=true";g='checked="checked"';o='style="display: none;"'}else{if(a.socksProxy==5){m="checked=true";g='checked="checked"';o='style="display: none;"'}else{o='style="display: block;"'}}l.innerHTML+='<div class="overlay_pnl_row"  style="overflow:hidden;"><div class="screen_share_pref_label inlineHelp float_left"><input type="checkbox" name="socksProxyCBox" id="socksProxyCBox" '+g+'  /><label for="socksProxyCBox">'+a.getCatalog("SocksProxy")+'</label><span title="'+a.getCatalog("SocksProxyHelp")+'"></span></div><div class="float_left"><div class="socks_proxy_disable" id="socks_proxy_disable" '+o+'></div><input type="radio" id="socksv4" name="socksversion" value=1 '+n+' /><label for="socksv4" style="margin-right:15px;">'+a.getCatalog("Socksv4")+'</label><input type="radio" name="socksversion" id="socksv5" value=2 '+m+' /><label for="socksv5">'+a.getCatalog("Socksv5")+"</label></div></div>";
l.innerHTML+='<div class="overlay_pnl_row"><div class="screen_share_pref_label float_left"> <label >'+a.getCatalog("ProxyDomain")+'</label> </div> <input class="screen_share_pref_input" type="input" name="proxyDomainInput" id="proxyDomainInput"   value="'+a.proxyDomain+'" /></div>';l.innerHTML+='<div class="overlay_pnl_row"><div class="screen_share_pref_label float_left"> <label >'+a.getCatalog("Username")+'</label> </div> <input class="screen_share_pref_input" type="input" name="proxyUsernameInput" id="proxyUsernameInput"  value="'+a.proxyUserName+'" /></div>';
l.innerHTML+='<div class="overlay_pnl_row"><div class="screen_share_pref_label float_left"> <label >'+a.getCatalog("Password")+'</label> </div> <input class="screen_share_pref_input" type="password" name="proxyPasswordInput" id="proxyPasswordInput"  value="'+a.proxyPassword+'" /></div>';l.innerHTML+='<div class="overlay_pnl_row"><div class="inlineHelp float_left"><input type="checkbox" name="byPassProxyCBox" id="byPassProxyCBox" '+p+'  /><label for="byPassProxyCBox">'+a.getCatalog("ByPassProxy")+'</label><span title="'+a.getCatalog("ByPassProxyHelp")+'"></span></div></div><div class="auto_proxy_options_pnl_disable" id="auto_detect_proxy_pnl_disable"></div>';
f.appendChild(l);d.appendChild(f);return d};this.buildGroupsTab=function(){var C=a.View.createEl("div",{className:"groups_table_holder"});var r=a.View.createEl("table",{className:"groups_table"});r.setAttribute("cellpadding","0");r.setAttribute("cellspacing","0");var v=a.View.createEl("thead",{className:"groups_header"});
var t=a.View.createEl("div",{className:"groups_table_body_holder"});var l=a.View.createEl("table",{className:"groups_table groups_table_body"});l.setAttribute("cellpadding","0");l.setAttribute("cellspacing","0");var h=a.View.createEl("tbody",{className:"groups_body"});var j=a.View.createEl("tr");var k=a.View.createEl("td",{className:"groups_table_actions header_txt",html:a.getCatalog("Actions")});
var x=a.View.createEl("td",{html:a.getCatalog("GroupName")});j.appendChild(k);j.appendChild(x);v.appendChild(j);r.appendChild(v);var d=a.Model.Owner.getInstance();var y=d.groups;var w=0;for(var n in y){if(!y[n].deleted){w++;var g="";var A=y[n];var i=a.View.escapeHtml(A.name);var p=(y[n].muted)?" muted":"";
var u=a.View.createEl("tr",{className:"chat_buddy_list_display"+p});var q=a.View.createEl("td",{className:"groups_table_actions"});var B=a.View.createEl("div",{className:"overlay_tab_content overlay_menu",id:"mute_menu_"+A.id});var z=a.View.createEl("div",{className:"mute_unmute"});var o=a.View.createEl("div",{className:"overlay_menu_inner"});
o.innerHTML=A.muted?a.getCatalog("StartReceiving"):a.getCatalog("StopReceiving");B.appendChild(o);q.appendChild(B);q.appendChild(z);u.appendChild(q);var m=a.View.createEl("td",{html:i,className:"chat_buddy_list_name"});u.appendChild(m);h.appendChild(u);z.onclick=function(D,G,E,F){return function(H){H=canvas_window.event||H;
a.View.stopEventPropogation(H);if(c.curMenu){a.View.getEl(c.curMenu).style.display="none"}D.style.display="block";c.curMenu="mute_menu_"+F.id;G.onclick=function(){if(F.muted){a.View.WindowManager.unmuteGroup(F);G.innerHTML=a.getCatalog("StopReceiving");a.View.removeClass(E,"muted")}else{a.View.WindowManager.muteGroup(F);
G.innerHTML=a.getCatalog("StartReceiving");a.View.addClass(E,"muted")}D.style.display="none"}}}(B,o,u,A)}}if(w>0){C.appendChild(r);l.appendChild(h);t.appendChild(l);C.appendChild(t)}else{var f=a.View.createEl("div",{className:"groups_empty_msg"});f.innerHTML=a.getCatalog("EmptyGroups");a.View.addClass(C,"groups_empty");
C.appendChild(f)}return C};this.saveScreenSharePreferences=function(){var j=a.View.getEl("ssConnectionTimeoutVal").value,f=a.config.ssConnectionTimeout;var g=parseInt(j,10);if(j.match(/^\d+$/)&&g&&g>=30&&g<=900){a.config.ssConnectionTimeout=g}else{a.View.removeClass(c.errorPanel,"hide");c.errorPanel.innerHTML=a.getCatalog("EnterValidTimeout");
a.View.getEl("ssConnectionTimeoutVal").value=a.config.ssConnectionTimeout;return false}var i=a.View.getEl("ssRetriesVal").value,d=a.config.ssRetries;var h=parseInt(i,10);if(i.match(/^\d+$/)&&h&&h>=3&&h<=10){a.config.ssRetries=h}else{a.View.removeClass(c.errorPanel,"hide");c.errorPanel.innerHTML=a.getCatalog("EnterValidRetries");
a.View.getEl("ssRetriesVal").value=a.config.ssRetries;return false}a.config.autoDetectProxy=(a.View.getEl("autoDetectProxyCBox").checked)?true:false;a.byPassProxy=(a.View.getEl("byPassProxyCBox").checked)?true:false;a.proxyAddress=(a.View.getEl("proxyAddressInput").value).length>0?a.View.getEl("proxyAddressInput").value:"";
if(a.View.getEl("socksProxyCBox").checked){if(a.View.getEl("socksv4").checked){a.socksProxy="4"}if(a.View.getEl("socksv5").checked){a.socksProxy="5"}}else{a.socksProxy=""}a.proxyDomain=(a.View.getEl("proxyDomainInput").value).length>0?a.View.getEl("proxyDomainInput").value:"";a.proxyUserName=(a.View.getEl("proxyUsernameInput").value).length>0?a.View.getEl("proxyUsernameInput").value:"";
a.proxyPassword=(a.View.getEl("proxyPasswordInput").value).length>0?a.View.getEl("proxyPasswordInput").value:"";return true};this.savePreferences=function(i){var g=a.View.getEl("awayTimeVal").value,d=a.config.autoIdleTime;var h=parseInt(g,10);if(g.match(/^\d+$/)&&h&&h>=1&&h<=480){a.config.autoIdleTime=h*60000
}else{a.View.removeClass(c.errorPanel,"hide");c.errorPanel.innerHTML=a.getCatalog("EnterValidNum");a.View.getEl("awayTimeVal").value=a.config.autoIdleTime/60000;return}a.setAutoidle=(a.View.getEl("showAwayCBox").checked)?true:false;a.hideOfflineUsers=(a.View.getEl("showOfflineCBox").checked)?true:false;
a.showFavorites=(a.View.getEl("showFavoriteCBox").checked)?true:false;a.showFollowed=(a.View.getEl("showFollowedCBox").checked)?true:false;a.showEmoticons=(a.View.getEl("showEmoticonsCBox").checked)?true:false;a.timeStampHover=(a.View.getEl("displayTimeStamp").checked)?true:false;a.blinkBrowserTab=a.View.getEl("showTitleMsgCBox").checked?true:false;
if(a.View.getEl("playSoundCBox").checked){a.config.audibleLevel=1}else{a.config.audibleLevel=0}var f=a.config.enableWebkitNotification;if(!f&&a.config.enableWebkitNotification){a.View.Actions.requestWebkitNotification()}var j=false;if(a.config.screenShareEnabled&&a.config.isOSsupported&&j){if(!c.saveScreenSharePreferences()){return
}}a.View.removeClass(c.loaderMask,"hide");a.View.addClass(c.errorPanel,"hide");c.loaderMask.innerHTML='<img  src="'+a.imageLocation+'/spinner.gif" alt="'+a.getCatalog("loading")+'" border="0" width="32" height="32" /><br/>'+a.getCatalog("SavingPref");a.View.WindowManager.updatePreferencesCall(i)};this.navigatePreference=function(d){c.navigatePreferenceMenu.dispatchMouseClick(c.preferenceTabs[c.navigatePreferenceMenu.getCurrentIndex()])
};this.count=0};a.View.PreferencesPanel=b})(presence);(function(b){var a={};a.init=function(){a.umps_convList_dummy=b.View.getEl("umps_convList_dummy");a.umps_favorites_dummy=b.View.getEl("umps_favorites_dummy");a.followedList_dummy=b.View.getEl("followedList_dummy");a.fav_edit=b.View.getEl("umps_fav_edit_dummy");
a.fav_done=b.View.getEl("umps_fav_done_dummy");a.fav_edt_btns_dummy=b.View.getEl("fav_edt_btns_dummy");a.searchList_dummy=b.View.getEl("searchList_dummy");a.fake_headers_holder=b.View.getEl("fake_headers_holder");a.curScrollEl=null;a.buddyPaintTimer=null;b.View.addHandler(a.umps_convList_dummy,"click",a.toggleCurConv);
b.View.addHandler(a.umps_favorites_dummy,"click",a.toggleMyFav);b.View.addHandler(a.followedList_dummy,"click",a.toggleFollowedPnl);b.View.addHandler(a.searchList_dummy,"click",a.toggleSearchPnl);b.View.addHandler(a.fav_edit,"click",function(c){b.View.Buddylist.Favorites.editModeOn(c);a.toggleMyFav(true)
});b.View.addHandler(a.fav_done,"click",b.View.Buddylist.Favorites.editModeOff);b.View.addHandler(a.fake_headers_holder,"mousewheel",function(d){d=canvas_window.event||d;b.View.cancelEvent(d);var c=d.wheelDelta;a.curScrollEl.mouseWheelListner(c)});b.View.addHandler(a.fake_headers_holder,"DOMMouseScroll",function(d){d=canvas_window.event||d;
b.View.cancelEvent(d);var c=-40*d.detail;a.curScrollEl.mouseWheelListner(c)})};a.stickyHeaders=function(h){clearTimeout(a.buddyPaintTimer);b.config.allowPainting=false;a.buddyPaintTimer=setTimeout(function(){b.config.allowPainting=true},b.config.paintWaitTime);a.curScrollEl=h;var f=Math.round(b.View.getEl("umps_convList").offsetHeight+b.View.getEl("umps_convlist_body").offsetHeight);
var d=Math.round(b.View.getEl("umps_favorites").offsetHeight+b.View.getEl("umps_favorites_body").offsetHeight);var g=Math.round(b.View.getEl("followedList").offsetHeight+b.View.getEl("presence_buddylist_body").offsetHeight);var c=30;if(-(h.scrollPane.offsetTop)>0){b.View.removeClass(b.View.getEl("fake_headers_holder"),"hide");
if(!b.View.hasClass(b.View.getEl("umps_convList"),"hide")){b.View.removeClass(a.umps_convList_dummy,"hide")}if(-(h.scrollPane.offsetTop-a.umps_convList_dummy.offsetHeight)>f){if(b.showFavorites){b.View.removeClass(a.umps_favorites_dummy,"hide")}b.View.addClass(a.umps_convList_dummy,"disabled");b.View.removeClass(a.umps_convList_dummy,"expanded");
if(-(h.scrollPane.offsetTop-(a.umps_convList_dummy.offsetHeight+a.umps_favorites_dummy.offsetHeight))>(f+d)){if(b.showFollowed){b.View.removeClass(a.followedList_dummy,"hide")}b.View.addClass(a.umps_favorites_dummy,"disabled");b.View.addClass(a.fav_edt_btns_dummy,"hide");b.View.addClass(a.fav_edt_btns_dummy,"disabled");
if(-(h.scrollPane.offsetTop-(a.umps_convList_dummy.offsetHeight+a.umps_favorites_dummy.offsetHeight+a.followedList_dummy.offsetHeight))>(f+d+g)){if(!b.View.hasClass(b.View.getEl("user_searchlist"),"hide")){b.View.removeClass(a.searchList_dummy,"hide")}b.View.addClass(a.followedList_dummy,"disabled")}else{b.View.addClass(a.searchList_dummy,"hide");
b.View.removeClass(a.followedList_dummy,"disabled")}}else{b.View.addClass(a.followedList_dummy,"hide");b.View.removeClass(a.umps_favorites_dummy,"disabled");b.View.removeClass(a.fav_edt_btns_dummy,"hide")}}else{b.View.addClass(a.umps_favorites_dummy,"hide");b.View.addClass(a.followedList_dummy,"hide");
b.View.removeClass(a.umps_convList_dummy,"disabled");b.View.addClass(a.umps_convList_dummy,"expanded")}}else{a.hideDummyHeaders()}};a.hideDummyHeaders=function(){b.View.addClass(b.View.getEl("fake_headers_holder"),"hide");b.View.addClass(a.umps_convList_dummy,"hide");b.View.addClass(a.umps_favorites_dummy,"hide");
b.View.addClass(a.followedList_dummy,"hide");b.View.addClass(a.searchList_dummy,"hide");if(a.curScrollEl){a.curScrollEl._scrolltop()}};a.toggleCurConv=function(){if(b.View.hasClass(a.umps_convList_dummy,"disabled")){b.View.Buddylist.toggleConversationPanel(true)}else{b.View.Buddylist.toggleConversationPanel()
}};a.toggleMyFav=function(d){var c=b.View.getEl("fav_arrow_dummy");if(b.View.hasClass(a.umps_favorites_dummy,"disabled")||d==true){b.View.Buddylist.toggleFavoritesPanel(true);b.View.setClass(c,"down_arrow")}else{b.View.Buddylist.toggleFavoritesPanel();if(b.View.hasClass(c,"right_arrow")){b.View.setClass(c,"down_arrow")
}else{b.View.setClass(c,"right_arrow")}}var f=b.View.getEl("umps_convlist_body");b.View.removeClass(f,"hide");b.View.Buddylist.toggleConversationPanel()};a.toggleFollowedPnl=function(){var c=b.View.getEl("follow_arrow_dummy");b.View.Buddylist.toggleFollowPanel(true);b.View.setClass(c,"down_arrow");var d=b.View.getEl("umps_convlist_body");
b.View.removeClass(d,"hide");b.View.Buddylist.toggleConversationPanel();var f=b.View.getEl("umps_favorites_body");b.View.removeClass(f,"hide");b.View.Buddylist.toggleFavoritesPanel()};a.toggleSearchPnl=function(){b.View.Buddylist.toggleSearchPanel();a.curScrollEl._scrolltoBottom()};b.View.RosterHeaders=a
})(presence);(function(f){var b={};var c=null;var d=null;var a=null;b.init=function(){c=f.View.Buddylist.participantsListTimer;d=f.View.Buddylist.curParticipantsList;a=f.View.getEl("fav_popup_holder");a.onmouseover=function(){clearTimeout(c);f.View.removeClass(a,"hide");f.View.addClass(d,"fav_active")
};a.onmouseout=function(){clearTimeout(c);f.View.removeClass(d,"fav_active");c=setTimeout(function(){f.View.addClass(a,"hide")},100)}};b.elHover=function(C){var h=C.buddyListObj;h=f.View.sortUserIdsByUserName(h);var l=C.oldBuddyListObj;var r=C.curActiveEl;var g=f.Model.Owner.getInstance();var z=C.evt;
var m=(C.showUserCnt===false)?false:true;var n=f.View.createEl("div",{className:"chat_search_header_white cursor_default"});var o=f.View.createEl("div",{className:"umps_popup_arrow"});if(d){f.View.removeClass(d,"fav_active")}f.View.addClass(r,"fav_active");f.View.Buddylist.curParticipantsList=r;var u=z.clientY,A=f.isIE?20:10;
var B;if(f.isIE){B=(canvas_doc.documentElement.clientHeight!=0)?(canvas_doc.documentElement.clientHeight-13):presence.config.defaultHeight}else{B=(canvas_window.innerHeight!=0)?canvas_window.innerHeight:presence.config.defaultHeight}a.style.bottom=(B-u+A)+"px";a.innerHTML="";var D=f.View.createEl("div",{className:"chat_buddy_search_result"});
var k=0,t=0;for(var y=0;y<h.length;y++){user=g.users[h[y]];k=k+1;if(user.presenceStatus!=f.presenceStatus.UNAVAILABLE){t=t+1}var w=f.View.Buddylist.getPresenceClass(user.presenceStatus);var E=f.View.createEl("div",{className:"chat_buddy_list_display cursor_default "+w});var F=f.View.escapeHtml(user.getName());
var q='<img class="chat_buddy_list_img" src="'+user.picture+'" alt="'+F+'" >';var p='<span class="chat_buddy_list_name_fav float_left">'+F+"</span>";var v='<img class="float_right chat_buddy_status_img" alt="'+(w=="offline"?f.getCatalog("unavailable"):f.getCatalog(w))+'" src="'+f.imageLocation+'/1pxDummy.png" align="right">';
f.View.append(E,v+q+p);D.appendChild(E)}if(l){for(var x=0;x<l.length;x++){user=g.users[l[x]];k=k+1;if(user.presenceStatus!=f.presenceStatus.UNAVAILABLE){t=t+1}var w=f.View.Buddylist.getPresenceClass(user.presenceStatus);var E=f.View.createEl("div",{className:"chat_buddy_list_display cursor_default "+w});
var F=f.View.escapeHtml(user.getName());var q='<img class="chat_buddy_list_img" src="'+user.picture+'" alt="'+F+'" >';var p='<span class="chat_buddy_list_name_fav float_left">'+F+"</span>";var v='<img class="float_right chat_buddy_status_img" alt="'+(w=="offline"?f.getCatalog("unavailable"):f.getCatalog(w))+'" src="'+f.imageLocation+'/1pxDummy.png" align="right">';
f.View.append(E,v+q+p);D.appendChild(E)}}a.appendChild(n);n.innerHTML=(m)?f.getCatalog("detailsHeader")+" ("+t+"/"+k+")":f.getCatalog("detailsHeader")+" ("+t+")";a.appendChild(D);a.appendChild(o);if(!m){if(t>0){clearTimeout(c);c=setTimeout(function(){f.View.removeClass(a,"hide")},1000)}}else{clearTimeout(c);
c=setTimeout(function(){f.View.removeClass(a,"hide")},1000)}};b.elHoverOut=function(){var g=f.View.getEl("fav_popup_holder");clearTimeout(c);f.View.removeClass(f.View.Buddylist.curParticipantsList,"fav_active");c=setTimeout(function(){f.View.addClass(g,"hide");f.View.removeClass(f.View.Buddylist.curParticipantsList,"cursor_default")
},100)};f.View.RosterParticipantsList=b})(presence);(function(b){var a=function(){var f=b.Model.Owner.getInstance();var d=b.View.OrgSearchCache.getInstance();var c={};var h=new b.View.OrgSearchList();var g=this;this.doSearch=function(i){c={};i=i.toLowerCase().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");
return this.localSearch(i)};this.accentsTidy=function(l){var j=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];
for(var k=0;k<j.length;k++){l=l.replace(j[k].letters,j[k].base)}return l};this.localSearch=function(m){var l,k,i=m.length;m=" "+m;for(var j in f.users){l=" "+f.users[j].getName().toLowerCase();l=g.accentsTidy(l);k=l.search(m);if(k!=-1){c[j]=f.users[j].toJSON();c[j]._startIndex=k;c[j]._endIndex=k+i}}return c
};this.doOrgSearch=function(o,p,j,n,m){var k,i=o.length;var l={prefix:o,searchSource:m};c={};o=o.toLowerCase().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");d.updateCurrentSearchString(o);if(d.isCacheHit(o)){c=d.getResults(o);d.updateCurrentSearchResult(c);c=this.updatePresenceAndSort(c);d.updateCurrentSearchResult(c);
if(p&&typeof p=="function"){p(c)}return}if(j){if(n&&typeof n=="function"){n()}}else{h.paintSpinner()}new b.Controller.ApiGateway().makeAPICall("orgWideSearch",l,null,function(x){if(x.result){var q={};var t=b.View.OrgSearchCache.getInstance();var y=x.data.users;if(y.length<1&&o==d.getCurrentSearchString()){t.updateCurrentSearchResult(q);
if(j){if(p&&typeof p=="function"){p(q)}}else{h.paintEmptyResults()}return}for(var w=0;w<y.length;w++){var r=new b.Model.User({id:y[w].objectId,name:y[w].screenName,title:y[w].title,lName:y[w].lastName,fName:y[w].firstName,name:y[w].screenName,picture:y[w].thumbnailUrl,presenceStatus:y[w].presence.aggregatedChannelsState=="idle"&&y[w].presence.status!=100?b.presenceStatus.IDLE:y[w].presence.status,isAnonymous:!y[w].isFollowee});
var u=r.getName().toLowerCase();k=u.search(o);if(k!=-1){q[r.id]=r.toJSON();q[r.id]._startIndex=k;q[r.id]._endIndex=k+i}}t.addToResultCache(o,q)}if(o==t.getCurrentSearchString()){t.updateCurrentSearchResult(q);var v=new b.View.Search();q=v.updatePresenceAndSort(q);if(p&&typeof p=="function"){p(q)}}},function(){if(j){if(p&&typeof p=="function"){p(c)
}}else{h.paintEmptyResults()}b.log("problem in org wide search","error")})};this.updatePresenceAndSort=function(i){if(!i){return null}for(var j in i){if(f.users[j.id]){i[j.id].presenceStatus=f.users[j.id].presenceStatus}}d.updateCurrentSearchResult(i);f.sortSearchUsers();return d.getCurrentSearchResult()
};this.doGroupSearch=function(m){var k,j,i=m.length;c={};m=m.toLowerCase().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");m=" "+m;for(var l in f.groups){k=" "+f.groups[l].name.toLowerCase();j=k.search(m);if(j!=-1){c[l]=f.groups[l].toJSON();c[l]._startIndex=j;c[l]._endIndex=j+i}}return c};this.doConversationSearch=function(o){var k,j,i=o.length,n=b.View.WindowManager.getWindows();
c={};o=o.toLowerCase().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");o=" "+o;for(var l in n){k="";var m=n[l].owner.favorites[n[l].owner.generateFvtId(n[l].entities)];if(m&&m.favoriteName&&m.favoriteName!=""){k+=" "+m.favoriteName}else{k=" "+n[l].fullTitle}k=g.accentsTidy(k);j=k.toLowerCase().search(o);if(j!=-1){c[l]=n[l];
c[l]._startIndex=j;c[l]._endIndex=j+i}}return c};this.doFavoriteSearch=function(q){var m,l,j=q.length,p=f.favorites,k;c={};q=q.toLowerCase().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");q=" "+q;for(var o in p){m="";if(p[o].favoriteName&&p[o].favoriteName!=""){m+=" "+p[o].favoriteName}else{for(var n=0;n<p[o].users.length;
n++){k=f.users[p[o].users[n]];if(k){m+=" "+f.users[p[o].users[n]].getName()+","}}}m=g.accentsTidy(m);l=m.toLowerCase().search(q);if(l!=-1){c[o]={id:p[o].id,users:p[o].users};c[o]._startIndex=l;c[o]._endIndex=l+j}}return c}};b.View.Search=a})(presence);(function(b){var a=function(g,d,f){var c=this;this.callback=g;
var d=d?d:{};this.id=b.View.WindowManager.getuuid();this.panel=canvas_doc.createElement("div");this.curSelUsrIndex=0;this.searchicon=b.View.createEl("span",{className:"chat_buddy_search_icon float_left"});this.clearSearchBtn=b.View.createEl("span",{className:"chat_buddy_remove float_right hide"});this.searchInput=b.View.createEl("input",{type:"text",id:"presence_"+c.id+"_buddy_search",className:"chat_buddy_search_input lightGreyTxt chat_buddy_search_input_default",value:b.config.catalog.typeToAddUser});
this.searchInputLbl=b.View.createEl("label",{className:"assistiveText","for":"presence_"+c.id+"_buddy_search",innerText:b.config.catalog.typeToAddUser});this.searchInput.maxLength=presence.config.nameMaxCharLimit;this.resultPanel=b.View.createEl("div",{className:"chat_buddy_search_result hide",id:"presence_"+c.id+"_search_result"});
this.search=new b.View.Search();c.searchInput.onkeyup=function(h){c.scheduleSearch(h)};c.searchInput.onfocus=function(){c.searchOnFocus()};c.searchInput.onblur=function(){c.searchOnBlur()};c.clearSearchBtn.onclick=function(){c.clearSearch()};c.panel.appendChild(c.resultPanel);this.inputDiv=b.View.createEl("div",{className:"chat_buddy_search"});
this.inputDiv.appendChild(c.clearSearchBtn);this.inputDiv.appendChild(c.searchicon);this.inputDiv.appendChild(c.searchInputLbl);this.inputDiv.appendChild(c.searchInput);this.show=function(){b.View.removeClass(c.panel,"hide")};this.hide=function(){b.View.addClass(c.panel,"hide")};this.searchOnFocus=function(){b.View.removeClass(c.searchInput,"lightGreyTxt");
if(c.searchInput.value==b.config.catalog.typeToAddUser){c.searchInput.value="";b.View.removeClass(c.clearSearchBtn,"hide");b.View.removeClass(c.searchInput,"chat_buddy_search_input_default")}};this.clearSearch=function(){c.resultPanel.innerHTML="";b.View.addClass(c.searchInput,"chat_buddy_search_input_default");
c.searchInput.value="";c.searchOnBlur();b.View.addClass(c.clearSearchBtn,"hide")};this.searchOnBlur=function(){if(c.searchInput.value==""){b.View.addClass(c.searchInput,"lightGreyTxt");c.searchInput.value=b.config.catalog.typeToAddUser}};this.dispose=function(){try{delete c.panel}catch(h){}};this.html=function(h){b.View.html(c.panel,h)
};this.add=function(h){b.View.append(c.panel,h)};this.scheduleSearch=function(i){var i=canvas_window.event||i;var h=i.charCode||i.keyCode;if(h&&h==27){if(c.callback&&typeof c.callback=="function"){c.callback(null,true)}return null}if(!c.searchScheduled){c.searchScheduled=true;if(h&&(h==37||h==38||h==39||h==40||h==13)){c.navigateSearch(h);
c.searchScheduled=false}else{window.setTimeout(function(){c.doSearch(h)},600)}}else{if(h){c.navigateSearch(h)}}};this.navigateSearch=function(j){var l=b.View.getTrimString(c.searchInput.value);if(j&&(j==38||j==40||j==13)&&l.length>0&&l!=b.config.catalog.typeToAddUser){var i=b.View.getEl("result_search_body").childNodes;
var m={up:38,down:40,enter:13};switch(j){case m.up:if(i.length>0){if((c.curSelUsrIndex-1)>=0){try{b.View.removeClass(i[c.curSelUsrIndex],"select")}catch(k){}c.curSelUsrIndex=c.curSelUsrIndex-1;b.View.addClass(i[c.curSelUsrIndex],"select")}}break;case m.down:if(i.length>0){if((c.curSelUsrIndex+1)<i.length){try{b.View.removeClass(i[c.curSelUsrIndex],"select")
}catch(k){}c.curSelUsrIndex=c.curSelUsrIndex+1;b.View.addClass(i[c.curSelUsrIndex],"select")}}break;case m.enter:var h=i[c.curSelUsrIndex].getAttribute("buddyid");b.View.addUserToOwnerList(h,c.addMemToChatCallBack);b.View.WindowManager.popupPanel.hide();break}}};this.addMemToChatCallBack=function(h){c.callback(b.Model.Owner.getInstance().users[h])
};this.doSearch=function(i){Jiffy.mark("Search_1_M_Chat_Adding_User");var h={},j=b.View.getTrimString(c.searchInput.value);if(j.length<1){c.resultPanel.innerHTML="";this.paintParticipants(h)}else{if(j.length<2||!b.config.orgWideSearchEnabled){h=c.search.doSearch(j);this.paintParticipants(h)}else{c.search.doOrgSearch(j,this.paintParticipants,true,this.paintSpinner,"chatWindow")
}}c.searchScheduled=false;Jiffy.measure("Done","Search_1_M_Chat_Adding_User")};this.paintParticipants=function(h){str=b.View.getTrimString(c.searchInput.value);var n=0;var l=b.View.createEl("div");var o=b.View.createEl("div",{className:"result_span_header",id:"result_span_header_id"});c.resultSpanHeader=o;
var k=b.View.createEl("div",{id:"result_search_body",className:"result_span_body"});l.appendChild(o);for(var m in h){if(!d[m]){n++;k.appendChild(c.getBuddyEl(h[m]))}}o.innerHTML='<img class="down_arrow" id="popup_search_arrow" alt="Down Arrow" src="'+b.imageLocation+'/1pxDummy.png">'+b.config.catalog.inviteHeader+'<span class="normalTxt"> ('+b.getCatalog("Found",n)+")</span>";
b.log("doing search "+c.searchInput.value+" "+n+" results found.");if(n<1&&str.length>0&&str!=b.config.catalog.typeToAddUser){b.View.append(k,"<div class='chat_popup_warn'>"+b.config.catalog.noResult+"</div>")}if((n<1&&str.length<1)||str==b.config.catalog.typeToAddUser){b.View.addClass(c.resultPanel,"hide")
}else{b.View.removeClass(c.resultPanel,"hide")}o.onclick=function(){if(b.View.hasClass(k,"hide")){b.View.removeClass(k,"hide");b.View.setClass(b.View.getEl("popup_search_arrow"),"down_arrow");b.View.WindowManager.togglePopPanelTabs("search")}else{b.View.addClass(k,"hide");b.View.setClass(b.View.getEl("popup_search_arrow"),"right_arrow")
}};c.resultPanel.innerHTML="";l.appendChild(k);c.resultPanel.appendChild(l);if(!b.View.hasClass(c.resultPanel,"hide")){b.View.WindowManager.togglePopPanelTabs("search")}c.searchScheduled=false;var j=k.childNodes;b.View.addClass(j[0],"select");new b.View.Accessibility({id:"result_span_header_id",onEscape:function(){if(c.callback&&typeof c.callback=="function"){c.callback(null,true)
}}})};this.paintSpinner=function(){str=b.View.getTrimString(c.searchInput.value);var k=0;var j=b.View.createEl("div");var m=b.View.createEl("div",{className:"result_span_header",id:"result_span_header_id"});c.resultSpanHeader=m;var h=b.View.createEl("div",{id:"result_search_body",className:"result_span_body"});
j.appendChild(m);m.innerHTML='<img class="down_arrow" id="popup_search_arrow" alt="Down Arrow" src="'+b.imageLocation+'/1pxDummy.png">'+b.config.catalog.inviteHeader+'<span class="normalTxt"> ('+b.getCatalog("Found",k)+")</span>";var l='<img class="chat_error float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" />'+presence.config.catalog.Searching;
b.View.html(h,l);b.View.removeClass(c.resultPanel,"hide");c.resultPanel.innerHTML="";j.appendChild(h);c.resultPanel.appendChild(j)};this.getBuddyEl=function(p){if(b.Model.Owner.getInstance().users[p.id]){p.presenceStatus=b.Model.Owner.getInstance().users[p.id].presenceStatus}if(!p.picture){p.picture=b.imageLocation+"/blankman200.png"
}var n="";if(p.presenceStatus==b.presenceStatus.AWAY){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display away";n=presence.getCatalog("away")}else{if(p.presenceStatus==b.presenceStatus.IDLE){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display idle";n=presence.getCatalog("idle")
}else{if(p.presenceStatus==b.presenceStatus.UNAVAILABLE){presenceClassName="chat_buddy_list_display chat_search_buddy_list_display offline";n=presence.getCatalog("unavailable")}else{presenceClassName="chat_buddy_list_display chat_search_buddy_list_display active";n=presence.getCatalog("available")}}}var h=p.getName();
var l=p.title;var k=b.View.createEl("div",{id:"buddy_"+c.id+"_"+p.id,className:presenceClassName});k.setAttribute("buddyid",p.id);if(c.callback&&typeof c.callback=="function"){k.onclick=function(){c.callback(p)}}var j=b.View.escapeHtml(p.getName());if(p._startIndex!==undefined){j=j.substring(0,p._startIndex)+"<span class='search_highlight'>"+j.substring(p._startIndex,p._endIndex)+"</span>"+j.substring(p._endIndex)
}var o='<img id="buddy_'+p.id+'_image" alt="'+j+'" class="chat_buddy_list_img" src="'+p.picture+'">';var i='<img class="chat_buddy_status_img float_right" alt="'+n+'"  src="'+b.imageLocation+'/1pxDummy.png">';var m='<span id="buddy_'+p.id+'_name" class="chat_buddy_list_name chat_search_buddy_list_name">'+j+'<br /><span id="buddy_'+p.id+'_title" class="lightGreyTxt" style="font-size:10px;">'+l+"</span></span>";
if(l==""){presenceClassName=presenceClassName.replace("chat_search_buddy_list_display","");m='<span id="buddy_'+p.id+'_name" class="chat_buddy_list_name">'+j+"</span>"}k.innerHTML=i+o+m;return k}};b.View.SearchPanel=a})(presence);(function(a){var b=function(){var o=this;var m=a.View.createEl("ul",{className:"settings_menu menu_box_shadow hide",tabIndex:"1",id:"settings_menu_boxId"});
m.innerHTML='<li class="lightGreyTxt menu_list_li">'+a.getCatalog("ShowChatList")+"</div>";var n=a.View.createEl("div",{className:"blueHR"});var h=a.View.createEl("div",{className:"blueHR"});var g=null;var d=null;this.currentSelectedIndex=0;var j=a.View.createEl("li",{className:"menu_box_list",tabIndex:"1"});
j.innerHTML='<span class="tick"></span>'+a.getCatalog("MyChatList");m.appendChild(j);j.onclick=function(p){if(a.showFavorites){a.showFavorites=false}else{a.showFavorites=true}o.setPref(p,true)};var c=a.View.createEl("li",{className:"menu_box_list"});c.innerHTML+='<span class="tick"></span>'+a.getCatalog("followed");
m.appendChild(c);c.onclick=function(p){if(a.showFollowed){a.showFollowed=false}else{a.showFollowed=true}o.setPref(p,true)};var f=a.View.createEl("li",{className:"menu_box_list"});f.innerHTML+='<span class="tick"></span>'+a.getCatalog("OfflineContacts");m.appendChild(f);f.onclick=function(p){if(a.hideOfflineUsers){a.hideOfflineUsers=false
}else{a.hideOfflineUsers=true}o.setPref(p,true)};m.appendChild(n);var i=a.View.createEl("li",{className:"menu_box_list"});i.innerHTML+='<span class="tick"></span>'+a.getCatalog("PlaySounds");m.appendChild(i);i.onclick=function(p){if(a.config.audibleLevel>0){a.config.audibleLevel=0}else{a.config.audibleLevel=1
}o.setPref(p,true)};var l=a.View.createEl("li",{className:"menu_box_list"});l.innerHTML+='<span class="tick"></span>'+a.getCatalog("ShowEmoticonsMenu");m.appendChild(l);l.onclick=function(p){if(a.showEmoticons){a.showEmoticons=false}else{a.showEmoticons=true}o.setPref(p,true)};m.appendChild(h);var k=a.View.createEl("li",{className:"menu_box_list"});
k.innerHTML+='<a href="javascript:void(0);" onclick="return false;" class="decoration_none"><span class="tick"></span>'+a.getCatalog("PreferencesMenuText")+"</a>";m.appendChild(k);a.View.addHandler(k,"click",function(p){a.View.PopOutWidget.resizeToFitChatWindow();o.hide();a.View.Buddylist.toggleOptionsMenu(p,true)
});a.View.getEl("chat_buddy_list_menus").appendChild(m);this.setPref=function(q,p){if(a.showFavorites){a.View.addClass(j,"active")}else{a.View.removeClass(j,"active")}if(a.showFollowed){a.View.addClass(c,"active")}else{a.View.removeClass(c,"active")}if(a.hideOfflineUsers){a.View.addClass(f,"active")}else{a.View.removeClass(f,"active")
}if(a.config.audibleLevel>0){a.View.addClass(i,"active")}else{a.View.removeClass(i,"active")}if(a.showEmoticons>0){a.View.addClass(l,"active")}else{a.View.removeClass(l,"active")}if(p){a.View.WindowManager.updatePreferencesCall(q)}};this.show=function(p){a.View.removeClass(m,"hide");a.View.addClass(a.View.getEl("presence_status_options"),"hide");
a.View.WindowManager.popupPanel.hide();a.View.addClass(a.View.getEl("optionsMenuBtn"),"clicked");o.setPref(p);d[0].focus();m.focus()};this.hide=function(){a.View.addClass(m,"hide");a.View.removeClass(a.View.getEl("optionsMenuBtn"),"clicked");if(g){o.currentSelectedIndex=g.getCurrentIndex();a.View.removeClass(d[o.currentSelectedIndex],"select");
g.resetCurrentIndex()}};this.toggle=function(){if(a.View.hasClass(m,"hide")){o.show()}else{o.hide()}};d=a.View.getByClass(m,"menu_box_list");g=new a.View.Navigate(m,d,"select")};a.View.SettingsMenu=b})(presence);(function(b){var a={};a.filterURL=function(o){Jiffy.mark("MessageURLFilter");var i=/((?:(?:https?|ftp):\/\/[\w\-=\?\.&;:%~]{1,2048}|(?:[a-zA-Z0-9\-]{1,256}\.){1,10}(?:com|edu|org|net|gov|info|co|in|eu|ag|es|it|fr|asia|biz|fm|tc|gs|vg|ms|jobs|tk|ws|br|cc|de|jp|nu|nl|am|at|be|se|me|tv|tw|uk|bz|us|ca|mx|nz|mobi|net\.[a-zA-Z][a-zA-Z]))(?:\/[\w\-=?\/.&;:%~,+@#*!]{0,2048}[\w\-=\/&%+~])?)|((?:<=<)((?:\|[A-Za-z]:)(?:\\[^\/:*?\"<>|]+))(?=>))|((?:\\|[A-Za-z]:)(?:\\[^\/:*?\"<>|\t\n\u000B\f\r]{1,255})+)|([\w\-\.\+]{1,64}@(?:[\w\-]){1,255}(?:\.[\w\-]{1,255}){1,10})/gi;
var d=o.split(/\s/g);var k="";var h=d.length;for(var f=0;f<h;f++){var p=d[f].match(i);if(p){var j=p.length;if(d[f].indexOf(p[0])!=-1&&p[0].length>1){k+=d[f].substr(0,d[f].indexOf(p[0]))}for(var c=0;c<j;c++){var g=/^(?:https?|ftp):\/\//;var l=/@/;if(p[c].length>1){if(l.exec(p[c])=="@"){k+='<a href="mailto:'+p[c]+'">'+p[c]+"</a>"
}else{if(g.exec(p[c])==null){k+='<a href="http://'+p[c]+'" target="_blank">'+p[c]+"</a>"}else{k+='<a href="'+p[c]+'" target="_blank">'+p[c]+"</a>"}}}else{k+=p[c]}if(j>=c+1){if((d[f].indexOf(p[c])+p[c].length)<d[f].indexOf(p[c+1])){k+=d[f].substr((d[f].indexOf(p[c])+p[c].length),(d[f].indexOf(p[c+1])-(d[f].indexOf(p[c])+p[c].length)))
}}}if((d[f].indexOf(p[c-1])+p[c-1].length)<d[f].length){k+=d[f].substr((d[f].indexOf(p[c-1])+p[c-1].length),(d[f].length-(d[f].indexOf(p[c-1])+p[c-1].length)))}k+=" "}else{k+=a.filterEmoitcons(d[f])+" "}}Jiffy.measure("Done","MessageURLFilter");return k};a.filterEmoitcons=function(c){if(b.showEmoticons){c=c.replace(/(:\))|(:-\))|(:\])|(=\))/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons" alt="[:-)]" />');
c=c.replace(/(:-\()|(:\()|(:\[)|(=\()/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons frown" alt="[:-(]" />');c=c.replace(/(:-O)|(:O)|(:-o)|(:o)/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons gasp" alt="[:-O]" />');c=c.replace(/(:-D)|(:D)|(=D)/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons grin" alt="[:-D]" />');
c=c.replace(/(:-P)|(:P)|(:-p)|(:p)|(=P)/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons tongue" alt="[:-P]" />');c=c.replace(/(;-\))|(;\))/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons wink" alt="[;-)]" />');c=c.replace(/((:\/ )|(:-\/)|(:\\)|(:-\\))/g,'<img src="'+b.imageLocation+'/1pxDummy.png" class="emoitcons unsure" alt="[:-]" />')
}return c};b.View.TextUtil=a})(presence);(function(a){a.presenceStatus={AVAILABLE:10,AWAY:100,IDLE:101,UNAVAILABLE:20};a.presenceStatusVal={10:"AVAILABLE",100:"AWAY",101:"IDLE",20:"offline"};a.CurPresenceEl="";a.createWorkspaceRequestsWithUuid={};a.isIE=(navigator.appName.indexOf("Microsoft")!=-1||navigator.userAgent.indexOf("Trident")!=-1)?true:false;
a.isIE7=a.isIE&&!window.postMessage;a.isIE9=(navigator.userAgent.indexOf("MSIE 9")!=-1)?true:false;a.isIE8=(navigator.userAgent.indexOf("MSIE 8")!=-1)?true:false;a.isFF=(navigator.userAgent.indexOf("Firefox")!=-1)?true:false;a.isChrome=(navigator.userAgent.indexOf("Chrome")!=-1)?true:false;a.onlineBuddyCount=0;
a.totalBuddyCount=0;a.isOffline=false;a.BuddylistCollapsed=false;a.setAutoidle=true;a.hideOfflineUsers=false;a.showEmoticons=true;a.blinkBrowserTab=true;a.expandChatWindow=false;a.showFavorites=true;a.showFollowed=true;a.timeStampHover=false;a.isIdle=null;a.byPassProxy=false;a.proxyAddress="";a.socksProxy="5";
a.proxyDomain="";a.proxyUserName="";a.proxyPassword="";a.BuddyListActive=false;a.ErrorRosterExpand=false;a.View.newMessagecounts={};a.closeDiv="</div>";a.focus="FOCUS_LOST";a.titleMsgs=[];a.focusTimer=0;a.idleTimer=0;a.previousState="";a.previousStateType=false;a.focusTitleIndex=0;a.focusTitleRotation=0;
a.prevMeasureLength=0;a.showCloseDialog=0;a.View.toTitleCase=function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()};a.View.getEl=function(b){return canvas_doc.getElementById(b)};a.View.getByClass=function(f,d,b){if(!f||!d){return[]}if(b==undefined){b=true}if(f.querySelectorAll&&!a.isIE9&&!a.isIE8){return f.querySelectorAll("."+d)
}var c=new Array();var g=function(m,l,j){var h=m.childNodes;for(var k=0;k<h.length;k++){if(!j&&h[k].className&&h[k].className.indexOf(l)!=-1){c.push(h[k])}else{if(h[k].className==l){c.push(h[k])}}g(h[k],l,j)}};g(f,d,b);return c};a.View.getElementByClass=function(b){return canvas_doc.getElementsByClassName(b)
};a.View.append=function(g,f){var h=canvas_doc.createElement("div");h.innerHTML=f;var c=canvas_doc.createDocumentFragment();var b=h.childNodes.length;for(var d=0;d<b;d++){c.appendChild(h.childNodes[0])}if(g){g.appendChild(c)}};a.View.remove=function(f,d){var b=a.View.getEl(f);var c=a.View.getEl(d);b.removeChild(c)
};a.View.html=function(c,b){if(c){c.innerHTML=b}};a.View.text=function(c,b){if(!c){return}if(c.innerText){c.innerText=b}else{c.textContent=b}};a.View.addHandler=function(d,b,c){if(!d){return a.log("addHandler: target not found!","error")}if(d.addEventListener){d.addEventListener(b,c,false)}else{if(d.attachEvent){d.attachEvent("on"+b,c)
}}};a.View.removeHandler=function(d,b,c){if(!d){return a.log("removeHandler: target not found!","error")}if(d.removeEventListener){d.removeEventListener(b,c,false)}else{if(d.detachEvent){d.detachEvent("on"+b,c)}}};a.View.stopEventPropogation=function(b){var b=window.event||b;if(b&&b.stopPropagation){b.stopPropagation()
}if(b){b.cancelBubble=true}};a.View.cancelEvent=function(b){var b=window.event||b;if(typeof b.preventDefault=="function"){b.preventDefault()}else{b.returnValue=false}};a.View.hasClass=function(c,b){if(!c){return false}if(c.classList){return c.classList.contains(b)}return(" "+c.className+" ").indexOf(" "+b+" ")>-1
};a.View.addClass=function(c,b){if(!c){return null}if(c.classList){return c.classList.add(b)}if(!a.View.hasClass(c,b)){c.className=a.View.getTrimString(c.className+" "+b)}};a.View.setClass=function(c,b){c.className=b};a.View.removeClass=function(c,b){if(!c){return null}if(c.classList){return c.classList.remove(b)
}if(a.View.hasClass(c,b)){c.className=a.View.getTrimString(c.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)")," "))}};a.View.escapeHtml=function(b){if(!b){return""}return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};a.View.escapeStr=function(b){if(!b){return""
}return b.replace(/"/g,"&quot;").replace(/'/g,"&#39;")};a.View.removeItems=function(d,c){var b=0;while(b<d.length){if(d[b]==c){d.splice(b,1);return}else{b++}}};a.View.getFormattedTime=function(d){var h="",g=new Date(),b=d?new Date(d):new Date();var c=DateUtil.formatDate(b,a.config.timeFormat);if(g.getYear()==b.getYear()&&g.getDate()==b.getDate()){h=c
}else{if(g.getYear()==b.getYear()&&(g.getDate()-b.getDate()==1)){h=presence.getCatalog("YesterdayAt",c)}else{var f=a.config.catalog.months?a.config.catalog.months[b.getMonth()]+" ":b.getMonth()+"/";h=presence.getCatalog("SomedayAt",(f+b.getDate()+", "+ +b.getFullYear()),c)}}return h};a.View.getStyle=function(b,d,f){var c=undefined;
if(b.currentStyle){c=b.currentStyle[d]}else{if(canvas_doc.defaultView&&canvas_doc.defaultView.getComputedStyle){c=canvas_doc.defaultView.getComputedStyle(b,"")[d]}else{if(b.style[d]){c=b.style[d]}else{c=undefined}}}if(f){return parseInt(c)||0}else{return c}};a.View.getTrimString=function(b){if(b){var c=/^\s+|\s+$/g;
return b.replace(c,"")}else{return""}};a.View.sortUserIdsByUserName=function(d){var c=d.slice(0);var b=function(g,f){if(typeof g=="string"){g=g.toLowerCase()}if(typeof f=="string"){f=f.toLowerCase()}if(g>f){return 1}if(g<f){return -1}if(g==f){return 0}};c.sort(function(h,g){var f=a.Model.Owner.getInstance();
if(!f.users[h]||!f.users[g]){return 0}return b(f.users[h].getName(),f.users[g].getName())});return c};a.View.objectToArray=function(c){var b=[];for(prop in c){b.push(prop)}return b};a.View.focusEle=function(b){try{var c=a.View.getEl(b);if(c&&c.focus){if(a.isIE){setTimeout(function(){try{c.focus()}catch(f){}},10)
}else{c.focus()}}}catch(d){}};a.View.updateAltAttrByTag=function(c,m){try{if(!c||!c.getElementsByTagName){return}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var b=c.getElementsByTagName(m.toUpperCase());for(var d=b.length-1;d>=0;
d--){var k=b[d];var h="";var f=k.getAttribute("alt");if(f&&f.trim()!=""){continue}var i=k.getAttribute("title");if(i&&i.trim()!=""){h=k.title}else{if(a.View.hasClass(k,"chat_buddy_status_img")){var j=k.parentElement;h=(j.className.indexOf("offline")!=-1?a.getCatalog("unavailable"):a.getCatalog(j.className))
}else{var j=k.parentElement;h=j.getAttribute("title")}}k.setAttribute("alt",h)}}catch(g){}};a.View.addUserToOwnerList=function(f,j,g,i,d){var b=a.Model.Owner.getInstance();var h=[];h.push(f);if(!b.users[f]){var c={userIds_list:h};a.Controller.call({method:"getmembersdetails",urlData:c,successCallBack:function(m){m=m.data;
for(var l in m){if(m[l].presence.aggregatedChannelsState=="idle"&&m[l].presence.status!=100){m[l].presence.status=a.presenceStatus.IDLE}var k=new a.Model.User({id:l,name:m[l].screenName,fName:m[l].firstName,lName:m[l].lastName,picture:m[l].thumbnailUrl,presenceStatus:m[l].presence.status,presenceMessage:m[l].presence.message});
if(d&&d==true){k.userSource="orgWideSearch"}k.isAnonymous=!m[l].isFollowee;b.addToUserList(k);if(j&&typeof j=="function"){if(i&&i==true){j([l])}else{j(l)}}}},failCallBack:function(k){if(g&&typeof g=="function"){g()}}})}else{if(j&&typeof j=="function"){j(f)}}};a.View.createEl=function(c,b){if(typeof c!="string"){return null
}var d=canvas_doc.createElement(c);if(b){if(b.id){d.id=b.id}if(b.className){d.className=b.className}if(b["class"]){d.className=b["class"]}if(b.title){d.title=b.title}if(b.type){d.type=b.type}if(b.value){d.value=b.value}if(b.cssText){d.cssText=b.cssText}if(b.alt){d.alt=b.alt}if(b.src){d.src=b.src}if(b.html){d.innerHTML=b.html
}if(b.align){d.align=b.align}if(b.text){a.View.text(d,b.text)}if(b.name){d.name=b.name}if(b.tabIndex){d.tabIndex=b.tabIndex}if(b["for"]){d.setAttribute("for",b["for"])}}return d};a.View.dispatchClickEvent=function(b){try{if(!a.View.isSafari()){b.click();return}var c=canvas_doc.createEvent("HTMLEvents");
c.initEvent("click",true,true);b.dispatchEvent(c)}catch(d){}};a.View.isSafari=function(){var b=navigator.userAgent.toLowerCase();if(b.indexOf("safari")!=-1){if(b.indexOf("chrome")>-1){}else{return true}}return false};a.View.extendNode=function(b){};a.View.init=function(){a.imageLocation=baseURL+a.getCodeLocation()+"images";
presence.View.subscribeEvents();if(!a.View.PopOutWidget.active){a.View.addHandler(canvas_window,"unload",presence.putInCache);a.View.addHandler(canvas_window,"beforeunload",presence.onbeforeunload)}else{}if(a.isIE){a.View.addHandler(canvas_doc,"focusin",a.View.Actions.focusListener);a.View.addHandler(canvas_doc,"focusout",a.View.Actions.lostFocus);
a.activeElementFoused=canvas_doc.activeElement}else{a.View.addHandler(canvas_window,"focus",a.View.Actions.focusListener);a.View.addHandler(canvas_window,"blur",a.View.Actions.lostFocus)}a.View.addHandler(canvas_window,"resize",a.View.Buddylist.setPanelHeight);a.View.addHandler(canvas_doc,"load",a.View.WindowManager.onCanvasLoad);
a.View.addHandler(canvas_doc,"mousedown",a.View.Actions.parentMouseDownListener);a.View.addHandler(canvas_doc,"keydown",a.View.Actions.parentKeyDownListener);if(a.focus=="FOCUS_GAIN"){a.View.Actions.sendBrowserEvent({command:"onFocus"})}else{a.View.Actions.sendBrowserEvent({command:"qn.isOnFocus"})}a.View.Actions.listenBrowserEvents();
if(a.View.PopOutWidget.active){if(popOut_ChatSubspaceId){a.View.PopOutWidget.getWorkspaceFromParent();delete a.View.WindowManager.popupPanel;a.View.WindowManager.popupPanel=new a.View.PopupPanel();a.View.WindowManager.popupPanel.hide();var b=a.Model.Owner.getInstance().workspaces[popOut_ChatSubspaceId],c=(b.groupId)?a.View.WindowManager.getGroupChatWindow(b):a.View.WindowManager.getChatWindow(b);
c.open();c.disableWindowOnly();a.View.WindowManager.currentWindow=c;Jiffy.measure("Done","CompleteBootstrapChatWindow")}else{a.log("Dummy view init start","info");a.View.PopOutWidget.getWorkspaceFromParent();a.View.Listeners.onBootstrap(null,null,true);a.View.Buddylist.toggleBuddyList();a.log("Dummy view init in popout complete","info");
Jiffy.measure("Done","CompleteBootstrapRoster")}}};a.View.subscribeEvents=function(){if(canvas_window.umps_config.isChatUiEnabled&&canvas_window.umps_config.isChatUiEnabled=="false"){return}a.EventManager.bind("event.bootstrap",a.View.Listeners.onBootstrap);a.EventManager.bind("event.bootstrap.started",a.View.Actions.showWidgetLoader);
a.EventManager.bind("event.bootstrap.failed",a.View.Listeners.onBootstrapFailed);a.EventManager.bind("event.bootstrap.showReconnect",a.View.Actions.showReconnect);a.EventManager.bind("event.bootstrap.cleanReconnect",a.View.Actions.cleanReconnect);a.EventManager.bind("event.error",a.View.Listeners.onError);
a.EventManager.bind("event.user.presence.status",a.View.Listeners.onPresence);a.EventManager.bind("event.user.message.text",a.View.Listeners.onTextMessage);a.EventManager.bind("event.user.roster.workspace.added",a.View.Listeners.onUserAddSubspace);a.EventManager.bind("event.user.roster.workspace.removed",a.View.Listeners.onUserRemoveSubspace);
a.EventManager.bind("event.user.roster.workspace.update",a.View.Listeners.onUserUpdateSubspace);a.EventManager.bind("event.owner.presence.status",a.View.Listeners.onOwnerPresence);a.EventManager.bind("event.user.workspace.deleted",a.View.Listeners.onWorkspaceDelete);a.EventManager.bind("event.user.workspace.refresh",a.View.Listeners.onWorkspaceRefresh);
a.EventManager.bind("event.user.workspace.refreshtitle",a.View.Listeners.onWorkspaceRefreshTitle);a.EventManager.bind("event.system.user.summary.updated",a.View.Listeners.onUserSummaryUpdated);a.EventManager.bind("event.system.owner.summary.updated",a.View.Listeners.onOwnerSummaryUpdated);a.EventManager.bind("event.system.userstore.summary.updated",a.View.Listeners.onStoreUserSummaryUpdated);
a.EventManager.bind("event.group.active.counter.updated",a.View.Listeners.onGroupCounterUpdated);a.EventManager.bind("event.group.total.counter.updated",a.View.Listeners.onGroupCounterUpdated);a.EventManager.bind("event.user.groupchat.unmuted",a.View.Listeners.onGroupUnmuted);a.EventManager.bind("event.user.groupchat.muted",a.View.Listeners.onGroupMuted);
a.EventManager.bind("event.user.group.roster.removed",a.View.Listeners.onGroupRemoved);a.EventManager.bind("event.user.group.roster.added",a.View.Listeners.onGroupAdded);a.EventManager.bind("event.system.group.summary.updated",a.View.Listeners.onGroupSummaryUpdated);a.EventManager.bind("event.custom.other",a.View.Listeners.onOtherCustomEvents);
a.EventManager.bind("event.user.preferences.status",a.View.Listeners.onPreferenceChange);a.EventManager.bind("event.device.attributes.changed",a.View.Listeners.onDeviceAttributesChanged);a.EventManager.bind("event.user.favourites.changed",a.View.Listeners.onFavoritesChanged);a.EventManager.bind("event.custom.poll.sleep",a.View.Listeners.onSleepModeOn);
a.EventManager.bind("event.custom.poll.wakeup",a.View.Listeners.onSleepModeOff);a.EventManager.bind("event.user.subspace.properties.changed",a.View.Listeners.onSubspacePropertiesChange);a.EventManager.bind("event.user.subspace.properties.deleted",a.View.Listeners.onSubspacePropertiesDeleted);a.EventManager.bind("event.user.device.notify",a.View.Listeners.onNotifyDevice);
a.EventManager.bind("event.channel.closed",a.View.Listeners.onChannelClosed);a.EventManager.bind("event.user.meetup.invited",a.View.Listeners.onMeetupMemberInvitationReceived);a.EventManager.bind("event.sessiongroups.session.added",a.View.Listeners.onAddedToSessionGroups);a.EventManager.bind("event.user.sds.meetups.ack",a.View.Listeners.onSDSAckReceived);
if(popOut_ChatSubspaceId){return}a.EventManager.bind("event.user.list.update",a.View.Listeners.onBuddySort);a.EventManager.bind("event.group.list.update",a.View.Listeners.onGroupSort);a.EventManager.bind("event.custom.notification.muted",a.View.Listeners.notificationMuted);a.EventManager.bind("event.custom.collapse.all",a.View.Listeners.collapseAll);
try{if(canvas_window.chatter){canvas_window.chatter.getEventBus().addEventListener("chatter:FollowUnfollow","onAfterFollow",function(c,f){a.log("onAfterFollow event received from chatter: "+a.encode(f),"info");var d={method:"umps.chatter.addFollowee",data:{entityID:f.entityId},callbackFn:function(){}};
a.Adapter.executeAction(d);a.View.WindowManager.followUserSuccess(a.Model.Owner.getInstance().users[f.entityId]);a.View.Actions.sendCustomEvent({event:"followUser",userId:f.entityId})});canvas_window.chatter.getEventBus().addEventListener("chatter:FollowUnfollow","onAfterUnfollow",function(c,f){a.log("onAfterUnfollow event received from chatter: "+a.encode(f),"info");
var d={method:"umps.chatter.removeFollowee",data:{entityID:f.entityId},callbackFn:function(){}};a.Adapter.executeAction(d)})}}catch(b){a.log("parent page chatter eventbus is not found","error")}};a.View.shortcutHandler=function(b){var c=b.charCode||b.keyCode;if((c==73||c==105)&&b.shiftKey&&b.altKey==1){a.View.focusEle("presence_widgetstatus")
}}})(presence);(function(b){var i={};var c=b.Model.Owner.getInstance();var o={};var h={};var k={};var j=0;var n=99;var m=308;var f=235;i.maxWindows=0;i.overflow=false;i.processLock={};i.curWindow=null;i.preinit=function(){c=b.Model.Owner.getInstance()};i.init=function(){if(b.View.PopOutWidget.active){m=280
}b.View.removeHandler(canvas_window,"resize",i.onWindowResize);b.View.addHandler(canvas_window,"resize",i.onWindowResize);i.preinit();h={};o={};if(!c.uuidCounter){c.uuidCounter=n}if(!i.timestampDiv){i.timestampDiv=b.View.createEl("div",{className:"presence_chat_widget chat_timestamp"});canvas_doc.body.appendChild(i.timestampDiv)
}delete i.popupPanel;i.popupPanel=new b.View.PopupPanel();i.popupPanel.hide();Jiffy.mark("ResurrectChatWindows");i.resurrectWindows();Jiffy.measure("Done","ResurrectChatWindows")};i.reInit=function(){if(i.curWindow){i.curWindow.closeSilently()}c.clearWorkspaces();h={};o={};delete i.popupPanel;i.popupPanel=new b.View.PopupPanel();
i.popupPanel.hide()};i.resurrectWindows=function(){for(var u in c.workspaces){var q=c.workspaces[u];var p;for(var r in q.users){p=q.users[r];break}var t=q.toJSON();var v=(t.groupId)?i.getGroupChatWindow(t):i.getChatWindow(t);if(!b.config.chatMsgHistoryEnabled){i.paintCacheHistory(q,v)}v.isPopped=t.isPopped;
v.isActive=t.isActive;v.hasUnreadMessages=t.hasUnreadMessages;v.msgCount=t.newMsgCount||0;q.newMsgCount=v.msgCount;if(t.disabled){v.disableWindow();if(p&&p.id&&c.users[p.id].presenceStatus!=20&&!t.once1toM){b.log("resurrectWindows: found disabled subspace but user is online so reclaiming again","info");
i.reclaimSubspace(v,p)}}if(t.doOpenWindow&&!c.currentWindow){c.currentWindow=v.id;delete t.doOpenWindow}b.log("window isActive: "+t.isActive+" disabled: "+t.disabled)}if(b.histObj&&b.histObj.chatSessionId){b.View.Buddylist.HistoryPanel.openHistoryWindow(b.histObj,true)}i.curWindow=o[c.currentWindow];
if(i.curWindow){d()}if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()}};i.paintCacheHistory=function(p,u){if(b.config.chatMsgHistoryEnabled){return}Jiffy.mark("MessageHistory");u.enableWindowOnly();var q=p.messageHistory.length,t=0;while(q--){var r=p.messageHistory[t];if(r.type){if(r.type=="status"){}else{if(r.type=="user"){u._paintUserEvent(c.users[r.userId],r.value,r.t,r.sourceId)
}else{if(r.type=="followLink"){u.paintFollowLink(c.users[r.userId],null,r.t,r.sourceId)}else{if(r.type=="followOnlyLink"){u.paintFollowLink(c.users[r.userId],"followOnlyLink",r.t)}else{if(r.type=="group"){u.processBulkEvents([{message:r.message,from:r.userId,name:r.n,picture:r.p}],r.t)}else{if(r.type=="share"){u.paintShareMessage(r.userId,r.status,r.deviceId,r.ssType,r.t)
}}}}}}}else{u.processBulkEvents([{message:r.message,from:r.userId}],r.t,null,true)}t++}Jiffy.measure("Done","MessageHistory")};i.paintHistory=function(z,q,B,A){Jiffy.mark("MessageHistory");var H=q.composeTextArea.disabled;if(H){q.enableWindowOnly()}var r=z.length,F=0;q.historyMsgsFragment=canvas_doc.createDocumentFragment();
while(r--){if(B){var w=z[r]}else{var w=z[F]}if(w.eventType!="event.user.message.text"){var C=(w.aggregatedChannelsState&&w.aggregatedChannelsState=="idle")?b.presenceStatusVal[101]:b.presenceStatusVal[w.status];if(!C){C="AVAILABLE"}if(w.eventType=="event.user.presence.status"&&w.userId!=c.id){}else{if(w.eventType=="event.user.subspace.member.added"){var G=w.memberIds;
for(var E=0;E<G.length;E++){var t=(w.sourceId&&w.sourceId!=G[E])?w.sourceId:null;if(G[E]!=c.id){q._paintUserEvent(c.users[G[E]],"joined",w.timestamp,t,true)}if(G[E]==c.id&&q.roomType=="multi"){q._paintUserEvent(null,"addedBack",w.timestamp,null,true)}}}else{if(w.eventType=="event.user.subspace.member.removed"){var x=w.memberIds;
for(var D=0;D<x.length;D++){if(x[D]!=c.id){q._paintUserEvent(c.users[x[D]],"left",w.timestamp,null,true)}if(x[D]==c.id&&q.roomType=="multi"){q._paintUserEvent(null,"removed",w.timestamp,null,true)}}}else{if(w.eventType=="event.user.subspace.properties.changed"&&w.properties){var u=w.properties;var p=JSON.parse(u.ssdata);
var v=(p)?p.publisherDeviceId:null;q.paintShareMessage(w.sourceId,u.publisherstatus,v,null,w.timestamp,true)}}}}}else{var y=q.isMessageinBufferQueue(w);if(!y){q.processBulkEvents([{message:w.message,from:w.sourceId}],w.timestamp,null,true)}}F++}if(B&&A){q.chatPanel.insertBefore(q.historyMsgsFragment,q.chatPanel.childNodes[0])
}else{q.chatPanel.appendChild(q.historyMsgsFragment)}if(!B){q.scrollToBottom()}else{if(!A){q.scrollToBottom()}}if(H){q.disableWindowOnly()}Jiffy.measure("Done","MessageHistory")};var d=function(){var p=c.workspaces[i.curWindow.subspaceId];if(!p){return b.log("Pooh! No subspace found for chat window #"+i.curWindow.id)
}i.curWindow.isOpen=true;i.curWindow.bringIntoView(true);if(p.collapsed&&!b.BuddyListActive){i.curWindow.minimize()}i.curWindow._appendToDom();i.curWindow.resize();if(i.curWindow.showHistoryIcon){i.curWindow.addHistoryIcon()}i.getHistory(i.curWindow);window.setTimeout(i.curWindow.scrollToBottom,200)};
i.searchSubspace=function(y,A,C,r,u){if(!y){return null}var w=0;var D=c.id;if(u){var B=u.chatSessionId,t=u.subspaceExists,z=u.showHistoryIcon;w=u.chatSessionType;if(u.sourceId){D=u.sourceId}}Jiffy.mark("NewChatWindowClickOnBuddy");var q=b.createWorkspaceRequestsWithUuid[y];if(q&&!q.isDisabled){return b.log("in process, return")
}var E;if(b.config.chatMsgDeepHistoryEnabled){if(u&&u.chatSessionId&&c.favorites[u.chatSessionId]){E=(r===true)?false:b.Controller.searchSubspace(u.chatSessionId,null,true)}else{E=(r===true)?false:b.Controller.searchSubspace(y)}}else{E=(r===true)?false:b.Controller.searchSubspace(y)}if(t){for(var v in b.Controller.ownerObj.workspaces){if(v==t){E=t;
break}else{if(w!=0){E=false}}}}var x={id:E,entityIds:y,chatSessionType:w,sourceId:D,showHistoryIcon:z};var p=(q&&q.isDisabled&&(o[q.uuid].entities.length<2||(o[q.uuid].chatSessionId==""||o[q.uuid].chatSessionId==B)))?o[q.uuid]:i.getChatWindow(x);if(u&&u.conWindow){p.conWindow=true}if(u&&u.hasUnreadMessages){p.hasUnreadMessages=true;
o[p.id].hasUnreadMessages=true}if(B){p.chatSessionId=B}if(!p.isPopped&&!popOut_ChatSubspaceId){b.View.PopOutWidget.resizeToFitChatWindow()}if(!A){if(!b.BuddyListActive){b.View.Buddylist.toggleBuddyList()}p.maximizeAndFocus()}if(!C){p.open(A,y)}if(!E){if(i.ismembersOnline(y.split("_"))&&!z){i.createSubspace(y,p.id,B,w)
}else{if(!b.createWorkspaceRequestsWithUuid[y]){b.createWorkspaceRequestsWithUuid[y]={uuid:p.id}}b.createWorkspaceRequestsWithUuid[y].isDisabled=true;if(z){p.addHistoryHandle(u)}else{p.disableWindow()}if(p.entities.length>1){p.recentHistory=false}i.getHistory(p)}}else{if(p.entities.length>1&&z){i.createSubspace(y,p.id,B,w)
}else{i.getHistory(p)}}Jiffy.measure("Done","NewChatWindowClickOnBuddy");return p};i.ismembersOnline=function(p){for(id in p){var q=c.users[p[id]];if(q&&q.presenceStatus!=20){return true}}return false};i.getOfflineWorkspaceRequests=function(q){var p=null;for(membersId in b.createWorkspaceRequestsWithUuid){if((membersId.split("_").join(",")).indexOf(q)!=-1){var r=b.createWorkspaceRequestsWithUuid[membersId];
if(p==null){p={}}p[membersId]=r}}return p};i.openConversation=function(q){var p=o[q];if(!p.isPopped){b.View.PopOutWidget.resizeToFitChatWindow()}p.showHistoryIcon=false;if(b.createWorkspaceRequestsWithUuid[p.entities[0]]&&b.createWorkspaceRequestsWithUuid[p.entities[0]].isDisabled){i.searchSubspace(p.entities[0])
}p.maximizeAndFocus();p.open();i.getHistory(p)};i.joinGroupChat=function(p){};i.muteGroup=function(p){};i.unmuteGroup=function(p){};i.groupUpdated=function(p){};i.groupRemoved=function(p){};i.groupMuted=function(p){};i.groupUnmuted=function(p){};i.userUpdated=function(v,q){for(var t in c.workspaces){var p=c.workspaces[t];
var u=p.uuid;if(u&&o[u]){if(!q){o[u].updateTitle()}o[u].repaintThumbnails(v.id,q)}if(!q&&p.groupId){for(var r=0;r<p.messageHistory.length;r++){if(p.messageHistory[r].userId==v.id){p.messageHistory[r].n=v.name;p.messageHistory[r].p=v.picture}}}}};i.createSubspace=function(r,t,q,w){var t=t,v=r.split("_"),p=c.getUserById(v[0]);
if(!b.createWorkspaceRequestsWithUuid[r]){b.createWorkspaceRequestsWithUuid[r]={uuid:t}}p.entityIdsString=r;var u={chatName:p.name,memberIds:v,contextId:p.name};if(q){u.chatSessionId=q}if(w){u.chatSessionType=w}if(p.userSource){u.chatSource=p.userSource}b.Controller.call({method:"createWorkspace",data:u,tempData:{uuid:t},successCallBack:function(x){b.View.WindowManager.createSubspaceSuccessCallBack(x,p,t)
},failCallBack:function(x){b.View.WindowManager.createSubspaceFailureCallBack(x,p,t)}})};i.createSubspaceSuccessCallBack=function(u,p,t){var r=b.View.getEl("chat_buddy_"+t+"_title_error");if(u.id){o[t].setSubspaceId(u.id,u.chatSessionId);o[t].updateTitle();o[t].addHistoryIcon();h[u.id]=t;if(p){if(b.createWorkspaceRequestsWithUuid[p.entityIdsString]&&b.createWorkspaceRequestsWithUuid[p.entityIdsString].isDisabled&&o[t].roomType!="multi"){o[t].enableWindow();
try{o[t].composeTextArea.focus()}catch(q){}}delete b.createWorkspaceRequestsWithUuid[p.entityIdsString]}if(!o[t].conWindow){b.View.Actions.sendCustomEvent({event:"windowOpened",subspaceId:u.id,entityId:p.entityIdsString,showHistoryIcon:o[t].showHistoryIcon})}b.View.WindowManager.synchWindows()}if(r){b.View.addClass(r,"hide");
o[t].maximizeAndFocus();b.View.removeClass(o[t].windowTitleContainer,"hide");o[t].enableWindow();if(o[t].roomType!="multi"&&p.presenceStatus){b.View.setClass(o[t].presenceElement,b.View.Buddylist.getPresenceClass(p.presenceStatus))}}if(o[t].roomType=="multi"){o[t].enableWindow();o[t].recentHistory=false
}o[t].isNew=true;i.getHistory(o[t])};i.createSubspaceFailureCallBack=function(w,p,r){b.log("problem in creating workspace","error");var v="/"+p.id,t=(b.View.PopOutWidget.active)?'target="_blank"':"";if(w.errorCode=="allUsersAreOffline"){var u=o[r].entities;if(u&&u.length>0){for(var q=0;q<u.length;q++){b.Controller.EventParser({messages:[{data:{presence:{message:"Unavailable",status:20},userId:u[q],screenName:c.users[u[q]].getName()},header:{topic:"event.user.presence.status"}}]})
}}if(o[r].roomType!="multi"){o[r].presenceClass=b.View.Buddylist.getPresenceClass(20);if(o[r].presenceElement){b.View.setClass(o[r].presenceElement,b.View.Buddylist.getPresenceClass(20))}}if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.onPresenceChange(o[r])}if(o[r].roomType=="multi"){o[r].onEvent('<span class="offline"><img class="chat_buddy_status_img float_left" alt="'+presence.getCatalog("AllUsersAreOffline")+'" src="'+b.imageLocation+'/1pxDummy.png"></span>'+presence.getCatalog("AllUsersAreOffline"))
}else{o[r].onEvent('<span class="offline"><img class="chat_buddy_status_img float_right" alt="'+presence.getCatalog("unavailable")+'"  src="'+b.imageLocation+'/1pxDummy.png"></span>'+presence.getCatalog("offlineWentMsg",'<a class="chat_messages_title" href="'+v+'" '+t+">"+b.View.escapeHtml(p.getName())+"</a>"))
}o[r].disableWindow();if(p){b.createWorkspaceRequestsWithUuid[p.entityIdsString].isDisabled=true}}else{o[r].minimize();o[r].disableWindow();b.View.addClass(o[r].windowTitleContainer,"hide");if(b.View.PopOutWidget.active){o[r].resetWidthHeight()}var x='<img class="chat_error_failed error_16 float_left" alt="error" src="'+b.imageLocation+'/1pxDummy.png" />'+presence.config.catalog.subspacefailed+'<a id="presence_'+r+'_title_error" class="chat_error_link">'+presence.config.catalog.tryAgain+"</a>";
if(!(b.View.getEl("chat_buddy_"+r+"_title_error"))){b.View.append(o[r].chatPanelContent,'<div id="chat_buddy_'+r+'_title_error" class="chat_buddy_title_error">'+x+"</div>")}else{b.View.html(b.View.getEl("chat_buddy_"+r+"_title_error"),x)}b.View.addHandler(b.View.getEl("presence_"+r+"_title_error"),"click",function(){i.retryCreateSubspace(r,p)
})}i.getHistory(o[r])};i.retryCreateSubspace=function(q,p){b.View.html(b.View.getEl("chat_buddy_"+q+"_title_error"),'<img class="chat_error_failed float_left" alt="loader" src="'+b.imageLocation+'/spinner_16_174.gif" width="16" height="12" alt="" />'+presence.config.catalog.widgetLoading);delete b.createWorkspaceRequestsWithUuid[p.entityIdsString];
i.createSubspace(p.entityIdsString,q)};i.getChatWindow=function(p){if(!h[p.id]){var q=new b.View.ChatWindow(p.uuid);q.init(p);if(b.config.previousPollMode&&b.config.previousPollMode==="short"){q.isNew=true}else{q.isNew=false}o[q.id]=q;if(p.id){h[p.id]=q.id}return q}return o[h[p.id]]};i.getGroupChatWindow=function(p){if(!h[p.id]){var q=new b.View.GroupChatWindow(p);
q.init(p);o[q.id]=q;if(p.id){h[p.id]=q.id}return q}return o[h[p.id]]};i.windowClosed=function(p){b.log("windowClosed: "+p.id,"info");if(i.curWindow&&i.curWindow.id==p.id){i.curWindow=null;c.currentWindow=null}if(p.isMeetups&&b.config.App==="webmessenger"&&b.config.meetupsEnabled){p.isMeetups=false}if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()
}};i.windowOpened=function(r,q){var p=false;if(i.curWindow){i.curWindow.isOpen=false;if(i.curWindow.showHistoryIcon){i.curWindow.close(null,true)}else{i.curWindow.close(null,false,true)}p=true}if(b.View.Buddylist.HistoryPanel&&b.View.Buddylist.HistoryPanel.isOpen){b.View.Buddylist.HistoryPanel.close()
}if(!b.View.PopOutWidget.active&&!p&&!q&&!(b.isIE&&!canvas_window.performance)&&!rtlLnaguage){setTimeout(r.bringIntoView,40)}else{r.bringIntoView(true);if(!q){r.maximizeAndFocus()}}i.curWindow=r;c.currentWindow=r.id;if(b.View.Buddylist.ChatList){b.View.Buddylist.ChatList.paintList()}};i.reclaimSubspace=function(q,p){var q=q;
q.initComposing=false;q.addMembersToChat(p,function(r,t){if(r){b.log("reclaimSubspace: user successfully added to chat: "+p.name);q.reclaimSubspace(p);q.autoAddMemTries=0}else{if(t&&t.errorCode!="allUsersAreOffline"){q.enableWindow();q.onError(b.getCatalog("ReclaimChatWindow"));q.disableWindow();q.autoAddMemTries=0
}else{if(t&&t.errorCode=="insufficientResources"){q.autoAddMemTries++;if(q.autoAddMemTries<3){i.reclaimSubspace(q,p)}}}}},true)};i.updateChatWinOnOpen=function(q){var p=b.getCookie("prePopin");if(p===true){if(!q.recentHistory){b.View.WindowManager.getHistory(q);b.setCookie("prePopin",false)}}};i.updatePrePollState=function(r,q){var p=b.config.previousPollMode&&b.config.previousPollMode==="short"&&b.config.chatMsgHistoryEnabled&&q=="me";
if(p&&r.isNew===true){r.historyInprogress=false;r.isNew=undefined}else{if(p&&r.isNew===false){if(!r.recentHistory){r.historyInprogress=false}r.isNew=undefined}else{if(r.isNew===true){b.config.previousPollMode="long";r.isNew=undefined}}}};i.onMessage=function(w){var y=w.bulkMsgs;var x,v=[],q,u="",r=!h[w.id];
for(x=0;x<y.length;x++){var t=y[x];if(t.isComposing){w.user={id:t.from};q=true}else{u=w.groupId?w.groupId:t.from;v[v.length]=t}}if(v.length==0&&q){i.onComposing(w)}else{var p=w.groupId?i.getGroupChatWindow(w):i.getChatWindow(w);r=r||!p.isActive;p.processBulkEvents(v,null,true);b.log("owner.state['rosterExpanded']: "+c.state.rosterExpanded);
if(b.View.Buddylist.ChatList&&(!i.curWindow||p.id!=i.curWindow.id||c.state.rosterExpanded!=true)){b.View.Buddylist.ChatList.onNewMessage(p)}if(u){i.notifyMessage(u,p,r)}}i.getHistory(p)};i.repaintWindow=function(t){var w=0,u="";var x;for(var y in t.users){x=t.users[y];w++;if(w>1){break}}if(w==1&&b.createWorkspaceRequestsWithUuid[x.id]){var r=b.createWorkspaceRequestsWithUuid[x.id];
o[r.uuid].setSubspaceId(t.id);h[t.id]=r.uuid}b.log("repaintWindow");if(!t.messageQueue||t.messageQueue.length==0){return}var q=i.getChatWindow(t);q.updateTitle();b.log("repaintWindow: "+JSON.stringify(t.messageQueue),"warn");for(var v=0;v<t.messageQueue.length;v++){var p=t.messageQueue[v];if(p.type&&p.type=="followLink"){q.paintFollowLink(t.users[p.userId],null,p.t)
}else{if(p.type&&p.type=="followOnlyLink"){q.paintFollowLink(t.users[p.userId],"followOnlyLink",p.t)}else{q.processBulkEvents([{message:p.message,from:p.userId,timestamp:p.t}],p.t)}}u=t.groupId?t.groupId:p.userId}q.enableWindow();b.log("owner.state['rosterExpanded']: "+c.state.rosterExpanded);if(b.View.Buddylist.ChatList&&(!i.curWindow||q.id!=i.curWindow.id||c.state.rosterExpanded!=true)){b.View.Buddylist.ChatList.onNewMessage(q)
}if(u){i.notifyMessage(u,q,true)}i.synchWindows()};i.repaintWindowTitle=function(p){var q=i.getChatWindow(p);q.updateTitle();q.enableWindow();if(p.myselfAdded&&q.roomType=="multi"){q._paintUserEvent(null,"addedBack")}};i.onUserAddedSubspace=function(p){if(!h[p.id]){return}var q=i.getChatWindow(p);q.onUserAdded(p);
if(!i.overflow){return}};i.onUserRemovedSubspace=function(q){if(!h[q.id]){return}var r=i.getChatWindow(q);var p=r.composeTextArea.disabled;if(p){r.enableWindowOnly()}r.onUserLeft(q);if(p){r.disableWindowOnly()}if(!i.overflow){return}};i.onWorkspaceDelete=function(p){var q=i.getChatWindow(p);q.onSubspaceClosed(p);
if(!i.overflow){return}};i.onComposing=function(p){if(h[p.id]&&o[h[p.id]]&&o[h[p.id]].isOpen){o[h[p.id]].addComposing(p.user.id)}};i.onPresence=function(t){var p=false;for(var q=0;q<t.workspaces.length;q++){var r=h[t.workspaces[q].id];if(r){var u=o[r];if(!u){continue}if(t.presenceStatus!=20){if(u.roomType!="multi"&&t.oldPresenceStatus==20&&!t.workspaces[q].once1toM){if(!p){i.reclaimSubspace(u,t);
p=true}}else{if(!u.composeTextArea.disabled){u.onPresence(t)}}}else{if(!u.composeTextArea.disabled){u.onPresence(t)}}}}};i.getWindows=function(){return o};i.onWindowResize=function(){i.popupPanel.hide();b.View.RosterHeaders.hideDummyHeaders()};i.notifyMessage=function(t,w,q){if(t=="me"){return}var r=c.users[t]?c.users[t]:c.groups[t];
var v=r.getName?r.getName():r.name;var p=!b.Controller.eventPollObj.shortPoll,u=((!w.isOpen)||(!w.isPopped&&!b.BuddyListActive)||(b.focus=="FOCUS_LOST"))&&(b.config.audibleLevel>=1);showToaster=(b.focus=="FOCUS_LOST")&&b.config.enableWebkitNotification&&(!b.isChatterInFocus||popOut_ChatSubspaceId||b.View.PopOutWidget.active);
b.log("notifyMessage, is primary tab: "+p+" playAudible: "+u+" showToaster: "+showToaster+"p.focus"+b.focus);b.log(" device state = "+c.deviceState.longPollTab+" - isPrimaryChannel="+(c.primaryChannelId==c.channelId));if((p&&!w.isPopped&&!b.View.PopOutWidget.popIn&&!popOut_ChatSubspaceId)||(popOut_ChatSubspaceId&&popOut_ChatSubspaceId==w.subspaceId)||(!p&&!w.isPopped&&c.deviceState.longPollTab=="CHAT_POPOUT"&&(c.primaryChannelId==c.channelId)&&!b.View.PopOutWidget.popIn)||(!p&&!w.isPopped&&c.deviceState.longPollTab=="CHAT_POPOUT"&&b.View.PopOutWidget.active&&!popOut_ChatSubspaceId)){if(u){b.View.Audible.play()
}if(showToaster){b.View.Actions.showWebkitNotification(r.picture,v,b.getCatalog("hasSentYouMessage"),w)}if(b.focus!="FOCUS_LOST"||!b.blinkBrowserTab||b.focusTitleRotation>0){return}if(b.titleMsgs.length==0){b.titleMsgs=[canvas_doc.title,"\u2022 "+presence.getCatalog("New"),presence.getCatalog("messageAlert")]
}b.View.WindowManager.rotatePageTitle()}};i.rotatePageTitle=function(){b.log("Rotate Page Title");b.focusTitleIndex++;b.focusTitleIndex=b.focusTitleIndex%b.titleMsgs.length;if(b.focusTitleIndex==0){b.focusTitleIndex++}if(b.focusTitleRotation>=25){b.focusTitleIndex=0;canvas_doc.title="\u2022 "+b.titleMsgs[b.focusTitleIndex];
return}if(b.focus=="FOCUS_LOST"){clearTimeout(b.focusTimer);b.focusTimer=setTimeout(i.rotatePageTitle,550)}b.focusTitleRotation++;canvas_doc.title=b.titleMsgs[b.focusTitleIndex]};i.closeAllWindows=function(){for(win in o){try{if(o[win].isOpen){o[win].close()}}catch(p){b.log("Error in closing window: ","error")
}}};i.disableAllWindows=function(){for(win in o){try{o[win].disableWindowOnly()}catch(p){b.log("Error in disabling window: ","error")}}};i.enableAllWindows=function(){for(win in o){try{o[win].enableWindowOnly()}catch(p){b.log("Error in enabling window: ","error")}}};i.onCanvasLoad=function(){b.log("onCanvasLoad");
b.View.Buddylist.setPanelHeight();if(i.curWindow){i.curWindow.scrollToBottom()}};i.getuuid=function(){return"umps_"+(++c.uuidCounter)};i.collapseAllWindows=function(t){Jiffy.mark("CollapseAllWindows");if(b.isOffline){return}if(b.View.PopOutWidget.active){return}var p,r=0;if(!t){var t=window.event}if(t){try{var q=null;
if(b.isFF){q=t.originalTarget.className}else{q=t.srcElement.className}if(q&&(q=="chatIcon"||q=="chatLabel"||q.search("green_dot_chat")!=-1)){return}p=(t.button==0)}catch(t){}}if(!t||p){if(b.View.hasClass(b.View.getEl("presence_main"),"chat_pan_active")){b.View.Buddylist.toggleBuddyList();r++}}Jiffy.measure("Done","CollapseAllWindows");
return r};i.followUserSuccess=function(r){if(r){var q=null;var v=null;for(var u in o){try{var p=o[u];q=i.getFollowLink(p,"chat_follow_"+r.id+"_"+p.id+"_holder");if(q){v=b.View.escapeHtml(r.getName());v=(v.length>20)?v.substr(0,17)+"...":v;b.View.html(q,presence.getCatalog("followingText",v));b.View.addClass(q,"chat_following");
p.owner.users[r.id].isAnonymous=false}}catch(t){b.log("Error in updating follow link: "+t.description)}}}};i.getFollowLink=function(q,t){var r=null;if(q.chatPanel.querySelector){r=q.chatPanel.querySelector("#"+t)}else{var p=b.View.getByClass(q.chatPanel,"chat_event_info");for(var w=0;w<p.length;w++){var v=p[w].childNodes;
for(var u=0;u<v.length;u++){if(v[u].id&&v[u].id==t){r=v[u]}}}}return r};i.updateRightMargin=function(p){m=p};i.togglePopPanelTabs=function(p){var r=b.View.getEl("result_search_body");var q=b.View.getEl("result_details_body");if(p=="search"){if(r){b.View.removeClass(r,"hide");b.View.setClass(b.View.getEl("popup_search_arrow"),"down_arrow")
}if(q){b.View.addClass(q,"hide");b.View.setClass(b.View.getEl("popup_details_arrow"),"right_arrow")}}else{if(p=="details"){if(r){b.View.addClass(r,"hide");b.View.setClass(b.View.getEl("popup_search_arrow"),"right_arrow")}if(q){b.View.removeClass(q,"hide");b.View.setClass(b.View.getEl("popup_details_arrow"),"down_arrow")
}}}};i.timeStampHoverToggle=function(){for(win in o){try{if(b.timeStampHover){b.View.addClass(o[win].chatPanel,"time_stamp_hover")}else{b.View.removeClass(o[win].chatPanel,"time_stamp_hover")}}catch(p){b.log("Error in enabling window: ","error")}}};i.updatePreferences=function(q){try{b.View.Audible.unloadSwf();
b.View.WindowManager.timeStampHoverToggle();if(popOut_ChatSubspaceId){return}if(b.showFollowed){b.View.Buddylist.paintBuddyList()}if(b.View.Buddylist.Favorites){b.View.Buddylist.Favorites.paintList()}if(q&&q!="event.user.preferences.status"){b.View.Buddylist.overlayPanel.hide(q)}if(b.showFollowed){b.View.Buddylist.toggleFollowedPeople("show")
}else{b.View.Buddylist.toggleFollowedPeople("hide")}if(b.showFavorites){b.View.Buddylist.Favorites.showHide("show")}else{b.View.Buddylist.Favorites.showHide("hide")}b.View.RosterHeaders.hideDummyHeaders()}catch(p){}};var a=function(){var p={hideOfflineUsers:b.hideOfflineUsers,showEmoticons:b.showEmoticons,setAutoidle:b.setAutoidle,autoIdleTime:b.config.autoIdleTime,blinkBrowserTab:b.blinkBrowserTab,audibleLevel:b.config.audibleLevel,enableWebkitNotification:b.config.enableWebkitNotification,showFavorites:b.showFavorites,showFollowed:b.showFollowed,timeStampHover:b.timeStampHover,showCloseDialog:b.showCloseDialog,channelId:c.channelId};
if(b.config.screenShareEnabled){p.ssConnectionTimeout=b.config.ssConnectionTimeout;p.ssRetries=b.config.ssRetries;p.autoDetectProxy=b.config.autoDetectProxy;p.byPassProxy=b.byPassProxy;p.proxyAddress=b.proxyAddress;p.socksProxy=b.socksProxy;p.proxyDomain=b.proxyDomain;p.proxyUserName=b.proxyUserName;
p.proxyPassword=b.proxyPassword}b.log(" pref data "+JSON.stringify(p));return p};i.updatePreferencesCall=function(r){var p=a();var q={userPreferences:p};b.Controller.call({method:"setuserpreferences",data:q,successCallBack:function(t){i.updatePreferences(r)},failCallBack:function(t){b.View.addClass(presence.View.Buddylist.prefPanel.loaderMask,"hide");
b.View.removeClass(presence.View.Buddylist.prefPanel.errorPanel,"hide");presence.View.Buddylist.prefPanel.errorPanel.innerHTML=b.getCatalog("FailedSettings");b.log("setuserpreferences failed ="+t,"error")}});b.Controller.updateChatterActivity()};var l=function(){var p=[];for(var r in c.workspaces){var q=c.workspaces[r];
if(q.isActive===true){p.push(r)}}return p};var g=function(){var p=[];for(var r in c.workspaces){var q=c.workspaces[r];if(q.hasUnreadMessages===true){p.push(r)}}return p};i.synchWindows=function(){if(b.synchScheduled||(b.Controller.eventPollObj&&b.Controller.eventPollObj.shortPoll)){return}b.synchScheduled=true;
setTimeout(function(){if(b.Controller.ownerObj&&b.Controller.ownerObj.presenceStatus!=20){var p={};b.synchScheduled=false;p.activeSubspaces=l();if(b.config.chatMsgHistoryEnabled){p.unreadSubspaces=g()}b.Controller.call({method:"setuserAppPreferences",data:{userAppPreferences:p},successCallBack:function(q){b.synchScheduled=false
},failCallBack:function(q){b.synchScheduled=false;b.log("synch windows setuserpreferences failed ="+q,"error")}})}else{b.log("Widget in offline state so dont make further calls","warn")}},2000)};i.synchWindowMaps=function(q,p){o[q.id].setSubspaceId(p.id);h[p.id]=q.id};i.onNotifyDevice=function(p){var q=i.getChatWindow(p);
q.onNotifyDevice(p.data)};i.onSubspacePropertiesChange=function(p){var q=i.getChatWindow(p);if(p.publisherId&&c.id==p.publisherId){if(p.publisherDeviceId!=b.getDeviceId()){q.paintViewerStatus(p)}else{if(p.publisherstatus=="started"){c.isSharingScreen=true;q.paintPublisherStatus()}}}else{if(c.sharingSubspaceId==null||b.View.ScreenShare.isHasError){q.paintViewerStatus(p)
}else{if(p.id!=c.sharingSubspaceId){q.paintViewerStatus(p)}else{if(b.View.ScreenShare.activity==b.View.ScreenShare.SHARE_ACTIVTITY){b.View.ScreenShare.resetStateValues();q.paintViewerStatus(p)}}}}i._notifyMessageOnScreeshareEvents(p,q);if(i.curWindow){i.curWindow.checkAnyShareActivity()}q.paintShareMessage(p.publisherId,p.publisherstatus,p.publisherDeviceId,"publisher")
};i.onSubspacePropertiesDeleted=function(p){if(p.publisherstatus!="stopped"){return}var q=i.getChatWindow(p);if(p.publisherId&&c.id==p.publisherId){c.isSharingScreen=false;q.paintPublisherStatus()}else{if(p.id!=c.sharingSubspaceId){q.paintViewerStatus(p)}}i._notifyMessageOnScreeshareEvents(p,q);if(i.curWindow){i.curWindow.checkAnyShareActivity()
}q.paintShareMessage(p.publisherId,p.publisherstatus,p.publisherDeviceId,"publisher")};i._notifyMessageOnScreeshareEvents=function(q,r){if(b.View.Buddylist.ChatList&&(!i.curWindow||r.id!=i.curWindow.id||c.state.rosterExpanded!=true)&&q.publisherstatus=="started"){b.View.Buddylist.ChatList.onNewMessage(r);
if(q.publisherId&&c.id!=q.publisherId&&q.publisherDeviceId!=b.getDeviceId()){var p=!h[q.id];p=p||!r.isActive;i.notifyMessage(q.publisherId,r,p)}}};i.disableShare=function(r,q){var p=h[r];for(win in o){if(win&&win!=p){o[win].disableScreenShare()}}};i.enableShare=function(r,q){var p=h[r];for(win in o){if(win&&win!=p){if(b.View.hasClass(b.View.getEl("presence_"+win+"_screen_share"),"disabled")){if(b.View.hasClass(b.View.getEl("presence_"+win+"_share_pannel"),"hide")){b.View.removeClass(b.View.getEl("presence_"+win+"_screen_share"),"disabled");
o[win].enableScreenShare()}else{if(!b.View.hasClass(o[win].viewNofityDisable,"hide")){b.View.addClass(o[win].viewNofityDisable,"hide")}}}}}};i.disableView=function(q){var p=h[q];for(win in o){if(win&&win==p){if(!b.View.hasClass(b.View.getEl("presence_"+win+"_screen_view"),"disabled")){b.View.addClass(b.View.getEl("presence_"+win+"_screen_view"),"disabled")
}}}};i.enableView=function(q){var p=h[q];for(win in o){if(win&&win==p){if(b.View.hasClass(b.View.getEl("presence_"+win+"_screen_view"),"disabled")){b.View.removeClass(b.View.getEl("presence_"+win+"_screen_view"),"disabled")}}}};i.updateViewIcon=function(p){if(c.viewingSubspaceId&&o[h[c.viewingSubspaceId]]){o[h[c.viewingSubspaceId]].updateViewerStatus()
}if(c.viewingSubspaceId&&!o[h[c.viewingSubspaceId]].confCode){o[h[c.viewingSubspaceId]].removeViewerPanel()}};i.updateShareIcon=function(){if(c.sharingSubspaceId&&o[h[c.sharingSubspaceId]]){o[h[c.sharingSubspaceId]].paintPublisherStatus()}};i.getDeepHistory=function(v,p,w){var u=0;if(p==0){u=-3*24*60*60*1000
}else{if(p==1){u=-7*24*60*60*1000}else{if(p==2){u=-30*24*60*60*1000}}}var t=0;if(!v){v=i.curWindow}if(!v||(b.Controller.eventPollObj&&b.Controller.eventPollObj.shortPoll)){return}if(!b.config.chatMsgDeepHistoryEnabled){v.historyInprogress=false;return}Jiffy.mark("fireDeepHistoryAPI");v.recentHistory=true;
v.historyInprogress=true;var r={};if(!w){window.setTimeout(function(){if(v.historyInprogress){b.View.removeClass(v.msgLoaderEl,"hide")}},2000)}if(v.subspaceId){}else{if(v.chatSessionId){r.chatSessionId=v.chatSessionId}else{r.userId=v.entities}}if(u!=0){r.fromTime=u}r.toTime=t;if(w){r.nextPageKey=w}var q={"this":v.subspaceId?v.subspaceId:"this"};
b.Controller.call({method:"getMessageHistory",data:r,urlData:q,successCallBack:function(x){Jiffy.measure("Done","fireDeepHistoryAPI");if(x&&x.data){i.getHistorySuccess(x.data.messages,v,w,true,!x.data.nextPageKey);if(x.data.nextPageKey){i.getDeepHistory(v,p,x.data.nextPageKey)}else{v.disableHistoryLink(p)
}}},failCallBack:function(){b.View.addClass(v.msgLoaderEl,"hide");i.paintBuffer(v);v.recentHistory=false;v.historyInprogress=false;Jiffy.measure("Done","fireDeepHistoryAPI");b.log("Failed to fetch history","error")}})};i.getHistory=function(t,q){if(!t){t=i.curWindow}if(!t||t.recentHistory||(b.Controller.eventPollObj&&b.Controller.eventPollObj.shortPoll)){return
}if(c.workspaces[t.subspaceId]){if(c.workspaces[t.subspaceId].isAttributePresent("historyLink")){i.getDeepHistory(t,c.workspaces[t.subspaceId].getAttribute("historyLink"));return}}if(!b.config.chatMsgHistoryEnabled){t.historyInprogress=false;return}if(b.config.chatMsgDeepHistoryEnabled){i.getDeepHistory(t,0);
return}Jiffy.mark("fireHistoryAPI");t.recentHistory=true;t.historyInprogress=true;var r={};window.setTimeout(function(){if(t.historyInprogress){b.View.removeClass(t.msgLoaderEl,"hide")}},2000);if(t.subspaceId){}else{if(t.chatSessionId){r.chatSessionId=t.chatSessionId}else{r.userIds=t.entities}}var p={"this":t.subspaceId?t.subspaceId:"this"};
b.Controller.call({method:"getMessageHistory",data:r,urlData:p,successCallBack:function(u){Jiffy.measure("Done","fireHistoryAPI");if(u&&u.data){Jiffy.mark("paintHistory");i.getHistorySuccess(u.data.messages,t,q)}},failCallBack:function(){b.View.addClass(t.msgLoaderEl,"hide");i.paintBuffer(t);t.recentHistory=false;
t.historyInprogress=false;Jiffy.measure("Done","fireHistoryAPI");b.log("Failed to fetch history","error")}})};i.getHistorySuccess=function(r,p,q,x,y){try{if(!q){p.chatPanel.innerHTML="";p.lastMessageFrom="";p.lastPresenceEvent=null;p.lastUserEvent=null;if(p.subspaceId){p.getAnonymousUsers()}}i.paintHistory(r,p,x,q);
var u=p.entities;var v=false;if(u&&u.length>0){for(var t=0;t<u.length;t++){if(c.users[u[t]].presenceStatus!=20){v=true}}}if(!v){if(p.roomType=="multi"){p.enableWindowOnly();p.onEvent('<span class="offline"><img class="chat_buddy_status_img float_left" src="'+b.imageLocation+'/1pxDummy.png" alt="'+presence.getCatalog("unavailable")+'"></span>'+presence.getCatalog("AllUsersAreOffline"))
}p.disableWindow();if(p.showHistoryIcon){b.View.addClass(p.presenceElement,"hide")}}else{if(p.roomType=="multi"){p.enableWindow()}}p.lastMessageFrom="";b.View.addClass(p.msgLoaderEl,"hide");i.paintBuffer(p,x,y);if(p.showHistoryIcon){p.composeTextArea.blur()}Jiffy.measure("Done","paintHistory")}catch(w){p.historyInprogress=false;
p.recentHistory=false;b.View.addClass(p.msgLoaderEl,"hide")}};i.paintBuffer=function(r,q,p){if(!r.historyInprogress){return}if(q&&q==true){if(p){r.historyInprogress=false}}else{r.historyInprogress=false}if(r.bufferMsgsFragment){r.chatPanel.appendChild(r.bufferMsgsFragment)}r.bufferMessageQueue=[];r.scrollToBottom();
r.bufferMsgsFragment=null;r.bufferMsgsFragment=canvas_doc.createDocumentFragment()};b.View.WindowManager=i})(presence);
/*!
 * Copyright (c) 2006, 2011, Oracle and/or its affiliates. All rights reserved.
 * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *
 *   - Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *
 *   - Neither the name of Oracle nor the names of its
 *     contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/*!
 * deployJava.js
 *
 * This file is part of the Deployment Toolkit.  It provides functions for web
 * pages to detect the presence of a JRE, install the latest JRE, and easily run
 * applets or Web Start programs.  More Information on usage of the
 * Deployment Toolkit can be found in the Deployment Guide at:
 * http://docs.oracle.com/javase/6/docs/technotes/guides/jweb/index.html
 */
var deployJava={debug:null,firefoxJavaVersion:null,myInterval:null,preInstallJREList:null,returnPage:null,brand:null,locale:null,installType:null,EAInstallEnabled:false,EarlyAccessURL:null,getJavaURL:"http://java.sun.com/webapps/getjava/BrowserRedirect?host=java.com",appleRedirectPage:"http://www.apple.com/support/downloads/",oldMimeType:"application/npruntime-scriptable-plugin;DeploymentToolkit",mimeType:"application/java-deployment-toolkit",launchButtonPNG:"http://java.sun.com/products/jfc/tsc/articles/swing2d/webstart.png",browserName:null,browserName2:null,win:canvas_window,window:canvas_window,document:canvas_doc,getJREs:function(){var f=new Array();
if(deployJava.isPluginInstalled()){var d=deployJava.getPlugin();var a=d.jvms;for(var c=0;c<a.getLength();c++){f[c]=a.get(c).version}}else{var b=deployJava.getBrowser();if(b=="MSIE"){if(deployJava.testUsingActiveX("1.7.0")){f[0]="1.7.0"}else{if(deployJava.testUsingActiveX("1.6.0")){f[0]="1.6.0"}else{if(deployJava.testUsingActiveX("1.5.0")){f[0]="1.5.0"
}else{if(deployJava.testUsingActiveX("1.4.2")){f[0]="1.4.2"}else{if(deployJava.testForMSVM()){f[0]="1.1"}}}}}}else{if(b=="Netscape Family"){deployJava.getJPIVersionUsingMimeType();if(deployJava.firefoxJavaVersion!=null){f[0]=deployJava.firefoxJavaVersion}else{if(deployJava.testUsingMimeTypes("1.7")){f[0]="1.7.0"
}else{if(deployJava.testUsingMimeTypes("1.6")){f[0]="1.6.0"}else{if(deployJava.testUsingMimeTypes("1.5")){f[0]="1.5.0"}else{if(deployJava.testUsingMimeTypes("1.4.2")){f[0]="1.4.2"}else{if(deployJava.browserName2=="Safari"){if(deployJava.testUsingPluginsArray("1.7.0")){f[0]="1.7.0"}else{if(deployJava.testUsingPluginsArray("1.6")){f[0]="1.6.0"
}else{if(deployJava.testUsingPluginsArray("1.5")){f[0]="1.5.0"}else{if(deployJava.testUsingPluginsArray("1.4.2")){f[0]="1.4.2"}}}}}}}}}}}}}if(deployJava.debug){for(var c=0;c<f.length;++c){alert("We claim to have detected Java SE "+f[c])}}return f},installJRE:function(b){var a=false;if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installJRE(b)){deployJava.refresh();
if(deployJava.returnPage!=null){canvas_doc.location=deployJava.returnPage}return true}else{return false}}else{return deployJava.installLatestJRE()}},installLatestJRE:function(){if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installLatestJRE()){deployJava.refresh();if(deployJava.returnPage!=null){canvas_doc.location=deployJava.returnPage
}return true}else{return false}}else{var b=deployJava.getBrowser();var a=navigator.platform.toLowerCase();if((deployJava.EAInstallEnabled=="true")&&(a.indexOf("win")!=-1)&&(deployJava.EarlyAccessURL!=null)){deployJava.preInstallJREList=deployJava.getJREs();if(deployJava.returnPage!=null){deployJava.myInterval=setInterval("deployJava.poll()",3000)
}location.href=deployJava.EarlyAccessURL;return false}else{if(b=="MSIE"){return deployJava.IEInstall()}else{if((b=="Netscape Family")&&(a.indexOf("win32")!=-1)){return deployJava.FFInstall()}else{location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")
}}return false}}},runApplet:function(b,g,d){if(d=="undefined"||d==null){d="1.1"}var f="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(f);if(deployJava.returnPage==null){deployJava.returnPage=canvas_doc.location}if(a!=null){var c=deployJava.getBrowser();if((c!="?")&&("Safari"!=deployJava.browserName2)){if(deployJava.versionCheck(d+"+")){deployJava.writeAppletTag(b,g)
}else{if(deployJava.installJRE(d+"+")){deployJava.refresh();location.href=canvas_doc.location;deployJava.writeAppletTag(b,g)}}}else{deployJava.writeAppletTag(b,g)}}else{if(deployJava.debug){alert("Invalid minimumVersion argument to runApplet():"+d)}}},writeAppletTag:function(d,i){var a="<applet ";var c="";
var f="</applet>";var j=true;for(var b in d){a+=(" "+b+'="'+d[b]+'"');if(b=="code"||b=="java_code"){j=false}}if(i!="undefined"&&i!=null){var h=false;for(var g in i){if(g=="codebase_lookup"){h=true}if(g=="object"||g=="java_object"){j=false}c+='<param name="'+g+'" value="'+i[g]+'"/>'}if(!h){c+='<param name="codebase_lookup" value="false"/>'
}}if(j){a+=(' code="dummy"')}a+=">";canvas_doc.write(a+"\n"+c+"\n"+f)},versionCheck:function(j){var c=0;var g="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?(\\*|\\+)?$";var a=j.match(g);if(a!=null){var f=true;var b=new Array();for(var d=1;d<a.length;++d){if((typeof a[d]=="string")&&(a[d]!="")){b[c]=a[d];
c++}}if(b[b.length-1]=="+"){f=false;b.length--}else{if(b[b.length-1]=="*"){b.length--}}var h=deployJava.getJREs();for(var d=0;d<h.length;++d){if(deployJava.compareVersionToPattern(h[d],b,f)){return true}}return false}else{alert("Invalid versionPattern passed to versionCheck: "+j);return false}},isWebStartInstalled:function(d){var c=deployJava.getBrowser();
if((c=="?")||("Safari"==deployJava.browserName2)){return true}if(d=="undefined"||d==null){d="1.4.2"}var b=false;var f="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(f);if(a!=null){b=deployJava.versionCheck(d+"+")}else{if(deployJava.debug){alert("Invalid minimumVersion argument to isWebStartInstalled(): "+d)
}b=deployJava.versionCheck("1.4.2+")}return b},getJPIVersionUsingMimeType:function(){for(var b=0;b<navigator.mimeTypes.length;++b){var c=navigator.mimeTypes[b].type;var a=c.match(/^application\/x-java-applet;jpi-version=(.*)$/);if(a!=null){deployJava.firefoxJavaVersion=a[1];if("Opera"!=deployJava.browserName2){break
}}}},launchWebStartApplication:function(d){var a=navigator.userAgent.toLowerCase();deployJava.getJPIVersionUsingMimeType();if(deployJava.isWebStartInstalled("1.7.0")==false){if((deployJava.installJRE("1.7.0+")==false)||((deployJava.isWebStartInstalled("1.7.0")==false))){return false}}var g=null;if(canvas_doc.documentURI){g=canvas_doc.documentURI
}if(g==null){g=canvas_doc.URL}var b=deployJava.getBrowser();var c;if(b=="MSIE"){c='<object classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" width="0" height="0"><PARAM name="launchjnlp" value="'+d+'"><PARAM name="docbase" value="'+g+'"></object>'}else{if(b=="Netscape Family"){c='<embed type="application/x-java-applet;jpi-version='+deployJava.firefoxJavaVersion+'" width="0" height="0" launchjnlp="'+d+'"docbase="'+g+'" />'
}}if(canvas_doc.body=="undefined"||canvas_doc.body==null){canvas_doc.write(c);canvas_doc.location=g}else{var f=canvas_doc.createElement("div");f.id="div1";f.style.position="relative";f.style.left="-10000px";f.style.margin="0px auto";f.className="dynamicDiv";f.innerHTML=c;canvas_doc.body.appendChild(f)
}},createWebStartLaunchButtonEx:function(c,b){if(deployJava.returnPage==null){deployJava.returnPage=c}var a="javascript:deployJava.launchWebStartApplication('"+c+"');";canvas_doc.write('<a href="'+a+'" onMouseOver="win.status=\'\'; return true;"><img src="'+deployJava.launchButtonPNG+'" border="0" /></a>')
},createWebStartLaunchButton:function(c,b){if(deployJava.returnPage==null){deployJava.returnPage=c}var a="javascript:if (!deployJava.isWebStartInstalled(&quot;"+b+"&quot;)) {if (deployJava.installLatestJRE()) {if (deployJava.launch(&quot;"+c+"&quot;)) {}}} else {if (deployJava.launch(&quot;"+c+"&quot;)) {}}";
canvas_doc.write('<a href="'+a+'" onMouseOver="win.status=\'\'; return true;"><img src="'+deployJava.launchButtonPNG+'" border="0" /></a>')},launch:function(a){canvas_doc.location=a;return true},isPluginInstalled:function(){var a=deployJava.getPlugin();if(a&&a.jvms){return true}else{return false}},isAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().isAutoUpdateEnabled()
}return false},setAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAutoUpdateEnabled()}return false},setInstallerType:function(a){deployJava.installType=a;if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setInstallerType(a)}return false},setAdditionalPackages:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAdditionalPackages(a)
}return false},setEarlyAccess:function(a){deployJava.EAInstallEnabled=a},isPlugin2:function(){if(deployJava.isPluginInstalled()){if(deployJava.versionCheck("1.6.0_10+")){try{return deployJava.getPlugin().isPlugin2()}catch(a){}}}return false},allowPlugin:function(){deployJava.getBrowser();var a=("Safari"!=deployJava.browserName2&&"Opera"!=deployJava.browserName2);
return a},getPlugin:function(){deployJava.refresh();var a=null;if(deployJava.allowPlugin()){a=canvas_doc.getElementById("deployJavaPlugin")}return a},compareVersionToPattern:function(g,b,c){var h="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var j=g.match(h);if(j!=null){var f=0;var k=new Array();
for(var d=1;d<j.length;++d){if((typeof j[d]=="string")&&(j[d]!="")){k[f]=j[d];f++}}var a=Math.min(k.length,b.length);if(c){for(var d=0;d<a;++d){if(k[d]!=b[d]){return false}}return true}else{for(var d=0;d<a;++d){if(k[d]<b[d]){return false}else{if(k[d]>b[d]){return true}}}return true}}else{return false
}},getBrowser:function(){if(deployJava.browserName==null){var a=navigator.userAgent.toLowerCase();if(deployJava.debug){alert("userAgent -> "+a)}if(a.indexOf("msie")!=-1){deployJava.browserName="MSIE";deployJava.browserName2="MSIE"}else{if(a.indexOf("iphone")!=-1){deployJava.browserName="Netscape Family";
deployJava.browserName2="iPhone"}else{if(a.indexOf("firefox")!=-1){deployJava.browserName="Netscape Family";deployJava.browserName2="Firefox"}else{if(a.indexOf("chrome")!=-1){deployJava.browserName="Netscape Family";deployJava.browserName2="Chrome"}else{if(a.indexOf("safari")!=-1){deployJava.browserName="Netscape Family";
deployJava.browserName2="Safari"}else{if(a.indexOf("mozilla")!=-1){deployJava.browserName="Netscape Family";deployJava.browserName2="Other"}else{if(a.indexOf("opera")!=-1){deployJava.browserName="Netscape Family";deployJava.browserName2="Opera"}else{deployJava.browserName="?";deployJava.browserName2="unknown"
}}}}}}}if(deployJava.debug){alert("Detected browser name:"+deployJava.browserName+", "+deployJava.browserName2)}}return deployJava.browserName},testUsingActiveX:function(a){var c="JavaWebStart.isInstalled."+a+".0";if(!ActiveXObject){if(deployJava.debug){alert("Browser claims to be IE, but no ActiveXObject object?")
}return false}try{return(new ActiveXObject(c)!=null)}catch(b){return false}},testForMSVM:function(){var b="{08B0E5C0-4FCB-11CF-AAA5-00401C608500}";if(typeof oClientCaps!="undefined"){var a=oClientCaps.getComponentVersion(b,"ComponentID");if((a=="")||(a=="5,0,5000,0")){return false}else{return true}}else{return false
}},testUsingMimeTypes:function(b){if(!navigator.mimeTypes){if(deployJava.debug){alert("Browser claims to be Netscape family, but no mimeTypes[] array?")}return false}for(var c=0;c<navigator.mimeTypes.length;++c){s=navigator.mimeTypes[c].type;var a=s.match(/^application\/x-java-applet\x3Bversion=(1\.8|1\.7|1\.6|1\.5|1\.4\.2)$/);
if(a!=null){if(deployJava.compareVersions(a[1],b)){return true}}}return false},testUsingPluginsArray:function(b){if((!navigator.plugins)||(!navigator.plugins.length)){return false}var a=navigator.platform.toLowerCase();for(var c=0;c<navigator.plugins.length;++c){s=navigator.plugins[c].description;if(s.search(/^Java Switchable Plug-in (Cocoa)/)!=-1){if(deployJava.compareVersions("1.5.0",b)){return true
}}else{if(s.search(/^Java/)!=-1){if(a.indexOf("win")!=-1){if(deployJava.compareVersions("1.5.0",b)||deployJava.compareVersions("1.6.0",b)){return true}}}}}if(deployJava.compareVersions("1.5.0",b)){return true}return false},IEInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");
return false},done:function(b,a){},FFInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");
return false},compareVersions:function(g,h){var d=g.split(".");var c=h.split(".");for(var f=0;f<d.length;++f){d[f]=Number(d[f])}for(var f=0;f<c.length;++f){c[f]=Number(c[f])}if(d.length==2){d[2]=0}if(d[0]>c[0]){return true}if(d[0]<c[0]){return false}if(d[1]>c[1]){return true}if(d[1]<c[1]){return false
}if(d[2]>c[2]){return true}if(d[2]<c[2]){return false}return true},enableAlerts:function(){deployJava.browserName=null;deployJava.debug=true},poll:function(){deployJava.refresh();var a=deployJava.getJREs();if((deployJava.preInstallJREList.length==0)&&(a.length!=0)){clearInterval(deployJava.myInterval);
if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}if((deployJava.preInstallJREList.length!=0)&&(a.length!=0)&&(deployJava.preInstallJREList[0]!=a[0])){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}},writePluginTag:function(){var a=deployJava.getBrowser();
if(a=="MSIE"){canvas_doc.write('<object classid="clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA" id="deployJavaPlugin" width="0" height="0"></object>')}else{if(a=="Netscape Family"&&deployJava.allowPlugin()){deployJava.writeEmbedTag()}}},refresh:function(){navigator.plugins.refresh(false);var a=deployJava.getBrowser();
if(a=="Netscape Family"&&deployJava.allowPlugin()){var b=canvas_doc.getElementById("deployJavaPlugin");if(b==null){deployJava.writeEmbedTag()}}},writeEmbedTag:function(){var a=false;if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){canvas_doc.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />');
a=true}}}if(!a){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.oldMimeType){if(navigator.mimeTypes[b].enabledPlugin){canvas_doc.write('<embed id="deployJavaPlugin" type="'+deployJava.oldMimeType+'" hidden="true" />')}}}}}},do_initialize:function(){deployJava.writePluginTag();
if(deployJava.locale==null){var b=null;if(b==null){try{b=navigator.userLanguage}catch(a){}}if(b==null){try{b=navigator.systemLanguage}catch(a){}}if(b==null){try{b=navigator.language}catch(a){}}if(b!=null){deployJava.locale=b.replace("-","_")}}}};
/*!	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var F="undefined",t="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",T="SWFObjectExprInst",z="onreadystatechange",Q=canvas_window,k=canvas_doc,v=navigator,V=false,W=[],p=[],P=[],K=[],m,S,G,D,L=false,a=false,o,I,n=true,O=function(){var ac=typeof k.getElementById!=F&&typeof k.getElementsByTagName!=F&&typeof k.createElement!=F,aj=v.userAgent.toLowerCase(),aa=v.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;
if(typeof v.plugins!=F&&typeof v.plugins[U]==t){ad=v.plugins[U].description;if(ad&&!(typeof v.mimeTypes!=F&&v.mimeTypes[r]&&!v.mimeTypes[r].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);
ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof Q.ActiveXObject!=F){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}
}(),l=function(){if(!O.w3){return}if((typeof k.readyState!=F&&k.readyState=="complete")||(typeof k.readyState==F&&(k.getElementsByTagName("body")[0]||k.body))){g()}if(!L){if(typeof k.addEventListener!=F){k.addEventListener("DOMContentLoaded",g,false)}if(O.ie&&O.win){k.attachEvent(z,function(){if(k.readyState=="complete"){k.detachEvent(z,arguments.callee);
g()}});if(Q==top){(function(){if(L){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}g()})()}}if(O.wk){(function(){if(L){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}g()})()}u(g)}}();function g(){if(L){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(E("span"));
ab.parentNode.removeChild(ab)}catch(ac){return}L=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function M(Z){if(L){if(W.length==0){W[W.length]=i;i()}Z()}else{W[W.length]=Z}}function u(aa){if(typeof Q.addEventListener!=F){Q.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=F){k.addEventListener("load",aa,false)
}else{if(typeof Q.attachEvent!=F){j(Q,"onload",aa)}else{if(typeof Q.onload=="function"){var Z=Q.onload;Q.onload=function(){Z();aa()}}else{Q.onload=aa}}}}}function i(){if(V){X()}else{J()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=E(t);ac.setAttribute("type",r);var ab=Z.appendChild(ac);
if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=F){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");O.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;J()})()}else{J()}}function J(){var ai=p.length;
if(ai>0){for(var ah=0;ah<ai;ah++){var aa=p[ah].id;var ad=p[ah].callbackFn;var ac={success:false,id:aa};if(O.pv[0]>0){var ag=c(aa);if(ag){if(H(p[ah].swfVersion)&&!(O.wk&&O.wk<312)){y(aa,true);if(ad){ac.success=true;ac.ref=B(aa);ad(ac)}}else{if(p[ah].expressInstall&&C()){var ak={};ak.data=p[ah].expressInstall;
ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")
}}R(ak,aj,aa,ad)}else{q(ag);if(ad){ad(ac)}}}}}else{y(aa,true);if(ad){var ab=B(aa);if(ab&&typeof ab.SetVariable!=F){ac.success=true;ac.ref=ab}ad(ac)}}}}}function B(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=F){Z=aa}else{var ab=aa.getElementsByTagName(t)[0];if(ab){Z=ab
}}}return Z}function C(){return !a&&H("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function R(ac,ad,Z,ab){a=true;G=ab||null;D={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=h(ag);S=null}else{m=ag;S=Z}ac.id=T;if(typeof ac.width==F||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"
}if(typeof ac.height==F||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=O.ie&&O.win?"ActiveX":"PlugIn",ae="MMredirectURL="+Q.location.toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=F){ad.flashvars+="&"+ae
}else{ad.flashvars=ae}if(O.ie&&O.win&&ag.readyState!=4){var aa=E("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}w(ac,ad,Z)}}function q(aa){if(O.ie&&O.win&&aa.readyState!=4){var Z=E("div");
aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(h(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(h(aa),aa)}}function h(ae){var ad=E("div");if(O.win&&O.ie){ad.innerHTML=ae.innerHTML
}else{var aa=ae.getElementsByTagName(t)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function w(ak,ai,aa){var Z,ac=c(aa);if(O.wk&&O.wk<312){return Z
}if(ac){if(typeof ak.id==F){ak.id=aa}if(O.ie&&O.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";
for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";P[P.length]=ak.id;Z=c(ak.id)}else{var ab=E(t);ab.setAttribute("type",r);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])
}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){f(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function f(ab,Z,aa){var ac=E("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);
ab.appendChild(ac)}function A(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(O.ie&&O.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null
}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function E(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);K[K.length]=[ab,Z,aa]}function H(ab){var aa=O.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;
Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function x(ae,aa,af,ad){if(O.ie&&O.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){o=null;I=null}if(!o||I!=Z){var ab=E("style");
ab.setAttribute("type","text/css");ab.setAttribute("media",Z);o=ac.appendChild(ab);if(O.ie&&O.win&&typeof k.styleSheets!=F&&k.styleSheets.length>0){o=k.styleSheets[k.styleSheets.length-1]}I=Z}if(O.ie&&O.win){if(o&&typeof o.addRule==t){o.addRule(ae,aa)}}else{if(o&&typeof k.createTextNode!=F){o.appendChild(k.createTextNode(ae+" {"+aa+"}"))
}}}function y(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(L&&c(ab)){c(ab).style.visibility=aa}else{x("#"+ab,"visibility:"+aa)}}function N(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=F?encodeURIComponent(aa):aa}var d=function(){if(O.ie&&O.win){window.attachEvent("onunload",function(){var ae=K.length;
for(var ad=0;ad<ae;ad++){K[ad][0].detachEvent(K[ad][1],K[ad][2])}var ab=P.length;for(var ac=0;ac<ab;ac++){A(P[ac])}for(var aa in O){O[aa]=null}O=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(O.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;
aa.expressInstall=ac;aa.callbackFn=ab;p[p.length]=aa;y(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(O.w3){return B(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(O.w3&&!(O.wk&&O.wk<312)&&ad&&aj&&ag&&ai&&aa){y(aj,false);M(function(){ag+="";
ai+="";var al={};if(ah&&typeof ah===t){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===t){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===t){for(var ak in ab){if(typeof ao.flashvars!=F){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]
}}}if(H(aa)){var ap=w(al,ao,aj);if(al.id==aj){y(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&C()){al.data=ac;R(al,ao,aj,ae);return}else{y(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}
},hasFlashPlayerVersion:H,createSWF:function(ab,aa,Z){if(O.w3){return w(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(O.w3&&C()){R(ab,ac,Z,aa)}},removeSWF:function(Z){if(O.w3){A(Z)}},createCSS:function(ac,ab,aa,Z){if(O.w3){x(ac,ab,aa,Z)}},addDomLoadEvent:M,addLoadEvent:u,isFlashPlayerAvailable:O.ie?O.ie:V,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;
if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return N(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return N(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(T);if(Z&&m){Z.parentNode.replaceChild(m,Z);
if(S){y(S,true);if(O.ie&&O.win){m.style.display="block"}}if(G){G(D)}}a=false}}}}();(function(c){var a={};a.owner=null;a.ackTimer=null;var b=a;a.slipstreamAdapter=null;a.action="start";a.isHasError=false;a.activity=0;a.VIEW_ACTIVTITY=1022;a.SHARE_ACTIVTITY=1021;a.init=function(){try{b.owner=c.Model.Owner.getInstance();
b.ackTimer=null;a.stopAckTimer();var i=c.View.getEl("ssContianer");if(!i){var i=c.View.createEl("div",{id:"ssContianer","class":"ssApplet"});var f=c.View.createEl("div",{id:"ssAppletContianer"});i.appendChild(f);var g=c.View.getEl("presence_widget");g.appendChild(i);i=c.View.getEl("ssContianer")}var d=parent.parent.document.createElement("script");
d.type="text/javascript";d.language="javascript";d.text="var notifyStatus = function(msg,type, errorCode,UMPSChannelId){ if(type && type =='alert') onShareFailed(errorCode,UMPSChannelId); else if(type){var data = {}; var request = {'method':type,'data':data,'callbackFn':function(resp){if(typeof(console) == 'undefined' || console == null) return; console.log(resp);}}; if(umps) umps.shareAction(request)}   else if(umps) umps.log(msg,'info');};";
d.text+="var onShareFailed = function(errorCode,chanId){ var data = {'event':'event.user.share','command':'error', 'errorCode':errorCode,'umpsChannelId':chanId}; var request = {'method':'onError','data':data,'callbackFn':function(resp){if(typeof(console) == 'undefined' || console == null) return; console.log(resp);}}; if(umps) umps.shareAction(request);}";
i.appendChild(d);c.getOSName()}catch(h){c.log("Failed in screenshare init "+h.message,"error")}};a.loadVersionJSON=function(f){var d=new c.Controller.HttpGateway();d.sendRequest(c.config.slipStreamDir+"config.json?cacheBuster="+new Date().getTime(),"GET",null,function(g){a.processVersion(g);f()},function(){a.onError(122);
c.log("load ssclient config file failed","error")},20000)};a.processVersion=function(d){c.config.winSSClientHashCode=d.WIN;c.config.macSSClientHashCode=d.MAC;c.config.StaticFileLocaton=baseURL+d.StaticFileLocaton;if(d.WINUNINSTALL){c.config.winSSClientUnistallerHashCode=d.WINUNINSTALL}};a.checkScreenShareCookie=function(){if(!b.owner){b.owner=c.Model.Owner.getInstance()
}if(b.owner.device.sshare){c.View.WindowManager.updateShareIcon()}};a.toggleShare=function(f,d){c.log("ScreenShare.toggleShare","info");if(!b.owner){b.owner=c.Model.Owner.getInstance()}if(b.owner.isSharingScreen){b.owner.sharingSubspaceId=f;a.initShare(f)}else{a.stopShare(f,d)}a.activity=a.SHARE_ACTIVTITY
};a.initShare=function(d){a.loadVersionJSON(function(){c.log("ScreenShare.initShare","info");a.startAckTimer();a.action="start";b.owner.isAppletLoading=true;var f=c.View.ScreenShare.getPublisherOrViewerJSON({subspaceId:d,publisherName:"",actionType:"publisher",confCode:""});if(!a.launchSSClient(f)){return
}a.startAckTimer(c.config.environmentCheckTimeout,"EnvCheck")})};a.stopShare=function(h,f){c.log("ScreenShare.stopShare","info");var d=b.owner.workspaces[h];if(d.publisherstatus=="started"){c.log("Stopping share ["+c.getMillisecToHours()+"]");var g={chatId:h,operationType:"delete"};g.properties={publisherstatus:"stopped",ssdata:""};
c.Controller.call({method:"setsubspaceproperties",data:g,urlData:{chatId:h},successCallBack:function(j){a.killScreenShareApp();c.log("setsubspaceproperties successfull","info")},failCallBack:function(j){c.log("setsubspaceproperties failed","error")}})}else{a.killScreenShareApp();var i=c.View.WindowManager.getChatWindow(d);
b.owner.isSharingScreen=false;i.paintPublisherStatus()}a.startAckTimer()};a.toggleView=function(f,d){c.log("ScreenShare.toggleView","info");if(!b.owner){b.owner=c.Model.Owner.getInstance()}if(b.owner.isViewingScreen){a.initView(f,d)}else{a.stopView()}a.activity=a.VIEW_ACTIVTITY};a.initView=function(f,d){c.log("ScreenShare.initView","info");
a.loadVersionJSON(function(){if(d==""){c.log("ScreenShare.initView - confCode missing","info");return false}b.owner.isViewingScreen=true;a.action="start";b.owner.isAppletLoading=true;a.startAckTimer();var g=b.owner.workspaces[f];var i="";if(b.owner.id==g.publisherId){i=presence.getCatalog("Your")}else{i=b.owner.users[g.publisherId].getName()
}var h=c.View.ScreenShare.getPublisherOrViewerJSON({subspaceId:f,publisherName:i,actionType:"viewer",confCode:d});if(!a.launchSSClient(h)){return}a.startAckTimer(c.config.environmentCheckTimeout,"EnvCheck")})};a.stopView=function(){a.killScreenShareApp();b.owner.isViewingScreen=false;c.log("ScreenShare.StopView","info")
};a.getPublisherOrViewerJSON=function(d){var g=(c.socksProxy=="")?false:true;var f={UMPSInfo:{SessionID:c.Controller.parentData.sid,UMPSSessionID:b.owner.umpsSessionId,OrgID:c.Controller.parentData.orgId,UserID:b.owner.id,ChatID:d.subspaceId,UMPSURL:baseURL+"/",ConnectURL:canvas_window.location.protocol+"//"+canvas_window.location.host,Action:d.actionType,PublisherName:d.publisherName},MediaServerInfo:{ConferenceCode:d.confCode,LocationOfFile:c.config.StaticFileLocaton},Preference:{ConnectionTimeout:c.config.ssConnectionTimeout,Retries:c.config.ssRetries,NetworkOptions:{AutoDetectProxy:c.config.autoDetectProxy,ByPassProxy:c.byPassProxy,ProxyAddress:c.proxyAddress,SocksProxy:g,SocksProxyVersion:c.socksProxy,ProxyDomain:c.proxyDomain,UserName:c.proxyUserName,Password:c.proxyPassword}}};
if(d.actionType=="viewer"){delete f.MediaServerInfo.LocationOfFile}else{delete f.UMPSInfo.PublisherName;delete f.MediaServerInfo.ConferenceCode}return f};a.launchSSClient=function(m){c.log("ScreenShare.launchSSClient","info");var j=c.View.getEl("ssAppletContianer");c.log("ScreenShare.launchSSClient - deployJava.do_initialize","info");
var k="";var l=canvas_doc.write;canvas_doc.write=function(p){k+=p};deployJava.do_initialize();canvas_doc.write=l;j.innerHTML=k;c.log("ScreenShare.launchSSClient - deployJava.versionCheck","info");if(!navigator.javaEnabled()||(!deployJava.isPluginInstalled()&&deployJava.getJREs().length==0)){a.onError(119);
return false}else{if(!deployJava.versionCheck("1.6.0_10+")){a.onError(120);c.log("ScreenShare.launchSSClient - Java not installed","info");return false}else{c.View.Actions.sendCustomEvent({event:"updateActivity"},function(p){if(!p){c.log("sendCustomEvent "+p.result+" "+p.errorCode);if(p.errorCode=="invalidChannelId"){c.View.BuddyList.closeChannel()
}}});c.log("ScreenShare.launchSSClient - getting hash code","info");var h="";var g="";if(c.osName.indexOf("Win")!=-1){}else{if(c.osName.indexOf("Mac")!=-1){}else{if(c.osName.indexOf("NotSupported")!=-1){a.onError(118);return false}}}var n=JSON.stringify(m);var d=Base64.encode(n);c.log("jsonString "+n+" encoded string "+d);
c.log("ScreenShare.launchSSClient - preparing params","info");var f={MAYSCRIPT:"true",archive:baseURL+c.config.slipStreamDir+"SlipstreamAdapter"+c.config.appletVersion+".jar",code:"com.sfdc.slipstream.SlipstreamAdapter.class",width:1,height:1,id:"slipstreamAdapter"};var o={launchTime:new Date().getTime(),action:a.action,cPath:c.config.ssClientDownloadPath,serName:c.config.ssClientServiceName,appName:c.config.slipStreamAppName,clientURL:baseURL+"/",command:d,cache_archive:baseURL+c.config.slipStreamDir+"SlipstreamAdapter"+c.config.appletVersion+".jar",cache_version:"1.2.9",type:"application/x-java-applet"};
if(c.osName.indexOf("Win")!=-1){o.uninstallerHcode=c.config.winSSClientUnistallerHashCode;o.uninstallerSerName=c.config.ssClientUninstalerServiceName}var i="1.6.0_10";c.log("ScreenShare.launchSSClient - getting Applet Tag","info");k="";l=canvas_doc.write;canvas_doc.write=function(p){k+=p};deployJava.runApplet(f,o,i);
canvas_doc.write=l;j.innerHTML=k;Jiffy.mark("AppletLoadTime");c.log("ScreenShare.launchSSClient - applet added to the page","info")}}return true};a.killScreenShareApp=function(){b.owner.isAppletLoading=false;try{var d=c.View.getEl("slipstreamAdapter");if(d&&d.killApplet){d.killApplet()}}catch(g){c.log("-->ScreenShare-->killScreenShareApp-> Error on kill ScreenShare Applet : "+g)
}var f=c.View.getEl("ssAppletContianer");f.innerHTML=""};a.userWentOffline=function(d){c.log("ScreenShare.userWentOffline","info");if(c.config.screenShareEnabled&&c.config.isOSsupported){if(b.owner.isSharingScreen&&b.owner.sharingSubspaceId&&d==b.owner.sharingSubspaceId){a.onCloseChannel(d)}else{if(b.owner.isViewingScreen&&b.owner.viewingSubspaceId&&d==b.owner.viewingSubspaceId){a.onCloseChannel(d)
}}}};a.onCloseChannel=function(d){c.log("ScreenShare.onCloseChannel","info");if(b.owner.isSharingScreen&&b.owner.sharingSubspaceId&&b.owner.sharingSubspaceId==d){a.stopShare(b.owner.sharingSubspaceId,true)}else{if(b.owner.isViewingScreen&&b.owner.viewingSubspaceId&&b.owner.viewingSubspaceId==d){c.setCookie("viewerSpace",null);
c.setCookie("viewerStatus",false);a.stopView()}}a.resetStateValues()};a.onError=function(f){var d="";switch(f){case 110:d=c.getCatalog("InstallationFailed");break;case 111:d=c.getCatalog("DownloadFailed");break;case 112:d=c.getCatalog("FileDamaged");break;case 113:d=c.getCatalog("UpdateClientFailed");
break;case 114:d=c.getCatalog("UnableToLaunch");break;case 115:d=c.getCatalog("CheckInternetConn");break;case 116:d=c.getCatalog("UnableToUpdateClient");break;case 117:d=c.getCatalog("RestrictAccess");break;case 118:d=c.getCatalog("OSNotSupported");break;case 119:d=c.getCatalog("JavaPluginDisabled");
break;case 120:d=c.getCatalog("JavaNotInstalled");break;case 121:d=c.getCatalog("AppletLoadTimeout");break;case 124:d=c.getCatalog("JavaSettingsError");break;case 122:d=c.getCatalog("LoadConfigFailed");break;case 123:c.log("ScreenShare.onError Internal Error [Acknowledgement Timeout], sorry for the inconvenience","error");
a.killScreenShareApp();break;default:c.log("ScreenShare.onError Internal Error ["+f+"], sorry for the inconvenience","error");break}if(d==""){if(b.owner.processShareEvent==true){d=c.getCatalog("FailedToLoad")}else{d=c.getCatalog("ErrorOccured")}}a.logErrorMessage(d);c.View.ScreenShare.isHasError=true
};a.logErrorMessage=function(d){c.log("ScreenShare.logErrorMessage "+d,"error");var f=a.getChatWindow();if(f){if(b.owner.processShareEvent){c.log("Failed To Load","error");if(c.View.hasClass(f.sharePanel,"on_failed")){errorView=new c.View.ScreenShare.ErrorView();errorView.failMessage=d;errorView._paintErrorMessage(f)
}else{c.View.ScreenShare.SSPresenter.appendView({chatWindow:f,view:new c.View.ScreenShare.ErrorView(),message:d})}}else{a.resetStateOnError();a.paintErrorMessage(f,d);b.owner.isSharingScreen=false;f.paintPublisherStatus()}a.stopAckTimer()}};a.paintErrorMessage=function(g,d){var f=new c.View.ScreenShare.ErrorView();
f.failMessage=d;f._paintErrorMessage(g);a.stopAckTimer()};a.resetStateOnError=function(){c.log("ScreenShare.resetStateOnError","info");if(b.owner.isSharingScreen&&b.owner.sharingSubspaceId){b.owner.isSharingScreen=false;a.stopShare(b.owner.sharingSubspaceId);c.View.WindowManager.updateShareIcon();b.owner.sharingSubspaceId=null
}else{if(!b.owner.isSharingScreen&&b.owner.sharingSubspaceId){a.stopShare(b.owner.sharingSubspaceId);c.View.WindowManager.updateShareIcon();b.owner.sharingSubspaceId=null}}if(b.owner.isViewingScreen&&b.owner.viewingSubspaceId){b.owner.isViewingScreen=false;c.View.WindowManager.updateViewIcon();a.stopView();
b.owner.viewingSubspaceId=null}else{if(!b.owner.isViewingScreen&&b.owner.viewingSubspaceId){c.View.WindowManager.updateViewIcon();a.stopView()}}a.resetStateValues()};a.resetStateValues=function(){c.log("ScreenShare.resetStateValues","info");a.stopAckTimer();if(!b.owner){b.owner=c.Model.Owner.getInstance()
}b.owner.isSharingScreen=false;b.owner.sharingSubspaceId=null;b.owner.isViewingScreen=false;b.owner.viewingSubspaceId=null;b.owner.processShareEvent=false;b.owner.publisherId=null;c.View.ScreenShare.isHasError=false};a.resetChatWindowShareState=function(d){if(d){d.sharePanel.className="share_status_bar share_panel";
d.shareStatusIcon.className="screen_share_loading float_left";d.viewText.innerHTML="";d.screenShareBtn.className="screen_share float_left";d.shareMessage.title=""}};a.startAckTimer=function(d){a.stopAckTimer();var g=c.config.acknowledgeTimeOut;if(d){g=d}c.log("ScreenShare.startAckTimer "+c.getMillisecToHours(),"info");
if(arguments.length>=2){var f=arguments[1];if(f=="EnvCheck"){b.ackTimer=setTimeout(a.environmentCheckTimerHandler,g);return}}b.ackTimer=setTimeout(a.ackTimerHandler,g)};a.stopAckTimer=function(){if(!b.ackTimer){b.ackTimer=null}if(b.ackTimer){c.log("ScreenShare.stopAckTimer "+c.getMillisecToHours(),"info");
clearTimeout(b.ackTimer);b.ackTimer=null}};a.ackTimerHandler=function(){c.log("ScreenShare.ackTimerHandler "+c.getMillisecToHours(),"info");if(b.ackTimer){if(b.owner.isAppletLoading){a.onError(121)}else{if((b.owner.sharingSubspaceId||b.owner.viewingSubspaceId)&&b.owner.processShareEvent){a.onError(123);
c.log("Not Responding","error")}}a.stopAckTimer();b.ackTimer=null}};a.environmentCheckTimerHandler=function(){c.log("ScreenShare.environmentCheckTimerHandler "+c.getMillisecToHours(),"info");if(b.ackTimer){var d=c.View.getEl("slipstreamAdapter");if(d&&!d.isActive&&b.owner.isAppletLoading){b.owner.isAppletLoading=false;
a.killScreenShareApp();a.onError(124)}a.stopAckTimer();b.ackTimer=null}};a.updateStatus=function(f){var g=a.getChatWindow();if(g){var d="";if(g.subspaceId==b.owner.sharingSubspaceId){c.View.ScreenShare.SSPresenter.appendView({chatWindow:g,view:new c.View.ScreenShare.PublisherLoadingView()});d=c.getCatalog(f)
}else{if(g.subspaceId==b.owner.viewingSubspaceId){c.View.ScreenShare.SSPresenter.appendView({chatWindow:g,view:new c.View.ScreenShare.ViewerLoadingView()});d=c.getCatalog(f)+((f.indexOf("InstallPlugin")!=-1||f.indexOf("StartingSession")!=-1)?"":g.userScreenTxt)}}if(d!=""){g.viewText.innerHTML=d;g.viewText.title=d
}}};a.getChatWindow=function(){if(b.owner.isSharingScreen&&b.owner.sharingSubspaceId){subspaceObj=b.owner.workspaces[b.owner.sharingSubspaceId]}else{if(b.owner.isViewingScreen&&b.owner.viewingSubspaceId){subspaceObj=b.owner.workspaces[b.owner.viewingSubspaceId]}}if(subspaceObj){chatWindow=c.View.WindowManager.getChatWindow(subspaceObj)
}return chatWindow};c.View.ScreenShare=a})(presence);(function(b){var a=function(d){d.viewerStatus=null;d.publisherId=null;d.confCode=null;d.publisherstatus=null;d.viewText=null;d.screenView="";d.screenShare="";d.shareNotificationPanel=false;d.shareStatus=null;d.shareStatusIcon=null;d.shareMessage=null;
d.stopShareConfirmation=null;d.shareState="";d.userScreenTxt="";d.publisherId="";d.viewNofityDisable="";d.sharePanelHeight=41;var c=d;d.initSS=function(g){if(b.config.screenShareEnabled&&b.config.isOSsupported){b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.BaseView()});
if(g&&(g.publisherstatus&&g.publisherstatus=="started")){if(((g.publisherId&&g.publisherId==c.owner.id)&&(g.publisherDeviceId!=b.getDeviceId()))||(g.publisherId&&g.publisherId!=c.owner.id)){b.View.addClass(c.screenShareBtn,"disabled");c.paintShareEvent(g.publisherId,g.confCode);var f=b.getCookie("viewerSpace");
var h=b.getCookie("viewerStatus");if(f&&f==c.subspaceId&&h){c.owner.isViewingScreen=true;c.owner.viewingSubspaceId=f}c.updateViewerStatus()}else{c.owner.isSharingScreen=true;if(c.subspaceId!=""){c.owner.sharingSubspaceId=c.subspaceId}c.paintPublisherStatus();b.View.addHandler(c.screenShareBtn,"click",c.toggleShare)
}}else{if(c.owner.isSharingScreen&&c.subspaceId!=""){if(c.owner.sharingSubspaceId&&c.owner.sharingSubspaceId==c.subspaceId){c.paintPublisherStatus();b.View.addHandler(c.screenShareBtn,"click",c.toggleShare)}else{b.View.addClass(c.screenShareBtn,"disabled")}}else{b.View.addHandler(c.screenShareBtn,"click",c.toggleShare)
}}}};d.onNotifyDevice=function(g){if(g){b.View.ScreenShare.stopAckTimer();if(g.conferencecode){if(c.owner.processShareEvent){Jiffy.measure("Done","SSclientStart");var h={chatId:c.subspaceId,operationType:"set"};h.properties={publisherstatus:"started",ssdata:JSON.stringify({confCode:g.conferencecode,publisherId:c.owner.id,publisherDeviceId:b.getDeviceId()})};
c.owner.workspaces[c.subspaceId].propData=h;c.owner.workspaces[c.subspaceId].propData.chatId=c.subspaceId;b.Controller.call({method:"setsubspaceproperties",data:h,urlData:{chatId:c.subspaceId},successCallBack:function(i){delete c.owner.workspaces[c.subspaceId].propData;b.log("setsubspaceproperties successfull","info")
},failCallBack:function(i){delete c.owner.workspaces[c.subspaceId].propData;b.log("setsubspaceproperties failed","error")}})}}else{if(g.status&&g.status=="stop"){if(g.type=="publisher"){c.owner.isSharingScreen=false;c.owner.processShareEvent=false;c.paintPublisherStatus();b.View.ScreenShare.stopShare(c.subspaceId,true);
b.View.ScreenShare.resetStateValues()}else{if(g.type=="viewer"){c.owner.isViewingScreen=false;b.setCookie("viewerSpace",null);b.setCookie("viewerStatus",false);c.updateViewerStatus();var f=c.owner.workspaces[c.subspaceId];if(f.viewed){f.addShareHistory(f.publisherId,"stopped",f.publisherDeviceId,"viewer");
c.paintShareMessage(f.publisherId,"stopped",f.publisherDeviceId,"viewer")}}}c.removeShareStatus()}else{if(g.errorcode){if(g.type=="publisher"){}else{b.setCookie("viewerSpace",null);b.setCookie("viewerStatus",false)}b.View.ScreenShare.onError(g.errorcode)}else{Jiffy.measure("Done","SSclientStart");c.owner.isViewingScreen=true;
c.owner.viewingSubspaceId=c.subspaceId;b.setCookie("viewerSpace",c.subspaceId);b.setCookie("viewerStatus",true);c.updateViewerStatus();var f=c.owner.workspaces[c.subspaceId];f.setViewed(true);f.addShareHistory(f.publisherId,"started",f.publisherDeviceId,"viewer");c.paintShareMessage(f.publisherId,"started",f.publisherDeviceId,"viewer")
}}}}};d.removeShareStatus=function(){var f=b.View.getEl("umps_chat_"+c.id+"_notify");if(f){if(c.msgCount==0){b.View.addClass(f,"hide")}b.View.removeClass(f,"notify_share")}};d.toggleShare=function(i,h){b.View.stopEventPropogation(i);if(!c.owner.isSharingScreen&&c.composeTextArea.disabled){return}if(c.owner.isViewingScreen||b.View.hasClass(c.screenShareBtn,"disabled")){return
}if(!c.subspaceId||c.subspaceId==""){b.log("Subspace id was incorrect ","info");return}var g=c.owner.workspaces[c.subspaceId];if(g.publisherstatus=="started"&&g.publisherId!=c.owner.id){return}if(!h){if(c.owner.processShareEvent){b.log("Some event in progress","info");return}else{c.owner.processShareEvent=true
}}c.owner.publisherId=c.owner.id;c.owner.processShareEvent=true;if(c.showHistoryIcon){c.hideHistoryIcon()}c.pushToHistory();var f=0;if(!c.owner.isSharingScreen){b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.EnvironmentCheckView()});c.owner.isSharingScreen=true;c.owner.sharingSubspaceId=c.subspaceId
}else{if(!h){return}c.owner.isSharingScreen=false}b.View.ScreenShare.toggleShare(c.subspaceId,h);b.View.ScreenShare.startAckTimer()};d.paintPublisherStatus=function(){b.View.ScreenShare.activity=b.View.ScreenShare.SHARE_ACTIVTITY;if(c.owner.isSharingScreen){b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.PublisherSuccessView()});
c.owner.sharingSubspaceId=c.subspaceId;c.shareNotificationPanel=true}else{b.View.ScreenShare.SSPresenter.resetState(c);c.owner.sharingSubspaceId=null;b.View.WindowManager.enableShare(c.subspaceId,false);c.shareNotificationPanel=false}c.owner.processShareEvent=false;c.resize()};d.paintViewerStatus=function(f){b.View.ScreenShare.activity=b.View.ScreenShare.VIEW_ACTIVTITY;
if(f.publisherstatus=="started"){if(!c.isPopped){c.notifyMessage(null,null)}c.paintShareEvent(f.publisherId,f.confCode)}else{if(f.publisherstatus=="stopped"){c.paintSharingStopped(f.publisherId)}}};d.paintShareMessage=function(o,m,j,k,p,q){var u="",h,t="",f="";statusType="";if(m=="stopped"){t='<a class="feedback_link stoppedShareMesg feedback" href="'+b.config.SSFeedbackURL+'" target="_blank" >'+b.getCatalog("SendUsYourFeedback")+"</a>"
}if(k=="error"){var l=new b.View.ScreenShare.ErrorView();l.failMessage=m;l._paintErrorMessage(c)}else{if(q===true){if(c.owner.id==o){if(m=="started"){statusType="start_status_message";u=b.getCatalog("PublisherStatus")}else{statusType="stop_status_message";u=b.getCatalog("PublisherStatusStopped")}}else{var h=c.owner.users[o].getName();
if(m=="started"){statusType="start_status_message";u=b.getCatalog("SharingStarted",h)}else{statusType="stop_status_message";u=b.getCatalog("SharingStopped",h);t=""}}}else{if(c.owner.id==o&&q!==true){if(j==b.getDeviceId()){if(m=="started"){statusType="start_status_message";u=b.getCatalog("PublisherStatus")
}else{statusType="stop_status_message";u=b.getCatalog("PublisherStatusStopped")}}else{if(m=="started"){statusType="start_status_message";u=(k=="publisher")?b.getCatalog("view")+" "+b.getCatalog("UserScreen",presence.getCatalog("Your")):b.getCatalog("ViewerStarted",presence.getCatalog("Your"))}else{statusType="stop_status_message";
u=(k=="publisher")?b.getCatalog("SharingStopped",presence.getCatalog("You")):b.getCatalog("ViewerStopped",presence.getCatalog("Your"));if(k=="publisher"){t=""}}}}else{var h=c.owner.users[o].getName();if(m=="started"){statusType="start_status_message";u=(k=="publisher")?b.getCatalog("SharingStarted",h):b.getCatalog("ViewerStarted",h)
}else{statusType="stop_status_message";u=(k=="publisher")?b.getCatalog("SharingStopped",h):b.getCatalog("ViewerStopped",h)}}}var n=b.View.createEl("div",{className:statusType});c.updateScrollFlag();var i=b.View.createEl("div",{className:"chat_event_info share_event_info"});var g=p?c.getFormattedTime(p):c.getFormattedTime();
var r=b.View.createEl("div",{align:"right",className:"chat_time_stamp"});r.innerHTML=g;u=b.View.escapeHtml(u);b.View.append(n,'<div class="ss_status_message">'+u+" "+t+"</div>");n.appendChild(r);i.appendChild(n);if(q&&q===true){c.historyMsgsFragment.appendChild(i)}else{c.chatPanel.appendChild(i);c.scrollToBottom()
}c.lastMessageFrom=null}};d.paintShareEvent=function(j,h,g){if(!b.config.screenShareEnabled&&!b.config.isOSsupported){return}if(!j){b.log("userId is undefined","error");return}if(c.showHistoryIcon){c.hideHistoryIcon()}c.pushToHistory();c.owner=b.Model.Owner.getInstance();c.publisherId=j;c.confCode=h;
var f=b.View.createEl("div");var k=c.getFormattedTime();var i=c.owner.workspaces[c.subspaceId];i.setViewed(false);b.log("Received view notification for conference"+c.confCode,"info");b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.ViewerNotifyView()});c.shareNotificationPanel=true;
c.resize()};d.paintSharingStopped=function(f){if(!c.owner){c.owner=b.Model.Owner.getInstance()}if(c.owner.isViewingScreen){if(c.subspaceId==c.owner.viewingSubspaceId){c.confCode="";c.toggleViewer(c.confCode,f,true);c.owner.isViewingScreen=false}}c.removeViewerPanel();c.resize()};d.removeViewerPanel=function(){b.log("Removing viewer Panel","info");
b.View.ScreenShare.SSPresenter.removeView({chatWindow:c,view:new b.View.ScreenShare.ViewerNotifyView()});if(c.subspaceId==c.owner.viewingSubspaceId){c.owner.viewingSubspaceId=null}c.shareNotificationPanel=false};d.updateViewerStatus=function(){var f=c.owner.workspaces[c.subspaceId];if(f.publisherstatus=="stopped"){return
}b.log("updateViewerStatus ","info");c.owner.processShareEvent=false;if(c.owner.isViewingScreen&&c.subspaceId==c.owner.viewingSubspaceId){b.View.ScreenShare.SSPresenter.updateView({chatWindow:c,view:new b.View.ScreenShare.ViewerNotifyView()})}else{if(c.confCode==""){var f=c.owner.workspaces[c.subspaceId];
c.confCode=f.confCode;c.publisherId=f.publisherId}b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.ViewerNotifyView()});if(c.subspaceId==c.owner.viewingSubspaceId){c.owner.viewingSubspaceId=null}}c.resize()};d.toggleViewer=function(f,g,h){if(c.composeTextArea.disabled){if(c.screenShareBtn){b.View.removeHandler(c.screenShareBtn,"click",c.toggleShare)
}return}if(c.owner.isSharingScreen){b.log("Screen sharing in progress, can't initiate viewer at this moment","info");return}if(c.owner.isViewingScreen&&c.owner.viewingSubspaceId&&c.subspaceId!=c.owner.viewingSubspaceId&&!h){b.log("Screen viewing in progress, can't initiate another viewer at this moment","info");
return}if(!b.View.hasClass(c.viewNofityDisable,"hide")){b.log("some other screen sharing session");return}if(c.owner.viewingSubspaceId&&c.subspaceId!=c.owner.viewingSubspaceId){b.log("Subspace not matching","info");return}b.log("Joining Conference: "+f,"info");if(c.showHistoryIcon){c.hideHistoryIcon()
}c.pushToHistory();c.owner.publisherId=g;c.confCode=f;if(!h){if(c.owner.processShareEvent){b.log("Some event in progress","info");return}c.owner.processShareEvent=true}if(!c.owner.isViewingScreen){b.View.ScreenShare.SSPresenter.appendView({chatWindow:c,view:new b.View.ScreenShare.EnvironmentCheckView()});
c.owner.isViewingScreen=true;c.owner.viewingSubspaceId=c.subspaceId}else{if(!h){return}c.owner.isViewingScreen=false;c.owner.processShareEvent=false}b.View.ScreenShare.toggleView(c.subspaceId,f);b.View.ScreenShare.startAckTimer()};d.disableScreenShare=function(){if(c.screenShareBtn){b.View.removeHandler(c.screenShareBtn,"click",c.toggleShare);
if((c.owner.isSharingScreen&&c.owner.sharingSubspaceId&&c.subspaceId!=c.owner.sharingSubspaceId)||(c.owner.isViewingScreen&&c.owner.viewingSubspaceId&&c.subspaceId!=c.owner.viewingSubspaceId)){c.disableNotification()}else{c.enableNotification()}}};d.enableScreenShare=function(){if(c.screenShareBtn&&!c.composeTextArea.disabled){b.View.addHandler(c.screenShareBtn,"click",c.toggleShare);
c.screenShareBtn.title=presence.getCatalog("StartShare");b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.viewNofityDisable,"hide","add")}};d.disableNotification=function(){b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.viewNofityDisable,"hide","remove");b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.shareMessage,"cursor_default","add");
c.screenShareBtn.title=b.getCatalog("AnotherSession")};d.enableNotification=function(){b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.viewNofityDisable,"hide","add");b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.shareMessage,"cursor_default","remove")};d.adjustHeightOnShare=function(g){var f;
c.sharePanelHeight=(c.sharePanel.clientHeight)?c.sharePanel.clientHeight:41;if(g==true){f=(parseInt(c.chatPanelContainer.style.height)+c.sharePanelHeight)}else{f=(parseInt(c.chatPanelContainer.style.height)-c.sharePanelHeight)}if(!b.View.PopOutWidget.active){if(f<presence.config.chatWindowHeight-c.sharePanelHeight){f=presence.config.chatWindowHeight
}if(f>presence.config.maxChatWindowHeight-c.sharePanelHeight){f=presence.config.maxChatWindowHeight}}c.chatPanelContainer.style.height=f+"px";if(typeof c.composeTextArea.heightChanged=="function"){c.composeTextArea.heightChanged(f)}};d.checkAnyShareActivity=function(){if(b.config.screenShareEnabled&&b.config.isOSsupported){c.sharePanel.appendChild(c.shareStatus);
if((c.owner.isSharingScreen||c.owner.isViewingScreen)){if(c.owner.viewingSubspaceId&&c.owner.viewingSubspaceId!=c.subspaceId){b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.screenShareBtn,"disabled","add");c.disableScreenShare()}if(c.owner.sharingSubspaceId&&c.owner.sharingSubspaceId!=c.subspaceId){b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.screenShareBtn,"disabled","add");
c.disableScreenShare()}}else{if(c.owner.workspaces[c.subspaceId]&&c.owner.workspaces[c.subspaceId].publisherstatus!="started"){b.View.ScreenShare.SSPresenter.addOrRemoveClassOn(c.screenShareBtn,"disabled","remove");c.enableScreenShare();c.removeViewerPanel()}else{c.enableNotification()}}}};d.cancelError=function(f){try{if(f){b.View.stopEventPropogation(f)
}if(b.View.ScreenShare.activity==b.View.ScreenShare.SHARE_ACTIVTITY){c.owner.isSharingScreen=false;c.paintPublisherStatus()}else{if(b.View.ScreenShare.activity==b.View.ScreenShare.VIEW_ACTIVTITY){c.owner.isViewingScreen=false;c.updateViewerStatus()}}b.View.ScreenShare.resetStateValues()}catch(g){b.log("-->SSChatWindow-->cancelError-> Error on cancel Error panel :"+g)
}}};b.View.SSChatWindow=a})(presence);(function(a){var b=function(){this.appendView=function(c){if(!c.view||!c.chatWindow){return}try{var g=c.chatWindow;var d=g.currentView;if(d&&d!=null){this.removeView({view:d,chatWindow:g})}var h=c.view;g.currentView=h;if(c.message){h.failMessage=c.message}if(h!=null){h.add(g)
}}catch(f){a.log("SSPresenter->appendView : problem in appendVivew to chatwindow "+f)}};this.removeView=function(d){if(!d.view||!d.chatWindow){return}try{d.chatWindow.currentView=null;var c=d.view;this.resetState(d.chatWindow);if(c!=null){c.remove(d.chatWindow)}}catch(f){a.log("SSPresenter->removeView : problem in removeView from chatwindow "+f)
}};this.updateView=function(d){if(!d.view||!d.chatWindow){return}try{var c=d.view;d.chatWindow.currentView=c;if(c!=null){c.update(d.chatWindow)}}catch(f){a.log("SSPresenter->updateView : problem in updateView from chatwindow "+f)}};this.resetState=function(c){if(!c){return}if(c.sharePanel!=null){if(!a.View.hasClass(c.sharePanel,"hide")){c.adjustHeightOnShare(true)
}c.sharePanel.className="share_status_bar hide";c.viewNofityDisable.className="share_notification_disable hide";c.shareStatus.className="standard_button box_shadow_none";c.shareStatusIcon.className="screen_share_loading float_left";c.shareMessage.className="status_message_style";c.viewText.className="view_text";
c.shareMessage.title="";this.addOrRemoveClassOn(c.screenShareBtn,"cursor_default","remove");this.addOrRemoveClassOn(c.screenShareBtn,"share","remove");c.screenShareBtn.title=a.getCatalog("StartShare");c.sharePanel.onclick=function(){};c.shareMessage.onclick=function(){};c.scrollToBottom()}};this.addOrRemoveClassOn=function(d,f,g){var c=a.View.hasClass(d,f);
if(g=="add"&&!c){a.View.addClass(d,f);return true}else{if(g=="remove"&&c){a.View.removeClass(d,f);return true}}return false}};a.View.ScreenShare.SSPresenter=new b()})(presence);(function(a){var b=a.View.ScreenShare.SSPresenter;var d=function(){this.add=function(k){if(!k){return}if(!a.config.screenShareEnabled&&!a.config.isOSsupported){a.log("BaseView.BaseView--> Screenshare is not enabled","info");
return}k.screenView=a.View.createEl("img",{id:"presence_"+k.id+"_screen_view",className:"screen_view",src:a.imageLocation+"/1pxDummy.png",alt:""});k.viewText=a.View.createEl("span",{id:"presence_"+k.id+"_view_text",className:"view_text"});k.environmentAddtionalTxt=a.View.createEl("span",{id:"presence_"+k.id+"_environment_add_txt",className:"environment_add_txt"});
k.sharePanel=a.View.getEl("presence_"+k.id+"_share_pannel");k.screenShareBtn=a.View.getEl("presence_"+k.id+"_screen_share");k.shareStatus=a.View.createEl("div",{id:"presence_"+k.id+"_share_status",className:"standard_button box_shadow_none"});k.shareStatusIcon=a.View.createEl("span",{id:"presence_"+k.id+"_share_status_icon",className:"screen_share_loading float_left"});
k.shareStatus.appendChild(k.shareStatusIcon);k.shareMessage=a.View.createEl("span",{id:"presence_"+k.id+"_status_message",className:"status_message_style"});k.shareMessage.appendChild(k.viewText);k.shareStatus.appendChild(k.shareMessage);k.viewNofityDisable=a.View.createEl("span",{id:"presence_"+k.id+"_view_disable",className:"share_notification_disable hide"});
k.viewNofityDisable.title=a.getCatalog("AnotherSession");k.sharePanel.appendChild(k.viewNofityDisable);k.ssErrorCloseimg=a.View.createEl("img",{id:"presence_"+k.id+"_sserror_close",className:"sserror_close_hide",src:a.imageLocation+"/1pxDummy.png",alt:a.getCatalog("Close")});k.sharePanel.appendChild(k.ssErrorCloseimg);
k.stopShareConfirmation=a.View.createEl("div",{className:"stop_share_confirmation hide",id:"presence_"+k.id+"_stop_share_confirmation"})};this.remove=function(k){};this.update=function(k){}};var c=function(){this.add=function(k){if(!k){return}a.View.addClass(k.screenShareBtn,"share");a.View.WindowManager.disableShare(k.subspaceId);
k.shareMessage.innerHTML="";k.sharePanel.appendChild(k.shareStatus);k.viewText.innerHTML=a.getCatalog("Environmentcheck");k.viewText.title=a.getCatalog("Environmentcheck");k.shareMessage.appendChild(k.viewText);k.environmentAddtionalTxt.innerHTML="("+a.getCatalog("EnvcheckAdditionText")+")";k.shareMessage.appendChild(k.environmentAddtionalTxt);
b.addOrRemoveClassOn(k.sharePanel,"share_panel","add");b.addOrRemoveClassOn(k.viewText,"view_text_extra","add");b.addOrRemoveClassOn(k.screenShareBtn,"share","add");if(b.addOrRemoveClassOn(k.shareStatusIcon,"share_error","remove")){b.addOrRemoveClassOn(k.shareStatusIcon,"screen_share_loading","add")}b.addOrRemoveClassOn(k.shareStatusIcon,"environment_check_icon","add");
b.addOrRemoveClassOn(k.shareStatus,"environment_check","add");b.addOrRemoveClassOn(k.shareStatus,"standard_button","remove");b.addOrRemoveClassOn(k.shareStatus,"progress","add");b.addOrRemoveClassOn(k.screenShareBtn,"cursor_default","add");k.screenShareBtn.title="";b.addOrRemoveClassOn(k.shareStatusIcon,"hide","remove");
b.addOrRemoveClassOn(k.sharePanel,"on_failed","remove");if(b.addOrRemoveClassOn(k.sharePanel,"hide","remove")){k.adjustHeightOnShare(false);k.scrollToBottom()}};this.remove=function(k){if(!k){return}b.addOrRemoveClassOn(k.viewText,"view_text_extra","remove");b.addOrRemoveClassOn(k.shareStatus,"environment_check","remove");
k.shareMessage.removeChild(k.environmentAddtionalTxt);b.addOrRemoveClassOn(k.shareStatus,"standard_button","add");b.addOrRemoveClassOn(k.shareStatusIcon,"environment_check_icon","remove");if(!k.owner.isSharingScreen){a.View.removeClass(k.screenShareBtn,"share");k.screenShareBtn.title=""}k.viewText.innerHTML="";
k.viewText.title=""};this.update=function(k){if(!k){return}}};var j=function(){this.add=function(k){if(!k){return}a.View.addClass(k.screenShareBtn,"share");a.View.WindowManager.disableShare(k.subspaceId);k.shareMessage.innerHTML="";k.sharePanel.appendChild(k.shareStatus);k.viewText.innerHTML=a.getCatalog("StartingShare");
k.shareMessage.appendChild(k.viewText);b.addOrRemoveClassOn(k.sharePanel,"share_panel","add");b.addOrRemoveClassOn(k.screenShareBtn,"share","add");if(b.addOrRemoveClassOn(k.shareStatusIcon,"share_error","remove")){b.addOrRemoveClassOn(k.shareStatusIcon,"screen_share_loading","add")}b.addOrRemoveClassOn(k.shareStatus,"progress","add");
b.addOrRemoveClassOn(k.screenShareBtn,"cursor_default","add");k.screenShareBtn.title="";b.addOrRemoveClassOn(k.shareStatusIcon,"hide","remove");b.addOrRemoveClassOn(k.sharePanel,"on_failed","remove");if(b.addOrRemoveClassOn(k.sharePanel,"hide","remove")){k.adjustHeightOnShare(false);k.scrollToBottom()
}};this.remove=function(k){if(!k){return}if(!k.owner.isSharingScreen){a.View.removeClass(k.screenShareBtn,"share");k.screenShareBtn.title=""}k.viewText.innerHTML=""};this.update=function(k){if(!k){return}}};var i=function(){this.add=function(k){if(!k){return}k.shareMessage.innerHTML="";k.sharePanel.title="";
k.viewText.innerHTML=presence.getCatalog("OnAir");k.viewText.title="";k.onAirImg=a.View.createEl("img",{id:"presence_"+k.id+"_ss_onAirImg",className:"ss_onAir",src:a.imageLocation+"/1pxDummy.png",alt:presence.getCatalog("OnAir")});k.shareMessage.appendChild(k.onAirImg);k.shareMessage.appendChild(k.viewText);
b.addOrRemoveClassOn(k.sharePanel,"share_panel","remove");k.shareStatus.className="share_status";b.addOrRemoveClassOn(k.shareStatus,"progress","remove");b.addOrRemoveClassOn(k.sharePanel,"on_air","add");if(b.addOrRemoveClassOn(k.sharePanel,"on_failed","remove")){k.shareMessage.innerHTML="";k.shareMessage.appendChild(k.viewText)
}b.addOrRemoveClassOn(k.screenShareBtn,"cursor_default","add");b.addOrRemoveClassOn(k.screenShareBtn,"share","add");k.screenShareBtn.title="";b.addOrRemoveClassOn(k.shareStatusIcon,"hide","add");b.addOrRemoveClassOn(k.sharePanel,"cursor_default","add");if(b.addOrRemoveClassOn(k.sharePanel,"hide","remove")){k.adjustHeightOnShare(false);
k.scrollToBottom()}};this.remove=function(k){if(!k){return}k.shareMessage.removeChild(k.onAirImg);if(!k.owner.isSharingScreen){a.View.removeClass(k.screenShareBtn,"share");k.screenShareBtn.title=""}k.viewText.innerHTML=""};this.update=function(k){}};var g=function(){this.add=function(m){if(!m){return
}m.shareMessage.innerHTML="";m.shareMessage.appendChild(m.viewText);var k="";var l="";if(m.owner.id==m.publisherId){k=a.getCatalog("Your")}else{k=a.View.escapeHtml(m.owner.users[m.publisherId].getName());l=(k.length>12)?k.substr(0,9)+"...'s":k+"'s"}m.userScreenTxt=a.getCatalog("UserScreen",l);m.viewText.innerHTML=a.getCatalog("View")+m.userScreenTxt;
m.viewText.title=a.getCatalog("View")+a.getCatalog("UserScreen",k);b.addOrRemoveClassOn(m.sharePanel,"viewer_panel","add");m.shareMessage.title=a.getCatalog("StartView");m.lastMessageFrom=null;if(!m.screenShareBtn){m.screenShareBtn=a.View.getEl("presence_"+m.id+"_screen_share")}if(b.addOrRemoveClassOn(m.screenShareBtn,"disabled","add")){m.disableScreenShare()
}if(m.screenShareBtn.title==a.getCatalog("StartShare")){m.screenShareBtn.title=""}b.addOrRemoveClassOn(m.screenShareBtn,"share","add");b.addOrRemoveClassOn(m.shareStatusIcon,"hide","add");b.addOrRemoveClassOn(m.shareMessage,"cursor_pointer","add");m.shareMessage.onclick=function(n){a.View.stopEventPropogation(n);
m.toggleViewer(m.confCode,m.publisherId,false)};if(b.addOrRemoveClassOn(m.sharePanel,"hide","remove")){m.adjustHeightOnShare(false);m.scrollToBottom()}a.View.WindowManager.enableShare(m.subspaceId,false)};this.remove=function(k){if(!k){return}k.sharePanel.title="";k.viewText.title="";if(k.owner.isSharingScreen==false&&k.owner.isViewingScreen==false){if(b.addOrRemoveClassOn(k.screenShareBtn,"disabled","remove")){k.enableScreenShare()
}b.addOrRemoveClassOn(k.screenShareBtn,"share","remove")}k.shareMessage.innerHTML="";k.screenShareBtn.title=presence.getCatalog("StartShare")};this.update=function(l){if(!l){return}if(l.owner.isViewingScreen&&l.subspaceId==l.owner.viewingSubspaceId){b.addOrRemoveClassOn(l.screenView,"progress","remove");
b.addOrRemoveClassOn(l.sharePanel,"viewer_panel","add");b.addOrRemoveClassOn(l.screenShareBtn,"share","add");l.shareMessage.innerHTML="";l.shareMessage.appendChild(l.viewText);l.shareMessage.onclick=function(){};l.sharePanel.onclick=function(){};b.addOrRemoveClassOn(l.shareStatusIcon,"hide","add");b.addOrRemoveClassOn(l.shareMessage,"cursor_pointer","remove");
b.addOrRemoveClassOn(l.shareStatus,"progress","remove");l.viewText.innerHTML=a.getCatalog("Viewing")+l.userScreenTxt;var k=a.View.escapeHtml(l.owner.users[l.publisherId].getName());l.viewText.title=a.getCatalog("Viewing")+a.getCatalog("UserScreen",k);l.shareMessage.title="";if(b.addOrRemoveClassOn(l.sharePanel,"hide","remove")){l.adjustHeightOnShare(false);
l.scrollToBottom()}a.View.WindowManager.disableShare(l.subspaceId)}}};var h=function(){this.add=function(k){if(!k){return}b.addOrRemoveClassOn(k.screenShareBtn,"share","add");b.addOrRemoveClassOn(k.shareStatus,"progress","add");b.addOrRemoveClassOn(k.sharePanel,"viewer_panel","add");a.View.WindowManager.disableShare(k.subspaceId);
k.shareMessage.innerHTML="";k.shareMessage.appendChild(k.viewText);k.viewText.innerHTML=a.getCatalog("Loading")+k.userScreenTxt;k.viewText.title="";if(b.addOrRemoveClassOn(k.shareStatusIcon,"share_error","remove")){a.View.addClass(k.shareStatusIcon,"screen_share_loading")}b.addOrRemoveClassOn(k.shareStatusIcon,"hide","remove");
b.addOrRemoveClassOn(k.sharePanel,"on_failed","remove");if(b.addOrRemoveClassOn(k.sharePanel,"hide","remove")){k.adjustHeightOnShare(false);k.scrollToBottom()}};this.remove=function(k){if(!k){return}a.View.WindowManager.enableShare(k.subspaceId);k.shareMessage.innerHTML="";k.shareMessage.appendChild(k.viewText);
k.viewText.innerHTML="";k.viewText.title=""};this.update=function(k){}};var f=function(){this.failMessage=null;this.isRetryClicks=false;var k=this;this.add=function(r){if(!r||!this.failMessage){return}r.shareMessage.innerHTML="";r.shareMessage.onclick=function(){};r.viewText.innerHTML=this.failMessage;
r.viewText.title=this.failMessage;b.addOrRemoveClassOn(r.viewText,"view_text_error","add");b.addOrRemoveClassOn(r.shareStatusIcon,"hide","remove");b.addOrRemoveClassOn(r.ssErrorCloseimg,"sserror_close_hide","remove");b.addOrRemoveClassOn(r.ssErrorCloseimg,"sserror_close","add");r.shareStatus.className="share_status";
b.addOrRemoveClassOn(r.shareStatusIcon,"share_error","add");b.addOrRemoveClassOn(r.sharePanel,"on_failed","add");b.addOrRemoveClassOn(r.screenShareBtn,"share","add");var p=a.View.createEl("span");var m=a.View.createEl("span",{className:"ss_link"});var l=this._getHelpLink();if(l!=-1){var q=(a.getCatalog("JavaPluginDisabled")==this.failMessage||a.getCatalog("JavaSettingsError")==this.failMessage)?a.getCatalog("Howto"):a.getCatalog("Help");
m.innerHTML='<a class="ss_link" href="'+l+'" target="_blank" >'+q+"</a>"}else{m.innerHTML=a.getCatalog("Retry");m.onclick=function(t){a.View.stopEventPropogation(t);k.isRetryClicks=true;r.owner.processShareEvent=false;if(r.owner.isSharingScreen&&r.owner.sharingSubspaceId){r.owner.isSharingScreen=false;
r.toggleShare(t,false)}else{if(r.owner.isViewingScreen&&r.owner.viewingSubspaceId){r.owner.isViewingScreen=false;subspaceObj=r.owner.workspaces[r.owner.viewingSubspaceId];r.toggleViewer(subspaceObj.confCode,subspaceObj.publisherId,false)}}}}var o=a.View.createEl("span",{className:"pipe"});o.innerHTML=" | ";
var n=a.View.createEl("span",{className:"ss_feedback_link"});n.innerHTML='<a class="ss_link" href="'+a.config.SSFeedbackURL+'" target="_blank" >'+a.getCatalog("Feedback")+"</a>";r.ssErrorCloseimg.onclick=function(t){a.View.stopEventPropogation(t);a.View.ScreenShare.SSPresenter.removeView({chatWindow:r,view:new a.View.ScreenShare.ErrorView()})
};p.appendChild(m);p.appendChild(o);p.appendChild(n);r.shareMessage.appendChild(r.viewText);r.shareMessage.appendChild(p);if(b.addOrRemoveClassOn(r.sharePanel,"hide","remove")){r.adjustHeightOnShare(false);r.scrollToBottom()}};this._paintErrorMessage=function(n){var o='<img class="chat_error error_16 float_left" alt="error" src="'+a.imageLocation+'/1pxDummy.png" />';
var m=a.View.createEl("div",{className:"status_error"});a.View.append(m,this.failMessage);var l=a.View.createEl("div",{className:"chat_event_error_msg"});this.failMessage=a.View.escapeHtml(this.failMessage);a.View.append(l,o);l.appendChild(m);n.chatPanel.appendChild(l);n.scrollToBottom()};this.remove=function(l){if(!l){return
}b.addOrRemoveClassOn(l.screenShareBtn,"share","remove");b.addOrRemoveClassOn(l.ssErrorCloseimg,"sserror_close_hide","add");l.viewText.title="";if(!this.isRetryClicks){l.cancelError()}l.enableScreenShare();k.isRetryClicks=false};this.update=function(l){};this._getHelpLink=function(){var m=["JavaPluginDisabled","JavaNotInstalled","RestrictAccess","OSNotSupported","JavaSettingsError"];
for(var n=0;n<m.length;n++){if(a.getCatalog(m[n])==this.failMessage){var l=a.config.SSHelpLinks[m[n]];if(l){if(a.osName.indexOf("Mac")!=-1&&l.MAC){return l.MAC}else{if(a.osName.indexOf("Win")!=-1&&l.WIN){return l.WIN}else{return l.MACWIN}}}else{return a.config.SSHelpURL}}}return -1}};a.View.ScreenShare.BaseView=d;
a.View.ScreenShare.PublisherLoadingView=j;a.View.ScreenShare.PublisherSuccessView=i;a.View.ScreenShare.ViewerNotifyView=g;a.View.ScreenShare.ViewerLoadingView=h;a.View.ScreenShare.ErrorView=f;a.View.ScreenShare.EnvironmentCheckView=c})(presence);(function(b){var a=function(d){d.publisherId=null;d.confCode=null;
d.publisherstatus="";d.publisherDeviceId="";d.propData;d.viewed=false;var c=d;d.setSubspaceProperties=function(g,h,f){if(g.sourceId){c.publisherId=g.sourceId}if(g.properties){c.publisherstatus=g.properties.publisherstatus;if(g.properties.ssdata){var i=JSON.parse(g.properties.ssdata);c.confCode=i.confCode;
c.publisherId=i.publisherId;c.publisherDeviceId=i.publisherDeviceId}}if(h){c.addShareHistory(c.publisherId,c.publisherstatus,c.publisherDeviceId,"publisher");if(f==="changed"){b.EventManager.trigger("event.user.subspace.properties.changed",c.toJSON())}else{if(f==="deleted"){c.publisherstatus="stopped";
b.EventManager.trigger("event.user.subspace.properties.deleted",c.toJSON())}}}};d.setViewed=function(f){c.viewed=f};d.processNotifyDeviceEvent=function(f){if(f.confCode){c.confCode=f.confCode}if((f.status&&f.status=="stop")&&(f.type&&f.type=="publisher")){c.confCode=null}var g=c.toJSON();g.data=f;b.EventManager.trigger("event.user.device.notify",g)
}};b.Model.SSWorkspace=a})(presence);(function(b){var k={};var d={};k.isReady=null;k.isHoverEnabled=canvas_window.umps_config.isChatUiEnabled!="false";k.executeAction=function(t){d=b.Model.Owner.getInstance();if(!b.Controller.ownerObj){if(t&&t.callbackFn){k.callback(t.callbackFn,{result:false,errorCode:"errorstate"})
}return}if(!k.isOnline()){if(t&&t.callbackFn){k.callback(t.callbackFn,{result:false,errorCode:"offline"})}return}var p=h(t,["method","data","callbackFn"]);if(!p.result){if(t&&t.callbackFn){k.callback(t.callbackFn,p)}b.log(p.errorCode,"error");return}b.log("Adapter: "+t.method,"info");if(t.method=="umps.presence.setPresenceStatus"){o(t.data,t.callbackFn)
}else{if(t.method=="umps.presence.getPresenceStatus"){r(t.data,t.callbackFn)}else{if(t.method=="umps.presence.getGroupPresenceStatus"){m(t.data,t.callbackFn)}else{if(t.method=="umps.chatter.addFollowee"){l(t.data,t.callbackFn)}else{if(t.method=="umps.chatter.removeFollowee"){i(t.data,t.callbackFn)}else{if(t.method=="umps.presence.trackPresence"){c(t.data,t.callbackFn)
}else{if(t.method=="umps.chat.startChat"){if(t.data.chatType&&t.data.chatType=="group"){a(t.data,t.callbackFn)}else{q(t.data,t.callbackFn)}}else{if(t.method=="umps.chat.startGroupChat"){a(t.data,t.callbackFn)}}}}}}}}};k.callback=function(t,p){if(typeof t=="function"){t(p)}};var o=function(u,v){var t=h(u,["status","message"]);
if(!t.result){k.callback(v,t)}var p={presenceStatus:u};new b.Controller.ApiGateway().makeAPICall("setPresence",p,null,v,v);b.Controller.call({method:"setPresence",data:p,successCallBack:v,failCallBack:v})};var r=function(u,v){var t=h(u,["entityList"]);if(!t.result){k.callback(v,t)}var p={userIds_list:u.entityList};
b.Controller.call({method:"getPresences",data:{},urlData:p,successCallBack:function(x){for(var w in x.data){if(x.data[w].presence.aggregatedChannelsState=="idle"){x.data[w].presence.status=100}}v(x)},failCallBack:v})};var m=function(v,x){var t=h(v,["entityList"]);if(!t.result){k.callback(x,t)}var p=new Array();
for(var u=0;u<v.entityList.length;u++){var w=d.groups[v.entityList[u]];if(w){if(w.activeCount>1){p.push({entityID:w.groupId,presence:{status:10,message:"available"}})}else{p.push({entityID:w.groupId,presence:{status:20,message:"offline"}})}}}x({result:true,method:"umps.presence.getGroupPresenceStatus",data:p})
};var c=function(v,w){var u=h(v,["entityList"]);if(!u.result){k.callback(w,u)}var t={memberIds:v.entityList,subspaceId:b.Controller.ownerObj.defaultSubSpaceId};var p={chatId:b.Controller.ownerObj.defaultSubSpaceId};b.Controller.call({method:"addMemberToWorkspace",data:t,urlData:p,successCallBack:w,failCallBack:w})
};var l=function(v,w){var u=h(v,["entityID"]);if(!u.result){k.callback(w,u)}var t={subspaceId:b.Controller.ownerObj.defaultSubSpaceId};var p={followeeId:v.entityID};b.Controller.call({method:"addroster",data:t,urlData:p,successCallBack:w,failCallBack:w})};var i=function(v,w){var u=h(v,["entityID"]);if(!u.result){k.callback(w,u)
}var t={subspaceId:b.Controller.ownerObj.defaultSubSpaceId};var p={followeeId:v.entityID};b.Controller.call({method:"removeroster",data:t,urlData:p,successCallBack:w,failCallBack:w})};var q=function(u,v){if(!f()){return}var u=u;var v=v;var t=h(u,["entityID"]);if(!t.result){k.callback(v,t)}if(d.users[u.entityID]){b.View.WindowManager.searchSubspace(u.entityID);
v({result:true,method:"umps.chat.startChat",data:{entityID:u.entityID}})}else{var p={userId:u.entityID};b.Controller.call({method:"getmemberdetails",urlData:p,successCallBack:function(x){x=x.data;if(x[u.entityID].presence.aggregatedChannelsState=="idle"&&x[u.entityID].presence.status!=100){x[u.entityID].presence.status=b.presenceStatus.IDLE
}var w=new b.Model.User({id:u.entityID,name:x[u.entityID].screenName,fName:x[u.entityID].firstName,lName:x[u.entityID].lastName,picture:x[u.entityID].thumbnailUrl,presenceStatus:x[u.entityID].presence.status,presenceMessage:x[u.entityID].presence.message});w.isAnonymous=!x[u.entityID].isFollowee;d.addToUserList(w);
b.View.WindowManager.searchSubspace(u.entityID);v({result:true,method:"umps.chat.startChat",data:{entityID:u.entityID}})},failCallBack:function(w){v({result:false,method:"umps.chat.startChat",data:{entityID:u.entityID}})}})}};var a=function(t,u){if(!f()){return}t.entityID=t.groupId||t.entityID;var p=h(t,["entityID"]);
if(!p.result){k.callback(u,p)}if(d.groups[t.entityID]){b.View.WindowManager.joinGroupChat(t.entityID);u({result:true,method:"umps.chat.startGroupChat",data:{groupId:t.entityID}})}else{u({result:false,method:"umps.chat.startGroupChat",errorCode:"NotAMember"})}};var f=function(){var t=true;if(b.View.PopOutWidget.popIn==true){var p=confirm(presence.config.catalog.popInConfirmMessage);
if(p==true){b.View.PopOutWidget.close()}else{t=false}}return t};k.bind=function(p,t){var t=t;if(p=="event.user.presence.status"){b.EventManager.bind(p,function(u,w){var v={};v.entityID=w.id;v.status=w.presenceStatus;v.message=w.presenceMessage;t(u,[v])})}else{if(p=="event.bootstrap"){b.EventManager.bind(p,function(u,v){if(t&&typeof t=="function"){t(u,true)
}})}else{if(p=="event.user.sfdc.notification"){if(!presence.config.enableNotifications){presence.config.enableNotifications=true;k.subscribeNotifications();b.EventManager.bind(p,function(u,v){t(v)})}}else{b.EventManager.bind(p,t)}}}};k.subscribeNotifications=function(){var p={appType:"notifications"};
new b.Controller.ApiGateway().makeAPICall("appsubscriptions",p,null,function(t){if(t&&t.result){b.log("subscribeNotifications:Success","info")}else{b.log("ApiCall - Subscribe To notification failed","error")}},function(){b.log("ApiCall - Subscribe To notification failed","error")})};k.log=function(t,p){b.log(t,p)
};k.unBind=function(p,t){var t=t;b.EventManager.unbind(p,t)};k.isOnline=function(){return(d.presenceStatus==20||!k.isReady)?false:true};k.isMuted=function(p){d=b.Model.Owner.getInstance();return d.getGroupById(p).muted};k.fireBootstrap=function(){b.View.Actions.showWidgetLoader();b.Controller.init(controllerInitData,true)
};k.escapeHTML=function(p){return b.View.escapeHtml(p)};k.getOwnerId=function(){d=b.Model.Owner.getInstance();return d.id};k.getMyGroups=function(){d=b.Model.Owner.getInstance();return d.groups};k.getWidgetMode=function(){if(canvas_window.umps_config.isChatUiEnabled=="false"){return"disabled"}else{return"enabled"
}};k.isGroupChatEnabled=function(){if(canvas_window.umps_config.isGroupChatEnabled=="false"){return false}else{return true}};k.getJiffyMeasures=function(){return Jiffy?Jiffy.getMeasures():{}};k.clearJiffyMeasures=function(){return Jiffy?Jiffy.clearMeasures():{}};var h=function(v,w){var u=true;var p=new Array();
for(var t=0;t<w.length;t++){if(v[w[t]]==undefined||v[w[t]]==null){u=false;p.push(w[t])}}return{result:u,errorCode:"missingParams: "+p.join(", ")}};k.assetsURL=function(){return b.imageLocation};k.getClientId=function(){return b.getClientId()};k.shareAction=function(t){d=b.Model.Owner.getInstance();if(!b.Controller.ownerObj){if(t&&t.callbackFn){k.callback(t.callbackFn,{result:false,errorCode:"errorstate"})
}return}if(!k.isOnline()){if(t&&t.callbackFn){k.callback(t.callbackFn,{result:false,errorCode:"offline"})}return}var p=h(t,["method","data","callbackFn"]);if(!p.result){if(t&&t.callbackFn){k.callback(t.callbackFn,p)}b.log(p.errorCode,"error");return}b.log("Adapter: "+t.method,"info");if(t.method=="logToConsole"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info")
}else{if(t.method=="onError"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info");b.View.ScreenShare.onError(t.data.errorCode,true)}else{if(t.method=="onSuccess"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info");Jiffy.measure("Done","AppletProcessTime");b.View.ScreenShare.updateStatus("StartingSession");
Jiffy.mark("SSclientStart");b.View.ScreenShare.startAckTimer()}else{if(t.method=="onAppletInit"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info");Jiffy.measure("Done","AppletLoadTime");Jiffy.mark("AppletProcessTime");d.isAppletLoading=false;b.View.ScreenShare.startAckTimer()}else{if(t.method=="onInstallUpgradeComplete"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info");
Jiffy.measure("Done","InstallUpgradeProcessTime");b.View.ScreenShare.startAckTimer()}else{if(t.method=="onInstallUpgradeInit"){b.log("request.method "+t.method+" "+b.getMillisecToHours(),"info");Jiffy.mark("InstallUpgradeProcessTime");b.View.ScreenShare.updateStatus("InstallPlugin");b.View.ScreenShare.startAckTimer(5*60000)
}}}}}}};var j=function(){};var n=null;j.bind=function(t,u){try{if(canvas_window.umps&&canvas_window.umps.isReady==true){g(t,u)}else{if(!n){canvas_window.clearInterval(n);n=canvas_window.setInterval(function(){if(canvas_window.umps&&canvas_window.umps.isReady==true){canvas_window.clearInterval(n);g(t,u)
}},100)}}}catch(p){}};var g=function(p,t){k.bind(p,t);k.bind("event.bootstrap",k.subscribeNotifications)};if(!canvas_window.RealTimeEventLib){canvas_window.RealTimeEventLib=j}b.Adapter=k;canvas_window.umps=k})(presence);var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";
var l,j,g,k,h,f,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){l=c.charCodeAt(b++);j=c.charCodeAt(b++);g=c.charCodeAt(b++);k=l>>2;h=((l&3)<<4)|(j>>4);f=((j&15)<<2)|(g>>6);d=g&63;if(isNaN(j)){f=d=64}else{if(isNaN(g)){d=64}}a=a+this._keyStr.charAt(k)+this._keyStr.charAt(h)+this._keyStr.charAt(f)+this._keyStr.charAt(d)
}return a},decode:function(c){var a="";var l,j,g;var k,h,f,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){k=this._keyStr.indexOf(c.charAt(b++));h=this._keyStr.indexOf(c.charAt(b++));f=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));l=(k<<2)|(h>>4);j=((h&15)<<4)|(f>>2);
g=((f&3)<<6)|d;a=a+String.fromCharCode(l);if(f!=64){a=a+String.fromCharCode(j)}if(d!=64){a=a+String.fromCharCode(g)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var f=0;f<b.length;f++){var d=b.charCodeAt(f);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);
a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var f=c1=c2=0;while(d<a.length){f=a.charCodeAt(d);if(f<128){b+=String.fromCharCode(f);d++}else{if((f>191)&&(f<224)){c2=a.charCodeAt(d+1);
b+=String.fromCharCode(((f&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((f&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};